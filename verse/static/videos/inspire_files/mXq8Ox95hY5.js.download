;/*FB_PKG_DELIM*/

__d("WAWebFetchQuickPromotionsQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="7364334306986866"}),null);
__d("WAWebFetchQuickPromotionsQuery.graphql",["WAWebFetchQuickPromotionsQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"nux_ids"},{defaultValue:null,kind:"LocalArgument",name:"trigger_context"}],c=[{kind:"Literal",name:"include_holdouts",value:!0},{kind:"Literal",name:"supports_client_side_filters",value:!0},{kind:"Variable",name:"surface_nux_ids",variableName:"nux_ids"},{kind:"Variable",name:"trigger_context",variableName:"trigger_context"}],d={alias:null,args:null,kind:"ScalarField",name:"surface_nux_id",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"client_ttl_seconds",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"priority",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"is_holdout",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"log_eligibility_waterfall",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"start",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"end",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"promotion_id",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"is_server_force_pass",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"ab_prop_name",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"surface_delay_in_seconds",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"encrypted_logging_data",storageKey:null},p=[{alias:null,args:null,kind:"ScalarField",name:"text",storageKey:null}],q=[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPText",selections:p,args:null,argumentDefinitions:[]}],r={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"title",plural:!1,selections:q,storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},t=[{alias:null,args:null,kind:"ScalarField",name:"jpeg_thumbnail",storageKey:null}],u={alias:null,args:null,concreteType:"WAQPMediaDetails",kind:"LinkedField",name:"wa_light_mode_media_details",plural:!1,selections:t,storageKey:null};t={alias:null,args:null,concreteType:"WAQPMediaDetails",kind:"LinkedField",name:"wa_dark_mode_media_details",plural:!1,selections:t,storageKey:null};var v={alias:null,args:null,kind:"ScalarField",name:"accessibility_text_for_image",storageKey:null},w={alias:null,args:null,kind:"ScalarField",name:"is_dismissible",storageKey:null},x={alias:null,args:null,concreteType:"QPContentAttributeDescriptor",kind:"LinkedField",name:"content_attributes",plural:!1,selections:[{alias:null,args:null,concreteType:"WhatsappQPColors",kind:"LinkedField",name:"wa_banner_background_color",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"light_mode_highlight_color",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"dark_mode_highlight_color",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"light_mode_background_color",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"dark_mode_background_color",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wa_primary_cta_alternative_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wa_eligible_duration_after_impression_in_seconds",storageKey:null}],storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},z={alias:null,args:null,concreteType:"WAQPContentAttribute",kind:"LinkedField",name:"wa_qp_content_attributes_do_not_use",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},y],storageKey:null},A={alias:null,args:null,kind:"ScalarField",name:"clause_type",storageKey:null};y=[{alias:null,args:null,kind:"ScalarField",name:"filter_name",storageKey:null},{alias:null,args:null,concreteType:"QPFilterParameter",kind:"LinkedField",name:"parameters",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},y],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"passes_if_client_not_supported",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"filter_result",storageKey:null}];var B={kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPWAFilterClause",selections:[A,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilter",kind:"LinkedField",name:"filters",plural:!0,selections:[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPWAFilter",selections:y,args:null,argumentDefinitions:[]}],storageKey:null}],args:null,argumentDefinitions:[]},C={alias:null,args:null,concreteType:"QPUserInteractionInfo",kind:"LinkedField",name:"user_interaction_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"impression_max_instances",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"impression_count_for_user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"dismiss_max_instances",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"dismiss_click_count_for_user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"primary_click_max_instances",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"primary_click_count_for_user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"secondary_click_count_for_user",storageKey:null}],storageKey:null},D={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"title",plural:!1,selections:p,storageKey:null},E={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};y={alias:null,args:null,concreteType:"QuickPromotionFlattenedFilter",kind:"LinkedField",name:"filters",plural:!0,selections:y,storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"WAWebFetchQuickPromotionsQuery",selections:[{alias:null,args:c,concreteType:"QuickPromotionBatchFetchSurface",kind:"LinkedField",name:"quick_promotion_batch_fetch_root",plural:!0,selections:[d,{alias:null,args:null,concreteType:"QuickPromotionSurfaceEligiblePromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotionSurfaceEligiblePromotionsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{kind:"RequiredField",field:e,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.client_ttl_seconds"},{kind:"RequiredField",field:f,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.priority"},{kind:"RequiredField",field:g,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.is_holdout"},{kind:"RequiredField",field:h,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.log_eligibility_waterfall"},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"TimeRange",kind:"LinkedField",name:"time_range",plural:!1,selections:[{kind:"RequiredField",field:i,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.time_range.start"},{kind:"RequiredField",field:j,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.time_range.end"}],storageKey:null},action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.time_range"},{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"node",plural:!1,selections:[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QuickPromotion",selections:[k,l,m,n,o,{alias:null,args:null,concreteType:"QuickPromotionCreative",kind:"LinkedField",name:"creatives",plural:!0,selections:[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPCreative",selections:[r,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"content",plural:!1,selections:q,storageKey:null},{alias:null,args:null,concreteType:"QuickPromotionAction",kind:"LinkedField",name:"primary_action",plural:!1,selections:[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPAction",selections:[r,s],args:null,argumentDefinitions:[]}],storageKey:null},u,t,v,w],args:null,argumentDefinitions:[]}],storageKey:null},x,z,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"contextual_filters_for_wa_do_not_use",plural:!1,selections:[B,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[B,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[B,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[B],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},C],args:null,argumentDefinitions:[]}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WAWebFetchQuickPromotionsQuery",selections:[{alias:null,args:c,concreteType:"QuickPromotionBatchFetchSurface",kind:"LinkedField",name:"quick_promotion_batch_fetch_root",plural:!0,selections:[d,{alias:null,args:null,concreteType:"QuickPromotionSurfaceEligiblePromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotionSurfaceEligiblePromotionsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[e,f,g,h,{alias:null,args:null,concreteType:"TimeRange",kind:"LinkedField",name:"time_range",plural:!1,selections:[i,j],storageKey:null},{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"node",plural:!1,selections:[k,l,m,n,o,{alias:null,args:null,concreteType:"QuickPromotionCreative",kind:"LinkedField",name:"creatives",plural:!0,selections:[D,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"content",plural:!1,selections:p,storageKey:null},{alias:null,args:null,concreteType:"QuickPromotionAction",kind:"LinkedField",name:"primary_action",plural:!1,selections:[D,s],storageKey:null},u,t,v,w,E],storageKey:null},x,z,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"contextual_filters_for_wa_do_not_use",plural:!1,selections:[A,y,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[A,y,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[A,y,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[A,y],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},C,E],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("WAWebFetchQuickPromotionsQuery_facebookRelayOperation"),metadata:{},name:"WAWebFetchQuickPromotionsQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPAction.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPAction"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPCreative.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPCreative"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPText.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPText"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPWAFilter.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPWAFilter"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPWAFilterClause.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPWAFilterClause"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QuickPromotion.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QuickPromotion"};e.exports=a}),null);
__d("WAWebWamEnumMdLinkDeviceCompanionStage",[],(function(a,b,c,d,e,f){a=Object.freeze({PAIR_SUCCESS_RECEIVED:1,PAIR_DEVICE_SIGN_SENT:2,FIRST_CONNECT:3,UPLOAD_PREKEYS:4,COMPLETE:5,GENERATE_PREKEYS:6,SENT_PREKEYS:7});f.MD_LINK_DEVICE_COMPANION_STAGE=a}),66);
__d("WAWebMdLinkDeviceCompanionWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMdLinkDeviceCompanionStage"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MdLinkDeviceCompanion:[2576,{mdDurationS:[8,a.TYPES.INTEGER],mdLinkDeviceCompanionErrorCode:[6,a.TYPES.INTEGER],mdLinkDeviceCompanionStage:[4,d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE],mdRegAttemptId:[9,a.TYPES.STRING],mdSessionId:[1,a.TYPES.STRING],mdTimestampS:[7,a.TYPES.INTEGER],mdWasUpgraded:[5,a.TYPES.BOOLEAN]},[1,1,1],"regular"]},{MdLinkDeviceCompanion:[]});g.MdLinkDeviceCompanionWamEvent=b}),98);
__d("WAWebWamDeviceLinkReporter",["WABase64","WABinary","WACryptoSha256","WAResolvable","WATimeUtils","WAWebMdLinkDeviceCompanionWamEvent","WAWebWamEnumMdLinkDeviceCompanionStage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=null,i=null,j=null,k=null;function a(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){h=new(d("WAWebMdLinkDeviceCompanionWamEvent").MdLinkDeviceCompanionWamEvent)();a=(yield n(a,b));i={regStartTime:c,sessionId:a}});return l.apply(this,arguments)}function c(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;if(!h)return;yield (b=k)==null?void 0:b.promise;k=new(d("WAResolvable").Resolvable)();j=a;yield p()});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=new(d("WABinary").Binary)();c.writeBuffer(a);c.write("_".charCodeAt(0));c.writeBuffer(b);a=c.readByteArray();b=(yield d("WACryptoSha256").sha256(a));return d("WABase64").encodeB64(b)});return o.apply(this,arguments)}function p(a){if(!h||!i)return;var b=i,c=d("WATimeUtils").unixTimeWithoutClockSkewCorrection()-b.regStartTime;if(j==null)return;h=new(d("WAWebMdLinkDeviceCompanionWamEvent").MdLinkDeviceCompanionWamEvent)({mdDurationS:c,mdSessionId:b.sessionId,mdTimestampS:b.regStartTime,mdLinkDeviceCompanionErrorCode:a==null?0:a,mdLinkDeviceCompanionStage:j});c=h;c.commitAndWaitForFlush(!0);(b=k)==null?void 0:b.resolve();(a!=null||c.mdLinkDeviceCompanionStage===d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE)&&(h=null,i=null,j=null)}g.initDeviceLinkEvent=a;g.setDeviceLinkPairStage=c;g.commitDeviceLinkEvent=p}),98);
__d("WAWebCompanionRegUtils",["WALogger","WAShiftTimer","WATimeUtils","WAWebAdvSignatureApi","WAWebCmd","WAWebLogoutReasonConstants","WAWebSocketLogoutJob","WAWebSocketModel","WAWebUserPrefsIsLoggedIn","WAWebWamDeviceLinkReporter","WAWebWamEnumMdLinkDeviceCompanionStage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync][reg] main screen unblocked in ","ms"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync][reg] begin device pairing latency measurement"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["logout due to initial history sync timeout"]);j=function(){return a};return a}var k=!1,l=!1,m=1e3,n=6e4*3;function o(){d("WALogger").ERROR(j()),void d("WAWebSocketLogoutJob").socketLogout(d("WAWebLogoutReasonConstants").LogoutReason.HistorySyncTimeout)}function a(){k=!1,l=!1}function c(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(k||l)return;yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.FIRST_CONNECT);k=!0;yield d("WAWebAdvSignatureApi").clearADVSecretKey();d("WAWebUserPrefsIsLoggedIn").setIsConnectedAsRegistered(!0)});return p.apply(this,arguments)}function q(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(k||l)return;l=!0;yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData();yield d("WAWebAdvSignatureApi").clearADVSecretKey()});return r.apply(this,arguments)}function e(){new(d("WAShiftTimer").ShiftTimer)(function(){q()}).onOrAfter(m)}var s;function f(){s==null&&(s=self.setTimeout(o,n),d("WAWebCmd").Cmd.on("on_initial_chat_synced",function(){self.clearTimeout(s)}))}function t(){var a=d("WATimeUtils").unixTimeMs();d("WALogger").LOG(i());d("WAWebCmd").Cmd.on("on_critical_sync_done",function(){d("WALogger").LOG(h(),d("WATimeUtils").unixTimeMs()-a)})}g.resetCompanionReg=a;g.startLogin=c;g.startLogout=q;g.logoutAfterValidationFail=e;g.startInitialHistorySyncTimeout=f;g.initDevicePairingLatencyMeasurement=t}),98);
__d("WAWebPassiveModeManager",["Promise","WAAbortError","WALogger","WAPromiseRaceAbort","WAResolvable","WASendPassiveModeProtocol","WAWebCmd","WAWebPageLoadLogging","WAWebWamOfflineResumeReporter"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: setPassiveModeTimeout: config timeout to be ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: send passive active iq"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: _endPassiveMode"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: passive mode end with timeout"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: done"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: end with error ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: abort by disconnect, skip send active"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: complete all tasks"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: failed for single task with ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: start to execute "," passive tasks"]);r=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: enable debug passive mode"]);a=function(){return b};return b}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: register passive task"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: reset status"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: processing tasks finished: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: "," current tasks"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: trying to abort passive mode because of disconnect"]);w=function(){return a};return a}var x=6e4;e=function(){function a(){var a=this;this._disconnectAbortController=new AbortController();this._passiveEndPromise=new(d("WAResolvable").Resolvable)();this._debugPassiveModeEnabled=!1;this._passiveTasks=[];this._passiveModeTimeout=x;d("WAWebCmd").Cmd.on("socket_stream_disconnected",function(){var b;d("WALogger").LOG(w());d("WALogger").LOG(v(),a._passiveTasks.length);d("WALogger").LOG(u(),a._passiveEndPromise.resolveWasCalled());(b=a._disconnectAbortController)==null?void 0:b.abort();a.resetState()})}var e=a.prototype;e.resetState=function(){d("WALogger").LOG(t()),this._passiveTasks=[],this._passiveTimeoutTimer&&(self.clearTimeout(this._passiveTimeoutTimer),this._passiveTimeoutTimer=null),this._debugPassiveModeEnabled=!1,this._passiveEndPromise.resolveWasCalled()||this._passiveEndPromise.resolve(),this._passiveEndPromise=new(d("WAResolvable").Resolvable)(),this._disconnectAbortController=new AbortController()};e.registerPassiveTask=function(a){d("WALogger").LOG(s()),this._passiveTasks.push(a)};e.enableDebugPassiveMode=function(){};e.executePassiveTasks=function(){var a=this;if(!this.shouldConnectAsPassiveMode()){this._passiveEndPromise.resolve();return}d("WAWebPageLoadLogging").startPageLoadQplMeasure("passive_tasks");d("WALogger").LOG(r(),this._passiveTasks.length);void c("WAPromiseRaceAbort")((h||(h=b("Promise"))).all(this._passiveTasks.map(function(a){return a()["catch"](function(a){d("WALogger").ERROR(q(),a)})})),this._disconnectAbortController.signal).then(function(){d("WALogger").LOG(p()),void a._endPassiveMode()})["catch"](d("WAAbortError").catchAbort(function(){d("WALogger").LOG(o()),a._passiveEndPromise.resolve()}))["catch"](function(b){d("WALogger").ERROR(n(),b),void a._endPassiveMode()})["finally"](function(){d("WAWebPageLoadLogging").endPageLoadQplMeasure("passive_tasks"),d("WALogger").LOG(m()),a.resetState()});this._passiveTimeoutTimer=self.setTimeout(function(){d("WALogger").ERROR(l()).sendLogs("passive-timeout"),void a._endPassiveMode(),a.resetState()},this._passiveModeTimeout)};e._endPassiveMode=function(){d("WALogger").LOG(k()),this._passiveEndPromise.resolve(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflinePassiveT(),this._debugPassiveModeEnabled||(d("WALogger").LOG(j()),void d("WASendPassiveModeProtocol").sendPassiveModeProtocol("active"))};e.waitForPassiveTaskEnd=function(){return this._passiveEndPromise.promise};e.shouldConnectAsPassiveMode=function(){return this._debugPassiveModeEnabled||this._passiveTasks.length>0};e.setPassiveModeTimeout=function(a){d("WALogger").LOG(i(),a),this._passiveModeTimeout=a};return a}();f=new e();g.PassiveTaskManager=f}),98);
__d("WAWebABPropsWamGlobals",["WAWebABProps","WAWebWamGlobals"],(function(a,b,c,d,e,f,g){function a(){d("WAWebWamGlobals").Global.set({serviceImprovementOptOut:d("WAWebABProps").getABPropConfigValue("service_improvement_opt_out_flag")})}g.setAbPropDependingGlobalWamAttributes=a}),98);
__d("WAWebAbPropsParsingJob",["WAWebABPropsConfigs"],(function(a,b,c,d,e,f,g){function a(a){var b=new Map();a.forEach(function(a){var c=a.configCode,d=a.configValue;a=a.configExpoKey;b.set(c,{configValue:d,configExpoKey:a})});var c=new Map();Object.keys(d("WAWebABPropsConfigs").ABPropConfigs).map(function(a){a=d("WAWebABPropsConfigs").ABPropConfigs[a][0];var e=b.get(a),f=e==null?void 0:e.configValue;e=e==null?void 0:e.configExpoKey;c.set(a,{configValue:f,configExpoKey:e==null?null:e.toString()})});return c}g.parseABProps=a}),98);
__d("WAWebEncryptedRid",["WABase64","WAWebUserPrefsIndexedDBStorage","WAWebUserPrefsMultiDevice"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set("WAWebEncryptedRid",d("WABase64").encodeB64(a))}function b(){return!d("WAWebUserPrefsMultiDevice").isRegistered()?null:d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get("WAWebEncryptedRid")}g.setEncryptedRid=a;g.getEncryptedRid=b}),98);
__d("WAWebSyncOnABProps",["WALogger","WAWebABProps","WAWebABPropsWamGlobals","WAWebProtobufsE2E.pb","WAWebSendNonMessageDataRequest","WAWebUserPrefsAppStateSync","WAWebUserPrefsCTWA","WAWebUserPrefsTypes","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Recent Stickers: request peer message for recent sticker bootstrap."]);h=function(){return a};return a}function a(a){a!==d("WAWebABProps").getABPropConfigValue("service_improvement_opt_out_flag")&&d("WAWebABPropsWamGlobals").setAbPropDependingGlobalWamAttributes()}function c(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebABProps").getABPropConfigValue("recent_sticker_rollout_phase")<3)return;var a=(yield d("WAWebUserPrefsAppStateSync").getNonCriticalDataSyncStatus());(a==null?void 0:a[d("WAWebUserPrefsTypes").NonCriticalDataSyncStatusType.RECENT_STICKER_INITIALIZED])===d("WAWebUserPrefsTypes").RecentStickerInitializedStatusType.NEED_REQUEST_BOOTSTRAP&&(d("WALogger").LOG(h()),yield d("WAWebSendNonMessageDataRequest").sendPeerDataOperationRequest(d("WAWebProtobufsE2E.pb").Message$PeerDataOperationRequestType.SEND_RECENT_STICKER_BOOTSTRAP,{}))});return i.apply(this,arguments)}function e(a){var b=d("WAWebABProps").getABPropConfigValue("ctwa_ad_account_token_storage_kill_switch_web");b===!0&&a===!1&&d("WAWebUserPrefsCTWA").clearAdAccountToken()}g.handleServiceImprovementOptOutFlagABPropConfigValueChange=a;g.ensureNonCriticalDataSyncIsInitialized=c;g.handleAdAccountTokenStorageKillSwitchABPropConfigValueChange=e}),98);
__d("WAWebAbPropsSyncJob",["Promise","WAGetAbPropsProtocol","WALogger","WAPromiseDelays","WAWebABProps","WAWebABPropsGlobals","WAWebABPropsLocalStorage","WAWebABPropsUpdateFromStorage","WAWebAbPropsParsingJob","WAWebApiAbPropConfig","WAWebApiAbPropEventSamplingConfig","WAWebCmd","WAWebEncryptedRid","WAWebEventSamplingCache","WAWebSyncOnABProps","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["failed to sync ABProps"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["update ABProps config table failed"]);j=function(){return a};return a}d("WAWebCmd").Cmd.on("on_ab_props_update",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.service_improvement_opt_out_flag;a=a.ctwa_ad_account_token_storage_kill_switch_web;yield d("WAWebSyncOnABProps").ensureNonCriticalDataSyncIsInitialized();d("WAWebSyncOnABProps").handleServiceImprovementOptOutFlagABPropConfigValueChange(b);d("WAWebSyncOnABProps").handleAdAccountTokenStorageKillSwitchABPropConfigValueChange(a)});return function(b){return a.apply(this,arguments)}}());function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c;a===void 0&&(a=!0);var e;a&&(e=d("WAWebABPropsLocalStorage").getHash());a=(yield d("WAGetAbPropsProtocol").getAbPropsProtocol(e));if(!a.success)return!1;a=a.value;var f=a.abKey,g=a.hash,i=a.refresh,k=a.refreshId,l=a.props,m=a.samplingConfigs;a=a.erid;a=a==null?(h||(h=b("Promise"))).resolve():d("WAWebEncryptedRid").setEncryptedRid(a);var n=Date.now();d("WAWebABPropsGlobals").updateGlobalABKey((c=f)!=null?c:"");d("WAWebABPropsLocalStorage").updateAttributesLocalStorage(f,e,i,n);k!=null&&d("WAWebABPropsLocalStorage").setRefreshId(k);if(g==null)return!1;try{yield (h||(h=b("Promise"))).all([d("WAWebApiAbPropEventSamplingConfig").updateEventSamplingConfigs(m),d("WAWebApiAbPropConfig").updateABPropConfigs(d("WAWebAbPropsParsingJob").parseABProps(l)),a]);return!0}catch(a){d("WALogger").ERROR(j()).verbose().devConsole(a).sendLogs("update ABProps config table failed when syncing ABProps")}return!1});return l.apply(this,arguments)}function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!0);var c=d("WAWebABPropsLocalStorage").isABPropsAfterFirstSync(),e=3;while(e-->0)try{var f={service_improvement_opt_out_flag:d("WAWebABProps").getABPropConfigValue("service_improvement_opt_out_flag"),ctwa_ad_account_token_storage_kill_switch_web:d("WAWebABProps").getABPropConfigValue("ctwa_ad_account_token_storage_kill_switch_web")},g=(yield k(c&&a));if(g){yield (h||(h=b("Promise"))).all([d("WAWebABPropsUpdateFromStorage").updateABPropsFromStorage(),d("WAWebEventSamplingCache").updateEventSamplingFromStorage()]);d("WAWebCmd").Cmd.onAbPropsUpdate(f);return}}catch(a){e===0&&d("WALogger").ERROR(i()).verbose().devConsole(a).sendLogs("failed to sync ABProps"),yield d("WAPromiseDelays").delayMs(10*1e3*Math.random())}});return m.apply(this,arguments)}g.syncABProps=k;g.syncABPropsTask=a}),98);
__d("WAWebUploadPrekeysForRegTask",["Promise","WAComms","WADeprecatedSendIq","WALogger","WAWap","WAWebConstantsDeprecated","WAWebServerPropsModel","WAWebSignalKeyApi","WAWebSignalStoreApi","WAWebSignalUtilsApi","WAWebUploadPreKeysJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: disconnected, unclear if on server: "," (count: ",", size: ","b)"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: unrecognized error "," (count: ",", size: ","b)"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: uploaded invalid keys (count: ",", size: ","b)"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: server requested backoff "," (count: ",", size: ","b)"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: "," keys uploaded, raw stanza size: ","b"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["PrekeyUploadForRegistrationTask: start key upload"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["PrekeyUploadForRegistrationTask: successfully generated "," keys"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["PrekeyUploadForRegistrationTask: start key generation"]);p=function(){return a};return a}var q=function(){function a(){}var e=a.prototype;e.startKeyGenerationStage=function(){this.$1||(this.$1=this.$3());return this.$1};e.startKeyUploadStage=function(){this.$2||(this.$2=this.$4());return this.$2};e.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(p());var a=d("WAWebServerPropsModel").ServerProps.maxKeys,e=(yield (h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo(),d("WAWebSignalStoreApi").waSignalStore.getSignedPreKey()])),f=e[0];e=e[1];if(!f||!e)throw c("err")("No signal info is available");a=(yield d("WAWebSignalStoreApi").waSignalStore.getOrGenPreKeys(a,d("WAWebSignalKeyApi").generatePreKeyPair));d("WALogger").LOG(o(),a.length);return{regInfo:f,signedPreKey:e,prekeys:a}});function e(){return a.apply(this,arguments)}return e}();e.$4=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this.$1||this.startKeyGenerationStage();a=(yield a);var b=a.regInfo,e=a.signedPreKey;a=a.prekeys;d("WALogger").LOG(n());var f=a.length;if(f===0)throw c("err")("No preKey is available");var g=a[a.length-1].keyId,h=b.registrationId;b=b.identityKeyPair;h=d("WAWap").wap("iq",{id:d("WAWap").generateId(),xmlns:"encrypt",type:"set",to:d("WAWap").S_WHATSAPP_NET},d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(h)),d("WAWap").wap("type",null,c("WAWebConstantsDeprecated").KEY_BUNDLE_TYPE),d("WAWap").wap("identity",null,b.pubKey),d("WAWap").wap("list",null,a.map(d("WAWebSignalUtilsApi").xmppPreKey)),d("WAWebSignalUtilsApi").xmppSignedPreKey(e));try{yield d("WAComms").waitForConnection();yield d("WAWebSignalStoreApi").waSignalStore.markKeyAsUploaded(g);b=(yield d("WADeprecatedSendIq").deprecatedSendIqWithoutRetry(h,d("WAWebUploadPreKeysJob").uploadPreKeyResParser));if(b.success){d("WAWebSignalStoreApi").waSignalStore.setServerHasPreKeys(!0);d("WALogger").LOG(m(),a.length,h.toString().length);return{success:!0}}e=b.errorCode;e>=500?d("WALogger").WARN(l(),e,f,h.toString().length):e===406?d("WALogger").WARN(k(),f,h.toString().length):d("WALogger").WARN(j(),e,f,h.toString().length);return{errorCode:b.errorCode,errorText:b.errorText}}catch(a){d("WALogger").WARN(i(),a,f,h.toString().length);return}});function e(){return a.apply(this,arguments)}return e}();return a}();function a(){return new q()}g["default"]=a}),98);
__d("WAWebRegisterPassiveTasks",["WALogger","WAWebABPropsLocalStorage","WAWebABPropsWamGlobals","WAWebAbPropsSyncJob","WAWebClearDanglingReceipts","WAWebOnlineDanglingReceipts","WAWebPassiveModeManager","WAWebSchemaDanglingReceipt","WAWebSignalStoreApi","WAWebUploadPrekeysForRegTask","WAWebUserPrefsGeneral","WAWebWamDeviceLinkReporter","WAWebWamEnumMdLinkDeviceCompanionStage","asyncToGeneratorRuntime","cr:3979"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while sending dangling receipts, ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] sending dangling receipts complete"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] start sending dangling receipts"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while sending online dangling receipts, ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] sending online dangling receipts complete"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] start sending online dangling receipts"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while sync ab props prekeys, ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while uploading prekeys, ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] key upload complete"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] start key upload"]);q=function(){return a};return a}function a(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSignalStoreApi").waSignalStore.getServerHasPreKeys());if(!a){yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.UPLOAD_PREKEYS);var e=c("WAWebUploadPrekeysForRegTask")();void e.startKeyGenerationStage();d("WAWebPassiveModeManager").PassiveTaskManager.registerPassiveTask(function(){d("WALogger").LOG(q());return e.startKeyUploadStage().then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(p()),yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE),yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent()}))["catch"](function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").ERROR(o(),a).verbose().devConsole(a).sendLogs("error while uploading prekeys"),yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent(-1)});return function(b){return a.apply(this,arguments)}}())})}(!d("WAWebABPropsLocalStorage").isABPropsAfterFirstSync()||(yield d("WAWebUserPrefsGeneral").getWhatsAppWebExternalBetaDirtyBitIdb()))&&(yield d("WAWebPassiveModeManager").PassiveTaskManager.registerPassiveTask(function(){return d("WAWebAbPropsSyncJob").syncABPropsTask()["catch"](function(a){d("WALogger").WARN(n(),a).verbose()})}),void d("WAWebUserPrefsGeneral").setWhatsAppWebExternalBetaDirtyBitIdb(!1),d("WAWebABPropsWamGlobals").setAbPropDependingGlobalWamAttributes())});return r.apply(this,arguments)}function e(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebOnlineDanglingReceipts").hasOnlineDanglingReceipts()){d("WAWebPassiveModeManager").PassiveTaskManager.registerPassiveTask(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{d("WALogger").LOG(m()),yield d("WAWebOnlineDanglingReceipts").sendAndClearOnlineDanglingReceipts(),d("WALogger").LOG(l())}catch(a){d("WALogger").ERROR(k(),a).verbose().devConsole(a).sendLogs("send-online-dangling-receipts-failed")}}));var a=(yield d("WAWebSchemaDanglingReceipt").getTable().count());a>0&&d("WAWebPassiveModeManager").PassiveTaskManager.registerPassiveTask(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{d("WALogger").LOG(j()),yield d("WAWebClearDanglingReceipts").sendAndClearDanglingReceipts(),d("WALogger").LOG(i())}catch(a){d("WALogger").ERROR(h(),a).verbose().devConsole(a).sendLogs("send-and-clear-dangling-receipts-failed")}}))}});return s.apply(this,arguments)}g.registerPassiveTaskForStartUp=a;g.registerPassiveTasksForConnect=e}),98);
__d("WAWebAdvStoredTimestampExpiredWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({AdvStoredTimestampExpired:[3036,{advExpireTimeInHours:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"regular"]},{AdvStoredTimestampExpired:[]});g.AdvStoredTimestampExpiredWamEvent=a}),98);
__d("WAWebAdvDeviceInfoCheckJob",["Promise","WAJids","WALogger","WATimeUtils","WAWebABProps","WAWebAdvStoredTimestampExpiredWamEvent","WAWebApiDeviceList","WAWebApiPendingDeviceSync","WAWebApiTasksScheduledTime","WAWebIdentityUpdateDeviceTableApi","WAWebLastADVCheckTimeApi","WAWebLogoutReasonConstants","WAWebSocketLogoutJob","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["error running the adv device check job"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["skip first run"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["scheduled in "," seconds"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Logging out due to own expired device"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv_device_info_check: sending usync query"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv: error sending usync query: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv: removing companions: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv: running device info check with t=",""]);p=function(){return a};return a}var q=25*d("WATimeUtils").HOUR_SECONDS,r=function(){function a(a){this.advToSystemBridge=a}var c=a.prototype;c.run=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(p(),a).tags("automated-device-verification");var b=this.advToSystemBridge,c=(yield b.getUsersForExpiration(a)),e=c.usersExpired;c=c.usersCloseToExpiration;d("WALogger").DEV(o(),Array.from(e.entries()).map(function(a){var b=a[0];a=a[1];return"\n\t"+b.toString()+" (t="+a.timestamp+")"})).tags("automated-device-verification");b.removeCompanions(e);b.sendADVStoredTimestampExpiredEvents(e,a);a=Array.from(e.keys()).concat(Array.from(c.keys())).filter(function(a){return!b.canRemoveUserDevices(a)});b.sendOrQueueDeviceUsyncQuery(a)["catch"](function(a){return d("WALogger").DEV(n(),a).tags("automated-device-verification")});return b.recordLocalTimestamp()});function c(b){return a.apply(this,arguments)}return c}();return a}(),s=function(){function a(){}var c=a.prototype;c.getNumDaysKeyIndexListExpiration=function(){return d("WAWebABProps").getABPropConfigValue("num_days_key_index_list_expiration")};c.getNumDaysBeforeDeviceExpiryCheck=function(){return d("WAWebABProps").getABPropConfigValue("num_days_before_device_expiry_check")};c.getUsersForExpiration=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this,c=(yield d("WAWebApiDeviceList").getAllDeviceLists()),e=(yield d("WAWebLastADVCheckTimeApi").getLastADVDeviceInfoCheckTime()),f=this.getNumDaysKeyIndexListExpiration()*d("WATimeUtils").DAY_SECONDS,g=new Map(),h=new Map();c.forEach(function(c){if(c.deleted||z(c))return;else A(a,f,c,e)?g.set(d("WAWebWidFactory").createUserWid(c.id),c):B(a,f-b.getNumDaysBeforeDeviceExpiryCheck()*d("WATimeUtils").DAY_SECONDS,c)&&h.set(d("WAWebWidFactory").createUserWid(c.id),c)});return{usersExpired:g,usersCloseToExpiration:h}});function c(b){return a.apply(this,arguments)}return c}();c.sendADVStoredTimestampExpiredEvents=function(a,b){var c=this;a.forEach(function(a){a=b-(a.timestamp+c.getNumDaysKeyIndexListExpiration()*d("WATimeUtils").DAY_SECONDS);if(a<0)return;a=Math.round(a/d("WATimeUtils").HOUR_SECONDS);new(d("WAWebAdvStoredTimestampExpiredWamEvent").AdvStoredTimestampExpiredWamEvent)({advExpireTimeInHours:a}).commit()})};c.sendOrQueueDeviceUsyncQuery=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(m());yield d("WAWebApiPendingDeviceSync").addUserToPendingDeviceSync(a.map(function(a){return a.toString()}));return d("WAWebApiPendingDeviceSync").doPendingDeviceSync()});function c(b){return a.apply(this,arguments)}return c}();c.canRemoveUserDevices=function(a){return!1};c.removeCompanions=function(a){var c=Array.from(a.entries());c=c.some(function(a){var b=a[0];a[1];b.user===d("WAWebUserPrefsMeUser").getMeUser().user});if(c){d("WALogger").LOG(l());void d("WAWebSocketLogoutJob").socketLogout(d("WAWebLogoutReasonConstants").LogoutReason.InvalidAdvStatus);return(h||(h=b("Promise"))).resolve()}return(h||(h=b("Promise"))).all(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];return d("WAWebIdentityUpdateDeviceTableApi").clearDeviceRecord(b,a.devices)}))};c.recordLocalTimestamp=function(){return(h||(h=b("Promise"))).resolve()};return a}(),t="advDeviceInfoCheck",u;function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){u!=null&&(self.clearTimeout(u),u=null);var a=d("WATimeUtils").unixTimeWithoutClockSkewCorrection(),c=(yield d("WAWebLastADVCheckTimeApi").getLastADVDeviceInfoCheckTime()),e=0,f=function(){return(h||(h=b("Promise"))).resolve()};c!=null?(e=Math.max(d("WATimeUtils").DAY_SECONDS-(a-c),0),f=function(){return y()},d("WALogger").DEV(k(),e).tags("automated-device-verification")):d("WALogger").DEV(j()).tags("automated-device-verification");u=self.setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield f()}catch(a){d("WALogger").ERROR(i()).tags("automated-device-verification")}u=null;var a=d("WATimeUtils").unixTimeWithoutClockSkewCorrection();d("WAWebLastADVCheckTimeApi").setLastADVDeviceInfoCheckTime(a);d("WAWebApiTasksScheduledTime").updateTaskScheduledTime(t,d("WATimeUtils").castToUnixTime(a));v()}),e*1e3)});return w.apply(this,arguments)}var x;function y(){x==null&&(x=new r(new s()));return x.run(d("WATimeUtils").unixTimeWithoutClockSkewCorrection())}function z(a){return a.devices.length===1&&a.devices[0].id===d("WAJids").DEFAULT_DEVICE_ID}function A(a,b,c,d){if(a-c.timestamp>=b)return!0;return c.expectedTsUpdateTs!=null?a-c.expectedTsUpdateTs>=q&&c.expectedTsLastDeviceJobTs!==d:!1}function B(a,b,c){if(a-c.timestamp>=b)return!0;return c.expectedTs!=null?c.expectedTs>c.timestamp:!1}g.AdvToSystemBridgeImpl=s;g.scheduleAdvDeviceInfoCheck=v;g.runAdvDeviceInfoCheck=y}),98);
__d("WAWebBootstrapPremiumMessages",["Promise","WAWebMiscGatingUtils","WAWebMsgCollection","WAWebPremiumMessageCollection","WAWebPremiumMessageSchema","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){var h,i=250;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("WAWebMiscGatingUtils").isRambutanEnabled())return(h||(h=b("Promise"))).resolve();var a=(yield d("WAWebPremiumMessageSchema").getPremiumMessageTable().all());d("WAWebPremiumMessageCollection").PremiumMessageCollection.initializeFromCache(a)});return j.apply(this,arguments)}function e(){if(!d("WAWebMiscGatingUtils").isRambutanEnabled())return;d("WAWebMsgCollection").MsgCollection.listenTo(d("WAWebMsgCollection").MsgCollection,"add",c("lodash").debounce(k,i,{leading:!0,trailing:!0}));d("WAWebPremiumMessageCollection").PremiumMessageCollection.listenTo(d("WAWebPremiumMessageCollection").PremiumMessageCollection,"add",function(a){return a.hydrateMessages()})}function k(){d("WAWebPremiumMessageCollection").PremiumMessageCollection.getModelsArray().forEach(function(a){a.hydrateMessages()})}g.restorePremiumMessages=a;g.bindPremiumMessageListeners=e}),98);
__d("WAWebCTWASuggestionInitFromStorage",["Promise","WALogger","WATimeUtils","WAWebBizGatingUtils","WAWebSchemaCTWASuggestion"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreCTWASuggestions: could not remove expired suggestions"]);i=function(){return a};return a}function a(a){if(!d("WAWebBizGatingUtils").adsActionBannersEnabledOnStartup())return(h||(h=b("Promise"))).resolve();var c=d("WAWebSchemaCTWASuggestion").getCTWASuggestionTable();return c.all().then(function(b){var e=[],f=[];b.forEach(function(a){d("WATimeUtils").isInFuture(a.expiresAt)?e.push(a):f.push(a.id)});a("loadedCTWASuggestions",{suggestions:e});if(f.length>0)return c.bulkRemove(f)["catch"](function(){d("WALogger").ERROR(i()).devConsole(f)})})}g.restoreCTWASuggestions=a}),98);
__d("WAWebCommsProcessAck",["WALogger","WAWebActiveMessageRanges","WAWebDBMessageUtils","WAWebMsgCollection","WAWebMsgKey","WAWebMsgType","WAWebSchemaMessage","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processAckForOutgoingMessage: failed to update in storage"]);h=function(){return a};return a}function a(a){var b=a.attrs,c=b.id,e=b.from;b=b.t;if(a.attrs["class"]==="message"){e=d("WAWebWidFactory").createWid(String(e));a=i(a);l(String(c),e,parseInt(b,10),a);k(a,String(c),e)}}function i(a){var b;a=a.content;if(!Array.isArray(a)||((b=a[0])==null?void 0:b.tag)!=="rcat")return null;a=(b=a[0])==null?void 0:b.content;return Array.isArray(a)?null:a}function j(a,b){return b.isGroup()?new(c("WAWebMsgKey"))({fromMe:!0,remote:b,id:a,participant:d("WAWebUserPrefsMeUser").getMeUser()}):new(c("WAWebMsgKey"))({fromMe:!0,remote:b,id:a})}function k(a,b,c){if(a==null)return;b=d("WAWebMsgCollection").MsgCollection.get(j(b,c));b!=null&&(b.rcat=a)}function l(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){a=j(a,b);var f=String(a);try{var g=(yield d("WAWebSchemaMessage").getMessageTable().get(f));if((g==null?void 0:g.type)===d("WAWebMsgType").MSG_TYPE.REACTION)return;g=d("WAWebDBMessageUtils").MessagePropertyType.cast(g==null?void 0:g.messageRangeIndex.split("_")[1]);d("WAWebSchemaMessage").getMessageTable().merge(f,{messageRangeIndex:d("WAWebDBMessageUtils").craftMessageRangeIndex(b.toString(),!1,g===d("WAWebDBMessageUtils").MessagePropertyType.SystemMessage,c),rcat:e})}catch(a){d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("message processAckForOutgoingMessage failed");throw a}d("WAWebActiveMessageRanges").checkAndRemoveActiveMessageRanges(a,c)});return m.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebMdDebugMdStanza.react",["invariant","WAWebConfirmPopup.react","WAWebModal.react","WAWebModalManager","WAWebUserPrefsMultiDeviceDebug","gkx","react"],(function(a,b,c,d,e,f,g,h){var i,j,k=j||c("react"),l=(i||(i=d("react"))).useState;c("gkx")("26258")&&h(0,56260);function a(a){var b=a.originalIqId,e=a.rawStanza,f=a.onExit;b=b!=null?'<iq from="s.whatsapp.net" type="result" id="'+(b||"")+'">   </iq> ':"";var g=c("WAWebUserPrefsMultiDeviceDebug").getDebugStanzaFilter()||"";b=l(b);var h=b[0],i=b[1];b=l(g);var j=b[0],m=b[1];g=function(a){a=a.target;i(a.value)};var n=function(){if(h==null||h==="")return;window.Debug.mockIncomingStanza(h)};b=function(){n(),e==null&&j!=null&&c("WAWebUserPrefsMultiDeviceDebug").setDebugStanzaFilter(j),d("WAWebModalManager").ModalManager.close(),f==null?void 0:f()};var o=function(a){a=a.target;m((a=a.value)==null?void 0:a.trim())};return k.jsx(d("WAWebConfirmPopup.react").ConfirmPopup,{type:d("WAWebModal.react").ModalTheme.Flex,okText:"OK",onOK:b,onCancel:function(){a.onExit==null?void 0:a.onExit(),d("WAWebModalManager").ModalManager.close()},children:k.jsxs("div",{style:{padding:"20px"},children:[k.jsxs("h4",{children:[" ",e?"Sent stanza: ":'List of xmlns to filter [input as CSV, e.g. "privacy, usync"]:'," "]}),k.jsx("textarea",{name:"filter",cols:"80",readOnly:!!e,rows:e?"15":"2",value:(b=e)!=null?b:j,onChange:o}),k.jsxs("h4",{children:[" ",e?"Mock reply: ":"Mock incoming Stanza:"," "]}),k.jsx("textarea",{name:"stanza",cols:"80",rows:"15",value:h,onChange:g})]})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("WAWebProtobufsCompanionReg.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({UNKNOWN:0,CHROME:1,FIREFOX:2,IE:3,OPERA:4,SAFARI:5,EDGE:6,DESKTOP:7,IPAD:8,ANDROID_TABLET:9,OHANA:10,ALOHA:11,CATALINA:12,TCL_TV:13,IOS_PHONE:14,IOS_CATALYST:15,ANDROID_PHONE:16,ANDROID_AMBIGUOUS:17,WEAR_OS:18,AR_WRIST:19,AR_DEVICE:20,UWP:21,VR:22});c={};e={};f={};c.internalSpec={os:[1,(b=d("WAProtoConst")).TYPES.STRING],version:[2,b.TYPES.MESSAGE,f],platformType:[3,b.TYPES.ENUM,a],requireFullSync:[4,b.TYPES.BOOL],historySyncConfig:[5,b.TYPES.MESSAGE,e]};e.internalSpec={fullSyncDaysLimit:[1,b.TYPES.UINT32],fullSyncSizeMbLimit:[2,b.TYPES.UINT32],storageQuotaMb:[3,b.TYPES.UINT32],inlineInitialPayloadInE2EeMsg:[4,b.TYPES.BOOL],recentSyncDaysLimit:[5,b.TYPES.UINT32],supportCallLogHistory:[6,b.TYPES.BOOL],supportBotUserAgentChatHistory:[7,b.TYPES.BOOL],supportCagReactionsAndPolls:[8,b.TYPES.BOOL],supportBizHostedMsg:[9,b.TYPES.BOOL],supportRecentSyncChunkMessageCountTuning:[10,b.TYPES.BOOL]};f.internalSpec={primary:[1,b.TYPES.UINT32],secondary:[2,b.TYPES.UINT32],tertiary:[3,b.TYPES.UINT32],quaternary:[4,b.TYPES.UINT32],quinary:[5,b.TYPES.UINT32]};g.DeviceProps$PlatformType=a;g.DevicePropsSpec=c;g.DeviceProps$HistorySyncConfigSpec=e;g.DeviceProps$AppVersionSpec=f}),98);
__d("WAWebClientPayload",["WABase64","WAByteArray","WAMd5","WAWebBuildConstants","WAWebClientPayloadReleaseChannel","WAWebMiscBrowserUtils","WAWebProtobufsCompanionReg.pb","WAWebProtobufsWa6.pb","WAWebSyncGatingUtils","WAWebSyncdMdSyncFieldstatMeta","WAWebUserPrefsInfoStore","WAWebUserPrefsMeUser","WAWebWamPlatform","asyncToGeneratorRuntime","encodeProtobuf","gkx"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebUserPrefsMeUser").assertGetMe();a=babelHelpers["extends"]({},yield j(a),{username:parseInt(b.user,10),device:b.device!=null?b.device:0});return d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").ClientPayloadSpec,a).readByteArray()});return h.apply(this,arguments)}function e(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=l(),f=(yield m());c=babelHelpers["extends"]({},yield j(c),{devicePairingData:{buildHash:e,deviceProps:f,eRegid:d("WAByteArray").intToBytes(4,a.registrationId),eKeytype:d("WAByteArray").intToBytes(1,5),eIdent:a.identityKeyPair.pubKey,eSkeyId:d("WAByteArray").intToBytes(3,b.keyId),eSkeyVal:b.keyPair.pubKey,eSkeySig:b.signature}});return d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").ClientPayloadSpec,c).readByteArray()});return i.apply(this,arguments)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;return{passive:(b=a==null?void 0:a.passive)!=null?b:!1,pull:(b=a==null?void 0:a.pull)!=null?b:!1,connectType:d("WAWebProtobufsWa6.pb").ClientPayload$ConnectType.WIFI_UNKNOWN,connectReason:d("WAWebProtobufsWa6.pb").ClientPayload$ConnectReason.USER_ACTIVATED,userAgent:yield o(),webInfo:{webSubPlatform:r()}}});return k.apply(this,arguments)}function l(){var a=d("WABase64").decodeB64(c("WAMd5")(d("WAWebBuildConstants").VERSION_BASE));a=new Uint8Array(a);return a}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=c("WAWebMiscBrowserUtils").info(),b;if(a.version&&a.version!==""){var e=a.version.split(".");e.length>0&&a.version&&/^[0-9\.]+$/.test(a.version)&&(b={primary:parseInt(e[0],10),secondary:e.length>1?parseInt(e[1],10):void 0,tertiary:e.length>2?parseInt(e[2],10):void 0})}e=!!c("gkx")("26255");var f={inlineInitialPayloadInE2EeMsg:d("WAWebSyncGatingUtils").isHistorySyncWithoutMmsEnabled(),supportBotUserAgentChatHistory:!0,supportCagReactionsAndPolls:!0,supportRecentSyncChunkMessageCountTuning:!0};if(!c("gkx")("26255")){var g=(yield d("WAWebSyncdMdSyncFieldstatMeta").MdSyncFieldStatsMeta.getStorageEstimation());g.mdStorageQuotaBytes!==d("WAWebSyncdMdSyncFieldstatMeta").STORAGE_QUOTA_UNAVAILABLE&&(f=babelHelpers["extends"]({},f,{storageQuotaMb:Math.trunc(g.mdStorageQuotaBytes/1024/1024)}))}g={os:a.os,version:b,platformType:q(a.name),requireFullSync:e,historySyncConfig:f};a=d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsCompanionReg.pb").DevicePropsSpec,g).readByteArray();return a});return n.apply(this,arguments)}function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsInfoStore").deviceInfo.get());return{appVersion:{primary:Number(d("WAWebBuildConstants").VERSION_PRIMARY),secondary:Number(d("WAWebBuildConstants").VERSION_SECONDARY),tertiary:Number(d("WAWebBuildConstants").VERSION_TERTIARY)},platform:d("WAWebProtobufsWa6.pb").ClientPayload$UserAgent$Platform.WEB,releaseChannel:yield d("WAWebClientPayloadReleaseChannel").getReleaseChannel(),mcc:a.mcc,mnc:a.mnc,osVersion:a.osVersion,manufacturer:a.manufacturer,device:a.device,osBuildNumber:a.osBuild,localeLanguageIso6391:a.lg,localeCountryIso31661Alpha2:a.lc}});return p.apply(this,arguments)}function q(a){switch(a){case"Chrome":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.CHROME;case"Firefox":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.FIREFOX;case"IE":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.IE;case"Opera":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.OPERA;case"Safari":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.SAFARI;case"Edge":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.EDGE;case"electron":case"Desktop":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.DESKTOP;case"ipad":case"iPad":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.IPAD;case"tablet":case"Android tablet":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.ANDROID_TABLET;case"Ohana":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.OHANA;case"Aloha":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.ALOHA;case"Catalina":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.CATALINA;default:return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.UNKNOWN}}function r(){switch(d("WAWebWamPlatform").getWamPlatform()){case"WEB":case"PWA":return d("WAWebProtobufsWa6.pb").ClientPayload$WebInfo$WebSubPlatform.WEB_BROWSER;case"DARWIN":case"DARWIN_BETA":return d("WAWebProtobufsWa6.pb").ClientPayload$WebInfo$WebSubPlatform.DARWIN;case"MACSTORE":return d("WAWebProtobufsWa6.pb").ClientPayload$WebInfo$WebSubPlatform.APP_STORE;default:return void 0}}g.getClientPayloadForLogin=a;g.getClientPayloadForRegistration=e;g.getUserAgent=o;g.getWebSubPlatform=r}),98);
__d("WAWebGetClientPayloadForLogin",["WALogger","WANullthrows","WAWebClientPayload","WAWebPassiveModeManager","WAWebRegisterPassiveTasks","WAWebSocketLogoutJob","WAWebUserPrefsInfoStore","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt noise data"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a||{passive:!1,pull:!0};var b=(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get());b==null&&(d("WALogger").LOG(h()).tags("launch-socket-chat"),yield d("WAWebSocketLogoutJob").socketLogout(),c("WANullthrows")(b));yield d("WAWebRegisterPassiveTasks").registerPassiveTasksForConnect();a.passive=d("WAWebPassiveModeManager").PassiveTaskManager.shouldConnectAsPassiveMode();return d("WAWebClientPayload").getClientPayloadForLogin(a)});return i.apply(this,arguments)}g.getClientPayloadForLogin=a}),98);
__d("WAWebGetClientPayloadForRegistration",["Promise","WAWebClientPayload","WAWebSignalStoreApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield (h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo(),d("WAWebSignalStoreApi").waSignalStore.getSignedPreKey()])),f=e[0];e=e[1];if(!e||!f)throw c("err")("Invalid signal credentials");return d("WAWebClientPayload").getClientPayloadForRegistration(f,e,a)});return i.apply(this,arguments)}g.getClientPayloadForRegistration=a}),98);
__d("WAPromiseAny",["Promise","WACustomError"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a.length===0?(h||(h=b("Promise"))).reject(new(d("WACustomError").AggregateError)([])):(h||(h=b("Promise"))).all(a.map(i)).then(function(a){throw new(d("WACustomError").AggregateError)(a)},function(a){return a})}function i(a){return new(h||(h=b("Promise")))(function(c,d){return(h||(h=b("Promise"))).resolve(a).then(d,c)})}g.promiseAny=a}),98);
__d("WARaceSignalLegacyPromise",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c,d=new AbortController();if(a.some(function(a){return a.aborted}))d.abort();else{c=function(){for(var d=0;d<a.length;d++){var b=a[d];b.removeEventListener("abort",e)}c=null};var e=function(){c==null?void 0:c(),d.abort()};for(var f=0;f<a.length;f++){var g=a[f];g.addEventListener("abort",e)}}return b(d.signal)["finally"](function(){c==null?void 0:c()})}f["default"]=a}),66);
__d("WAWebEventsWaitForOnline",["WAPromiseDelays","WAWebEventsWaitForEvent","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=100;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield c("WAWebEventsWaitForEvent")(self,"online",void 0,a);return d("WAPromiseDelays").delayMs(h,a)});return i.apply(this,arguments)}g.waitForOnlineNaive=a}),98);
__d("WAWebWatchdog",["WALogger","WAShiftTimer","WAWebBaseModel"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Watchdog timed-out without handler!"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["forced non-running watchdog!"]);i=function(){return a};return a}b=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.failGeneration=d("WAWebBaseModel").session(0),c.ts=d("WAWebBaseModel").session(),c.waitDuration=d("WAWebBaseModel").session(0),c.prevWaitDuration=d("WAWebBaseModel").session(0),c.jitter=d("WAWebBaseModel").session(0),c.shiftTimer=d("WAWebBaseModel").session(),c.waitAlgorithm=d("WAWebBaseModel").session(),c.onActivated=d("WAWebBaseModel").session(),c.onDeactivated=d("WAWebBaseModel").session(),c.onFed=d("WAWebBaseModel").session(),c.onTimeout=d("WAWebBaseModel").session(),b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.initialize=function(){var a=this;this.shiftTimer=new(d("WAShiftTimer").ShiftTimer)(function(){return j.call(a)})};c.activate=function(){this.shiftTimer.isScheduled()||(this._run(!0),this.onActivated&&this.onActivated(this))};c.deactivate=function(){this.shiftTimer.isScheduled()&&(this.shiftTimer.cancel(),this.onDeactivated&&this.onDeactivated(this))};c.feed=function(){if(!this.shiftTimer.isScheduled())return;this._run(!0);this.onFed&&this.onFed(this)};c.forceTimeout=function(a){!this.shiftTimer.isScheduled()?d("WALogger").WARN(i()):a!=null&&a!==0?(this.shiftTimer.onOrBefore(a),this.ts=this.shiftTimer.ts):this.shiftTimer.forceRunNow()};c.poke=function(){this.forceTimeout.apply(this,arguments)};c.resetGeneration=function(){this.failGeneration=0};c._run=function(a){a&&this.resetGeneration();a=this.waitAlgorithm(this);var b=this.jitter*Math.random()*a;this.shiftTimer.debounce(a+b);this.set({ts:this.shiftTimer.ts,waitDuration:a,prevWaitDuration:this.waitDuration})};return b}(d("WAWebBaseModel").BaseModel);c=d("WAWebBaseModel").defineModel(b);function j(){var a=this.onTimeout;if(!a){d("WALogger").WARN(h()).sendLogs("watchdog-no-handler");return}this.failGeneration++;a(this)&&this._run(!1)}function a(a,b,c){if(typeof c==="number"){var d=c;return function(c){switch(c.failGeneration){case 0:return Math.min(d,b);case 1:return Math.min(d,a+b);default:return Math.min(d,c.waitDuration+c.prevWaitDuration)}}}return function(c){switch(c.failGeneration){case 0:return b;case 1:return a+b;default:return c.waitDuration+c.prevWaitDuration}}}g.Watchdog=c;g.fibonacci=a}),98);
__d("WAWebSocketOpenerMd",["Promise","WAAbortError","WACustomError","WALogger","WAPromiseAny","WAPromiseDelays","WARaceSignalLegacyPromise","WAWebABProps","WAWebBaseJSHaltDetector","WAWebBaseModel","WAWebDeprecatedTightPromise","WAWebEventsWaitForBbEvent","WAWebEventsWaitForOnline","WAWebJSHaltDetector","WAWebNetworkStatus","WAWebStreamModel","WAWebWatchdog","WAWebWatchedSocketMd","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["js halt longer than "," ms detected, resetting watchdog fail generation"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:offline... heuristic poll"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:offline... quick poll"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:offline... wait for navigator"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:offlineController activating"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:onlineController activating"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: opened web socket"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: attemptOpen called while not active!"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["SocketOpenerMD deadly error! ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD closing socket opener"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD set to socket ",""]);s=function(){return a};return a}var t=c("gkx")("26258")?"wss://web.whatsapp.com/ws/chat":"wss://dev-web.whatsapp.com/ws/chat",u=c("gkx")("26258")?"wss://web-fallback.whatsapp.com/ws/chat":"wss://dev-web-fallback.whatsapp.com/ws/chat",v=3e5,w=6e3,x=2,y=.2,z=180*1e3,A=d("WAWebWatchdog").fibonacci(8e3,4e3,3e5);a=function(a){babelHelpers.inheritsLoose(e,a);function e(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.active=d("WAWebBaseModel").prop(!0),c.socket=d("WAWebBaseModel").prop(),c.signal=d("WAWebBaseModel").prop(),c.sockets=d("WAWebBaseModel").prop(),c.pendingSocketPromiseCount=d("WAWebBaseModel").prop(0),c.attempts=d("WAWebBaseModel").prop(0),c.watchDogController=d("WAWebBaseModel").prop(),c.retryTimestamp=d("WAWebBaseModel").prop(),c.tsListener=d("WAWebBaseModel").prop(),c.onerror=d("WAWebBaseModel").prop(),b)||babelHelpers.assertThisInitialized(c)}var f=e.prototype;f.initialize=function(){var a=this;this.sockets=[];new(h||(h=b("Promise")))(function(b,c){a.$SocketOpenerMD1=b,a.$SocketOpenerMD2=c}).then(function(b){d("WALogger").LOG(s(),b.id);if(a.signal.aborted)throw new(d("WAAbortError").AbortError)();a.set({active:!1,socket:b});c("WAWebNetworkStatus").online=!0})["finally"](function(){a.stopListening();d("WALogger").LOG(r());a.active=!1;a.sockets.forEach(function(a){a.promise instanceof c("WAWebDeprecatedTightPromise")&&a.promise.cancel();if(d("WAWebABProps").getABPropConfigValue("web_prevent_parallel_socket_connection_enabled")){(a=a.controller)==null?void 0:a.abort()}});var b=a.watchDogController;b&&(b.deactivate(),a.watchDogController=null)})["catch"](d("WAAbortError").catchAbort(function(){}))["catch"](function(b){d("WALogger").WARN(q(),String(b)).devConsole(b);if(a.onerror)a.onerror(b);else throw b});this.tsListener=function(b){a.retryTimestamp=b.ts};this.listenTo(c("WAWebNetworkStatus"),"change:online",this.$SocketOpenerMD3);this.listenTo(d("WAWebJSHaltDetector").jsHaltDetector,d("WAWebBaseJSHaltDetector").JS_HALT_EVENT,this.$SocketOpenerMD4);self.addEventListener("online",function(){a.$SocketOpenerMD3()});this.$SocketOpenerMD3()};f.$SocketOpenerMD5=function(a,e){var f=this;if(!this.active){d("WALogger").LOG(p());return}var g=new AbortController();a=c("WARaceSignalLegacyPromise")([g.signal,a],function(a){return d("WAWebWatchedSocketMd").open(f.routingToken?e+"?ED="+f.routingToken:e,a)});d("WALogger").DEV(o()).devConsole(a);this.attempts=this.sockets.push({promise:a,controller:g});this.pendingSocketPromiseCount++;var i=!1,j=function(){if(i)return(h||(h=b("Promise"))).resolve();i=!0;var a=g.signal;return c("WAWebNetworkStatus").checkOnline({signal:a})},k=new AbortController();d("WAPromiseDelays").delayMs(6e3,k.signal).then(function(){return j()})["catch"](function(){});a.then(this.$SocketOpenerMD1)["finally"](function(){f.pendingSocketPromiseCount--,k.abort()})["catch"](d("WAAbortError").catchAbort(function(){}))["catch"](function(){return j()})};f.attemptOpen=function(a){this.$SocketOpenerMD5(a,t),d("WAWebABProps").getABPropConfigValue("web_socket_parallel_connection_enabled")&&this.$SocketOpenerMD5(a,u)};f.poke=function(){this.watchDogController&&this.watchDogController.forceTimeout()};f.$SocketOpenerMD3=function(){if(!this.active)return;var a=this.watchDogController,b=c("WAWebNetworkStatus").online?this.onlineController():this.offlineController();a&&(a.off("change:ts",this.tsListener),a.deactivate());b.on("change:ts",this.tsListener);b.activate();this.watchDogController=b};f.onlineController=function(){var a=this;d("WALogger").LOG(n());return new(d("WAWebWatchdog").Watchdog)({waitAlgorithm:A,jitter:y,onActivated:function(){a.attemptOpen(a.signal)},onTimeout:function(){a.attemptOpen(a.signal);return!0}})};f.offlineController=function(){var a=this;d("WALogger").LOG(m());var e=0,f,g=function(a){f&&f.abort();f=new AbortController();var g=f.signal;if(!navigator.onLine){d("WALogger").LOG(l());e=0;void B(a,[d("WAWebEventsWaitForOnline").waitForOnlineNaive(g)],f);return v}else if(e++<x){d("WALogger").LOG(k());return w}d("WALogger").LOG(j());void B(a,[d("WAWebEventsWaitForOnline").waitForOnlineNaive(g),c("WAWebEventsWaitForBbEvent")(d("WAWebJSHaltDetector").jsHaltDetector,d("WAWebBaseJSHaltDetector").JS_HALT_EVENT,void 0,g),c("WAWebEventsWaitForBbEvent")(b("WAWebStreamModel").Stream,"change:available",void 0,g)],f);return v};return new(d("WAWebWatchdog").Watchdog)({waitAlgorithm:g,jitter:y,onActivated:function(){a.pendingAttempts()===0&&a.attemptOpen(a.signal)},onDeactivated:function(){f&&f.abort()},onTimeout:function(){a.attemptOpen(a.signal);return!0}})};f.deactivate=function(){this.$SocketOpenerMD2(new(d("WAAbortError").AbortError)())};f.pendingAttempts=function(){return this.pendingSocketPromiseCount};f.$SocketOpenerMD4=function(a){var b=this.watchDogController;b&&a>z&&(d("WALogger").LOG(i(),z),b.resetGeneration())};return e}(d("WAWebBaseModel").BaseModel);function B(a,b,c){return d("WAPromiseAny").promiseAny(b).then(function(){a.forceTimeout()})["finally"](function(){c.abort()})["catch"](d("WAAbortError").catchAbort(function(){}))["catch"](function(a){if(a instanceof d("WACustomError").AggregateError&&a.errors.every(function(a){return a.name===d("WAAbortError").ABORT_ERROR}))return;throw a})}e=d("WAWebBaseModel").defineModel(a);g["default"]=e}),98);
__d("WAWebChatSocketPlatformDetails",["Promise","WABase64","WACryptoCurve25519","WALogger","WANullthrows","WAResultOrError","WASignalKeys","WAVerifyChainCertificateWA6","WAWebABProps","WAWebCommonSocketPlatformDetails","WAWebEventsWaitForBbEvent","WAWebGetClientPayloadForLogin","WAWebGetClientPayloadForRegistration","WAWebPageLoadLogging","WAWebSocketOpenerMd","WAWebUserPrefsInfoStore","WAWebUserPrefsMultiDevice","WAWebUserPrefsMultiDeviceDebug","WAWebWorkerCurve25519SignalDependencies","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: processCertificate: failed to set cert chain: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: processCertificate start"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD: error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD: socket event"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: openNewChatSocket"]);m=function(){return a};return a}function a(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(yield d("WAWebUserPrefsMultiDevice").getRoutingInfo());e=e==null?void 0:e.edgeRouting;a=d("WASignalKeys").makeKeyPairFromArrayBuffers(a.pubKey,a.privKey);return{edgeInfo:e,getClientPayload:d("WAWebUserPrefsMultiDevice").isRegistered()?function(){return d("WAWebGetClientPayloadForLogin").getClientPayloadForLogin(c)}:function(){return d("WAWebGetClientPayloadForRegistration").getClientPayloadForRegistration(c)},protoHeader:d("WAWebCommonSocketPlatformDetails").WA_WEB_PROTO_HEADER,encodeHandshakeHello:d("WAWebCommonSocketPlatformDetails").encodeHandshakeHello,decodeServerHello:d("WAWebCommonSocketPlatformDetails").decodeServerHello,encodeHandshakeFinish:d("WAWebCommonSocketPlatformDetails").encodeHandshakeFinish,processCertificate:q,serverStaticKeyIfKnown:d("WAWebCommonSocketPlatformDetails").makeServerInfoIfKnown(d("WAWebUserPrefsMultiDevice").isRegistered()?b:void 0),staticKeyPair:new(d("WACryptoCurve25519").Curve25519)(d("WAWebWorkerCurve25519SignalDependencies").curve25519SignalDependencies,a),openSocket:o,curveSignalDependencies:d("WAWebWorkerCurve25519SignalDependencies").curve25519SignalDependencies,preLogging:{onHandshakeError:d("WAWebPageLoadLogging").incrementPageLoadQplSocketError,onBeforeFullHandshakeStarted:function(){return d("WAWebPageLoadLogging").startPageLoadQplMeasure("auth_handshake")},onAfterFullHandshakeCompleted:function(){return d("WAWebPageLoadLogging").endPageLoadQplMeasure("auth_handshake")}}}});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(m());var b=(yield d("WAWebUserPrefsMultiDevice").getRoutingInfo());b=b?b.edgeRouting:null;b=b?d("WABase64").encodeB64UrlSafe(b):null;d("WAWebPageLoadLogging").startPageLoadQplMeasure("socket_open");var e;try{a=c("WANullthrows")(a,"not received abort signal from Comms");b=new(c("WAWebSocketOpenerMd"))({routingToken:b,signal:a});yield c("WAWebEventsWaitForBbEvent")(b,"change:socket",void 0,a);a=(yield b.socket);d("WAWebPageLoadLogging").endPageLoadQplMeasure("socket_open");d("WALogger").DEV(l());return d("WAResultOrError").makeResult(a)}catch(a){d("WALogger").LOG(k(),a);d("WAWebPageLoadLogging").incrementPageLoadQplSocketError();return d("WAResultOrError").makeError(a)}finally{e==null?void 0:e.deactivate()}});return p.apply(this,arguments)}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.certificate;a=a.serverStatic;if(!d("WAWebABProps").getABPropConfigValue("web_optimized_resume_handshake_enabled"))return(h||(h=b("Promise"))).resolve();d("WALogger").LOG(j());e=d("WAVerifyChainCertificateWA6").verifyChainCertificateWA6(e,a);if(!e.success)throw c("err")("Comms: processCertificate error: "+e.error);a=e.value;e=a.intermediate;a=a.leaf;if(a&&e)return d("WAWebUserPrefsInfoStore").waNoiseInfo.setCertificateChain({intermediate:{key:e.key,notAfter:Number(e.notAfter),notBefore:Number(e.notBefore)},leaf:{key:a.key,notAfter:Number(a.notAfter),notBefore:Number(a.notBefore)}})["catch"](function(a){d("WALogger").ERROR(i(),a)})});return r.apply(this,arguments)}g.getChatSocketPlatformDetails=a}),98);
__d("WAWebOpenChatSocket",["Promise","WABase64","WABinary","WAFrameSocket","WAHex","WALogger","WANoiseHandshake","WANullthrows","WAOpenChatSocket","WAResultOrError","WAVerifyChainCertificateWA6","WAWapDict","WAWebABProps","WAWebChatSocketPlatformDetails","WAWebClientPayload","WAWebCryptoCurve25519","WAWebEventsWaitForBbEvent","WAWebPageLoadLogging","WAWebPassiveModeManager","WAWebProtobufsWa6.pb","WAWebRegisterPassiveTasks","WAWebSignalStoreApi","WAWebSocketLogoutJob","WAWebSocketOpenerMd","WAWebUserPrefsInfoStore","WAWebUserPrefsMultiDevice","WAWebUserPrefsMultiDeviceDebug","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocketForRegistration error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocketForRegistration success, resetting round"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocketForLogin error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocketForLogin success, resetting round"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt noise data"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifying certificate"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket send hello"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket preIntro ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD: socket event"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: openChatSocketCommon"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["certificateCiphertext: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["serverStaticCiphertext: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["serverEphemeral: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["server hello content: ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket rcv hello"]);w=function(){return a};return a}e=6;var x=new Uint8Array([87,65,e,d("WAWapDict").DICT_VERSION]),y="Noise_XX_25519_AESGCM_SHA256\0\0\0\0",z;function A(a){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(r());var b=(yield d("WAWebUserPrefsMultiDevice").getRoutingInfo()),e=b?b.edgeRouting:null;b=e?d("WABase64").encodeB64UrlSafe(e):null;d("WAWebPageLoadLogging").startPageLoadQplMeasure("socket_open");var f=new(c("WAWebSocketOpenerMd"))({routingToken:b,signal:a}),g=d("WAWebCryptoCurve25519").keyPair();b=(yield c("WAWebEventsWaitForBbEvent")(f,"change:socket",void 0,a).then(function(){d("WAWebPageLoadLogging").endPageLoadQplMeasure("socket_open");d("WALogger").DEV(q());return f.socket})["finally"](function(){f.deactivate()}).then(function(a){var b=void 0;if(e){var c=new(d("WABinary").Binary)();c.write("ED",0,1);c.writeUint8(e.byteLength>>16);c.writeUint16(e.byteLength&65535);c.writeBuffer(e);b=c.readByteArray();d("WALogger").DEV(p(),b)}c=b?d("WABinary").Binary.build(b,x).readByteArray():x;b=new(d("WAFrameSocket").FrameSocket)(a,c);d("WAWebPageLoadLogging").startPageLoadQplMeasure("auth_handshake");z=new(d("WANoiseHandshake").NoiseHandshake)(b);z.start(y,x);d("WALogger").LOG(o());z.authenticate(g.pubKey);a={clientHello:{ephemeral:g.pubKey}};return z.sendAndReceive(d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,a).readByteArray())}).then(function(a){return C(z,a,g)}));a=b[0];var h=b[1];b=b[2];d("WAWebPageLoadLogging").endPageLoadQplMeasure("auth_handshake");d("WALogger").LOG(n());h=d("WAVerifyChainCertificateWA6").verifyChainCertificateWA6(h,a);if(!h.success)throw c("err")("verifyCertificateWA6 - "+h.error);return b});return B.apply(this,arguments)}function C(a,e,f){d("WALogger").LOG(w());d("WALogger").DEV(v(),d("WAHex").toLowerCaseHex(e));e=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,e);e=e.serverHello;if(!e)throw c("err")("ServerHello payload error");var g=e.ephemeral,i=e["static"];e=e.payload;if(g==null||i==null||e==null)throw c("err")("Missing server Ephemeral");d("WALogger").DEV(u(),d("WAHex").toLowerCaseHex(new Uint8Array(g)));d("WALogger").DEV(t(),d("WAHex").toLowerCaseHex(new Uint8Array(i)));d("WALogger").DEV(s(),d("WAHex").toLowerCaseHex(new Uint8Array(e)));a.authenticate(g);a.mixIntoKey(d("WAWebCryptoCurve25519").sharedSecret(g,f.privKey));i=a.decrypt(i);var j=i.then(function(a){return d("WAWebCryptoCurve25519").sharedSecret(a,f.privKey)});a.mixIntoKey(j);return(h||(h=b("Promise"))).all([i,a.decrypt(e),g])}function D(a){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var e=a||{passive:!1,pull:!0},f=(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get());a=c("WANullthrows")(a==null?void 0:a.signal,"abort signal is null");a=(yield A(a).then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){f==null&&(d("WALogger").LOG(m()).tags("launch-socket-chat"),yield d("WAWebSocketLogoutJob").socketLogout(),c("WANullthrows")(f,"Unexpected null: noiseData"));var g=c("WANullthrows")(f).staticKeyPair;yield d("WAWebRegisterPassiveTasks").registerPassiveTasksForConnect();e.passive=d("WAWebPassiveModeManager").PassiveTaskManager.shouldConnectAsPassiveMode();var i=(yield d("WAWebClientPayload").getClientPayloadForLogin(e));return(h||(h=b("Promise"))).all([H(g,z,a),z.encrypt(h.resolve(i))])});return function(b){return a.apply(this,arguments)}}()).then(function(a){var b=a[0];a=a[1];b={clientFinish:{"static":b,payload:a}};z.send(d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,b).readByteArray());return z.finish()}));d("WALogger").LOG(l());return d("WAResultOrError").makeResult(a)}catch(a){d("WAWebPageLoadLogging").incrementPageLoadQplSocketError();d("WALogger").WARN(k(),a);return d("WAResultOrError").makeError("disconnected")}});return E.apply(this,arguments)}function F(a){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var e=c("WANullthrows")(a==null?void 0:a.signal,"abort signal is null");e=(yield A(e).then(function(a){return(h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo(),d("WAWebSignalStoreApi").waSignalStore.getSignedPreKey(),a])}).then(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var f=e[0],g=e[1];e=e[2];if(!g||!f)throw c("err")("Invalid signal credentials");f=(yield d("WAWebClientPayload").getClientPayloadForRegistration(f,g,a));g=c("WANullthrows")(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get()).staticKeyPair;return(h||(h=b("Promise"))).all([H(g,z,e),z.encrypt(h.resolve(f))])});return function(a){return e.apply(this,arguments)}}()).then(function(a){var b=a[0];a=a[1];b={clientFinish:{"static":b,payload:a}};z.send(d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,b).readByteArray());return z.finish()}));d("WALogger").LOG(j());return d("WAResultOrError").makeResult(e)}catch(a){d("WALogger").WARN(i(),a);return d("WAResultOrError").makeError("disconnected")}});return G.apply(this,arguments)}function H(a,e,f){var g=(h||(h=b("Promise"))).resolve(a.pubKey);g=e.encrypt(g);if(!f)return(h||(h=b("Promise"))).reject(c("err")("staticAgreement called before serverKeys"));f=d("WAWebCryptoCurve25519").sharedSecret(f,a.privKey);e.mixIntoKey(f);return g}function a(a){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebUserPrefsMultiDevice").isRegistered();if(d("WAWebABProps").getABPropConfigValue("web_optimized_handshake_flow_enabled")){var e=c("WANullthrows")(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get()),f=e.staticKeyPair;e=e.certificateChainBuffer?d("WAWebUserPrefsInfoStore").waNoiseInfo.getCertficateChain(e.certificateChainBuffer):void 0;f=(yield d("WAWebChatSocketPlatformDetails").getChatSocketPlatformDetails(f,e,a));return d("WAOpenChatSocket").openChatSocket(f,function(){},a==null?void 0:a.signal)}return b?D(a):F(a)});return I.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebCommsConfig",["WALogger","WANullthrows","WAWapJid","WAWebABProps","WAWebCmd","WAWebCommsProcessAck","WAWebCommsSendPing","WAWebMdDebugMdStanza.react","WAWebModalManager","WAWebOfflineResumePreAckHandler","WAWebOpenChatSocket","WAWebSocketConstants","WAWebUserPrefsMultiDevice","WAWebUserPrefsMultiDeviceDebug","gkx","react"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ack.to is a "," not a WapJid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms:getCommsConfig:onSocketLoopIteration"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms:getCommsConfig:onSocketOpen"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms:getCommsConfig:onDisconnect"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms:getCommsConfig:openChatSocket"]);m=function(){return a};return a}b=!1;function a(a){var b=a?a:{passive:!1,pull:!1};return{maxRetries:Number.MAX_SAFE_INTEGER,openChatSocket:function(a,e){d("WAWebABProps").getABPropConfigValue("web_comms_socket_reconnect_enabled")?b.signal=c("WANullthrows")(e):b.signal=new AbortController().signal;return c("WAWebOpenChatSocket")(b).then(function(c){d("WALogger").DEV(m()).devConsole(c);a();b.passive=!1;return c})},healthCheckInterval:15,deadSocketTime:2e4,maxSocketLoopWaitTime:6e4*15,shouldCloseStaleSocket:!0,shouldBlockReceivingUntilSuccess:!0,handlers:{onConnect:function(){d("WAWebUserPrefsMultiDevice").isRegistered()&&(d("WAWebCmd").Cmd.setSocketState(d("WAWebSocketConstants").SOCKET_STATE.CONNECTED),d("WAWebCmd").Cmd.openSocketStream())},onDisconnect:function(){d("WALogger").DEV(l()),d("WAWebCmd").Cmd.socketStreamDisconnected()},onSocketOpen:function(){d("WALogger").DEV(k()),d("WAWebCmd").Cmd.setSocketState(d("WAWebSocketConstants").SOCKET_STATE.PAIRING)},onSocketLoopIteration:function(a){d("WAWebABProps").getABPropConfigValue("web_prevent_parallel_socket_connection_enabled")&&(a==null?void 0:a.abort()),d("WALogger").DEV(j()),d("WAWebCmd").Cmd.setSocketState(d("WAWebSocketConstants").SOCKET_STATE.OPENING)},onConnectionChange:function(a){},onOptimisticConnectionChange:function(a){},onBeforeCastStanzaForE2E:function(a,b){a.tag==="ack"&&!(b==null?void 0:b.preAck)&&!d("WAWebCmd").Cmd.isOfflineDeliveryEnd&&void d("WAWebOfflineResumePreAckHandler").parseAndSerializeOfflinePreAck(a)},onCastStanza:function(a){c("gkx")("26259")&&(a.tag==="ack"&&!(a.attrs.to instanceof d("WAWapJid").WapJid)&&d("WALogger").ERROR(i(),typeof a.attrs.to,a).sendLogs("send-string-jid"))},onHandleAck:function(a){c("WAWebCommsProcessAck")(a)},onHandleStanza:function(a){},onSendIq:function(a){},onClockSkewUpdate:function(a){d("WAWebCommsSendPing").updateClockSkew(a)}}}}g.getCommsConfig=a}),98);
__d("WAWebEventsWaitForMain",["Promise","WAWebCmd","WAWebEventsWaitForBbEvent"],(function(a,b,c,d,e,f,g){var h;function a(){return d("WAWebCmd").Cmd.isMainLoaded?(h||(h=b("Promise"))).resolve():c("WAWebEventsWaitForBbEvent")(d("WAWebCmd").Cmd,"main_loaded")}g["default"]=a}),98);
__d("WAWebInitFavoritesFromStorage",["WAWebFavoriteCollection","WAWebSchemaFavorite"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebSchemaFavorite").getFavoriteTable().all().then(function(a){d("WAWebFavoriteCollection").FavoriteCollection.initializeFromCache(a)})}g.restoreFavorites=a}),98);
__d("WAWebPersistBotProfiles",["WAWebBotProfileCollection","WAWebSchemaBotProfile","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebSchemaBotProfile").getBotProfileTable().bulkCreateOrMerge(a.map(function(a){return{id:a.id.toString(),name:a.name,attrs:a.attrs,description:a.description,category:a.category,isDefault:a.isDefault,prompts:JSON.stringify(a.prompts),personaId:a.personaId,commands:JSON.stringify(a.commands),commandsDescription:a.commandsDescription}})),a.forEach(function(a){return d("WAWebBotProfileCollection").BotProfileCollection.gadd({id:a.id,name:a.name,attrs:a.attrs,description:a.description,category:a.category,isDefault:a.isDefault,prompts:a.prompts,personaId:a.personaId,commands:a.commands,commandsDescription:a.commandsDescription})})});return h.apply(this,arguments)}g.persistBotProfiles=a}),98);
__d("WASmaxInBotIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInBotIQErrorForbiddenMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","forbidden");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",403);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorForbiddenMixin=a}),98);
__d("WASmaxInBotIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInBotIQErrorNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-allowed");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",405);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAllowedMixin=a}),98);
__d("WASmaxInBotIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup",["WAResultOrError","WASmaxInBotIQErrorBadRequestMixin","WASmaxInBotIQErrorForbiddenMixin","WASmaxInBotIQErrorInternalServerErrorMixin","WASmaxInBotIQErrorNotAllowedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInBotIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInBotIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:c.value});var e=d("WASmaxInBotIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:e.value});var f=d("WASmaxInBotIQErrorNotAllowedMixin").parseIQErrorNotAllowedMixin(a);return f.success?d("WAResultOrError").makeResult({name:"IQErrorNotAllowed",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorForbidden","IQErrorBadRequest","IQErrorNotAllowed"],[b,c,e,f])}g.parseIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup=a}),98);
__d("WASmaxInBotIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInBotBotListResponseError",["WAResultOrError","WASmaxInBotIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup","WASmaxInBotIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInBotIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInBotIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup").parseIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup:b.value}))}g.parseBotListResponseError=a}),98);
__d("WASmaxInBotEnums",[],(function(a,b,c,d,e,f){a={"AI available":"AI available","Added to waitlist":"Added to waitlist","In waitlist":"In waitlist"};b={"AI available":"AI available","In waitlist":"In waitlist"};c={all:"all",category:"category",featured:"featured"};d={dark:"dark",light:"light"};e={"false":"false","true":"true"};f.ENUM_AIAVAILABLE_ADDEDTOWAITLIST_INWAITLIST=a;f.ENUM_AIAVAILABLE_INWAITLIST=b;f.ENUM_ALL_CATEGORY_FEATURED=c;f.ENUM_DARK_LIGHT=d;f.ENUM_FALSE_TRUE=e}),66);
__d("WASmaxInBotIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInBotBotListResponseSuccessV1",["WAResultOrError","WASmaxInBotEnums","WASmaxInBotIQResultResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"bot");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"default",d("WASmaxInBotEnums").ENUM_FALSE_TRUE);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,"default":a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"bot");if(!c.success)return c;var e=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"v","1");if(!e.success)return e;a=d("WASmaxInBotIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"bot",1,Infinity,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({botV:e.value},a.value,{botBot:b.value}))}g.parseBotListResponseSuccessV1BotBot=h;g.parseBotListResponseSuccessV1=a}),98);
__d("WASmaxInBotBotListResponseSuccessV2",["WAResultOrError","WASmaxInBotEnums","WASmaxInBotIQResultResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"theme");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"background");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a,"primary_text");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(a,"secondary_text");if(!e.success)return e;a=d("WASmaxParseUtils").attrStringEnum(a,"mode",d("WASmaxInBotEnums").ENUM_DARK_LIGHT);if(!a.success)return a;b=d("WASmaxParseUtils").contentString(b.value);if(!b.success)return b;c=d("WASmaxParseUtils").contentString(c.value);if(!c.success)return c;e=d("WASmaxParseUtils").contentString(e.value);return!e.success?e:d("WAResultOrError").makeResult({mode:a.value,backgroundElementValue:b.value,primaryTextElementValue:c.value,secondaryTextElementValue:e.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"bot");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"persona_id");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,a,"count");if(!e.success)return e;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"theme",0,2,h);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,personaId:c.value,count:e.value,theme:a.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"section");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;var c=d("WASmaxParseUtils").attrStringEnum(a,"type",d("WASmaxInBotEnums").ENUM_ALL_CATEGORY_FEATURED);if(!c.success)return c;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"bot",0,Infinity,i);return!a.success?a:d("WAResultOrError").makeResult({name:b.value,type:c.value,bot:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"bot");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"default");if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"v","2");if(!f.success)return f;var g=d("WASmaxParseJid").attrUserJid(e.value,"jid");if(!g.success)return g;e=d("WASmaxParseUtils").attrString(e.value,"persona_id");if(!e.success)return e;a=d("WASmaxInBotIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"section",1,Infinity,j);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({botV:f.value,botDefaultJid:g.value,botDefaultPersonaId:e.value},a.value,{botSection:b.value}))}g.parseBotListResponseSuccessV2BotSectionBotTheme=h;g.parseBotListResponseSuccessV2BotSectionBot=i;g.parseBotListResponseSuccessV2BotSection=j;g.parseBotListResponseSuccessV2=a}),98);
__d("WASmaxOutBotBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutBotBotListIQMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutBotBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxOutBotBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"bot"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotListIQMixin=a}),98);
__d("WASmaxOutBotBotListRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutBotBotListIQMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.botV;a=d("WASmaxOutBotBotListIQMixin").mergeBotListIQMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("bot",{v:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}g.makeBotListRequest=a}),98);
__d("WASmaxBotBotListRPC",["WAComms","WASmaxInBotBotListResponseError","WASmaxInBotBotListResponseSuccessV1","WASmaxInBotBotListResponseSuccessV2","WASmaxOutBotBotListRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutBotBotListRequest").makeBotListRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInBotBotListResponseSuccessV1").parseBotListResponseSuccessV1(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"BotListResponseSuccessV1",value:g.value});case 7:h=d("WASmaxInBotBotListResponseSuccessV2").parseBotListResponseSuccessV2(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"BotListResponseSuccessV2",value:h.value});case 10:i=d("WASmaxInBotBotListResponseError").parseBotListResponseError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"BotListResponseError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("BotList",{SuccessV1:g,SuccessV2:h,Error:i}));case 14:case"end":return j.stop()}},null,this)}g.sendBotListRPC=a}),98);
__d("WAWebRequestBotList",["WALogger","WASmaxBotBotListRPC","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] requestBotList failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] requestBotList failed"]);i=function(){return a};return a}function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASmaxBotBotListRPC").sendBotListRPC({botV:"2"}));switch(a.name){case"BotListResponseSuccessV1":var b=a.value.botBot;b=b.map(function(a){return{id:d("WAWebWidFactory").createWid(a.jid),isDefault:a["default"]==="true"}});var c=b.filter(function(a){return a.isDefault===!0}).length;if(c!==1){d("WALogger").ERROR(i()).devConsole("[bot] requestBotList response has "+c+" default bots");return[]}return b;case"BotListResponseSuccessV2":c=a.value;var e=c.botDefaultJid;b=c.botSection;var f=[];b.forEach(function(a){a.bot.forEach(function(a){var b=a.jid;a=a.personaId;f.push({id:d("WAWebWidFactory").createWid(b),isDefault:b===e,personaId:a})})});return f;case"BotListResponseError":c=a.value.errorIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup.value;b=c.code;a=c.text;d("WALogger").ERROR(h()).devConsole("[bot] requestBotList failed with code "+b+", "+a);return[]}});return j.apply(this,arguments)}g.requestBotList=a}),98);
__d("WAWebBotProfileCategory",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({SYNTHETIC:"synthetic",LIVING:"living",FICTIONAL:"fictional",HISTORICAL:"historical"});f.BotProfileCategory=a}),66);
__d("WAWebRequestBotProfiles",["Promise","WAWebBackendErrors","WAWebBotProfileCategory","WAWebUsync","WAWebUsyncUser","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return(h||(h=b("Promise"))).resolve([]);var e=new(d("WAWebUsync").USyncQuery)().withContext("interactive").withMode("query").withBotProfileProtocol();a.forEach(function(a){var b=a.id;a=a.personaId;e.withUser(new(d("WAWebUsyncUser").USyncUser)().withId(b).withPersonaId(a))});a=(yield e.execute());var f=a.error.all||a.error.status;if(f)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(f.errorCode,f.errorText);f=a.list;return!f.length?(h||(h=b("Promise"))).reject(c("err")("no status data returned for user")):f.map(function(a){var b=a.bot;a=a.id;return{id:a,name:b.name,attrs:b.attributes,description:b.description,category:(a=d("WAWebBotProfileCategory").BotProfileCategory.cast(b.category))!=null?a:d("WAWebBotProfileCategory").BotProfileCategory.SYNTHETIC,isDefault:b.isDefault,prompts:b.prompts,personaId:b.personaId,commands:b.commands,commandsDescription:b.commandsDescription}})});return i.apply(this,arguments)}g.requestBotProfiles=a}),98);
__d("WAWebRestoreBotProfilesFromDb",["WALogger","WAWebBotProfileCollection","WAWebSchemaBotProfile","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: commands parsing failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: commands are not an array"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: prompts parsing failed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: prompts are not an array"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: invalid id"]);l=function(){return a};return a}function a(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaBotProfile").getBotProfileTable().all());a.forEach(function(a){var b;try{b=d("WAWebWidFactory").createUserWid(a.id)}catch(a){d("WALogger").ERROR(l()).sendLogs("restore-bot-profiles: invalid id");return}var c=[];if(a.prompts!=null)try{c=JSON.parse(a.prompts),Array.isArray(c)||(c=[],d("WALogger").ERROR(k()).sendLogs("restore-bot-profiles: prompts are not an array"))}catch(a){d("WALogger").ERROR(j()).sendLogs("restore-bot-profiles: prompts parsing failed")}var e=[];if(a.commands!=null)try{e=JSON.parse(a.commands),Array.isArray(e)||(e=[],d("WALogger").ERROR(i()).sendLogs("restore-bot-profiles: commands are not an array"))}catch(a){d("WALogger").ERROR(h()).sendLogs("restore-bot-profiles: commands parsing failed")}d("WAWebBotProfileCollection").BotProfileCollection.gadd({id:b,name:a.name,attrs:a.attrs,description:a.description,category:a.category,isDefault:a.isDefault,prompts:c,personaId:a.personaId,commands:e})})});return m.apply(this,arguments)}g.restoreBotProfilesFromDb=a}),98);
__d("WAWebInitializeBots",["WALogger","WATimeUtils","WAWebABProps","WAWebBotGating","WAWebCmd","WAWebPersistBotProfiles","WAWebRequestBotList","WAWebRequestBotProfiles","WAWebRestoreBotProfilesFromDb","WAWebRuntimeEnvironmentUtils","WAWebUserPrefsBot","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] initializing bots complete, next fetch at ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] restoring bots from DB"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] requesting bots from server"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] not initializing bots due to feature being disabled"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] skipping bot initialization in worker"]);l=function(){return a};return a}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebRuntimeEnvironmentUtils").isWorker()){d("WALogger").LOG(l());return}if(!d("WAWebBotGating").isBotEnabled()){d("WALogger").LOG(k());return}var a=d("WAWebUserPrefsBot").getBotListLastRequestedTimestamp(),c=d("WATimeUtils").unixTime(),e=d("WAWebABProps").getABPropConfigValue("bonsai_update_interval"),f;a+e<c?(d("WALogger").LOG(j()),yield o(),f=e):(d("WALogger").LOG(i()),yield d("WAWebRestoreBotProfilesFromDb").restoreBotProfilesFromDb(),f=a+e-c);self.setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield m()}),f*1e3);d("WALogger").LOG(h(),c+f)});return n.apply(this,arguments)}function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebRequestBotList").requestBotList());a=(yield d("WAWebRequestBotProfiles").requestBotProfiles(a));yield d("WAWebPersistBotProfiles").persistBotProfiles(a);d("WAWebUserPrefsBot").setBotListLastRequestedTimestamp(d("WATimeUtils").unixTime())});return p.apply(this,arguments)}d("WAWebCmd").Cmd.on("bot_waitlist_state_updated",function(){void m()});d("WAWebCmd").Cmd.on("on_ab_props_update",function(){void m()});d("WAWebCmd").Cmd.on("ab_props_loaded",function(){void m()});g.initializeBots=m}),98);
__d("WAWebMergeContactRecordsById",["WALogger","WAWebModelStorageUtils","WAWebSchemaContact","WAWebUserPrefsIndexedDBStorage","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["mergeContactRecordsById: end migration"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["mergeContactRecordsById: start migration"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["mergeContactRecordsById: migration already complete"]);j=function(){return a};return a}function a(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebModelStorageUtils").getStorage().lock(["contact","user-prefs"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get("WAContactMigrationIdComplete")){d("WALogger").LOG(j());return}d("WALogger").LOG(i());var a=(yield d("WAWebSchemaContact").getContactTable().all()).filter(function(a){return a.id.endsWith("@c.us")});yield d("WAWebSchemaContact").getContactTable().bulkCreateOrMerge(a.map(function(a){var b=a.id;a=a.pushname;return{id:d("WAWebWidFactory").createWid(b).toJid(),pushname:a}}));yield d("WAWebSchemaContact").getContactTable().bulkRemove(a.map(function(a){a=a.id;return a}));yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set("WAContactMigrationIdComplete",!0);d("WALogger").LOG(h())}))});return k.apply(this,arguments)}g.mergeContactRecordsById=a}),98);
__d("WAWebNewsletterMetadataInitFromStorage",["WAJids","WALinkify","WALogger","WAWebBackendApi","WAWebCommonNewsletterEnums","WAWebNewsletterMessageDeliveryUpdateToModelUtils","WAWebNewsletterMetadataCollection","WAWebSchemaNewsletterMetadata","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: restoreNewsletterMetadata: complete restoring newsletter metadata"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: restoreNewsletterMetadata: start restoring newsletter metadata"]);i=function(){return a};return a}function j(a){switch(a){case 0:return d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Subscriber;case 1:return d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Admin;case 3:return d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Owner;case 2:default:return d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Guest}}function k(a){switch(a){case 0:return d("WAWebCommonNewsletterEnums").NewsletterReactionCodesSetting.All;case 3:return d("WAWebCommonNewsletterEnums").NewsletterReactionCodesSetting.None;case 2:return d("WAWebCommonNewsletterEnums").NewsletterReactionCodesSetting.Blocklist;case 1:default:return d("WAWebCommonNewsletterEnums").NewsletterReactionCodesSetting.Basic}}function l(a){switch(a){case 1:return d("WAWebCommonNewsletterEnums").NewsletterPrivacy.Private;case 0:default:return d("WAWebCommonNewsletterEnums").NewsletterPrivacy.Public}}function a(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").DEV(i());try{var a=(yield d("WAWebSchemaNewsletterMetadata").getNewsletterMetadataTable().all());a.forEach(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebWidFactory").createWid(a.id),e={id:b,creationTime:a.creationTime,name:a.name,nameUpdateTime:a.nameUpdateTime,description:a.description,descriptionUpdateTime:a.descriptionUpdateTime,handle:a.handle,inviteCode:a.inviteCode,size:a.size,verified:a.verified,membershipType:j(a.membershipType),reactionCodesSetting:k(a.reactionCodesSetting),privacy:l(a.privacy),website:a.website!=null?d("WALinkify").findLink(a.website):null,adminCount:a.adminCount,suspended:a.suspended,geosuspended:a.geosuspended,terminated:a.terminated};c("WAWebNewsletterMetadataCollection")==null?void 0:c("WAWebNewsletterMetadataCollection").add(e,{merge:!0});if(a.messageDeliveryUpdates!=null){var f=[];a.messageDeliveryUpdates.forEach(function(a,b){return f.push({id:b,code:a.code})});e=(yield d("WAWebNewsletterMessageDeliveryUpdateToModelUtils").getMessageDeliveryUpdatesModelToUpdate(d("WAJids").toNewsletterJid(a.id),f,[]));a=e.modelUpdatesToAdd;yield d("WAWebBackendApi").frontendFireAndForget("updateNewsletterMessageDeliveryUpdate",{id:b,modelUpdatesToAdd:a,modelUpdatesToRemove:[]})}});return function(b){return a.apply(this,arguments)}}())}finally{d("WALogger").DEV(h())}});return m.apply(this,arguments)}g.restoreNewsletterMetadata=a}),98);
__d("WAWebBlockingOfflineResumeManager",["WALogger","WAShiftTimer","WAWebApiPendingDeviceSync","WAWebBackendApi","WAWebBrokerGlobalAppState","WAWebChatThreadLogging","WAWebCmd","WAWebHandleMsgTypes.flow","WAWebHandleOfflineAbProps","WAWebJSHaltDetector","WAWebMessageThread","WAWebOfflineResumeConst","WAWebOfflineResumeTypes.flow","WAWebOfflineResumeUtils","WAWebSignalProtocolStore","WAWebUserPrefsGeneral","WAWebWamEnumWebcScenarioType","WAWebWamOfflineResumeReporter","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] _onOfflineComplete: clearOfflineSnapShot done."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] _onOfflineComplete: waitForOfflineMsgThread done, total decryption error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking]offline resume finished by timeout"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking]: offline session completed by timeout"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] "," received after offline completion marker. Refreshing window due to potential server issue."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] start handling offline stanza"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] Reject multiple offline preview ib during offline resume, delay ","."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] Reject multiple offline preview ibs during offline resume, delay ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] Accept multiple offline preview ibs during offline resume, delay ","."]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] start handling offline stanza"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] restart client due to exceed the LIMIT, message: ",", receipt: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] Offline session is complete when receiving offline preview ib."]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] offline resume stage: "," -> ",""]);t=function(){return a};return a}a=function(){function a(){var a=this;this._offlineCompleteTimer=null;this._progressBarTimer=new(d("WAShiftTimer").ShiftTimer)(function(){d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),a._progressBarTimer.onOrAfter(d("WAWebOfflineResumeConst").UI_UPDATE_TIME_MS)});this._chatsAndMsgsRestored=!1;this._initState()}var e=a.prototype;e._initState=function(){this.offlineMessagePreviewCounter=-1,this._decryptedMessageCount=0,this._decryptionErrorCount=0,this._finishedDownloading=!1,this._hasMessagesToDownload=null,this._status=d("WAWebOfflineResumeConst").ResumeStatus.INIT};e._setStatus=function(a){d("WALogger").LOG(t(),this._status,a),this._status=a};e.processOfflinePreview=function(a){d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflinePreviewT();if(this.isResumeFromRestartComplete())d("WALogger").LOG(s()),d("WAWebOfflineResumeUtils").exceedResumeWithOpenTabLimit(a.message,a.receipt)&&(d("WALogger").LOG(r(),a.message,a.receipt),d("WAWebOfflineResumeUtils").refreshWindow()),d("WAWebJSHaltDetector").jsHaltDetector.restartDetection(),this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB),d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!1}),self.setTimeout(function(){d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!0})},7e3);else if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.INIT)c("WAWebBrokerGlobalAppState").initOrUpdateTracking(d("WAWebWamEnumWebcScenarioType").WEBC_SCENARIO_TYPE.OFFLINE_RESUME),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineCount(a),this._hasMessagesToDownload=a.message>0,this._finishedDownloading=a.message===0,this.offlineMessagePreviewCounter=a.message,this._decryptedMessageCount=0,this._firstPreviewReceivedT=Date.now(),d("WAWebSignalProtocolStore").enableMemSignalStore(),d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),d("WAWebJSHaltDetector").jsHaltDetector.restartDetection(),this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.RESUME_ON_RESTART),this._startOfflineCompleteTimer(a.message,a.receipt),this._progressBarTimer.onOrAfter(d("WAWebOfflineResumeConst").UI_UPDATE_TIME_MS),d("WAWebCmd").Cmd.readyForProcessOffline(),d("WALogger").LOG(q());else{var b=this._firstPreviewReceivedT;if(b!=null){b=Date.now()-b;b<d("WAWebOfflineResumeConst").OFFLINE_PREVIEW_PERIOD_MS?(d("WALogger").LOG(p(),b),this.offlineMessagePreviewCounter+=a.message,this._hasMessagesToDownload=this.offlineMessagePreviewCounter>0,this._finishedDownloading=this.offlineMessagePreviewCounter===0,d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineCount(a),d("WAWebCmd").Cmd.handleOfflineProgressUpdate()):!c("gkx")("26258")?d("WALogger").ERROR(o(),b).sendLogs("offline-multiple-preview"):d("WALogger").LOG(n(),b)}this._refreshOfflineCompleteTimer()}};e.getOfflineDeliveryProgress=function(){if(this._finishedDownloading)return 100;else if(this.offlineMessagePreviewCounter===-1)return 0;else if(this.offlineMessagePreviewCounter===0)return 100;return Math.min(Math.ceil(100*this._decryptedMessageCount/this.offlineMessagePreviewCounter),100)};e.processOfflineSessionComplete=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,c=this;a=a;self.setTimeout(function(){d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!0})},3e3);(b=this._offlineCompleteTimer)==null?void 0:b.cancel();this._offlineCompleteTimer=null;d("WAWebCmd").Cmd.readyForProcessOffline();d("WALogger").LOG(m());if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE){d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&(d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logLastStanzaT(),void d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.commit());return}else if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB){yield d("WAWebMessageThread").waitForOnlineMsgThread();yield d("WAWebApiPendingDeviceSync").doPendingDeviceSync();this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE);return}this._hasMessagesToDownload=a>0;this._finishedDownloading=a===0;this._offlineStanzaCountAfterOfflineMarker=0;self.setTimeout(function(){c._offlineStanzaCountAfterOfflineMarker>d("WAWebOfflineResumeConst").OFFLINE_STANZA_COUNT_LIMIT&&(d("WALogger").WARN(l(),c._offlineStanzaCountAfterOfflineMarker),d("WAWebOfflineResumeUtils").refreshWindow())},d("WAWebOfflineResumeConst").OFFLINE_STANZA_COUNT_CHECK_TIMEOUT_MS);d("WAWebCmd").Cmd.handleOfflineProgressUpdate();this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE);return this._handleOfflineComplete()});function c(b){return a.apply(this,arguments)}return c}();e.isResumeFromRestartComplete=function(){return this._status!==d("WAWebOfflineResumeConst").ResumeStatus.RESUME_ON_RESTART&&this._status!==d("WAWebOfflineResumeConst").ResumeStatus.INIT};e.isResumeOnSocketDisconnectInProgress=function(){return this._status===d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB};e.isResumeFromRestartInProgress=function(){return this._status!==d("WAWebOfflineResumeConst").ResumeStatus.INIT&&!d("WAWebCmd").Cmd.isOfflineDeliveryEnd};e.getHasMessagesToDownload=function(){return this._hasMessagesToDownload};e.getFinishedDownloading=function(){return this.getOfflineDeliveryProgress()===100};e.shouldUseOfflineResumeScreen=function(){return this.offlineMessagePreviewCounter>this._decryptedMessageCount};e.processDecryptResult=function(a){this._refreshOfflineCompleteTimer(),this._decryptedMessageCount+=1,a===d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY&&(this._decryptionErrorCount+=1)};e.offlineStanzaReceivedAfterComplete=function(){this.isResumeFromRestartComplete()&&(this._offlineStanzaCountAfterOfflineMarker+=1)};e.newOfflineStanza=function(a,b){this._refreshOfflineCompleteTimer(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logAddOfflineSizeBytes(b),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOldestStanzaTime(a)};e.getResumeUIProgressBarType=function(){return d("WAWebOfflineResumeTypes.flow").ResumeUIProgressBarType.None};e._refreshOfflineCompleteTimer=function(){this._offlineCompleteTimer&&this._offlineCompleteTimer.onOrAfter(d("WAWebOfflineResumeConst").OFFLINE_STANZA_TIMEOUT_MS)};e._startOfflineCompleteTimer=function(a,b){var c,e=this;(c=this._offlineCompleteTimer)==null?void 0:c.cancel();this._offlineCompleteTimer=new(d("WAShiftTimer").ShiftTimer)(function(){e._status!==d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE&&(d("WALogger").LOG(k()),d("WALogger").ERROR(j()).sendLogs("blocking-offline-resume-timeout",.01),e.processOfflineSessionComplete(a+b),e._offlineCompleteTimer=null,d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logMissedOfflineComplete())});this._offlineCompleteTimer.onOrAfter(d("WAWebOfflineResumeConst").OFFLINE_STANZA_TIMEOUT_MS)};e._handleOfflineComplete=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebMessageThread").waitForOfflineMsgThread(),this._finishedDownloading=!0,d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineDecryptionErrorCount(this._decryptionErrorCount),d("WALogger").LOG(i(),this._decryptionErrorCount),this._decryptionErrorCount=0,yield d("WAWebOfflineResumeUtils").clearOfflineSnapShot(),d("WALogger").LOG(h()),d("WAWebSignalProtocolStore").enablePersistSignalStore(),d("WAWebOfflineResumeUtils").runReceiptCleanUpLoop(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logLastStanzaT(),yield d("WAWebOfflineResumeUtils").loadMainScreen({shouldUpdateReceipts:!0,shouldRestoreChatsAndMsgs:!this._chatsAndMsgsRestored}),d("WAWebCmd").Cmd.offlineDeliveryEnd(),d("WAWebUserPrefsGeneral").setOfflinePushCount(0),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.commit(),d("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("processAllOrphanPaymentNotifications"),d("WAWebChatThreadLogging").uploadChatThreadLoggingEvents(),c("WAWebBrokerGlobalAppState").initOrUpdateTracking(d("WAWebWamEnumWebcScenarioType").WEBC_SCENARIO_TYPE.IDLE),self.setTimeout(function(){d("WAWebApiPendingDeviceSync").doPendingDeviceSync()},d("WAWebOfflineResumeConst").OFFLINE_DEVICE_SYNC_DELAY)});function a(){return a.apply(this,arguments)}return a}();return a}();g.OfflineBlockingResumeStageManager=a}),98);
__d("WAWebThreadMetadata",["WALogger","WAWebBackendApi"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processOfflineThreadMeta:"]);h=function(){return a};return a}var i=null;function a(a){d("WALogger").DEV(h()).devConsole(a),i=a,d("WAWebBackendApi").frontendFireAndForget("updateChatPreviewT",{threadMeta:a.chatTimestamp})}function b(){return i}function c(){var a;a=(a=i)==null?void 0:a.chatTimestamp;a!=null&&d("WAWebBackendApi").frontendFireAndForget("resetChatPreviewT",{chatIds:Object.keys(a)});i=null}g.setOfflineThreadMeta=a;g.getOfflineThreadMetaPreview=b;g.resetThreadMeta=c}),98);
__d("WAWebNonBlockingOfflineResumeManager",["WALogger","WAShiftTimer","WAWebApiPendingDeviceSync","WAWebBackendApi","WAWebBrokerGlobalAppState","WAWebChatThreadLogging","WAWebCmd","WAWebHandleMsgTypes.flow","WAWebHandleOfflineAbProps","WAWebJSHaltDetector","WAWebMessageThread","WAWebOffdStorageUpdateOfflinePeerReceipts","WAWebOfflineResumeConst","WAWebOfflineResumeTypes.flow","WAWebOfflineResumeUtils","WAWebSignalProtocolStore","WAWebThreadMetadata","WAWebUserPrefsGeneral","WAWebWamEnumWebcScenarioType","WAWebWamOfflineResumeReporter","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] _onOfflineComplete: clearOfflineSnapShot done."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] _onOfflineComplete: waitForOfflineMsgThread done, total decryption error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] offline resume finished by timeout"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking]: offline session completed by timeout"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] "," received after offline completion marker. Refreshing window due to potential server issue."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] Reject multiple offline preview ib during offline resume, delay ","."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] Reject multiple offline preview ibs during offline resume, delay ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] Accept multiple offline preview ibs during offline resume, delay ","."]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[resume-from-open-tab] Main screen is loaded"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] restart client due to exceed the LIMIT, message: ",", receipt: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] Offline session is complete when receiving offline preview ib."]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[resume-from-open-tab] reset offline delivery end to false"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] offline resume stage: "," -> ",""]);t=function(){return a};return a}var u=100;a=function(){function a(a){var b=this;this._offlineCompleteTimer=null;this._progressBarTimer=new(d("WAShiftTimer").ShiftTimer)(function(){d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),b._progressBarTimer.onOrAfter(d("WAWebOfflineResumeConst").UI_UPDATE_TIME_MS)});this._maxProgress=95;(a==null?void 0:a.mainScreenLoaded)&&(this._mainScreenLoaded=!0);this._initState()}var e=a.prototype;e._initState=function(){this.offlineMessagePreviewCounter=-1,this._decryptedMessageCount=0,this._decryptionErrorCount=0,this._finishedDownloading=!1,this._hasMessagesToDownload=null,this._status=d("WAWebOfflineResumeConst").ResumeStatus.INIT};e._setStatus=function(a){d("WALogger").LOG(t(),this._status,a),this._status=a};e.processOfflinePreview=function(a){d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflinePreviewT();d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&this._mainScreenLoaded&&(d("WALogger").LOG(s()),d("WAWebCmd").Cmd.offlineDeliveryStart());if(this.isResumeFromRestartComplete())d("WALogger").LOG(r()),d("WAWebOfflineResumeUtils").exceedResumeWithOpenTabLimit(a.message,a.receipt)&&(d("WALogger").LOG(q(),a.message,a.receipt),d("WAWebOfflineResumeUtils").refreshWindow()),d("WAWebJSHaltDetector").jsHaltDetector.restartDetection(),this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB),d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!1}),self.setTimeout(function(){d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!0})},7e3);else if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.INIT)c("WAWebBrokerGlobalAppState").initOrUpdateTracking(d("WAWebWamEnumWebcScenarioType").WEBC_SCENARIO_TYPE.OFFLINE_RESUME),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineCount(a),this.offlineMessagePreviewCounter=a.message,this._hasMessagesToDownload=!1,this._finishedDownloading=!0,this._decryptedMessageCount=0,this._firstPreviewReceivedT=Date.now(),d("WAWebSignalProtocolStore").enableMemSignalStore(),d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),d("WAWebJSHaltDetector").jsHaltDetector.restartDetection(),this._progressBarTimer.onOrAfter(d("WAWebOfflineResumeConst").UI_UPDATE_TIME_MS),this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.RESUME_ON_RESTART),this._startOfflineCompleteTimer(a.message,a.receipt),!this._mainScreenLoaded?this._mainScreenLoadPromise=d("WAWebOfflineResumeUtils").loadMainScreen({}):d("WALogger").LOG(p());else{var b=this._firstPreviewReceivedT;if(b!=null){b=Date.now()-b;b<d("WAWebOfflineResumeConst").OFFLINE_PREVIEW_PERIOD_MS?(d("WALogger").LOG(o(),b),this.offlineMessagePreviewCounter+=a.message,this._hasMessagesToDownload=!1,this._finishedDownloading=!0,d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineCount(a)):!c("gkx")("26258")?d("WALogger").ERROR(n(),b).sendLogs("offline-multiple-preview"):d("WALogger").LOG(m(),b)}this._refreshOfflineCompleteTimer()}};e.getOfflineDeliveryProgress=function(){return this.offlineMessagePreviewCounter===0?this._maxProgress:Math.min(Math.ceil(100*this._decryptedMessageCount/this.offlineMessagePreviewCounter),this._maxProgress)};e.processOfflineSessionComplete=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this;self.setTimeout(function(){d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!0})},3e3);(a=this._offlineCompleteTimer)==null?void 0:a.cancel();this._offlineCompleteTimer=null;if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE){d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&(d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logLastStanzaT(),void d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.commit());return}else if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB){yield d("WAWebMessageThread").waitForOnlineMsgThread();yield d("WAWebApiPendingDeviceSync").doPendingDeviceSync();this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE);return}else this._status===d("WAWebOfflineResumeConst").ResumeStatus.INIT&&(this._hasMessagesToDownload=!1,this._finishedDownloading=!0,d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),!this._mainScreenLoaded&&!this._mainScreenLoadPromise&&(this._mainScreenLoadPromise=d("WAWebOfflineResumeUtils").loadMainScreen({})));yield this._mainScreenLoadPromise;this._offlineStanzaCountAfterOfflineMarker=0;self.setTimeout(function(){b._offlineStanzaCountAfterOfflineMarker>d("WAWebOfflineResumeConst").OFFLINE_STANZA_COUNT_LIMIT&&(d("WALogger").WARN(l(),b._offlineStanzaCountAfterOfflineMarker),d("WAWebOfflineResumeUtils").refreshWindow())},d("WAWebOfflineResumeConst").OFFLINE_STANZA_COUNT_CHECK_TIMEOUT_MS);this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE);return this._handleOfflineComplete()});function c(b){return a.apply(this,arguments)}return c}();e.isResumeFromRestartComplete=function(){return this._status!==d("WAWebOfflineResumeConst").ResumeStatus.RESUME_ON_RESTART&&this._status!==d("WAWebOfflineResumeConst").ResumeStatus.INIT};e.isResumeFromRestartInProgress=function(){return this._status!==d("WAWebOfflineResumeConst").ResumeStatus.INIT&&!d("WAWebCmd").Cmd.isOfflineDeliveryEnd};e.isResumeOnSocketDisconnectInProgress=function(){return this._status===d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB};e.getHasMessagesToDownload=function(){return this._hasMessagesToDownload};e.getFinishedDownloading=function(){return this.getOfflineDeliveryProgress()===100};e.shouldUseOfflineResumeScreen=function(){return this.offlineMessagePreviewCounter>this._decryptedMessageCount};e.processDecryptResult=function(a){this._refreshOfflineCompleteTimer(),this._decryptedMessageCount+=1,a===d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY&&(this._decryptionErrorCount+=1)};e.offlineStanzaReceivedAfterComplete=function(){this.isResumeFromRestartComplete()&&(this._offlineStanzaCountAfterOfflineMarker+=1)};e.newOfflineStanza=function(a,b){d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logAddOfflineSizeBytes(b),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOldestStanzaTime(a),this._refreshOfflineCompleteTimer()};e.getResumeUIProgressBarType=function(){return!d("WAWebCmd").Cmd.isOfflineDeliveryEnd&&this.offlineMessagePreviewCounter>=u?d("WAWebOfflineResumeTypes.flow").ResumeUIProgressBarType.Toastbar:d("WAWebOfflineResumeTypes.flow").ResumeUIProgressBarType.None};e._refreshOfflineCompleteTimer=function(){this._offlineCompleteTimer&&this._offlineCompleteTimer.onOrAfter(d("WAWebOfflineResumeConst").OFFLINE_STANZA_TIMEOUT_MS)};e._startOfflineCompleteTimer=function(a,b){var c,e=this;(c=this._offlineCompleteTimer)==null?void 0:c.cancel();this._offlineCompleteTimer=new(d("WAShiftTimer").ShiftTimer)(function(){e._status!==d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE&&(d("WALogger").LOG(k()),d("WALogger").ERROR(j()).sendLogs("non-blocking-offline-resume-timeout",.01),e.processOfflineSessionComplete(a+b),e._offlineCompleteTimer=null,d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logMissedOfflineComplete())});this._offlineCompleteTimer.onOrAfter(d("WAWebOfflineResumeConst").OFFLINE_STANZA_TIMEOUT_MS)};e._handleOfflineComplete=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebMessageThread").waitForOfflineMsgThread(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineDecryptionErrorCount(this._decryptionErrorCount),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logLastStanzaT(),d("WAWebThreadMetadata").resetThreadMeta(),d("WALogger").LOG(i(),this._decryptionErrorCount),this._decryptionErrorCount=0,yield d("WAWebOfflineResumeUtils").clearOfflineSnapShot(),this._maxProgress=97,yield this._mainScreenLoadPromise,yield d("WAWebOffdStorageUpdateOfflinePeerReceipts").updatePeerReceipts(),this._maxProgress=99,d("WALogger").LOG(h()),d("WAWebCmd").Cmd.offlineDeliveryEnd(),d("WAWebUserPrefsGeneral").setOfflinePushCount(0),this._progressBarTimer.forceRunNow(),this._progressBarTimer.cancel(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.commit(),d("WAWebSignalProtocolStore").enablePersistSignalStore(),void d("WAWebOfflineResumeUtils").runReceiptCleanUpLoop(),d("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("processAllOrphanPaymentNotifications"),d("WAWebChatThreadLogging").uploadChatThreadLoggingEvents(),c("WAWebBrokerGlobalAppState").initOrUpdateTracking(d("WAWebWamEnumWebcScenarioType").WEBC_SCENARIO_TYPE.IDLE),self.setTimeout(function(){d("WAWebApiPendingDeviceSync").doPendingDeviceSync()},d("WAWebOfflineResumeConst").OFFLINE_DEVICE_SYNC_DELAY)});function a(){return a.apply(this,arguments)}return a}();return a}();g.OfflineNonBlockingResumeStageManager=a}),98);
__d("WAWebOfflineResumeMainThread",["WAWebBlockingOfflineResumeManager","WAWebNonBlockingOfflineResumeManager"],(function(a,b,c,d,e,f,g){function a(a){a.initState({createBlockingStageManager:function(){return new(d("WAWebBlockingOfflineResumeManager").OfflineBlockingResumeStageManager)()},createNonblockingStageManager:function(a){return new(d("WAWebNonBlockingOfflineResumeManager").OfflineNonBlockingResumeStageManager)(a)}})}g.setupMainThreadResume=a}),98);
__d("WAQplNetwork",["WABaseGlobals","WALogger","WAQplTypes","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Default Network already init"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["qpl_networkSendEventsOverNetwork, completed Request"]);i=function(){return a};return a}function j(a,b,c){c=c||{};a=new Blob(a,c);c=a;c.name=b;return c}function k(a,b){function c(a){delete a.app_version;delete a.app_build_number;a.wa_ab_key2===void 0&&(a.wa_ab_key2="abkey");return JSON.stringify(a)}return JSON.stringify(a)+"\n"+b.map(c).join("\n")}var l=function(){function a(a){var c;this.$1=(c=(c=a==null?void 0:a.qplEndpoint)!=null?c:(c=d("WABaseGlobals").getQplConfig())==null?void 0:c.endpoint)!=null?c:"";this.$2=(c=(c=a==null?void 0:a.qplAccessToken)!=null?c:(c=d("WABaseGlobals").getQplConfig())==null?void 0:c.accessToken)!=null?c:"";this.$3=(c=(c=a==null?void 0:a.qplAppId)!=null?c:(c=d("WABaseGlobals").getQplConfig())==null?void 0:c.appId)!=null?c:"";this.$4=(c=a==null?void 0:a.isDev)!=null?c:!1;this.$6=(c=a==null?void 0:a.restInterface)!=null?c:{post:function(a,c){return fetch(a,{method:"POST",body:c}).then(function(a){var c,d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(a.text());case 2:c=e.sent;d=a.status;return e.abrupt("return",{status:d,responseText:c});case 5:case"end":return e.stop()}},null,this)})}}}var c=a.prototype;c.sendEventsOverNetwork=function(a){var c,e,f,g,h;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:c=this.$4?{is_employee:"true"}:{};e=this.$1;f=new FormData();f.append("access_token",this.$2);f.append("app_id",this.$3);this.$5===void 0&&(this.$5=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString());f.append("user_id",this.$5);f.append("upload_time",d("WATimeUtils").unixTime().toString());f.append("batch_info",JSON.stringify(c));g={};a.forEach(function(a){a.app_version!==void 0&&(g[a.app_version]?g[a.app_version].push(a):g[a.app_version]=[a])});if(!(Object.keys(g).length===0)){l.next=13;break}return l.abrupt("return");case 13:Object.keys(g).map(function(a){return g[a]}).forEach(function(a){var b={app_version:a[0].app_version,app_build_number:a[0].app_build_number};f.append("batches[]",j([k(b,a)],"qpldata.txt"))});l.next=16;return b("regeneratorRuntime").awrap(this.$6.post(e,f));case 16:h=l.sent;d("WALogger").LOG(i()).tags("qpl").devConsole(h);if(!(200!==h.status)){l.next=20;break}throw new(d("WAQplTypes").QplServerStatusCodeError)(h.status,"Failed call to QPL endpoint: "+this.$1+", response: "+h.responseText);case 20:case"end":return l.stop()}},null,this)};return a}(),m;function a(a){m?a&&d("WALogger").WARN(h()):m=new l(a);return m}g.createPayload=k;g.QplNetwork=l;g.defaultQplNetwork=a}),98);
__d("WAWebWamEnumWebcQplHealthEventType",[],(function(a,b,c,d,e,f){a=Object.freeze({ANNOTATION_SIZE_LIMIT_EXCEEDED:1,MAX_POINT_COUNT_EXCEEDED:2,MAX_MARKER_COUNT_EXCEEDED:3,TOO_MANY_OPEN_MARKERS_TO_WRITE:4,POINT_TO_END_AT_NOT_FOUND:5,JSON_FORMAT_ERROR:6,MAX_STORAGE_EVENT_COUNT_REACHED:7,ERROR_UPLOADING_CHUNK:8,POINT_NAME_TOO_LONG:9,ANNOTATION_KEY_TOO_LONG:10,POINT_DATA_TOO_LONG:11,ERROR_PARSING_CONFIG:12});f.WEBC_QPL_HEALTH_EVENT_TYPE=a}),66);
__d("WAWebWebcQplHealthWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumWebcQplHealthEventType"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebcQplHealth:[3134,{webcQplHealthEventData:[1,d("WAWebWamCodegenUtils").TYPES.STRING],webcQplHealthEventType:[2,d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE]},[1,1,1],"regular"]},{WebcQplHealth:[]});g.WebcQplHealthWamEvent=a}),98);
__d("WAWebQplHealthLogger",["WALogger","WAWebWamEnumWebcQplHealthEventType","WAWebWebcQplHealthWamEvent"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL errorUploadingChunk, error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL maxStorageEventCountReached"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL errorParsingConfig, error ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL pointDataTooLong, markerId: ",", instanceKey: ",", data: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL annotationKeyTooLong, markerId: ",", instanceKey: ",", annotationKey: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL pointNameTooLong, markerId: ",", instanceKey: ",", pointName: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL maxPointCountExceeded, markerId: ",", instanceKey: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL annotationSizeLimitExceeded, markerId: ",", instanceKey: ",", annotationKey: ",""]);o=function(){return a};return a}var p=5,q=0;function a(a,b,c){d("WALogger").DEV(o(),a,b,c);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_SIZE_LIMIT_EXCEEDED,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b+", annotationKey: "+c});a.commit()}function b(a,b){d("WALogger").DEV(n(),a,b);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.MAX_POINT_COUNT_EXCEEDED,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b});a.commit()}function c(a,b,c){d("WALogger").DEV(m(),a,b,c);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.POINT_NAME_TOO_LONG,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b+", pointName: "+c});a.commit()}function e(a,b,c){d("WALogger").DEV(l(),a,b,c);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_KEY_TOO_LONG,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b+", annotationKey: "+c});a.commit()}function f(a,b,c){d("WALogger").DEV(k(),a,b,c);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.POINT_DATA_TOO_LONG,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b+", data: "+c});a.commit()}function r(a){d("WALogger").DEV(j(),a);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_PARSING_CONFIG,webcQplHealthEventData:"errorString: "+a});a.commit()}function s(){d("WALogger").DEV(i());if(q++>p)return;var a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.MAX_STORAGE_EVENT_COUNT_REACHED});a.commit()}function t(a){d("WALogger").DEV(h(),a);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_UPLOADING_CHUNK,webcQplHealthEventData:"errorString: "+a});a.commit()}g.annotationSizeLimitExceeded=a;g.maxPointCountExceeded=b;g.pointNameTooLong=c;g.annotationKeyTooLong=e;g.pointDataTooLong=f;g.errorParsingConfig=r;g.maxStorageEventCountReached=s;g.errorUploadingChunk=t}),98);
__d("WAWebApiQplEvents",["WALogger","WAWebABPropsLocalStorage","WAWebBuildConstants","WAWebQplHealthLogger","WAWebQplStorage","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Storage, error saving events ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Storage, saved "," rows"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Storage, error during checking for excessive events ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Storage, error calling initializeQplStorage, error ",""]);k=function(){return a};return a}var l=200,m=1e5,n=parseInt(d("WAWebBuildConstants").BUILD_ID,10)||0,o=[],p=c("lodash").throttle(function(){return C()},l);function q(a){return function(b){return r(b,a)}}function r(a,b){return{marker_id:a.marker_id,method:a.method,action_id:a.action_id,duration_ns:a.duration_ns,marker_type:a.marker_type,sample_rate:a.sample_rate,points:a.points,instance_id:a.instance_id,metadata:a.metadata||{application_analytics:{time_since_qpl_module_init:0}},flags:a.flags,annotations_bool_array:a.annotations_bool_array,annotations_bool:a.annotations_bool,annotations_double_array:a.annotations_double_array,annotations_double:a.annotations_double,annotations_int_array:a.annotations_int_array,annotations_int:a.annotations_int,annotations_string_array:a.annotations_string_array,annotations:a.annotations,app_version:d("WAWebBuildConstants").VERSION_BASE,app_build_number:n,wa_ab_key2:b}}function s(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebQplStorage").initialize()}catch(a){d("WALogger").ERROR(k(),a).verbose().devConsole(a).sendLogs("QPL Storage init error");throw a}});return t.apply(this,arguments)}function a(a,b){b===void 0&&(b=d("WAWebABPropsLocalStorage").getABKey()||"abkey"),o=o.concat(a.map(q(b))),p()}function e(a,b){b===void 0&&(b=d("WAWebABPropsLocalStorage").getABKey()||"abkey");return a.map(q(b))}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield s();return d("WAWebQplStorage").getQplEventsTable().all({limit:a,offset:0})});return v.apply(this,arguments)}function w(){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield s();return d("WAWebQplStorage").getQplEventsTable().count()});return x.apply(this,arguments)}function f(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield s();return d("WAWebQplStorage").getQplEventsTable().clear(!0)});return y.apply(this,arguments)}function z(a,b){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield s();return d("WAWebQplStorage").getQplEventsTable().bulkDeleteRange(["id"],a-1,b+1).then(function(){})});return A.apply(this,arguments)}var B=null;function C(){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield s();if(B)B.then(C);else if(o.length>0){var a=o;o=[];try{var b=(yield w());if(b+a.length>m){d("WAWebQplHealthLogger").maxStorageEventCountReached();b=b+a.length-m;yield E(b)}}catch(a){d("WALogger").ERROR(j(),a).verbose().devConsole(a).sendLogs("QPL Storage, error saving events");return}B=d("WAWebQplStorage").getQplEventsTable().bulkCreate(a).then(function(){d("WALogger").DEV(i(),a.length),B=null})["catch"](function(a){d("WALogger").ERROR(h(),a).verbose().devConsole(a).sendLogs("QPL Storage, error saving events"),B=null})}});return D.apply(this,arguments)}function E(a){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield u(a));var b=a[0].id||0;a=a[a.length-1].id||0;yield z(b,a)});return F.apply(this,arguments)}g.WRITE_THROTTLE_INTERVAL=l;g.add=a;g.createRows=e;g.getFromBottom=u;g.rowCount=w;g.clear=f;g.deleteRange=z}),98);
__d("WAWebQplAbpropsConfigValueProvider",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("qpl_enabled")}function b(){return d("WAWebABProps").getABPropConfigValue("qpl_upload_delay")*60}function c(){return d("WAWebABProps").getABPropConfigValue("qpl_sampling_as_string")}function e(){return d("WAWebABProps").getABPropConfigValue("qpl_initial_upload_delay")*60}g.isQplEnabled=a;g.getUploadIntervalInSeconds=b;g.getEventSampling=c;g.getInitialUploadDelayInSeconds=e}),98);
__d("WAWebQplConfig",["WALogger","WAQplConfigTypes","WAWebQplHealthLogger","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Config has already been initialized"]);h=function(){return a};return a}var i={sampleRate:0,samplingMethod:d("WAQplConfigTypes").QplSampleMethod.EVENT_BASED_SAMPLING},j={sampleRate:1,samplingMethod:d("WAQplConfigTypes").QplSampleMethod.EVENT_BASED_SAMPLING},k,l,m;function n(){return m.isQplEnabled()}function o(){return m.getUploadIntervalInSeconds()}function p(){return m.getInitialUploadDelayInSeconds()}function q(a){if(!c("gkx")("26258"))return j;a=k.get(a);return a?a:i}function r(){if(c("gkx")("26258"))try{var a=m.getEventSampling();a.indexOf("json:")===0&&(a=a.slice(5));a=JSON.parse(a);a=a.sampling;a.forEach(function(a){var b=a[0],c=a[1];a=Math.max(a[2],0);k.set(b,{sampleRate:a,samplingMethod:c})})}catch(a){d("WAWebQplHealthLogger").errorParsingConfig(a)}}function a(a,b){b===void 0&&(b=!1);!l||b===!0?(k=new Map(),m=a,r(),l={isQplEnabled:n,uploadInterval:o,getEventDetails:q,uploadDelay:p}):d("WALogger").WARN(h()).tags("qpl");return l}g.config=a}),98);
__d("WAWebQplStorageApi",["WAWebApiQplEvents"],(function(a,b,c,d,e,f,g){a=function(){function a(){}var b=a.prototype;b.add=function(a,b){return d("WAWebApiQplEvents").add(a,b)};b.getFromBottom=function(a){return d("WAWebApiQplEvents").getFromBottom(a)};b.getRowCount=function(){return d("WAWebApiQplEvents").rowCount()};b.clear=function(){return d("WAWebApiQplEvents").clear()};b.deleteRange=function(a,b){return d("WAWebApiQplEvents").deleteRange(a,b)};return a}();g.QplStorageApi=a}),98);
__d("WAWebQplValuesConfig",["gkx"],(function(a,b,c,d,e,f,g){a="167028690535322";b="346387865799334";d=a;c("gkx")("26265")&&(d=b);e={accessToken:"1063127757113399|745146ffa34413f9dbb5469f5370b7af",appId:d,endpoint:"https://graph.whatsapp.net/wa_qpl_data"};g.qplConfigs=e}),98);
__d("WAWebQplInitMd",["Promise","WALogger","WAQplNetwork","WAQplUploader","WAWebApiQplEvents","WAWebQplAbpropsConfigValueProvider","WAWebQplConfig","WAWebQplHealthLogger","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebQplStorageApi","WAWebQplValuesConfig","WAWebXHR","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL is disabled, throwing Killswitch, will clear database"]);i=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["QPL, got event ",", duration: ","ms, ",""]);a=function(){return b};return b}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL is being initialized"]);j=function(){return a};return a}var k={post:c("WAWebXHR").post};function e(){d("WAQplNetwork").defaultQplNetwork({restInterface:k,isDev:0,qplAccessToken:d("WAWebQplValuesConfig").qplConfigs.accessToken,qplAppId:d("WAWebQplValuesConfig").qplConfigs.appId,qplEndpoint:d("WAWebQplValuesConfig").qplConfigs.endpoint});var a=d("WAWebQplConfig").config(d("WAWebQplAbpropsConfigValueProvider"));if(a.isQplEnabled()){d("WALogger").LOG(j());if(c("gkx")("26256")){var e=new URLSearchParams(window.location.search).get("e2etestname");void d("WAQplUploader").start({sendEvents:function(a){a.forEach(function(a){e!=null&&(a.annotations?a.annotations.e2etestname=e:a.annotations={e2etestname:e})});var b=window.__je2e_recordQPLMarker;b!=null&&typeof b==="function"&&a.forEach(b);return d("WAQplNetwork").defaultQplNetwork().sendEventsOverNetwork(a)},isQplEnabled:function(){return!0},intervalInSeconds:a.uploadInterval(),startDelayInSeconds:a.uploadDelay()},{storageApi:new(d("WAWebQplStorageApi").QplStorageApi)(),healthLogger:d("WAWebQplHealthLogger")})}else d("WAQplUploader").start({isQplEnabled:a.isQplEnabled,sendEvents:function(a){return d("WAQplNetwork").defaultQplNetwork().sendEventsOverNetwork(a)},intervalInSeconds:a.uploadInterval(),startDelayInSeconds:a.uploadDelay()},{storageApi:new(d("WAWebQplStorageApi").QplStorageApi)(),healthLogger:d("WAWebQplHealthLogger")});d("WAWebQplQuickPerformanceLoggerModule").QPL.init(function(a,c){d("WAWebApiQplEvents").add([a]);return(h||(h=b("Promise"))).resolve()},a.getEventDetails,a.isQplEnabled)}else d("WALogger").LOG(i()),d("WAWebQplQuickPerformanceLoggerModule").QPL.throwKillswitch(!0),d("WAWebQplQuickPerformanceLoggerModule").QPL.clearStorage()}g.startQPL=e}),98);
__d("WAWebSubscriptionJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWapDeprecatedSmaxID","WAWebBackendErrors","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new(c("WADeprecatedWapParser"))("subscriptionsParser",function(a){a.assertTag("iq");a.assertFromServer();a=a.child("subscriptions");var b=[];a.forEachChildWithTag("subscription",function(a){var c=a.attrString("status"),d=a.maybeAttrInt("subscription_end_time");a=a.attrString("id");b.push({id:a,status:c,expirationDate:d})});return b});function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;a=(a=d("WAWap")).wap("iq",{xmlns:"fb:thrift_iq",id:a.generateId(),type:"get",smax_id:a.SMAX_ID(c("WAWapDeprecatedSmaxID").QuerySubscription),to:a.S_WHATSAPP_NET});a=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,h));if(a.success)return a.result;throw new(d("WAWebBackendErrors").ServerStatusCodeError)(a.errorCode,a.errorText)});return i.apply(this,arguments)}g.querySubscriptions=a}),98);
__d("WAWebSubscriptions",["WAExponentialBackoff","WALogger","WAPromiseDelays","WAWebBackendErrors","WAWebBizGatingUtils","WAWebPremiumAccessEngine","WAWebSchemaSubscription","WAWebSubscriptionCollection","WAWebSubscriptionJob","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, fetch state"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["subscription sync: error PremiumAccessEngine ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, got subscriptions: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["subscription sync: error PremiumAccessEngine ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, no subscriptions found"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, sleeping for "," sec"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, non recoverable error, exiting"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, will retry in "," ms"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager pull failed, error: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager query failed, retriable error: ",", failCount ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, run"]);r=function(){return a};return a}var s={minTimeout:1e3,maxTimeout:16e3,retries:5,signal:new AbortController().signal},t=86400*1e3;function u(){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("WAWebBizGatingUtils").subscriptionFetchEnabled())return;try{yield d("WAExponentialBackoff").exponentialBackoff(s,function(a,b){d("WALogger").DEV(r());return y()["catch"](function(c){if(c instanceof d("WAWebBackendErrors").ServerStatusCodeError)switch(c.statusCode){case 500:d("WALogger").WARN(q(),c.message,b);return a(c)}throw c})})}catch(a){d("WALogger").ERROR(p(),a).verbose().devConsole(a).sendLogs("Subscriptions manager run failed");if(a instanceof d("WAWebBackendErrors").ServerStatusCodeError&&a.statusCode===500)d("WALogger").DEV(o(),t);else{d("WALogger").DEV(n());return}}d("WALogger").DEV(m(),t/1e3);yield d("WAPromiseDelays").delayMs(t);d("WAWebUserPrefsMeUser").getMaybeMeUser()&&u()});return v.apply(this,arguments)}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(d("WAWebBizGatingUtils").subscriptionFetchEnabled()){if(a.length===0){d("WALogger").DEV(l());d("WAWebSubscriptionCollection").SubscriptionCollection.reset();try{d("WAWebPremiumAccessEngine").update()}catch(a){d("WALogger").ERROR(k(),a).sendLogs("PremiumAccessEngine")}return}var b=["ACTIVE","FREE_TRIAL","IN_GRACE_PERIOD"];a=a.map(function(a){var c={id:a.id,isAutoRenewing:a.status==="ACTIVE",isDeactivated:!b.includes(a.status),expirationDate:a.expirationDate!==void 0?parseInt(a.expirationDate,10):void 0};a.status==="CANCELED"&&(c.expirationDate||0)>new Date().getTime()/1e3&&(c.isDeactivated=!1);return c});d("WALogger").DEV(j(),JSON.stringify(a));yield d("WAWebSchemaSubscription").getSubscriptionTable().bulkCreateOrMerge(a);d("WAWebSubscriptionCollection").SubscriptionCollection.add(a,{merge:!0});try{d("WAWebPremiumAccessEngine").update()}catch(a){d("WALogger").ERROR(i(),a).sendLogs("PremiumAccessEngine")}}});return x.apply(this,arguments)}function y(){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("WAWebUserPrefsMeUser").getMaybeMeUser())return;d("WALogger").DEV(h());var a=(yield d("WAWebSubscriptionJob").querySubscriptions());yield w(a)});return z.apply(this,arguments)}g.runSubscriptionsManager=u;g.applySubscriptions=w}),98);
__d("WAWebApiTextStatus",["Promise","WATimeUtils","WAWebModelStorageUtils","WAWebTextStatusGatingUtils","WAWebTextStatusUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(){var a=d("WATimeUtils").unixTime();return!d("WAWebTextStatusGatingUtils").receiveTextStatusEnabled()?(h||(h=b("Promise"))).resolve():d("WAWebModelStorageUtils").getStorage().lock(["contact"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield b.lessThan(["textStatusExpiryTs"],a));if(!c||c.length===0)return;c=c.map(function(a){return{id:a.id,textStatusString:void 0,textStatusEmoji:void 0,textStatusExpiryTs:void 0,textStatusEphemeralDuration:void 0,textStatusLastUpdateTime:d("WAWebTextStatusUtils").CLEAR_TEXT_STATUS_LAST_UPDATE_TIME_VAL}});return b.bulkCreateOrMerge(c)});return function(a){return c.apply(this,arguments)}}())}g.updateExpiredTextStatusOfContact=a}),98);
__d("WAWebCleanUtmJob",["WAJobOrchestratorTypes","WAPromiseCallSync","WAWebOrchestratorNonPersistedJob","WAWebUtmBizPrefs","WAWebUtmBizUtils"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("cleanExpiredUtm",function(){return h()},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT}).waitUntilCompleted()}function h(){return d("WAPromiseCallSync").promiseCallSync(function(){var a=d("WAWebUtmBizPrefs").getAllUtmsFromLocalStorage();Object.keys(a).forEach(function(b){var c=a[b];d("WAWebUtmBizUtils").hasUtmExpired(c)&&d("WAWebUtmBizPrefs").removeUtmFromLocalStorage(b)})})}g.cleanExpiredUtmJob=a}),98);
__d("WAWebDBPruneExpiredOrphanReactions",["WALogger","WATimeUtils","WAWebABProps","WAWebModelStorageUtils","WAWebSchemaReactions","WAWebSchemaTypes.flow","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["pruneExpiredOrphanReactions: Pruning expired orphan reactions from the Reactions DB"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkDeleteExpiredOrphans: unsupported orphan reason found in the Reactions table ",""]);i=function(){return a};return a}var j=60;function a(){return d("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield d("WAWebSchemaReactions").getReactionsTable().equals(["orphan"],1)),c=[];b.forEach(function(a){var b=d("WATimeUtils").castToUnixTime(a.timestamp/1e3),e;a.orphanReason===d("WAWebSchemaTypes.flow").OrphanReactionsReasonType.ParentMsgMissing?e=d("WAWebABProps").getABPropConfigValue("reaction_cleanup_days"):a.orphanReason===d("WAWebSchemaTypes.flow").OrphanReactionsReasonType.ParentMsgPlaceholder?e=j:a.orphanReason===d("WAWebSchemaTypes.flow").OrphanReactionsReasonType.ParentMsgFutureproof?e=null:d("WALogger").DEV(i(),a.orphanReason);if(e!=null){b=!d("WATimeUtils").happenedWithin(b,d("WATimeUtils").DAY_SECONDS*e);b&&c.push(a)}});b=c.map(function(a){return[a.parentMsgKey,a.senderUserJid]});if(b.length>0){d("WALogger").DEV(h());return a.bulkRemove(b)}});return function(b){return a.apply(this,arguments)}}())}g.PARENT_MSG_PLACEHOLDER_ORPHAN_THRESHOLD=j;g.pruneExpiredOrphanReactions=a}),98);
__d("WAWebDBPurgeExpiredRecords",["Promise","WAWeb-moment","WAWebDBMapOrphansToProviders","WAWebDBOrphanDbSerialization","WAWebMsgType","WAWebSchemaMessage","WAWebSchemaMessageOrphans","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){a=c("WAWeb-moment")().subtract(a,"days").unix();var f=c("WAWeb-moment")().subtract(e,"days").unix();e=(yield d("WAWebSchemaMessageOrphans").getMessageOrphanTable().between(["t"],0,a));a=new Set(e.map(function(a){return a.parentMsgKey}));a=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(Array.from(a)));var g=new Set(a.filter(function(a){return a&&a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN}).map(function(a){return a==null?void 0:a.id}));a=e.filter(function(a){return!g.has(a.parentMsgKey)||a.t<f}).map(d("WAWebDBOrphanDbSerialization").orphanFromDbRow);e=(yield d("WAWebDBMapOrphansToProviders").mapOrphansToProviders(a));var i=[];for(e of e.entries()){var j=e[0],k=e[1];j.onRecordsPurged!=null&&i.push(j.onRecordsPurged(k))}yield (h||(h=b("Promise"))).all(i);j=a.map(function(a){return a.msgKey});return d("WAWebSchemaMessageOrphans").getMessageOrphanTable().bulkRemove(j)});return i.apply(this,arguments)}g.purgeExpiredOrphanRecords=a}),98);
__d("WAWebJobUpdateQPSurfaces",["Promise","WALogger","WATimeUtils","WAWebCTWAConstants","WAWebJobLoadQuickPromotions","WAWebModelStorageUtils","WAWebOrchestratorNonPersistedJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateQPSurfaces: found duplicated surface"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateQPSurfaces: no surfaces"]);j=function(){return a};return a}function k(a){var b;a=(a=a.qpConfigPacing)==null?void 0:a.userInfo;return{impressions:(b=a==null?void 0:a.impressionCount)!=null?b:0,primaryClicks:(b=a==null?void 0:a.primaryClickCount)!=null?b:0,secondaryClicks:(b=a==null?void 0:a.secondaryClickCount)!=null?b:0,dismisses:(b=a==null?void 0:a.dismissClickCount)!=null?b:0}}function l(a,b){var c,d,e,f;a=a.tracking;c=(c=b.qpConfigPacing)==null?void 0:c.userInfo;b=k(b);d=a.dismisses-((d=c==null?void 0:c.dismissClickCount)!=null?d:0);e=a.primaryClicks-((e=c==null?void 0:c.primaryClickCount)!=null?e:0);f=a.secondaryClicks-((f=c==null?void 0:c.secondaryClickCount)!=null?f:0);c=a.impressions-((c=c==null?void 0:c.impressionCount)!=null?c:0);d>0&&(b.dismisses+=d);e>0&&(b.primaryClicks+=e);f>0&&(b.secondaryClicks+=f);c>0&&(b.impressions+=c);d=a.lastImpressionTs;e=a.lastPrimaryClickTs;f=a.lastSecondaryClickTs;c=a.lastDismissTs;d!=null&&(b.lastImpressionTs=d);e!=null&&(b.lastPrimaryClickTs=e);f!=null&&(b.lastSecondaryClickTs=f);c!=null&&(b.lastDismissTs=c);return b}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(a.length===0){d("WALogger").LOG(j());return(h||(h=b("Promise"))).resolve()}var e=a.map(function(a){return a.id}),f=new Set(e);if(f.size!==e.length){d("WALogger").WARN(i());return(h||(h=b("Promise"))).resolve()}var g=new Map();a.forEach(function(a){if(!d("WAWebCTWAConstants").KNOWN_QP_SURFACES.has(a.id))return;a.promotions.forEach(function(b){g.set(b.id,{promotion:b,surfaceId:a.id})})});yield d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("updateQPSurfaces",function(){return d("WAWebModelStorageUtils").getStorage().lock(["quick-promotions"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var d=a[0];a=(yield d.anyOf(["surfaceId"],e));a=a.map(function(a){var b=a.id,e=g.get(b);if(e==null)return d.remove(b);a=l(a,e.promotion);e={data:e.promotion,ts:c,tracking:a};g["delete"](b);return d.merge(b,e)});yield (h||(h=b("Promise"))).all(a);a=Array.from(g.values());a=a.map(function(a){var b=a.promotion;a=a.surfaceId;return{id:b.id,surfaceId:a,data:b,ts:c,tracking:k(b)}});yield d.bulkCreate(a)});return function(b){return a.apply(this,arguments)}}())}).waitUntilCompleted();yield d("WAWebJobLoadQuickPromotions").loadQuickPromotions()});return n.apply(this,arguments)}function a(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return m(a,b)});return o.apply(this,arguments)}function c(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WATimeUtils").unixTime();return m(a,b)});return p.apply(this,arguments)}g.updateQPSurfacesFromNotification=a;g.updateQPSurfacesFromGraphQLFetch=c}),98);
__d("WAWebFetchQuickPromotions",["Promise","WABase64","WACustomError","WALogger","WAPromiseTimeout","WAQplTypes","WAWebBackendApi","WAWebBizGatingUtils","WAWebBuildConstants","WAWebCTWAConstants","WAWebFetchAdAccountToken","WAWebFetchQuickPromotionsQuery.graphql","WAWebFetchQuickPromotionsQuery_QPAction.graphql","WAWebFetchQuickPromotionsQuery_QPCreative.graphql","WAWebFetchQuickPromotionsQuery_QPText.graphql","WAWebFetchQuickPromotionsQuery_QPWAFilter.graphql","WAWebFetchQuickPromotionsQuery_QPWAFilterClause.graphql","WAWebFetchQuickPromotionsQuery_QuickPromotion.graphql","WAWebJobUpdateQPSurfaces","WAWebL10NCountryCodes","WAWebOrchestratorNonPersistedJob","WAWebProtobufsQuickPromotionSurfaces.pb","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebRelayClient","WAWebUserPrefsMeUser","WAWebWebp","err"],(function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o;function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: failed to decode base64 for dark mode media details"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: failed to decode base64 for light mode media details"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: received unexpected nux ID ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: could not find "," in reverse mapping"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(['fetchQuickPromotions: failed as "timeout"']);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(['fetchQuickPromotions: failed as "','"']);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: success"]);v=function(){return a};return a}var w={type:"error"},x=h!==void 0?h:h=b("WAWebFetchQuickPromotionsQuery.graphql"),y=i!==void 0?i:i=b("WAWebFetchQuickPromotionsQuery_QuickPromotion.graphql"),z=j!==void 0?j:j=b("WAWebFetchQuickPromotionsQuery_QPCreative.graphql"),A=k!==void 0?k:k=b("WAWebFetchQuickPromotionsQuery_QPAction.graphql"),B=l!==void 0?l:l=b("WAWebFetchQuickPromotionsQuery_QPText.graphql"),C=m!==void 0?m:m=b("WAWebFetchQuickPromotionsQuery_QPWAFilterClause.graphql"),D=n!==void 0?n:n=b("WAWebFetchQuickPromotionsQuery_QPWAFilter.graphql");function a(){return!d("WAWebBizGatingUtils").qpGraphQLEnabled()?(o||(o=b("Promise"))).resolve({type:"not-enabled"}):d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("fetchQuickPromotions",function(){return E()}).waitUntilCompleted()}function E(){return d("WAPromiseTimeout").promiseTimeout(F(),d("WAWebCTWAConstants").QP_FETCH_TIMEOUT_MS).then(function(a){if(a.type==="success"){d("WALogger").LOG(v());return d("WAWebJobUpdateQPSurfaces").updateQPSurfacesFromGraphQLFetch(a.quickPromotions).then(function(){return a})}a.type;d("WALogger").WARN(u(),a.type);return a})["catch"](function(a){if(a instanceof d("WACustomError").TimeoutError){d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,"fetch_promotions_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,d("WAQplTypes").QuickLogActionType.ABORTED);d("WALogger").WARN(t());return{type:"timeout"}}throw a})}function F(){d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS);d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,"fetch_promotions_start");return d("WAWebFetchAdAccountToken").fetchToken().then(function(a){if(a.type==="success")return G(a.token).then(function(a){if(a.type==="success"){d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,"fetch_promotions_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,d("WAQplTypes").QuickLogActionType.SUCCESS);return a}d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,"fetch_promotions_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,d("WAQplTypes").QuickLogActionType.FAIL);a.type==="auth-failure"?d("WAWebFetchAdAccountToken").markTokenAsInvalid():a.type;return a});a.type;return a})}function G(a){return d("WAWebBackendApi").frontendSendAndReceive("getUserLocale").then(function(b){return H(a,b)})}function H(a,c){var e,f=Array.from(d("WAWebBizGatingUtils").qpSurfaceIdsUsingGraphQL());if(f.length===0)return(o||(o=b("Promise"))).resolve({type:"not-enabled"});e=(e=d("WAWebUserPrefsMeUser").getMaybeMeUser())==null?void 0:e.user;if(e==null)return(o||(o=b("Promise"))).resolve({type:"error"});e=d("WAWebL10NCountryCodes").getCountryShortcodeByPhone(e);var g;return d("WAWebRelayClient").fetchQuery(x,{nux_ids:f,trigger_context:{wa_smb_trigger_context:{is_from_wa_smb:!0,app_version:d("WAWebBuildConstants").VERSION_BASE,country:e,locale:c}}},{environmentType:"facebook",accessToken:a,getInlineDataReader:function(a){g=a}}).then(function(a){if(a==null)return w;a=a.quick_promotion_batch_fetch_root;var b=new Map();f.forEach(function(a){var c=M(a);if(c==null){d("WALogger").ERROR(s(),a).sendLogs("quick-promotions-graphql-missing-surface");return}b.set(a,{id:c,promotions:[]})});a.forEach(function(a){var c=a.surface_nux_id;a=a.eligible_promotions;if(c==null||a==null)return;var e=b.get(c);if(e==null){d("WALogger").ERROR(r(),c);return}c=a.edges;c.forEach(function(a){if(a==null)return;var b=a.node,c=a.priority,f=a.time_range,h=a.is_holdout,i=a.log_eligibility_waterfall;a=a.client_ttl_seconds;if(b==null)return;b=g(y,b);var j=b.promotion_id,k=b.creatives,l=b.is_server_force_pass,m=b.content_attributes,n=b.ab_prop_name,o=b.wa_qp_content_attributes_do_not_use,r=b.contextual_filters_for_wa_do_not_use,s=b.surface_delay_in_seconds,t=b.user_interaction_info;b=b.encrypted_logging_data;if(j==null||l==null||m==null||s==null)return;var u=m.wa_eligible_duration_after_impression_in_seconds,v=m.wa_banner_background_color;m=m.wa_primary_cta_alternative_url;if(u==null)return;k=k.map(function(a){return g(z,a)});k=k[0];var w,x,C,D,E;if(k!=null){var F=k.primary_action,G=k.title,H=k.content,I=k.wa_dark_mode_media_details,J=k.wa_light_mode_media_details,L=k.accessibility_text_for_image;if(G==null||H==null)return;x=g(B,G).text;C=g(B,H).text;if(F!=null){G=g(A,F);H=G.title;F=G.url;if(H!=null){G=g(B,H);G.text!=null&&(w={text:G==null?void 0:G.text,deepLink:F,universalLink:m})}}D=k.is_dismissible;if(L!=null){var M;try{(J==null?void 0:J.jpeg_thumbnail)!=null&&(M={elementValue:new Uint8Array(d("WABase64").decodeB64(J.jpeg_thumbnail))})}catch(a){d("WALogger").ERROR(q())}var N;try{(I==null?void 0:I.jpeg_thumbnail)!=null&&(N={elementValue:new Uint8Array(d("WABase64").decodeB64(I.jpeg_thumbnail))})}catch(a){d("WALogger").ERROR(p())}E={description:L,light:M,dark:N}}}if(x==null||C==null||D==null)return;H=v!=null?{lightHighlight:v.light_mode_highlight_color,lightBackground:v.light_mode_background_color,darkHighlight:v.dark_mode_highlight_color,darkBackground:v.dark_mode_background_color}:void 0;G=o.reduce(function(a,b){var c=b.name;b=b.value;if(c==null||b==null)return a;a.push({key:c,value:b});return a},[]);var O;if(t!=null){F=t.dismiss_click_count_for_user;m=t.impression_count_for_user;k=t.primary_click_count_for_user;J=t.secondary_click_count_for_user;I=t.dismiss_max_instances;L=t.impression_max_instances;v=t.primary_click_max_instances;if(m==null||k==null||J==null||F==null||L==null||v==null||I==null)return;O={promotionConfig:{maxImpressions:L,maxDismisses:I,maxPrimaryClicks:v,maxSecondaryClicks:0},userInfo:{impressionCount:m,primaryClickCount:k,secondaryClickCount:J,dismissClickCount:F}}}o=r!=null?K(r,g):void 0;t=b!=null?{elementValue:d("WAWebWebp").stringToUint8(b)}:void 0;L={id:j,qpConfigPriority:c,qpConfigDismissable:D?"true":"false",qpConfigEligibilityDurationMs:u*1e3,qpConfigEndTimeSeconds:f.end,qpConfigExperimentKey:n,qpConfigExposureHoldout:h?"true":"false",qpConfigForcePass:l?"true":"false",qpConfigLogEligibilityWaterfall:i?"true":"false",qpConfigStartTimeSeconds:f.start,qpConfigSurfaceDelayTimeSeconds:s,qpConfigTtlSeconds:a,titleElementValue:x,textElementValue:C,colors:H,contentAttributes:{attribute:G},image:E,primaryAction:w,qpConfigPacing:O,qpConfigFilterRules:o,header:void 0,instanceId:void 0,qpConfigDeterministic:"true",qpConfigImpressionCooldown:-1,qpConfigInstanceLogData:t,qpConfigMaxImpressions:-1,qpConfigTemplateName:"whatsapp_banner",qpConfigTriggersTrigger:[],secondaryAction:void 0};e.promotions.push(L)})});return{type:"success",quickPromotions:Array.from(b.values(),function(a){var b=a.id;a=a.promotions;return{id:b,promotions:[].concat(a)}})}})["catch"](function(a){return d("WAWebFetchAdAccountToken").hasGraphQLAuthError(a)?{type:"auth-failure"}:w})}function I(a){switch(a){case"AND_TYPE":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$ClauseType.AND;case"OR_TYPE":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$ClauseType.OR;case"NOR_TYPE":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$ClauseType.NOR;default:a;throw c("err")("Unexpected future filter clause type")}}function J(a){switch(a){case"PASS":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterResult.TRUE;case"FAIL":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterResult.FALSE;case"UNKNOWN":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterResult.UNKNOWN;default:a;throw c("err")("Unexpected future filter result")}}function K(a,b){var c=b(C,a),d=c.clause_type;c=c.filters;a=a.clauses;if(d==null)return;a=a!=null?a.map(function(a){return K(a,b)}).filter(Boolean):[];c=c.map(function(a){return L(a,b)}).filter(Boolean);d={clauseType:I(d),clauses:a,filters:c};return d}function L(a,b){b=b(D,a);a=b.filter_name;var c=b.parameters,e=b.passes_if_client_not_supported;b=b.filter_result;if(a==null)return;c=c.reduce(function(a,b){var c=b.key;b=b.value;if(c==null||b==null)return a;a.push({key:c,value:b});return a},[]);a={filterName:a,parameters:c,clientNotSupportedConfig:e===!0?d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterClientNotSupportedConfig.PASS_BY_DEFAULT:d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterClientNotSupportedConfig.FAIL_BY_DEFAULT,filterResult:b!=null?J(b):void 0};return a}function M(a){for(var b=d("WAWebCTWAConstants").KNOWN_QP_SURFACES.entries(),c=Array.isArray(b),e=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;var g=f[0];f=f[1];if(f===a)return g}}g.fetchQuickPromotions=a}),98);
__d("WAWebApiPrivacyDisallowedList",["WALogger","WAWebSchemaPrivacyDisallowedList","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["privacy_settings_drawer: get all privacy disallowed lists failed"]);h=function(){return a};return a}function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield d("WAWebSchemaPrivacyDisallowedList").getPrivacyDisallowedListTable().all());return j(a)}catch(a){d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("privacy_settings_drawer: get all privacy disallowed lists failed");return{about:null,groupadd:null,last:null,profile:null}}});return i.apply(this,arguments)}function j(a){var b={about:null,groupadd:null,last:null,profile:null};a.forEach(function(a){switch(a.id){case d("WAWebSchemaPrivacyDisallowedList").PrivacyDisallowedListType.About:b.about=a;return;case d("WAWebSchemaPrivacyDisallowedList").PrivacyDisallowedListType.GroupAdd:b.groupadd=a;return;case d("WAWebSchemaPrivacyDisallowedList").PrivacyDisallowedListType.LastSeen:b.last=a;return;case d("WAWebSchemaPrivacyDisallowedList").PrivacyDisallowedListType.ProfilePicture:b.profile=a;return}});return b}g.queryDisallowedLists=a;g.disallowedRowsToLists=j}),98);
__d("WAWebApiPrivacyEphemerality",["WALogger","WAWebSchemaChat","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ephemerality_daily_logs: retrieving current ephemerality information failed"]);h=function(){return a};return a}function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield d("WAWebSchemaChat").getChatTable().greaterThan(["ephemeralDuration"],0)),b=a.length;a=a.filter(function(a){return a.disappearingModeInitiatedByMe===!0}).length;return{isEphemeralMessagingUser:a>0,countEphemeralThreadsEnabledByMe:a,countEphemeralThreads:b}}catch(a){d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("ephemerality_daily_logs: retrieving current ephemerality information failed");return{isEphemeralMessagingUser:null,countEphemeralThreadsEnabledByMe:null,countEphemeralThreads:null}}});return i.apply(this,arguments)}g.queryEphemeralityDailyLogInfo=a}),98);
__d("WAWebCommunityHomeActionWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({CommunityHomeAction:[3494,{communityHomeGroupDiscoveries:[1,a.TYPES.INTEGER],communityHomeGroupJoins:[2,a.TYPES.INTEGER],communityHomeGroupNavigations:[3,a.TYPES.INTEGER],communityHomeId:[4,a.TYPES.STRING],communityHomeViews:[5,a.TYPES.INTEGER]},[1,1,1],"regular"]},{CommunityHomeAction:[]});g.CommunityHomeActionWamEvent=b}),98);
__d("WAWebCommunityTabActionWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({CommunityTabAction:[3496,{communityNoActionTabViews:[4,a.TYPES.INTEGER],communityTabGroupNavigations:[1,a.TYPES.INTEGER],communityTabToHomeViews:[2,a.TYPES.INTEGER],communityTabViews:[3,a.TYPES.INTEGER],communityTabViewsViaContextMenu:[5,a.TYPES.INTEGER]},[1,1,1],"regular"]},{CommunityTabAction:[]});g.CommunityTabActionWamEvent=b}),98);
__d("WAWebWamEnumBackupNetworkSetting",[],(function(a,b,c,d,e,f){a=Object.freeze({WIFI_ONLY:0,WIFI_OR_CELLULAR:1});f.BACKUP_NETWORK_SETTING=a}),66);
__d("WAWebWamEnumBackupSchedule",[],(function(a,b,c,d,e,f){a=Object.freeze({OFF:0,DAILY:1,WEEKLY:2,MONTHLY:3,MANUAL:4});f.BACKUP_SCHEDULE=a}),66);
__d("WAWebWamEnumEmailState",[],(function(a,b,c,d,e,f){a=Object.freeze({NOT_ADDED:1,UNVERIFIED:2,VERIFIED:3});f.EMAIL_STATE=a}),66);
__d("WAWebWamEnumNotificationSettingType",[],(function(a,b,c,d,e,f){a=Object.freeze({ALLOWED:1,BLOCKED:2,UNKNOWN:3});f.NOTIFICATION_SETTING_TYPE=a}),66);
__d("WAWebWamEnumPrivacySettingsContactsBuckets",[],(function(a,b,c,d,e,f){a=Object.freeze({B0:1,B1:2,B5:3,B10:4,B15:5,B20:6,B30:7,B40:8,B50:9,B60:10,B70:11,B80:12,B90:13,B100:14});f.PRIVACY_SETTINGS_CONTACTS_BUCKETS=a}),66);
__d("WAWebWamEnumPrivacySettingsValueType",[],(function(a,b,c,d,e,f){a=Object.freeze({NOBODY:1,ONLY_SHARE_WITH:2,MY_CONTACTS:3,MY_CONTACTS_EXCEPT:4,EVERYONE:5});f.PRIVACY_SETTINGS_VALUE_TYPE=a}),66);
__d("WAWebDailyWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAndroidKeystoreStateType","WAWebWamEnumBackupNetworkSetting","WAWebWamEnumBackupSchedule","WAWebWamEnumEmailState","WAWebWamEnumMediaQuality","WAWebWamEnumNotificationSettingType","WAWebWamEnumPrivacySettingsContactsBuckets","WAWebWamEnumPrivacySettingsValueType"],(function(a,b,c,d,e,f,g){e=(a=d("WAWebWamCodegenUtils")).defineEvents({Daily:[1158,{accessibilityVoiceover:[108,a.TYPES.BOOLEAN],addressbookSize:[11,a.TYPES.INTEGER],addressbookWhatsappSize:[12,a.TYPES.INTEGER],androidAdvertisingId:[135,a.TYPES.STRING],androidKeystoreState:[139,d("WAWebWamEnumAndroidKeystoreStateType").ANDROID_KEYSTORE_STATE_TYPE],androidXmppWorkersRuntime:[167,a.TYPES.INTEGER],appCodeHash:[103,a.TYPES.STRING],appStandbyBucket:[121,a.TYPES.INTEGER],autoDlAudioCellular:[90,a.TYPES.BOOLEAN],autoDlAudioRoaming:[91,a.TYPES.BOOLEAN],autoDlAudioWifi:[89,a.TYPES.BOOLEAN],autoDlDocCellular:[96,a.TYPES.BOOLEAN],autoDlDocRoaming:[97,a.TYPES.BOOLEAN],autoDlDocWifi:[95,a.TYPES.BOOLEAN],autoDlImageCellular:[87,a.TYPES.BOOLEAN],autoDlImageRoaming:[88,a.TYPES.BOOLEAN],autoDlImageWifi:[86,a.TYPES.BOOLEAN],autoDlVideoCellular:[93,a.TYPES.BOOLEAN],autoDlVideoRoaming:[94,a.TYPES.BOOLEAN],autoDlVideoWifi:[92,a.TYPES.BOOLEAN],backupNetworkSetting:[10,d("WAWebWamEnumBackupNetworkSetting").BACKUP_NETWORK_SETTING],backupRestoreEncryptionVersion:[138,a.TYPES.INTEGER],backupSchedule:[9,d("WAWebWamEnumBackupSchedule").BACKUP_SCHEDULE],channelsMediaFolderSize:[186,a.TYPES.INTEGER],chatDatabaseSize:[19,a.TYPES.INTEGER],chatLockFolderCount:[168,a.TYPES.INTEGER],countEphemeralThreads:[181,a.TYPES.INTEGER],countEphemeralThreadsEnabledByMe:[182,a.TYPES.INTEGER],defaultDisappearingDuration:[140,a.TYPES.INTEGER],deviceLanguage:[153,a.TYPES.STRING],emailState:[174,d("WAWebWamEnumEmailState").EMAIL_STATE],entSecurityNotificationsEnabled:[134,a.TYPES.BOOLEAN],experimentTmoPreloadGroupDaily:[166,a.TYPES.INTEGER],favoritedAnimatedStickerCount:[113,a.TYPES.INTEGER],favoritedFirstPartyStickerCount:[112,a.TYPES.INTEGER],favoritedTotalStickerCount:[111,a.TYPES.INTEGER],hasTextstatusEmojiModified24h:[175,a.TYPES.BOOLEAN],hasTextstatusModified24h:[176,a.TYPES.BOOLEAN],hasTextstatusTextModified24h:[177,a.TYPES.BOOLEAN],hasUsername:[187,a.TYPES.BOOLEAN],installedAnimatedStickerPackCount:[116,a.TYPES.INTEGER],installedAnimatedThirdPartyStickerPackCount:[137,a.TYPES.INTEGER],installedFirstPartyStickerPackCount:[115,a.TYPES.INTEGER],installedTotalStickerPackCount:[114,a.TYPES.INTEGER],ipStr:[122,a.TYPES.STRING],isDefaultDisappearingMessagingUser:[183,a.TYPES.BOOLEAN],isEphemeralMessagingUser:[184,a.TYPES.BOOLEAN],keyboardLanguage:[154,a.TYPES.STRING],languageCode:[5,a.TYPES.STRING],lastCloudBackupSize:[185,a.TYPES.INTEGER],locationCode:[6,a.TYPES.STRING],lockFolderHidden:[171,a.TYPES.BOOLEAN],lowestAppStandbyBucket:[160,a.TYPES.INTEGER],mdPairTime:[124,a.TYPES.INTEGER],mediaFolderFileCount:[21,a.TYPES.INTEGER],mediaFolderSize:[20,a.TYPES.INTEGER],mediaQualitySetting:[188,d("WAWebWamEnumMediaQuality").MEDIA_QUALITY],modifiedInternalProps:[155,a.TYPES.BOOLEAN],networkIsRoaming:[7,a.TYPES.BOOLEAN],networkOperatorName:[159,a.TYPES.STRING],numAccounts:[163,a.TYPES.INTEGER],numContactsWithTextstatus24h:[178,a.TYPES.INTEGER],numContactsWithTextstatusEmoji24h:[179,a.TYPES.INTEGER],numContactsWithTextstatusText24h:[180,a.TYPES.INTEGER],osBuildNumber:[4,a.TYPES.STRING],osNotificationSetting:[118,d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE],packageName:[102,a.TYPES.STRING],passkeyExists:[165,a.TYPES.BOOLEAN],paymentsIsEnabled:[100,a.TYPES.BOOLEAN],permissionAccessCoarseLocation:[57,a.TYPES.INTEGER],permissionAccessFineLocation:[58,a.TYPES.INTEGER],permissionCamera:[56,a.TYPES.INTEGER],permissionContacts:[104,a.TYPES.BOOLEAN],permissionReadExternalStorage:[53,a.TYPES.INTEGER],permissionRecordAudio:[55,a.TYPES.INTEGER],phoneCores:[156,a.TYPES.INTEGER],phoneyid:[162,a.TYPES.STRING],privacySettingsAbout:[141,(b=d("WAWebWamEnumPrivacySettingsValueType")).PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsAboutExceptNum:[142,(c=d("WAWebWamEnumPrivacySettingsContactsBuckets")).PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsGroups:[143,b.PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsGroupsExceptNum:[144,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsLastSeen:[145,b.PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsLastSeenExceptNum:[146,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsProfilePhoto:[147,b.PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsProfilePhotoExceptNum:[148,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsStatus:[150,b.PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsStatusExceptNum:[151,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsStatusShareNum:[152,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],receiptsEnabled:[8,a.TYPES.BOOLEAN],secretCodeActive:[172,a.TYPES.BOOLEAN],showMetaAiButtonSetting:[173,a.TYPES.BOOLEAN],simMcc:[2,a.TYPES.INTEGER],simMnc:[3,a.TYPES.INTEGER],storageAvailSize:[31,a.TYPES.INTEGER],storageTotalSize:[32,a.TYPES.INTEGER],supportedDecoders:[169,a.TYPES.STRING],supportedEncoders:[170,a.TYPES.STRING],videoFolderFileCount:[23,a.TYPES.INTEGER],videoFolderSize:[22,a.TYPES.INTEGER]},[1,1,1],"regular"]},{Daily:[]});g.DailyWamEvent=e}),98);
__d("WAWebEstimateFtsStorageApi",["Promise","WALogger","WANullthrows","WAWebDbUsageApiUtils","WAWebIndexedDB","WAWebScanDbRowApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Estimated FTS "," size: "," KB, fetched rows: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Estimated FTS size: "," KB, fetched rows: "," took: "," ms"]);j=function(){return a};return a}var k="fts-storage",l=15e3;function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a===void 0?{sampleRows:l}:a;a=a.sampleRows;var e=Date.now(),f=a;a=c("WANullthrows")(c("WAWebIndexedDB"));a=(yield d("WAWebDbUsageApiUtils").getDatabase(a,k));var g=a.transaction(a.objectStoreNames,"readonly"),m=0,n=0;a=function*(a){var b=g.objectStore(a),c=(yield d("WAWebDbUsageApiUtils").promisifyRequest(b.count()));if(c===0)return"continue";var e=Math.min(f,c);n=e;var h=0;yield d("WAWebDbUsageApiUtils").objectStoreIterator(b,function(b){h+=d("WAWebScanDbRowApi").estimateSize(b,a);n--;return n>0});b=Math.round(h*(c/(e-n)));m+=b;d("WALogger").DEV(i(),a,b/1e3,e-n)};for(var o of g.objectStoreNames){var p=(yield* a(o));if(p==="continue")continue}p=Date.now()-e;d("WALogger").DEV(j(),m/1e3,n,p);return(h||(h=b("Promise"))).resolve(m)});return m.apply(this,arguments)}g.getEstimatedFTSDbSize=a}),98);
__d("WAWebKeepInChatNotifWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({KeepInChatNotif:[3484,{kicGroupNotificationTaps:[3,a.TYPES.INTEGER],kicGroupNotifications:[4,a.TYPES.INTEGER],kicNotificationTaps:[5,a.TYPES.INTEGER],kicNotifications:[6,a.TYPES.INTEGER]},[1,1,1],"regular"]},{KeepInChatNotif:[]});g.KeepInChatNotifWamEvent=b}),98);
__d("WAWebWamEnumInAppNotificationAlertStyle",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:1,BANNERS:2,ALERTS:3});f.IN_APP_NOTIFICATION_ALERT_STYLE=a}),66);
__d("WAWebWamEnumNotificationSoundTone",[],(function(a,b,c,d,e,f){a=Object.freeze({DEFAULT:1,CUSTOM:2});f.NOTIFICATION_SOUND_TONE=a}),66);
__d("WAWebNotificationSettingWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumInAppNotificationAlertStyle","WAWebWamEnumNotificationSoundTone"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({NotificationSetting:[3684,{groupReactionNotification:[1,a.TYPES.BOOLEAN],groupShowNotification:[2,a.TYPES.BOOLEAN],groupSoundTone:[3,d("WAWebWamEnumNotificationSoundTone").NOTIFICATION_SOUND_TONE],inAppNotificationAlertStyle:[4,d("WAWebWamEnumInAppNotificationAlertStyle").IN_APP_NOTIFICATION_ALERT_STYLE],inAppNotificationSound:[5,a.TYPES.BOOLEAN],inAppNotificationVibrate:[6,a.TYPES.BOOLEAN],messageReactionNotification:[7,a.TYPES.BOOLEAN],messageShowNotification:[8,a.TYPES.BOOLEAN],messageSoundTone:[9,d("WAWebWamEnumNotificationSoundTone").NOTIFICATION_SOUND_TONE],offlineNotification:[11,a.TYPES.BOOLEAN],showPreview:[10,a.TYPES.BOOLEAN]},[1,1,1],"regular"]},{NotificationSetting:[]});g.NotificationSettingWamEvent=b}),98);
__d("WAWebPnhDailyCtwaWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PnhDailyCtwa:[4280,{matMessagesReceived:[1,a.TYPES.INTEGER],threadDs:[3,a.TYPES.STRING],threadId:[2,a.TYPES.STRING]},[1,1,1],"regular"]},{PnhDailyCtwa:[]});g.PnhDailyCtwaWamEvent=b}),98);
__d("WAWebPnhDailyWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumTypeOfGroupEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PnhDaily:[3806,{communityId:[1,a.TYPES.STRING],mappingMissing:[7,a.TYPES.INTEGER],pnhIndicatorClicksChat:[2,a.TYPES.INTEGER],pnhIndicatorClicksInfoScreen:[3,a.TYPES.INTEGER],reactionDeleteCount:[4,a.TYPES.INTEGER],reactionOpenTrayCount:[5,a.TYPES.INTEGER],totalContacts:[8,a.TYPES.INTEGER],typeOfGroup:[6,d("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM]},[1,1,1],"regular"]},{PnhDaily:[]});g.PnhDailyWamEvent=b}),98);
__d("WAWebWamEnumPrivacyHighlightCategoryEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({E2EE:0});f.PRIVACY_HIGHLIGHT_CATEGORY_ENUM=a}),66);
__d("WAWebPrivacyHighlightDailyWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumPrivacyHighlightCategoryEnum","WAWebWamEnumPrivacyHighlightSurfaceEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PrivacyHighlightDaily:[3522,{dialogAppearCount:[1,a.TYPES.INTEGER],dialogSelectCount:[2,a.TYPES.INTEGER],narrativeAppearCount:[3,a.TYPES.INTEGER],privacyHighlightCategory:[4,d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM],privacyHighlightSurface:[5,d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM]},[1,1,1],"regular"]},{PrivacyHighlightDaily:[]});g.PrivacyHighlightDailyWamEvent=b}),98);
__d("WAWebPttDailyWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PttDaily:[2938,{pttCancelBroadcast:[9,a.TYPES.INTEGER],pttCancelGroup:[8,a.TYPES.INTEGER],pttCancelIndividual:[7,a.TYPES.INTEGER],pttCancelInterop:[42,a.TYPES.INTEGER],pttCancelNewsletter:[32,a.TYPES.INTEGER],pttDraftReviewBroadcast:[15,a.TYPES.INTEGER],pttDraftReviewGroup:[14,a.TYPES.INTEGER],pttDraftReviewIndividual:[13,a.TYPES.INTEGER],pttDraftReviewInterop:[43,a.TYPES.INTEGER],pttDraftReviewNewsletter:[33,a.TYPES.INTEGER],pttFastplaybackBroadcast:[21,a.TYPES.INTEGER],pttFastplaybackGroup:[20,a.TYPES.INTEGER],pttFastplaybackIndividual:[19,a.TYPES.INTEGER],pttFastplaybackInterop:[44,a.TYPES.INTEGER],pttFastplaybackNewsletter:[34,a.TYPES.INTEGER],pttLockBroadcast:[12,a.TYPES.INTEGER],pttLockGroup:[11,a.TYPES.INTEGER],pttLockIndividual:[10,a.TYPES.INTEGER],pttLockInterop:[45,a.TYPES.INTEGER],pttLockNewsletter:[35,a.TYPES.INTEGER],pttOutOfChatBroadcast:[29,a.TYPES.INTEGER],pttOutOfChatGroup:[30,a.TYPES.INTEGER],pttOutOfChatIndividual:[31,a.TYPES.INTEGER],pttOutOfChatInterop:[46,a.TYPES.INTEGER],pttOutOfChatNewsletter:[36,a.TYPES.INTEGER],pttPausedRecordBroadcast:[22,a.TYPES.INTEGER],pttPausedRecordGroup:[23,a.TYPES.INTEGER],pttPausedRecordIndividual:[24,a.TYPES.INTEGER],pttPausedRecordInterop:[47,a.TYPES.INTEGER],pttPausedRecordNewsletter:[37,a.TYPES.INTEGER],pttPlaybackBroadcast:[18,a.TYPES.INTEGER],pttPlaybackGroup:[17,a.TYPES.INTEGER],pttPlaybackIndividual:[16,a.TYPES.INTEGER],pttPlaybackInterop:[48,a.TYPES.INTEGER],pttPlaybackNewsletter:[38,a.TYPES.INTEGER],pttRecordBroadcast:[3,a.TYPES.INTEGER],pttRecordGroup:[2,a.TYPES.INTEGER],pttRecordIndividual:[1,a.TYPES.INTEGER],pttRecordInterop:[49,a.TYPES.INTEGER],pttRecordNewsletter:[39,a.TYPES.INTEGER],pttSendBroadcast:[6,a.TYPES.INTEGER],pttSendGroup:[5,a.TYPES.INTEGER],pttSendIndividual:[4,a.TYPES.INTEGER],pttSendInterop:[50,a.TYPES.INTEGER],pttSendNewsletter:[40,a.TYPES.INTEGER],pttStopTapBroadcast:[25,a.TYPES.INTEGER],pttStopTapGroup:[26,a.TYPES.INTEGER],pttStopTapIndividual:[27,a.TYPES.INTEGER],pttStopTapInterop:[51,a.TYPES.INTEGER],pttStopTapNewsletter:[41,a.TYPES.INTEGER]},[1,1,1],"regular"]},{PttDaily:[]});g.PttDailyWamEvent=b}),98);
__d("WAWebScreenLockSettingsDataWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({ScreenLockSettingsData:[4802,{screenAutoLockDuration:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"regular"]},{ScreenLockSettingsData:[]});g.ScreenLockSettingsDataWamEvent=a}),98);
__d("WAWebChatLockDailyWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({ChatLockDaily:[4214,{folderChatsCount:[1,a.TYPES.INTEGER],folderOpenCount:[2,a.TYPES.INTEGER],lockFolderHidden:[5,a.TYPES.BOOLEAN],newAddChatCount:[3,a.TYPES.INTEGER],newRemoveChatCount:[4,a.TYPES.INTEGER],secretCodeActive:[6,a.TYPES.BOOLEAN]},[1,1,1],"regular"]},{ChatLockDaily:[]});g.ChatLockDailyWamEvent=b}),98);
__d("WAWebSubmitChatLockDailyStats",["WAWebChatLockDailyWamEvent","WAWebChatLockGatingUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chatLockFolderChatsCount,c=a.chatLockFolderOpenCount,e=a.chatLockNewAddChatCount,f=a.chatLockNewRemoveChatCount,g=a.chatLockLockFolderHidden;a=a.chatLockSecretCodeActive;if(!d("WAWebChatLockGatingUtils").chatLockEnabled())return;if(b===0||c===0||e===0||f===0)return;b=new(d("WAWebChatLockDailyWamEvent").ChatLockDailyWamEvent)({folderChatsCount:b,folderOpenCount:c,newAddChatCount:e,newRemoveChatCount:f});g!=null&&b.set({lockFolderHidden:g});a!=null&&b.set({secretCodeActive:a});b.commit()}g.submitChatLockDailyStats=a}),98);
__d("WAWebWebDynamicSamplingTestEventWithSamplingWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebDynamicSamplingTestEventWithSampling:[5320,{},[100,100,1e4],"regular"]},{WebDynamicSamplingTestEventWithSampling:[]});g.WebDynamicSamplingTestEventWithSamplingWamEvent=a}),98);
__d("WAWebWebDynamicSamplingTestEventWithoutSamplingWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebDynamicSamplingTestEventWithoutSampling:[5322,{},[1,1,1],"regular"]},{WebDynamicSamplingTestEventWithoutSampling:[]});g.WebDynamicSamplingTestEventWithoutSamplingWamEvent=a}),98);
__d("WAWebWebcFtsStorageWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebcFtsStorage:[3642,{ftsTotalSize:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"regular"]},{WebcFtsStorage:[]});g.WebcFtsStorageWamEvent=a}),98);
__d("WAWebTasksDailyStatsTask",["Promise","WALogger","WAStorageEstimator","WATimeUtils","WAWebABProps","WAWebApiPrivacyDisallowedList","WAWebApiPrivacyEphemerality","WAWebChatThreadLoggingUtils","WAWebCommunityHomeActionWamEvent","WAWebCommunityTabActionWamEvent","WAWebContactCollection","WAWebDailyAggregatedStatsCollection","WAWebDailyWamEvent","WAWebEphemeralityResolver","WAWebEstimateFtsStorageApi","WAWebKeepInChatNotifWamEvent","WAWebMediaStore","WAWebMiscGatingUtils","WAWebMuteCollection","WAWebNotificationConstants","WAWebNotificationEngagementWamEvent","WAWebNotificationSettingWamEvent","WAWebPnhDailyCtwaWamEvent","WAWebPnhDailyWamEvent","WAWebPrivacyHighlightDailyWamEvent","WAWebPttDailyWamEvent","WAWebSchemaContact","WAWebScreenLockSettingsDataWamEvent","WAWebSubmitChatLockDailyStats","WAWebUserPrefsGeneral","WAWebUserPrefsInfoStore","WAWebUserPrefsMultiDevice","WAWebUserPrefsNotifications","WAWebUserPrefsScreenLock","WAWebWamEnumNotificationSettingType","WAWebWamEnumNotificationSoundTone","WAWebWamEnumPrivacyHighlightCategoryEnum","WAWebWamEnumPrivacyHighlightSurfaceEnum","WAWebWamEnumPrivacySettingsContactsBuckets","WAWebWamEnumPrivacySettingsValueType","WAWebWamEnumTypeOfGroupEnum","WAWebWamPrivateStatsUtils","WAWebWebDynamicSamplingTestEventWithSamplingWamEvent","WAWebWebDynamicSamplingTestEventWithoutSamplingWamEvent","WAWebWebcFtsStorageWamEvent","WAWebWebcStorageStatWamEvent","WAWebWid","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WamDailyStats: "]);i=function(){return a};return a}function j(a){if(a.goldenBoxContactNarrativeAppearCount>0||a.goldenBoxContactDialogAppearCount>0||a.goldenBoxContactDialogSelectCount>0){var b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.GOLDEN_BOX_CONTACT,narrativeAppearCount:a.goldenBoxContactNarrativeAppearCount,dialogAppearCount:a.goldenBoxContactDialogAppearCount,dialogSelectCount:a.goldenBoxContactDialogSelectCount});b.commit()}if(a.goldenBoxGroupNarrativeAppearCount>0||a.goldenBoxGroupDialogAppearCount>0||a.goldenBoxGroupDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.GOLDEN_BOX_GROUP,narrativeAppearCount:a.goldenBoxGroupNarrativeAppearCount,dialogAppearCount:a.goldenBoxGroupDialogAppearCount,dialogSelectCount:a.goldenBoxGroupDialogSelectCount});b.commit()}if(a.infoScreenGroupNarrativeAppearCount>0||a.infoScreenGroupDialogAppearCount>0||a.infoScreenGroupDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.INFO_SCREEN_GROUP,narrativeAppearCount:a.infoScreenGroupNarrativeAppearCount,dialogAppearCount:a.infoScreenGroupDialogAppearCount,dialogSelectCount:a.infoScreenGroupDialogSelectCount});b.commit()}if(a.chatsListNarrativeAppearCount>0||a.chatsListDialogAppearCount>0||a.chatsListDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.CHATS_LIST,narrativeAppearCount:a.chatsListNarrativeAppearCount,dialogAppearCount:a.chatsListDialogAppearCount,dialogSelectCount:a.chatsListDialogSelectCount});b.commit()}if(a.statusListNarrativeAppearCount>0||a.statusListDialogAppearCount>0||a.statusListDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.STATUS_LIST,narrativeAppearCount:a.statusListNarrativeAppearCount,dialogAppearCount:a.statusListDialogAppearCount,dialogSelectCount:a.statusListDialogSelectCount});b.commit()}if(a.callingScreenAudioNarrativeAppearCount>0||a.callingScreenAudioDialogAppearCount>0||a.callingScreenAudioDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.CALLING_SCREEN_AUDIO,narrativeAppearCount:a.callingScreenAudioNarrativeAppearCount,dialogAppearCount:a.callingScreenAudioDialogAppearCount,dialogSelectCount:a.callingScreenAudioDialogSelectCount});b.commit()}}function k(){var a=!d("WAWebMuteCollection").MuteCollection.globalReactionsMute(),b=!!d("WAWebUserPrefsNotifications").getIgnoreNondirectGroupMsg(),c=new(d("WAWebNotificationSettingWamEvent").NotificationSettingWamEvent)();c.set({groupReactionNotification:b&&a,groupShowNotification:b,groupSoundTone:d("WAWebWamEnumNotificationSoundTone").NOTIFICATION_SOUND_TONE.DEFAULT,inAppNotificationSound:d("WAWebUserPrefsNotifications").getGlobalSounds(),messageReactionNotification:a,messageShowNotification:d("WAWebUserPrefsNotifications").getGlobalNotifications(),messageSoundTone:d("WAWebWamEnumNotificationSoundTone").NOTIFICATION_SOUND_TONE.DEFAULT,showPreview:d("WAWebUserPrefsNotifications").getGlobalPreviews(),offlineNotification:d("WAWebUserPrefsNotifications").getGlobalOfflineNotifications()});c.commit()}function a(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m()),b=(yield o()),e=(yield s()),f=(yield u()),g=v(),h=(yield w());a=babelHelpers["extends"]({},a,b,e,g,h);d("WALogger").DEV(i()).devConsole(a);b=new(d("WAWebDailyWamEvent").DailyWamEvent)();b.set(a);b.commit();k();g=new(d("WAWebWebcFtsStorageWamEvent").WebcFtsStorageWamEvent)();g.set({ftsTotalSize:f});g.commit();h=new(d("WAWebScreenLockSettingsDataWamEvent").ScreenLockSettingsDataWamEvent)();a=y();a&&h.set(a);h.commit();b=d("WAWebUserPrefsMultiDevice").getPairingTimestamp();f=new(d("WAWebWebcStorageStatWamEvent").WebcStorageStatWamEvent)();f.set({webcStorageQuota:e.storageTotalSize,webcStorageUsage:e.storageUsed,webcAgeOfStorage:b!=null?d("WATimeUtils").unixTimeWithoutClockSkewCorrection()-b:-1,webcPackingEnabled:!1});void f.commit();g=(yield d("WAWebUserPrefsGeneral").getOfflineNotificationEngagement());if(g){new(d("WAWebNotificationEngagementWamEvent").NotificationEngagementWamEvent)({isWebBackgroundSyncNotif:!0,totalNotifShown:(a=g.totalNotifShown)!=null?a:0,totalNotifTapToOpen:(h=g.totalNotifTapToOpen)!=null?h:0}).commit();void d("WAWebUserPrefsGeneral").clearOfflineNotificationContentEngagement()}d("WAWebWamPrivateStatsUtils").logDailyPrivateStatsTestEvents();e=d("WAWebDailyAggregatedStatsCollection").DailyAggregatedStatsCollection.toArray().filter(function(a){return a.shouldBeSubmitted()});d("WAWebDailyAggregatedStatsCollection").DailyAggregatedStatsCollection.remove(e);e.forEach(function(a){var b=new(d("WAWebPttDailyWamEvent").PttDailyWamEvent)({pttCancelBroadcast:a.pttCancelBroadcast,pttCancelGroup:a.pttCancelGroup,pttCancelIndividual:a.pttCancelIndividual,pttCancelNewsletter:a.pttCancelNewsletter,pttDraftReviewBroadcast:a.pttDraftReviewBroadcast,pttDraftReviewGroup:a.pttDraftReviewGroup,pttDraftReviewIndividual:a.pttDraftReviewIndividual,pttDraftReviewNewsletter:a.pttDraftReviewNewsletter,pttFastplaybackBroadcast:a.pttFastplaybackBroadcast,pttFastplaybackGroup:a.pttFastplaybackGroup,pttFastplaybackIndividual:a.pttFastplaybackIndividual,pttFastplaybackNewsletter:a.pttFastplaybackNewsletter,pttLockBroadcast:a.pttLockBroadcast,pttLockGroup:a.pttLockGroup,pttLockIndividual:a.pttLockIndividual,pttLockNewsletter:a.pttLockNewsletter,pttOutOfChatBroadcast:a.pttOutOfChatBroadcast,pttOutOfChatGroup:a.pttOutOfChatGroup,pttOutOfChatIndividual:a.pttOutOfChatIndividual,pttOutOfChatNewsletter:a.pttOutOfChatNewsletter,pttPlaybackBroadcast:a.pttPlaybackBroadcast,pttPlaybackGroup:a.pttPlaybackGroup,pttPlaybackIndividual:a.pttPlaybackIndividual,pttPlaybackNewsletter:a.pttPlaybackNewsletter,pttRecordBroadcast:a.pttRecordBroadcast,pttRecordGroup:a.pttRecordGroup,pttRecordIndividual:a.pttRecordIndividual,pttRecordNewsletter:a.pttRecordNewsletter,pttSendBroadcast:a.pttSendBroadcast,pttSendGroup:a.pttSendGroup,pttSendIndividual:a.pttSendIndividual,pttSendNewsletter:a.pttSendNewsletter,pttPausedRecordBroadcast:a.pttPausedRecordBroadcast,pttPausedRecordGroup:a.pttPausedRecordGroup,pttPausedRecordIndividual:a.pttPausedRecordIndividual,pttPausedRecordNewsletter:a.pttPausedRecordNewsletter,pttStopTapBroadcast:a.pttStopTapBroadcast,pttStopTapGroup:a.pttStopTapGroup,pttStopTapIndividual:a.pttStopTapIndividual,pttStopTapNewsletter:a.pttStopTapNewsletter});b.commit();j(a);new(d("WAWebCommunityTabActionWamEvent").CommunityTabActionWamEvent)({communityTabGroupNavigations:a.communityTabGroupNavigations,communityTabToHomeViews:a.communityTabToHomeViews,communityTabViews:a.communityTabViews,communityTabViewsViaContextMenu:a.communityTabViewsViaContextMenu}).commit();a.communityHome!=null&&Object.keys(a.communityHome).forEach(function(b){var e=c("WAWebWid").user(b);if(e==null)return;b=a.communityHome[b];var f=b.communityHomeGroupDiscoveries,g=b.communityHomeGroupJoins,h=b.communityHomeGroupNavigations;b=b.communityHomeViews;new(d("WAWebCommunityHomeActionWamEvent").CommunityHomeActionWamEvent)({communityHomeId:e,communityHomeGroupDiscoveries:f,communityHomeGroupJoins:g,communityHomeGroupNavigations:h,communityHomeViews:b}).commit()});a.pnhCagActions!=null&&Object.keys(a.pnhCagActions).forEach(function(b){var c=a.pnhCagActions[b],e=c.pnhIndicatorClicksChat,f=c.pnhIndicatorClicksInfoScreen,g=c.reactionDeleteCount;c=c.reactionOpenTrayCount;new(d("WAWebPnhDailyWamEvent").PnhDailyWamEvent)({communityId:b,pnhIndicatorClicksChat:e,pnhIndicatorClicksInfoScreen:f,reactionDeleteCount:g,reactionOpenTrayCount:c,typeOfGroup:d("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM.DEFAULT_SUBGROUP}).commit()});a.pnhCtwaActions!=null&&Object.keys(a.pnhCtwaActions).forEach(function(b){new(d("WAWebPnhDailyCtwaWamEvent").PnhDailyCtwaWamEvent)({threadDs:d("WAWebChatThreadLoggingUtils").getThreadDs(a.startTime),threadId:b,matMessagesReceived:a.pnhCtwaActions[b]}).commit()});b=new(d("WAWebKeepInChatNotifWamEvent").KeepInChatNotifWamEvent)({kicGroupNotificationTaps:a.kicGroupNotificationTaps,kicGroupNotifications:a.kicGroupNotifications,kicNotificationTaps:a.kicNotificationTaps,kicNotifications:a.kicNotifications});b.commit();d("WAWebSubmitChatLockDailyStats").submitChatLockDailyStats(a)});void new(d("WAWebWebDynamicSamplingTestEventWithoutSamplingWamEvent").WebDynamicSamplingTestEventWithoutSamplingWamEvent)().commit();void new(d("WAWebWebDynamicSamplingTestEventWithSamplingWamEvent").WebDynamicSamplingTestEventWithSamplingWamEvent)().commit()});return l.apply(this,arguments)}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsInfoStore").deviceInfo.get());return{languageCode:a.lg,locationCode:a.lc,osBuildNumber:a.osBuild,simMcc:parseInt(a.mcc,10),simMnc:parseInt(a.mnc,10)}});return n.apply(this,arguments)}function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a,b=d("WAWebUserPrefsGeneral").getUserPrivacySettings(),c={receiptsEnabled:b.readReceipts!=="none"},e=(yield d("WAWebApiPrivacyDisallowedList").queryDisallowedLists());c.privacySettingsAbout=q(b.about);c.privacySettingsAboutExceptNum=b.about==="contact_blacklist"?r((a=e.about)==null?void 0:a.disallowedList.length):null;c.privacySettingsGroups=q(b.groupAdd);c.privacySettingsGroupsExceptNum=b.groupAdd==="contact_blacklist"?r((a=e.groupadd)==null?void 0:a.disallowedList.length):null;c.privacySettingsLastSeen=q(b.lastSeen);c.privacySettingsLastSeenExceptNum=b.lastSeen==="contact_blacklist"?r((a=e.last)==null?void 0:a.disallowedList.length):null;c.privacySettingsProfilePhoto=q(b.profilePicture);c.privacySettingsProfilePhotoExceptNum=b.profilePicture==="contact_blacklist"?r((a=e.profile)==null?void 0:a.disallowedList.length):null;b=d("WAWebEphemeralityResolver").getEphemeralDurationForUser(d("WAWebContactCollection").ContactCollection.getMeContact());c.defaultDisappearingDuration=(e=b)!=null?e:0;if(d("WAWebABProps").getABPropConfigValue("dm_initiator_trigger_daily_logs")){c.isDefaultDisappearingMessagesUser=b!==0;a=(yield d("WAWebApiPrivacyEphemerality").queryEphemeralityDailyLogInfo());e=a.isEphemeralMessagingUser;b=a.countEphemeralThreadsEnabledByMe;a=a.countEphemeralThreads;c.isEphemeralMessagingUser=e;c.countEphemeralThreads=a;c.countEphemeralThreadsEnabledByMe=b}return c});return p.apply(this,arguments)}function q(a){if(a==null)return null;switch(a){case"all":return d("WAWebWamEnumPrivacySettingsValueType").PRIVACY_SETTINGS_VALUE_TYPE.EVERYONE;case"contacts":return d("WAWebWamEnumPrivacySettingsValueType").PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS;case"contact_blacklist":return d("WAWebWamEnumPrivacySettingsValueType").PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS_EXCEPT;case"none":return d("WAWebWamEnumPrivacySettingsValueType").PRIVACY_SETTINGS_VALUE_TYPE.NOBODY}}function r(a){if(a==null)return null;if(a===0)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B0;if(a<5)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B1;if(a<10)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B5;if(a<15)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B10;if(a<20)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B15;if(a<30)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B20;if(a<40)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B30;if(a<50)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B40;if(a<60)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B50;if(a<70)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B60;if(a<80)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B70;if(a<90)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B80;return a<100?d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B90:d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B100}function s(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaContact").getContactTable().equals(["isAddressBookContact"],1).then(function(a){return a.length})),c=(yield d("WAStorageEstimator").estimateStorage()),e=(yield d("WAWebMediaStore").LruMediaStore.count());c=(yield (h||(h=b("Promise"))).all([c,a,e]));a=0;e=0;var f=0,g=c[0];if(g.success){g=g.value;var i=g.quota;g=g.usage;a=i-g;e=i;f=g}return{addressbookWhatsappSize:z(c[1],10),storageAvailSize:z(a,100),storageTotalSize:z(e,100),storageUsed:z(f,100),mediaFolderFileCount:c[2]}});return t.apply(this,arguments)}function u(){return d("WAWebEstimateFtsStorageApi").getEstimatedFTSDbSize()}function v(){var a=d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE.UNKNOWN;if(window.Notification!=null)switch(window.Notification.permission){case d("WAWebNotificationConstants").PERMISSION_ALLOWED:a=d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE.ALLOWED;break;case d("WAWebNotificationConstants").PERMISSION_DENIED:a=d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE.BLOCKED;break;default:a=d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE.UNKNOWN}return{osNotificationSetting:a}}function w(){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=[],b=[],c=window.navigator.mediaCapabilities;if(c!=null){var d={width:800,height:600,bitrate:1e4,framerate:30},e={type:"record"},f={type:"file"},g={contentType:'video/mp4; codecs="avc1.42000a"'},h={contentType:'video/mp4; codecs="hev1.1.6.L93.B0"'},i={contentType:'video/mp4; codecs="av01.0.00M.08"'},j={contentType:'video/mp4; codecs="vp09.00.51.08.01.01.01.01.00"'},k=babelHelpers["extends"]({},e,{video:babelHelpers["extends"]({},g,d)}),l=babelHelpers["extends"]({},e,{video:babelHelpers["extends"]({},h,d)}),m=babelHelpers["extends"]({},e,{video:babelHelpers["extends"]({},i,d)});e=babelHelpers["extends"]({},e,{video:babelHelpers["extends"]({},j,d)});g=babelHelpers["extends"]({},f,{video:babelHelpers["extends"]({},g,d)});h=babelHelpers["extends"]({},f,{video:babelHelpers["extends"]({},h,d)});i=babelHelpers["extends"]({},f,{video:babelHelpers["extends"]({},i,d)});f=babelHelpers["extends"]({},f,{video:babelHelpers["extends"]({},j,d)});if(c.encodingInfo!=null){try{(yield c.encodingInfo(k)).supported&&a.push("avc")}catch(a){}try{(yield c.encodingInfo(l)).supported&&a.push("hevc")}catch(a){}try{(yield c.encodingInfo(m)).supported&&a.push("av1")}catch(a){}try{(yield c.encodingInfo(e)).supported&&a.push("vp9")}catch(a){}}if(c.decodingInfo!=null){try{(yield c.decodingInfo(g)).supported&&b.push("avc")}catch(a){}try{(yield c.decodingInfo(h)).supported&&b.push("hevc")}catch(a){}try{(yield c.decodingInfo(i)).supported&&b.push("av1")}catch(a){}try{(yield c.decodingInfo(f)).supported&&b.push("vp9")}catch(a){}}}return{supportedEncoders:a.join(","),supportedDecoders:b.join(",")}});return x.apply(this,arguments)}function y(){if(d("WAWebMiscGatingUtils").screenLockFeatureSupported())return{screenAutoLockDuration:d("WAWebUserPrefsScreenLock").getScreenLockDurationForLogging()}}function z(a,b){return c("gkx")("26258")?Math.round(a/b)*b:a}g.logDailyStats=a}),98);
__d("WAWebLogDailyStatsJob",["WAJobOrchestratorTypes","WAWebOrchestratorNonPersistedJob","WAWebTasksDailyStatsTask"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("logDailyStats",function(a){return d("WAWebTasksDailyStatsTask").logDailyStats()},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT}).waitUntilCompleted()}g.logDailyStatsJob=a}),98);
__d("WAWebWamEnumActiveTimeAfterPairing",[],(function(a,b,c,d,e,f){a=Object.freeze({MINS_10:1,MINS_20:2,MINS_40:3,MINS_60:4,MINS_5:5});f.ACTIVE_TIME_AFTER_PAIRING=a}),66);
__d("WAWebWamEnumMdHistorySyncStatusResult",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:1,UNFINISHED:2,FAIL_TO_DOWNLOAD:3,MISSING_CHUNK:4,PROTOBUF_ERROR:5,FAIL_TO_STORE:6,OTHER_ERROR:7,IN_PROGRESS:8,FAIL_TO_RECEIVE:9,FAIL_TO_STORE_CHUNK:10,FAIL_TO_FETCH:11,FAIL_TO_PREPROCESS:12,FAIL_TO_ENCRYPT:13});f.MD_HISTORY_SYNC_STATUS_RESULT=a}),66);
__d("WAWebMdBootstrapHistorySyncStatusAfterPairingWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumActiveTimeAfterPairing","WAWebWamEnumMdBootstrapHistoryPayloadType","WAWebWamEnumMdHistorySyncStatusResult"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MdBootstrapHistorySyncStatusAfterPairing:[4652,{activeTimeAfterPairing:[1,d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING],isLoopRunning:[12,a.TYPES.BOOLEAN],lastProcessedNotificationChunkOrder:[2,a.TYPES.INTEGER],lastProcessedNotificationChunkProgress:[3,a.TYPES.INTEGER],mdBootstrapHistoryPayloadType:[4,d("WAWebWamEnumMdBootstrapHistoryPayloadType").MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE],mdHistorySyncStatusResult:[5,d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT],mdSessionId:[6,a.TYPES.STRING],mdTimestamp:[7,a.TYPES.INTEGER],missingNotificationCount:[8,a.TYPES.INTEGER],nextNotificationChunkOrder:[9,a.TYPES.INTEGER],totalProcessedMessageCount:[10,a.TYPES.INTEGER],unprocessedNotificationCount:[11,a.TYPES.INTEGER]},[1,1,1],"regular"]},{MdBootstrapHistorySyncStatusAfterPairing:[]});g.MdBootstrapHistorySyncStatusAfterPairingWamEvent=b}),98);
__d("WAWebLogHistorySyncStatusAfterPairingJob",["Promise","WAJobOrchestratorTypes","WALogger","WATimeUtils","WAWebApiHistorySyncNotification","WAWebHistorySyncNotificationUtils","WAWebMdBootstrapHistorySyncStatusAfterPairingWamEvent","WAWebOrchestratorNonPersistedJob","WAWebSyncBootstrap","WAWebSyncdMdSyncFieldstatMeta","WAWebUserPrefsHistorySync","WAWebUserPrefsTypes","WAWebWamEnumActiveTimeAfterPairing","WAWebWamEnumMdBootstrapHistoryPayloadType","WAWebWamEnumMdHistorySyncStatusResult","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] do not log status as no requirment meets"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 5 minutes after pairing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 10 minutes after pairing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 20 minutes after pairing"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 40 minutes after pairing"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 60 minutes after pairing"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] skip sync status logging as we've logged for more than 5 times"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] skip sync status logging as it's too soon after pairing"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log history sync status with time after pairing "," mins and logging count ",""]);q=function(){return a};return a}function a(a,c){a=(d("WATimeUtils").unixTime()-a)/60;d("WALogger").DEV(q(),a,c);if(a<5){d("WALogger").LOG(p());return(h||(h=b("Promise"))).resolve()}return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("logHistorySyncStatusAfterPairing",function(a){return r(a.timeAfterPairingMins,a.loggingCount)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}).waitUntilCompleted({timeAfterPairingMins:a,loggingCount:c})}function r(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b>=5){d("WALogger").LOG(o());return}if(a>=60){d("WALogger").LOG(n());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_60);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(5);return}if(b<4&&a>=40){d("WALogger").LOG(m());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_40);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(4);return}if(b<3&&a>=20){d("WALogger").LOG(l());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_20);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(3);return}if(b<2&&a>=10){d("WALogger").LOG(k());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_10);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(2);return}if(b<1&&a>=5){d("WALogger").LOG(j());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_5);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(1);return}d("WALogger").LOG(i())});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield v(a)});return u.apply(this,arguments)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSyncdMdSyncFieldstatMeta").MdSyncFieldStatsMeta.getMdSessionId());b=new(d("WAWebMdBootstrapHistorySyncStatusAfterPairingWamEvent").MdBootstrapHistorySyncStatusAfterPairingWamEvent)({mdBootstrapHistoryPayloadType:d("WAWebWamEnumMdBootstrapHistoryPayloadType").MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.RECENT_HISTORY,mdSessionId:b,mdTimestamp:d("WATimeUtils").unixTimeMs(),activeTimeAfterPairing:a,isLoopRunning:c("WAWebSyncBootstrap").getIsHistorySyncRunning()});a=(yield d("WAWebUserPrefsHistorySync").getLastHistoryRecentSyncedChunk());var e=a!=null?a.chunkOrder:-1,f=a!=null?a.progress:-1;b.lastProcessedNotificationChunkOrder=e;b.lastProcessedNotificationChunkProgress=f;f=(f=(yield d("WAWebUserPrefsHistorySync").getHistorySyncTotalProcessedMessageCount()))!=null?f:0;b.totalProcessedMessageCount=f;f=(yield d("WAWebUserPrefsHistorySync").getHistorySyncStatus());if((f==null?void 0:f.recentCompleted)===!0){b.mdHistorySyncStatusResult=d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.SUCCESS;b.commit();return}f=(yield d("WAWebHistorySyncNotificationUtils").getUnprocessedRecentSyncNotifications());var g=f.length;b.unprocessedNotificationCount=g;f=g>0?(g=f[0].chunkOrder)!=null?g:0:-1;b.nextNotificationChunkOrder=f;if(d("WAWebApiHistorySyncNotification").inFlightChunk.size>0){b.mdHistorySyncStatusResult=d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.IN_PROGRESS;b.commit();return}g=a?e+1:1;f=(yield d("WAWebUserPrefsHistorySync").getRecentSyncSingleChunkStatus());a=x(f,g);b.mdHistorySyncStatusResult=a;b.commit()});return w.apply(this,arguments)}function x(a,b){if(a==null||a[b]==null)return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_RECEIVE;switch(a[b]){case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.RECEIVED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_STORE_CHUNK;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.NOTIFICATION_STORED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_FETCH;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.DOWNLOADING:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_DOWNLOAD;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.DOWNLOADED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.PROTOBUF_ERROR;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.DECODED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_PREPROCESS;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.MESSAGE_PREPROCESSED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_ENCRYPT;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.ENCRYPTED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_STORE;default:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.OTHER_ERROR}}g.logHistorySyncStatusAfterPairingJob=a;g.logHistorySyncStatusAfterPairing=r;g.commitHistorySyncStatusData=t}),98);
__d("WAWebNewsletterCleanupTasks",["WAWebBackendApi","WAWebCommonNewsletterEnums","WAWebNewsletterDeleteChatJob","WAWebNewsletterStorageUtils","WAWebSchemaNewsletterMetadata","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=d("WAWebNewsletterStorageUtils").mapNewsletterMembershipTypeForStorage(d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Guest);function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebBackendApi").frontendSendAndReceive("getActiveNewsletter")),b=a==null?void 0:a.toJid();a=(yield d("WAWebSchemaNewsletterMetadata").getNewsletterMetadataTable().all());a=a.filter(function(a){return a.membershipType===h&&a.id!==b}).map(function(a){return a.id});yield d("WAWebNewsletterDeleteChatJob").bulkDeleteNewsletterChats(a.map(d("WAWebWidFactory").createWid))});return i.apply(this,arguments)}g.deletePreviewNewsletters=a}),98);
__d("WAWebWebDbVersionNonAnonymousWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumWebDbNameType"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebDbVersionNonAnonymous:[4816,{webDbName:[1,d("WAWebWamEnumWebDbNameType").WEB_DB_NAME_TYPE],webDbVersionNumber:[2,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"regular"]},{WebDbVersionNonAnonymous:[]});g.WebDbVersionNonAnonymousWamEvent=a}),98);
__d("WAWebReportDbVerionsJob",["WAJobOrchestratorTypes","WAWebLocalSchemaVersions","WAWebOrchestratorNonPersistedJob","WAWebSchemaVersions","WAWebWebDbVersionNonAnonymousWamEvent","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("reportDbVersions",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebLocalSchemaVersions").getLocalSchemaVersions());a.forEach(function(a,b){new(d("WAWebWebDbVersionNonAnonymousWamEvent").WebDbVersionNonAnonymousWamEvent)({webDbName:d("WAWebSchemaVersions").convertDBName(b),webDbVersionNumber:a}).commit()})}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,maxTimeoutMs:1e3*30}).waitUntilCompleted()}g.reportDbVersionsJob=a}),98);
__d("WAWebRestartRecentSyncJob",["Promise","WAJobOrchestratorTypes","WALogger","WAWebHistorySyncNotificationUtils","WAWebOrchestratorNonPersistedJob","WAWebProtobufsHistorySync.pb","WAWebSchemaHistorySyncNotification","WAWebSyncBootstrap","WAWebSyncGatingUtils","WAWebUserPrefsHistorySync","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Restart recent sync job"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Unprocessed notifications length: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] No unprocessed notifications found, skip restart recent sync job"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Full sync already completed, skip restart recent sync job"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Recent sync already completed, skip restart recent sync job"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] History sync is running, skip restart recent sync job"]);n=function(){return a};return a}function a(){return!d("WAWebSyncGatingUtils").isHistorySyncHandlingRestartV2Enabled()?(h||(h=b("Promise"))).resolve():d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("restartRecentSyncJob",function(){return o()},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}).waitUntilCompleted()}function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("WAWebSyncBootstrap").getIsHistorySyncRunning()){d("WALogger").LOG(n());return}var a=(yield d("WAWebUserPrefsHistorySync").getHistorySyncStatus()),b=c("gkx")("26254");if(b&&(a==null?void 0:a.recentCompleted)===!0){d("WALogger").LOG(m());return}if(!b&&(a==null?void 0:a.fullCompleted)===!0){d("WALogger").LOG(l());return}b=(yield d("WAWebSchemaHistorySyncNotification").getHistorySyncNotificationTable().equals(["processed"],0,{shouldDecrypt:!1}).then(function(a){return a.filter(function(a){return a.syncType===d("WAWebProtobufsHistorySync.pb").HistorySync$HistorySyncType.RECENT||a.syncType===d("WAWebProtobufsHistorySync.pb").HistorySync$HistorySyncType.FULL})}));if(b.length===0){d("WALogger").LOG(k());return}d("WALogger").LOG(j(),b.length);d("WALogger").LOG(i());void c("WAWebSyncBootstrap").continueProgressiveHistorySyncProcessingV2(d("WAWebHistorySyncNotificationUtils").HistorySyncScheduleSource.ManualRestart)});return p.apply(this,arguments)}g.restartRecentSyncJob=a}),98);
__d("WAWebSyncdKeyCountWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({SyncdKeyCount:[3978,{keysUsedInSnapshotCount:[1,a.TYPES.INTEGER],p80MuationsPerKey:[2,a.TYPES.INTEGER],p95MuationsPerKey:[3,a.TYPES.INTEGER],syncdSessionLengthDays:[4,a.TYPES.INTEGER],totalKeyCount:[5,a.TYPES.INTEGER]},[1,1,1],"regular"]},{SyncdKeyCount:[]});g.SyncdKeyCountWamEvent=b}),98);
__d("WAWebWamEnumMutationCountBucket",[],(function(a,b,c,d,e,f){a=Object.freeze({ZERO:1,ONE:2,LT10:3,LT100:4,LT500:5,LT1K:6,LT5K:7,GTE5K:8});f.MUTATION_COUNT_BUCKET=a}),66);
__d("WAWebSyncdWamUtils",["WABase64","WAGetSyncKey","WASyncdConst","WATimeUtils","WAWebSchemaSyncActions","WAWebWamEnumMutationCountBucket","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=new Map(),b=(yield d("WAWebSchemaSyncActions").getSyncActionsTable().all());b.map(function(b){var c,e=JSON.parse(b.index)[0];c=(c=a.get(e))!=null?c:{action:e,applied:0,invalid:0,orphan:0,unsupported:0,failed:0};switch(b.actionState){case d("WASyncdConst").SyncActionState.Success:case d("WASyncdConst").SyncActionState.Skipped:c.applied++;break;case d("WASyncdConst").SyncActionState.Malformed:c.invalid++;break;case d("WASyncdConst").SyncActionState.Orphan:c.orphan++;break;case d("WASyncdConst").SyncActionState.Unsupported:c.unsupported++;break;case d("WASyncdConst").SyncActionState.Failed:c.failed++;break}a.set(e,c)});return a});return h.apply(this,arguments)}function e(a){if(a<0)throw c("err")("cannot convert negative number to a bucket");else if(a===0)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.ZERO;else if(a===1)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.ONE;else if(a<10)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT10;else if(a<100)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT100;else if(a<500)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT500;else if(a<1e3)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT1K;else if(a<5e3)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT5K;else return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.GTE5K}function i(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaSyncActions").getSyncActionsTable().get('["primary_version","session_start"]'));return a==null?void 0:a.timestamp});return j.apply(this,arguments)}function f(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAGetSyncKey").getAllSyncKeysInTransaction()),b=(yield d("WAWebSchemaSyncActions").getSyncActionsTable().all()),c=(yield i());c=c==null?void 0:Math.round((d("WATimeUtils").unixTimeMs()-c)/(1e3*3600*24));return l(a,b,c)});return k.apply(this,arguments)}function l(a,b,c){b=b.map(function(a){return d("WABase64").encodeB64(a.keyId)});var e=Array.from(new Set(b)),f=new Map();for(b of b)f.set(b,(f.get(b)||0)+1);b=Array.from(f.values()).sort();f=b.length;var g=Math.floor(f*.8)-1;f=Math.floor(f*.95)-1;return{totalKeyCount:a.length,keysUsedInSnapshotCount:e.length,p80MuationsPerKey:b[g],p95MuationsPerKey:b[f],syncdSessionLengthDays:c}}g.generateActionStatCounts=a;g.convertToBucket=e;g.getKeyStats=f;g.getKeyStatsInternal=l}),98);
__d("WAWebSyncdReportKeyStatsJob",["WAJobOrchestratorTypes","WAWebOrchestratorNonPersistedJob","WAWebSyncdKeyCountWamEvent","WAWebSyncdWamUtils","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("reportSyncdKeyStats",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("gkx")("26258"))return;var a=(yield d("WAWebSyncdWamUtils").getKeyStats()),b={keysUsedInSnapshotCount:a.keysUsedInSnapshotCount,p80MuationsPerKey:a.p80MuationsPerKey,p95MuationsPerKey:a.p95MuationsPerKey,totalKeyCount:a.totalKeyCount};a.syncdSessionLengthDays!=null&&(b.syncdSessionLengthDays=a.syncdSessionLengthDays);new(d("WAWebSyncdKeyCountWamEvent").SyncdKeyCountWamEvent)(b).commit()}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,maxTimeoutMs:1e3*30}).waitUntilCompleted()}g.reportSyncdKeyStatsJob=a}),98);
__d("WAWebMdAppStateSyncMutationStatsWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMutationCountBucket"],(function(a,b,c,d,e,f,g){b=d("WAWebWamCodegenUtils").defineEvents({MdAppStateSyncMutationStats:[3180,{applied:[1,(a=d("WAWebWamEnumMutationCountBucket")).MUTATION_COUNT_BUCKET],failed:[2,a.MUTATION_COUNT_BUCKET],invalid:[3,a.MUTATION_COUNT_BUCKET],orphan:[4,a.MUTATION_COUNT_BUCKET],syncdAction:[5,d("WAWebWamCodegenUtils").TYPES.STRING],unsupported:[6,a.MUTATION_COUNT_BUCKET]},[1,1,20],"private",0]},{MdAppStateSyncMutationStats:[]});g.MdAppStateSyncMutationStatsWamEvent=b}),98);
__d("WAWebSyncdReportSyncdStatJob",["WAJobOrchestratorTypes","WAWebMdAppStateSyncMutationStatsWamEvent","WAWebOrchestratorNonPersistedJob","WAWebSyncdWamUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("reportSyncdStats",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSyncdWamUtils").generateActionStatCounts());for(a of a.values()){var b;new(d("WAWebMdAppStateSyncMutationStatsWamEvent").MdAppStateSyncMutationStatsWamEvent)({syncdAction:a.action,applied:(b=d("WAWebSyncdWamUtils")).convertToBucket(a.applied),invalid:b.convertToBucket(a.invalid),orphan:b.convertToBucket(a.orphan),unsupported:b.convertToBucket(a.unsupported),failed:b.convertToBucket(a.failed)}).commit()}}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,maxTimeoutMs:1e3*30}).waitUntilCompleted()});return h.apply(this,arguments)}g.reportSyncdStatsJob=a}),98);
__d("WAWebSyncdRequestAllSyncdMissingKeysJob",["WAJobOrchestratorTypes","WASyncdHandleMissingKeys","WASyncdStoreMissingKeys","WAWebOrchestratorNonPersistedJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("requestAllSyncdMissingKeys",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WASyncdHandleMissingKeys").requestAllMissingKeys(),self.setTimeout(d("WASyncdStoreMissingKeys").setMissingKeyTimeoutInTransaction,1e3*20)}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,maxTimeoutMs:1e3*30}).waitUntilCompleted()}g.requestAllSyncdMissingKeysJob=a}),98);
__d("WAWebSyncdSyncAllCollectionsJob",["WAJobOrchestratorTypes","WALogger","WASyncd","WASyncdConst","WATimeUtils","WAWebOrchestratorNonPersistedJob","WAWebUserPrefsAppStateSync","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: periodic sync for all collection"]);h=function(){return a};return a}function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("syncdSyncAllCollections",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;d("WALogger").LOG(h());yield d("WASyncd").markCollectionsForSync([(a=d("WASyncdConst")).CollectionName.CriticalBlock,a.CollectionName.CriticalUnblockLow,a.CollectionName.Regular,a.CollectionName.RegularLow,a.CollectionName.RegularHigh]);yield d("WAWebUserPrefsAppStateSync").setLastPeriodicAppStateSyncTs(d("WATimeUtils").unixTime())}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,maxTimeoutMs:1e3*30}).waitUntilCompleted()}g.syncdSyncAllCollectionsJob=a}),98);
__d("WAWebTasksDefinitions",["$InternalEnum","Promise","WALogger","WASyncdAntiTampering","WATaskScheduler","WATimeUtils","WAWebABProps","WAWebABPropsLocalStorage","WAWebAbPropsSyncJob","WAWebApiChat","WAWebApiParticipantStore","WAWebApiTasksScheduledTime","WAWebApiTextStatus","WAWebBizGatingUtils","WAWebCleanUtmJob","WAWebContactSyncBridge","WAWebCoreWamIntegration","WAWebDBPruneExpiredOrphanReactions","WAWebDBPurgeExpiredRecords","WAWebDBReportingTokenUtils","WAWebFetchQuickPromotions","WAWebLogDailyStatsJob","WAWebLogHistorySyncStatusAfterPairingJob","WAWebMessagingGatingUtils","WAWebMobilePlatforms","WAWebNewsletterCleanupTasks","WAWebNonAddressBookContactsJob","WAWebNonMessageDataRequestMediaHandlingUtils","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","WAWebReportDbVerionsJob","WAWebRestartRecentSyncJob","WAWebSyncContactsJob","WAWebSyncdReportKeyStatsJob","WAWebSyncdReportSyncdStatJob","WAWebSyncdRequestAllSyncdMissingKeysJob","WAWebSyncdSyncAllCollectionsJob","WAWebUserPrefsHistorySync","WAWebUserPrefsMultiDevice","WAWebUserPrefsTabMutex","asyncToGeneratorRuntime","cr:4857","cr:4940","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeRegisterTask: registering task ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to cleanup reporting token table: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] do not schedule job for logging history sync status as we've logged for more than 4 times."]);k=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["wam-core: This tab is in the background, skipping Private Core WAM processing for now"]);a=function(){return b};return b}function e(){var a=babelHelpers.taggedTemplateLiteralLoose(["wam-core: This tab is in the background, skipping Regular Core WAM processing for now"]);e=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to clean expired UTM: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete the expired orphan reactions with error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete the expired orphan add-on messages with error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete the expired orphan reactions with error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: syncdPeriodicSyncDays is 0, skipping sync"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncContacts: contact sync failed, error: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to sync non-address book contacts with error: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["RotateKeyTask skip first run"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to log daily stats: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to update the expired text status of contacts with error: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update expired text status skip first run"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete the expired TcTokens with error: ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["CleanTcToken skip first run"]);x=function(){return a};return a}var y=b("$InternalEnum")({CLEAN_TC_TOKENS:"cleanTcTokens",LOG_DAILY_STATS:"logDailyStats",LOG_DB_ROW_COUNTS:"logDbRowCounts",ROTATE_KEY:"rotateKey",SYNC_AB_PROPS:"syncAbProps",SYNC_CONTACTS:"syncContacts",MONITOR_DB_STORAGE:"monitorDbStorage",REPORT_SYNCD_ACTION_STAT:"reportSyncdActionStat",LT_HASH_CHECK:"ltHashCheck",REQUEST_ALL_SYNCD_MISSING_KEYS:"requestAllSyncdMissingKeys",REPORT_SYNCD_KEY_STATS:"reportSyncdKeyStats",SYNCD_SYNC_ALL_COLLECTIONS:"syncdSyncAllCollections",CLEAN_ORPHAN_REACTIONS:"cleanOrphanReactions",CLEAN_ORPHAN_ADD_ONS:"cleanOrphanAddOns",CLEAN_PAST_PARTICIPANTS:"cleanPastParticipants",CLEAN_EXPIRED_UTM:"cleanExpiredUtm",SEND_REGULAR_WAM_EVENTS:"sendCoreWamRegularMetrics",SEND_PRIVATE_WAM_EVENTS:"sendCoreWamPrivateMetrics",SEND_NON_MESSAGE_DATA_REQUEST:"sendNonMessageDataRequest",LOG_HISTORY_SYNC_STATUS_AFTER_PAIRING:"logHistorySyncStatusAfterPairing",DELETE_NEWSLETTER_PREVIEW_CHATS:"deleteNewsletterPreviewChats",REPORT_DB_VERSIONS:"reportDbVersions",UPDATE_EXPIRED_TEXT_STATUS:"updateExpiredTextStatus",RESTART_RECENT_SYNC:"restartRecentSync",CLEANUP_REPORTING_TOKEN_TABLE:"cleanupReportingTokenTable",FETCH_QUICK_PROMOTIONS:"fetchQuickPromotions"}),z=[y.CLEAN_TC_TOKENS,y.LOG_DAILY_STATS,y.ROTATE_KEY,y.SYNC_AB_PROPS,y.SYNC_CONTACTS,y.MONITOR_DB_STORAGE,y.REPORT_SYNCD_ACTION_STAT,y.LT_HASH_CHECK,y.REQUEST_ALL_SYNCD_MISSING_KEYS,y.REPORT_SYNCD_KEY_STATS,y.SYNCD_SYNC_ALL_COLLECTIONS,y.CLEAN_ORPHAN_REACTIONS,y.CLEAN_ORPHAN_ADD_ONS,y.CLEAN_EXPIRED_UTM,y.SEND_REGULAR_WAM_EVENTS,y.SEND_PRIVATE_WAM_EVENTS,y.SEND_NON_MESSAGE_DATA_REQUEST,y.LOG_HISTORY_SYNC_STATUS_AFTER_PAIRING,y.DELETE_NEWSLETTER_PREVIEW_CHATS,y.REPORT_DB_VERSIONS,y.UPDATE_EXPIRED_TEXT_STATUS,y.RESTART_RECENT_SYNC,y.CLEANUP_REPORTING_TOKEN_TABLE],A=[y.FETCH_QUICK_PROMOTIONS],B=[y.LOG_DB_ROW_COUNTS];function C(a){switch(a){case y.MONITOR_DB_STORAGE:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(c("gkx")("26258"))return d("WATaskScheduler").DO_NOT_RESCHEDULE;a=(yield b("cr:4857")==null?void 0:b("cr:4857").shouldMonitorDbStorageUsageJob());return a?d("WATimeUtils").HOUR_SECONDS:d("WATaskScheduler").DO_NOT_RESCHEDULE});return function(b){return a.apply(this,arguments)}}();case y.CLEAN_TC_TOKENS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a)d("WALogger").LOG(x());else try{yield d("WAWebApiChat").pruneExpiredTcTokens(),yield d("WAWebApiChat").pruneExpiredOrphanTcTokens()}catch(a){d("WALogger").ERROR(w(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case y.UPDATE_EXPIRED_TEXT_STATUS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a)d("WALogger").LOG(v());else try{yield d("WAWebApiTextStatus").updateExpiredTextStatusOfContact()}catch(a){d("WALogger").ERROR(u(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case y.LOG_DAILY_STATS:return function(){return d("WAWebLogDailyStatsJob").logDailyStatsJob()["catch"](function(a){d("WALogger").ERROR(t(),a).verbose().devConsole(a)}).then(function(){return d("WATimeUtils").DAY_SECONDS})};case y.LOG_DB_ROW_COUNTS:if(!c("gkx")("26258")){var e=120,f=7200;return function(){self.setTimeout(function(){b("cr:4940")==null?void 0:b("cr:4940").logStorageTableRowCounts()},e*1e3);return(h||(h=b("Promise"))).resolve(f)}}else break;case y.ROTATE_KEY:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a?d("WALogger").LOG(s()):yield d("WAWebPersistedJobManager").getJobManager().waitUntilCompleted(d("WAWebPersistedJobDefinitions").jobSerializers.rotateKey());return 27*d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case y.SYNC_AB_PROPS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a||(yield d("WAWebAbPropsSyncJob").syncABPropsTask());return d("WAWebABPropsLocalStorage").getRefresh()});return function(b){return a.apply(this,arguments)}}();case y.SYNC_CONTACTS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a){try{yield d("WAWebNonAddressBookContactsJob").getNonAddressBookContactsAndMarkAllContactsDirty()}catch(a){d("WALogger").ERROR(r(),a).verbose().devConsole(a)}try{yield d("WAWebContactSyncBridge").contactSync()}catch(a){d("WALogger").ERROR(q(),a).verbose().tags("non-sad","contact-sync").sendLogs("syncContacts: contact sync failed")}}return d("WAWebSyncContactsJob").getContactSyncRefreshSeconds()});return function(b){return a.apply(this,arguments)}}();case y.REPORT_SYNCD_ACTION_STAT:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a||(yield d("WAWebSyncdReportSyncdStatJob").reportSyncdStatsJob());return d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case y.LT_HASH_CHECK:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebABProps").getABPropConfigValue("lthash_check_hours");if(b===0)return 24*d("WATimeUtils").HOUR_SECONDS;a||(yield d("WASyncdAntiTampering").checkLtHash());return b*d("WATimeUtils").HOUR_SECONDS});return function(b){return a.apply(this,arguments)}}();case y.REQUEST_ALL_SYNCD_MISSING_KEYS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a||(yield d("WAWebSyncdRequestAllSyncdMissingKeysJob").requestAllSyncdMissingKeysJob());return d("WATimeUtils").HOUR_SECONDS*6});return function(b){return a.apply(this,arguments)}}();case y.REPORT_SYNCD_KEY_STATS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a||(yield d("WAWebSyncdReportKeyStatsJob").reportSyncdKeyStatsJob());return c("gkx")("26258")?d("WATimeUtils").DAY_SECONDS*3:d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case y.SYNCD_SYNC_ALL_COLLECTIONS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebABProps").getABPropConfigValue("syncd_periodic_sync_days");if(b===0){d("WALogger").LOG(p());return d("WATimeUtils").DAY_SECONDS}a||(yield d("WAWebSyncdSyncAllCollectionsJob").syncdSyncAllCollectionsJob());return d("WATimeUtils").DAY_SECONDS*b});return function(b){return a.apply(this,arguments)}}();case y.CLEAN_ORPHAN_REACTIONS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebDBPruneExpiredOrphanReactions").pruneExpiredOrphanReactions()}catch(a){d("WALogger").ERROR(o(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});case y.CLEAN_ORPHAN_ADD_ONS:var g=30,i=90;return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebDBPurgeExpiredRecords").purgeExpiredOrphanRecords(g,i)}catch(a){d("WALogger").ERROR(n(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});case y.CLEAN_PAST_PARTICIPANTS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebApiParticipantStore").pruneExpiredPastParticipants()}catch(a){d("WALogger").ERROR(m(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});case y.CLEAN_EXPIRED_UTM:return function(){return!d("WAWebBizGatingUtils").isUtmTrackingEnabled()?(h||(h=b("Promise"))).resolve(d("WATaskScheduler").DO_NOT_RESCHEDULE):d("WAWebCleanUtmJob").cleanExpiredUtmJob()["catch"](function(a){d("WALogger").ERROR(l(),a).verbose().devConsole(a)}).then(function(){return d("WATimeUtils").DAY_SECONDS})};case y.SEND_REGULAR_WAM_EVENTS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WATaskScheduler").DO_NOT_RESCHEDULE;if(!d("WAWebUserPrefsTabMutex").currentTabHasMutex()){d("WALogger").WARN(_templateObject14());return d("WATaskScheduler").DO_NOT_RESCHEDULE}yield d("WAWebCoreWamIntegration").uploadRegularCoreWamEvents();return d("WATimeUtils").FIVE_MINUTES});case y.SEND_PRIVATE_WAM_EVENTS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WATaskScheduler").DO_NOT_RESCHEDULE;if(!d("WAWebUserPrefsTabMutex").currentTabHasMutex()){d("WALogger").WARN(_templateObject15());return d("WATaskScheduler").DO_NOT_RESCHEDULE}yield d("WAWebCoreWamIntegration").uploadPrivateCoreWamEvents();return d("WATimeUtils").FIVE_MINUTES});case y.SEND_NON_MESSAGE_DATA_REQUEST:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebNonMessageDataRequestMediaHandlingUtils").retryNonMessageDataRequestJob();return d("WATimeUtils").HOUR_SECONDS*23});case y.DELETE_NEWSLETTER_PREVIEW_CHATS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebNewsletterCleanupTasks").deletePreviewNewsletters();return d("WATimeUtils").HOUR_SECONDS*4});case y.REPORT_DB_VERSIONS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebReportDbVerionsJob").reportDbVersionsJob();return d("WATimeUtils").DAY_SECONDS*3});case y.LOG_HISTORY_SYNC_STATUS_AFTER_PAIRING:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebUserPrefsMultiDevice").getPairingTimestamp();if(a!=null){var b;b=(b=(yield d("WAWebUserPrefsHistorySync").getHistorySyncStatusAfterPairingLoggingCount()))!=null?b:0;if(b>=5){d("WALogger").LOG(k());return d("WATaskScheduler").DO_NOT_RESCHEDULE}yield d("WAWebLogHistorySyncStatusAfterPairingJob").logHistorySyncStatusAfterPairingJob(a,b);return b===0?d("WATimeUtils").MINUTE_SECONDS*5:d("WATimeUtils").MINUTE_SECONDS*10}return 10});case y.RESTART_RECENT_SYNC:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebUserPrefsMultiDevice").getPairingTimestamp();if(a!=null){a=(d("WATimeUtils").unixTime()-a)/60;a>=5&&(yield d("WAWebRestartRecentSyncJob").restartRecentSyncJob());return d("WATimeUtils").MINUTE_SECONDS*5}return 10});case y.CLEANUP_REPORTING_TOKEN_TABLE:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebDBReportingTokenUtils").cleanupReportingTokenTable(d("WAWebMessagingGatingUtils").getReportingTagCleanupDays())}catch(a){d("WALogger").ERROR(j(),a).tags("messaging","wa-ice","report-token").devConsole(a)}return d("WATimeUtils").DAY_SECONDS});case y.FETCH_QUICK_PROMOTIONS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebFetchQuickPromotions").fetchQuickPromotions();return d("WAWebBizGatingUtils").qpGraphQLFetchIntervalMinutes()*d("WATimeUtils").MINUTE_SECONDS})}}function D(){return{scheduledTimeResolver:{get:function(a){return d("WAWebApiTasksScheduledTime").getTaskScheduledTime(String(a))},set:function(a,b){return d("WAWebApiTasksScheduledTime").updateTaskScheduledTime(String(a),b)}}}}function E(a){var b=C(a);b!=null&&(d("WALogger").LOG(i(),a),d("WATaskScheduler").registerTask(a,b))}function f(){d("WATaskScheduler").startScheduler(D()),z.forEach(E),d("WAWebMobilePlatforms").isSMB()&&A.forEach(E),c("gkx")("26258")||B.forEach(E)}g.registerTasks=f}),98);
__d("WAWebWamEnumRetryRejectReason",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,DOUBLE_CHECKMARK:1,IDENTITY_CHANGE:2,MESSAGE_NOT_EXIST:3});f.RETRY_REJECT_REASON=a}),66);
__d("WAWebE2eRetryRejectWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumDeviceType","WAWebWamEnumMessageType","WAWebWamEnumRetryRejectReason"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({E2eRetryReject:[3578,{messageType:[1,d("WAWebWamEnumMessageType").MESSAGE_TYPE],msgRetryCount:[2,d("WAWebWamCodegenUtils").TYPES.INTEGER],retryRejectReason:[3,d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON],retryRevoke:[4,d("WAWebWamCodegenUtils").TYPES.BOOLEAN],senderDeviceType:[5,d("WAWebWamEnumDeviceType").DEVICE_TYPE]},[1,1,1],"regular"]},{E2eRetryReject:[]});g.E2eRetryRejectWamEvent=a}),98);
__d("WAWebMdAppStateDirtyBitsWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdAppStateDirtyBits:[2520,{dirtyBitsFalsePositive:[2,d("WAWebWamCodegenUtils").TYPES.BOOLEAN]},[1,20,1e3],"regular"]},{MdAppStateDirtyBits:[]});g.MdAppStateDirtyBitsWamEvent=a}),98);
__d("WAWebWamEnumMdAppStateKeyRotationReasonCode",[],(function(a,b,c,d,e,f){a=Object.freeze({APP_STATE_SYNC_KEY_EXPIRY:1,DEVICE_DEREGISTERATION:2,NO_KEYS:3});f.MD_APP_STATE_KEY_ROTATION_REASON_CODE=a}),66);
__d("WAWebMdAppStateKeyRotationWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMdAppStateKeyRotationReasonCode"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdAppStateKeyRotation:[2518,{mdAppStateKeyRotationReason:[1,d("WAWebWamEnumMdAppStateKeyRotationReasonCode").MD_APP_STATE_KEY_ROTATION_REASON_CODE]},[1,20,1e3],"regular"]},{MdAppStateKeyRotation:[]});g.MdAppStateKeyRotationWamEvent=a}),98);
__d("WAWebMdAppStateMessageRangeWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdAppStateMessageRange:[2522,{additionalMessagesCount:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,20,1e3],"regular"]},{MdAppStateMessageRange:[]});g.MdAppStateMessageRangeWamEvent=a}),98);
__d("WAWebMdAppStateSyncDailyWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MdAppStateSyncDaily:[2300,{crossIndexConflictCount:[11,a.TYPES.INTEGER],invalidActionCount:[4,a.TYPES.INTEGER],keyRotationRemoveCount:[12,a.TYPES.INTEGER],missingKeyCount:[9,a.TYPES.INTEGER],mutationCount:[1,a.TYPES.INTEGER],storedMutationCount:[7,a.TYPES.INTEGER],unsetActionCount:[8,a.TYPES.INTEGER],unsupportedActionCount:[5,a.TYPES.INTEGER],uploadConflictCount:[10,a.TYPES.INTEGER]},[1,1,1],"regular"]},{MdAppStateSyncDaily:[]});g.MdAppStateSyncDailyWamEvent=b}),98);
__d("WAWebMdBootstrapAppStateDataDownloadedWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMdBootstrapHistoryPayloadType","WAWebWamEnumMdBootstrapPayloadType","WAWebWamEnumMdBootstrapStepResult"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MdBootstrapAppStateDataDownloaded:[2294,{mdBootstrapContactsCount:[5,a.TYPES.INTEGER],mdBootstrapHistoryPayloadType:[11,d("WAWebWamEnumMdBootstrapHistoryPayloadType").MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE],mdBootstrapPayloadSize:[4,a.TYPES.INTEGER],mdBootstrapPayloadType:[2,d("WAWebWamEnumMdBootstrapPayloadType").MD_BOOTSTRAP_PAYLOAD_TYPE],mdBootstrapStepDuration:[6,a.TYPES.INTEGER],mdBootstrapStepResult:[7,d("WAWebWamEnumMdBootstrapStepResult").MD_BOOTSTRAP_STEP_RESULT],mdRegAttemptId:[10,a.TYPES.STRING],mdSessionId:[1,a.TYPES.STRING],mdStorageQuotaBytes:[8,a.TYPES.INTEGER],mdStorageQuotaUsedBytes:[9,a.TYPES.INTEGER],mdTimestamp:[3,a.TYPES.INTEGER]},[1,1,1],"regular"]},{MdBootstrapAppStateDataDownloaded:[]});g.MdBootstrapAppStateDataDownloadedWamEvent=b}),98);
__d("WAWebMdRetryFromUnknownDeviceWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumDeviceType"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdRetryFromUnknownDevice:[2178,{offline:[2,d("WAWebWamCodegenUtils").TYPES.BOOLEAN],senderType:[1,d("WAWebWamEnumDeviceType").DEVICE_TYPE]},[1,1,1],"regular"]},{MdRetryFromUnknownDevice:[]});g.MdRetryFromUnknownDeviceWamEvent=a}),98);
__d("WAWebWamEnumNotificationActionType",[],(function(a,b,c,d,e,f){a=Object.freeze({SHOW:1,REMOVE:2});f.NOTIFICATION_ACTION_TYPE=a}),66);
__d("WAWebWamEnumNotificationDestinationType",[],(function(a,b,c,d,e,f){a=Object.freeze({INDIVIDUAL:1,GROUP:2,OTHER:3,CHANNEL:4,INTEROP:5});f.NOTIFICATION_DESTINATION_TYPE=a}),66);
__d("WAWebWamEnumNotificationSourceType",[],(function(a,b,c,d,e,f){a=Object.freeze({PUSH_TRIGGERED:1,MAIN_APP:2,IN_APP:3});f.NOTIFICATION_SOURCE_TYPE=a}),66);
__d("WAWebWamEnumNotificationTypeEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({TEXT_MESSAGE:1,VOICE_MESSAGE:2,FILE_MESSAGE:3,PHOTO_MESSAGE:4,VIDEO_MESSAGE:5,MISSED_VOICE_CALL:6,MISSED_VIDEO_CALL:7,STICKER_MESSAGE:8,REACTION_MESSAGE:9,GROUP_INVITE_MESSAGE:10,REQUEST_MEDIA_REUPLOAD:11,WEB_CLIENT_LOGIN:12,BACKUP:13,KEEP_IN_CHAT:14,PAYMENT:15,POLL_MESSAGE:16,LOCATION_MESSAGE:17,WEB_PAGE_MESSAGE:18,FAILED_UPLOAD:19,GDPR_REPORT:20,INCOMING_VOICE_CALL:21,INCOMING_VIDEO_CALL:22,VIDEO_CALL_UPGRADE:23,WAFFLE:24,XPLAT_MIGRATION:25,OTHER:26,INVITE_JOINED:27,SCHEDULED_CALL_LOCAL_REMINDER:28,PTV_MESSAGE:29});f.NOTIFICATION_TYPE_ENUM=a}),66);
__d("WAWebNotificationDeliveryWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumNotificationActionType","WAWebWamEnumNotificationDestinationType","WAWebWamEnumNotificationSourceType","WAWebWamEnumNotificationTypeEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({NotificationDelivery:[3748,{clientMessageId:[1,a.TYPES.STRING],notificationAction:[2,d("WAWebWamEnumNotificationActionType").NOTIFICATION_ACTION_TYPE],notificationDeliveryT:[3,a.TYPES.INTEGER],notificationDestination:[4,d("WAWebWamEnumNotificationDestinationType").NOTIFICATION_DESTINATION_TYPE],notificationId:[5,a.TYPES.STRING],notificationSource:[6,d("WAWebWamEnumNotificationSourceType").NOTIFICATION_SOURCE_TYPE],threadId:[7,a.TYPES.STRING],uiNotificationType:[8,d("WAWebWamEnumNotificationTypeEnum").NOTIFICATION_TYPE_ENUM]},[1,1,1],"regular"]},{NotificationDelivery:[]});g.NotificationDeliveryWamEvent=b}),98);
__d("WAWebWaOldCodeWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WaOldCode:[3940,{deviceId:[1,d("WAWebWamCodegenUtils").TYPES.STRING]},[1,1,1],"regular"]},{WaOldCode:[]});g.WaOldCodeWamEvent=a}),98);
__d("WAWebWamProcessWorkerData",["WALogger","WAShiftTimer","WAWebAdvMetadataCreationFailureWamEvent","WAWebAdvStoredTimestampExpiredWamEvent","WAWebChatMessageCountsWamEvent","WAWebClockSkewDifferenceTWamEvent","WAWebCommunityHomeActionWamEvent","WAWebCommunityTabActionWamEvent","WAWebDailyWamEvent","WAWebE2eMessageRecvWamEvent","WAWebE2eMessageSendWamEvent","WAWebE2eRetryRejectWamEvent","WAWebFmxActionWamEvent","WAWebForwardSendWamEvent","WAWebGatedMessageReceivedWamEvent","WAWebGraphqlCatalogRequestWamEvent","WAWebGroupJoinCWamEvent","WAWebIncomingMessageDropWamEvent","WAWebKeepInChatNotifWamEvent","WAWebMdAppStateDirtyBitsWamEvent","WAWebMdAppStateKeyRotationWamEvent","WAWebMdAppStateMessageRangeWamEvent","WAWebMdAppStateSyncDailyWamEvent","WAWebMdAppStateSyncMutationStatsWamEvent","WAWebMdBadDeviceSentMessageWamEvent","WAWebMdBootstrapAppStateCriticalDataProcessingWamEvent","WAWebMdBootstrapAppStateDataDownloadedWamEvent","WAWebMdBootstrapDataAppliedWamEvent","WAWebMdBootstrapHistoryDataDownloadedWamEvent","WAWebMdBootstrapHistoryDataStartDownloadingWamEvent","WAWebMdBootstrapHistorySyncStatusAfterPairingWamEvent","WAWebMdCriticalEventWamEvent","WAWebMdDeviceSyncAckWamEvent","WAWebMdFatalErrorWamEvent","WAWebMdGroupParticipantMissAckWamEvent","WAWebMdRetryFromUnknownDeviceWamEvent","WAWebMdSyncdDogfoodingFeatureUsageWamEvent","WAWebMessageReceiveWamEvent","WAWebMessageSecretErrorsWamEvent","WAWebMessageSendWamEvent","WAWebMexEventV2WamEvent","WAWebMexEventWamEvent","WAWebNonMessagePeerDataMediaUploadWamEvent","WAWebNonMessagePeerDataOperationResponseWamEvent","WAWebNonMessagePeerDataRequestWamEvent","WAWebNotificationDeliveryWamEvent","WAWebNotificationEngagementWamEvent","WAWebOfflineCountTooHighWamEvent","WAWebOfflineResumeWamEvent","WAWebPlaceholderActivityWamEvent","WAWebPsBufferUploadWamEvent","WAWebReceiptStanzaReceiveWamEvent","WAWebSignCredentialWamEvent","WAWebSyncdKeyCountWamEvent","WAWebWaOldCodeWamEvent","WAWebWamStorage","WAWebWebDbLoadFromVersionFailureNonAnonymousWamEvent","WAWebWebDbTableUsageWamEvent","WAWebWebDbVersionNonAnonymousWamEvent","WAWebWebcDbOpenWamEvent","WAWebWebcJobInfoWamEvent","WAWebWebcLinkPreviewResponseHandleWamEvent","WAWebWebcOfflineNotificationProcessWamEvent","WAWebWebcPageResumeWamEvent","WAWebWebcPhoneDisconnectedWamEvent","WAWebWebcRawPlatformsWamEvent","WAWebWebcStreamModeChangeWamEvent","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to process worker wam data: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processWorkerWamData ",""]);i=function(){return a};return a}var j=2e4,k=1e4;function l(a){d("WALogger").LOG(i(),a?"start":"run");m();var b=new(d("WAShiftTimer").ShiftTimer)(function(){c("WAWebWamStorage").processWorkerWamData().then(function(a){a&&l(!1)})["catch"](function(a){d("WALogger").ERROR(h(),a).verbose().devConsole(a)})});b.onOrAfter(a?j:k)}function m(){if(c("gkx")("26257"))return;void b("WAWebOfflineResumeWamEvent").OfflineResumeWamEvent;void b("WAWebOfflineResumeWamEvent").OfflineResumeWamEvent;void b("WAWebMessageSecretErrorsWamEvent").MessageSecretErrorsWamEvent;void b("WAWebMessageSendWamEvent").MessageSendWamEvent;void b("WAWebForwardSendWamEvent").ForwardSendWamEvent;void b("WAWebMexEventV2WamEvent").MexEventV2WamEvent;void b("WAWebWaOldCodeWamEvent").WaOldCodeWamEvent;void b("WAWebChatMessageCountsWamEvent").ChatMessageCountsWamEvent;void b("WAWebNotificationDeliveryWamEvent").NotificationDeliveryWamEvent;void b("WAWebGroupJoinCWamEvent").GroupJoinCWamEvent;void b("WAWebMdAppStateDirtyBitsWamEvent").MdAppStateDirtyBitsWamEvent;void b("WAWebMdBadDeviceSentMessageWamEvent").MdBadDeviceSentMessageWamEvent;void b("WAWebPlaceholderActivityWamEvent").PlaceholderActivityWamEvent;void b("WAWebGatedMessageReceivedWamEvent").GatedMessageReceivedWamEvent;void b("WAWebMessageReceiveWamEvent").MessageReceiveWamEvent;void b("WAWebOfflineCountTooHighWamEvent").OfflineCountTooHighWamEvent;void b("WAWebReceiptStanzaReceiveWamEvent").ReceiptStanzaReceiveWamEvent;void b("WAWebMdRetryFromUnknownDeviceWamEvent").MdRetryFromUnknownDeviceWamEvent;void b("WAWebE2eRetryRejectWamEvent").E2eRetryRejectWamEvent;void b("WAWebMdBootstrapHistoryDataDownloadedWamEvent").MdBootstrapHistoryDataDownloadedWamEvent;void b("WAWebMdBootstrapHistoryDataStartDownloadingWamEvent").MdBootstrapHistoryDataStartDownloadingWamEvent;void b("WAWebClockSkewDifferenceTWamEvent").ClockSkewDifferenceTWamEvent;void b("WAWebGraphqlCatalogRequestWamEvent").GraphqlCatalogRequestWamEvent;void b("WAWebSignCredentialWamEvent").SignCredentialWamEvent;void b("WAWebMdBootstrapHistorySyncStatusAfterPairingWamEvent").MdBootstrapHistorySyncStatusAfterPairingWamEvent;void b("WAWebWebcJobInfoWamEvent").WebcJobInfoWamEvent;void b("WAWebFmxActionWamEvent").FmxActionWamEvent;void b("WAWebE2eMessageSendWamEvent").E2eMessageSendWamEvent;void b("WAWebMdDeviceSyncAckWamEvent").MdDeviceSyncAckWamEvent;void b("WAWebMdGroupParticipantMissAckWamEvent").MdGroupParticipantMissAckWamEvent;void b("WAWebMexEventWamEvent").MexEventWamEvent;void b("WAWebAdvStoredTimestampExpiredWamEvent").AdvStoredTimestampExpiredWamEvent;void b("WAWebSyncdKeyCountWamEvent").SyncdKeyCountWamEvent;void b("WAWebMdAppStateSyncMutationStatsWamEvent").MdAppStateSyncMutationStatsWamEvent;void b("WAWebNonMessagePeerDataMediaUploadWamEvent").NonMessagePeerDataMediaUploadWamEvent;void b("WAWebNonMessagePeerDataOperationResponseWamEvent").NonMessagePeerDataOperationResponseWamEvent;void b("WAWebNonMessagePeerDataRequestWamEvent").NonMessagePeerDataRequestWamEvent;void b("WAWebWebcLinkPreviewResponseHandleWamEvent").WebcLinkPreviewResponseHandleWamEvent;void b("WAWebE2eMessageRecvWamEvent").E2eMessageRecvWamEvent;void b("WAWebIncomingMessageDropWamEvent").IncomingMessageDropWamEvent;void b("WAWebAdvMetadataCreationFailureWamEvent").AdvMetadataCreationFailureWamEvent;void b("WAWebWebcRawPlatformsWamEvent").WebcRawPlatformsWamEvent;void b("WAWebWebcPageResumeWamEvent").WebcPageResumeWamEvent;void b("WAWebWebcPhoneDisconnectedWamEvent").WebcPhoneDisconnectedWamEvent;void b("WAWebWebcStreamModeChangeWamEvent").WebcStreamModeChangeWamEvent;void b("WAWebPsBufferUploadWamEvent").PsBufferUploadWamEvent;void b("WAWebWebDbTableUsageWamEvent").WebDbTableUsageWamEvent;void b("WAWebWebDbVersionNonAnonymousWamEvent").WebDbVersionNonAnonymousWamEvent;void b("WAWebWebDbLoadFromVersionFailureNonAnonymousWamEvent").WebDbLoadFromVersionFailureNonAnonymousWamEvent;void b("WAWebWebcDbOpenWamEvent").WebcDbOpenWamEvent;void b("WAWebMdBootstrapAppStateCriticalDataProcessingWamEvent").MdBootstrapAppStateCriticalDataProcessingWamEvent;void b("WAWebMdCriticalEventWamEvent").MdCriticalEventWamEvent;void b("WAWebMdSyncdDogfoodingFeatureUsageWamEvent").MdSyncdDogfoodingFeatureUsageWamEvent;void b("WAWebMdAppStateMessageRangeWamEvent").MdAppStateMessageRangeWamEvent;void b("WAWebMdBootstrapDataAppliedWamEvent").MdBootstrapDataAppliedWamEvent;void b("WAWebMdBootstrapAppStateDataDownloadedWamEvent").MdBootstrapAppStateDataDownloadedWamEvent;void b("WAWebMdFatalErrorWamEvent").MdFatalErrorWamEvent;void b("WAWebMdAppStateKeyRotationWamEvent").MdAppStateKeyRotationWamEvent;void b("WAWebMdAppStateSyncDailyWamEvent").MdAppStateSyncDailyWamEvent;void b("WAWebCommunityHomeActionWamEvent").CommunityHomeActionWamEvent;void b("WAWebCommunityTabActionWamEvent").CommunityTabActionWamEvent;void b("WAWebDailyWamEvent").DailyWamEvent;void b("WAWebKeepInChatNotifWamEvent").KeepInChatNotifWamEvent;void b("WAWebNotificationEngagementWamEvent").NotificationEngagementWamEvent;void b("WAWebWebcOfflineNotificationProcessWamEvent").WebcOfflineNotificationProcessWamEvent}g.processWorkerWamData=l}),98);
__d("WAWebStartBackend",["Promise","WABase64","WABinary","WAComms","WAGzip","WALogger","WAPromiseTimeout","WAWebABPropsWamGlobals","WAWebAdvDeviceInfoCheckJob","WAWebApiContact","WAWebBackendApi","WAWebBackgroundSyncAction","WAWebBizAgentAction","WAWebBizChatAssignmentAction","WAWebBizGatingUtils","WAWebBizUpdateContactsWithVerifiedNamesAction","WAWebBootstrapPremiumMessages","WAWebBuildConstants","WAWebCTWASuggestionInitFromStorage","WAWebChatThreadLogging","WAWebCmd","WAWebCommonCTWADataSharing","WAWebCommsConfig","WAWebCommsHandleStanza","WAWebCrashlog","WAWebCryptoCurve25519","WAWebDbEncryptionKey","WAWebDeleteStatusAction","WAWebEventsWaitForMain","WAWebFeatureDetectionSwSupport","WAWebFetchAdEntryPointsConfiguration","WAWebFtsClient","WAWebHandleOfflineAbProps","WAWebHistorySyncNotificationUtils","WAWebHistorySyncProgress","WAWebInboxFiltersGatingUtils","WAWebInitFavoritesFromStorage","WAWebInitFromStorage","WAWebInitWaitForEvents","WAWebInitializeBots","WAWebJestE2ELogUtils","WAWebJobLoadQuickPromotions","WAWebL10NCountryCodes","WAWebLazyLoadedMainRequires","WAWebLogoutReason","WAWebLogoutReasonConstants","WAWebMediaHosts","WAWebMergeContactRecordsById","WAWebModelStorage","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataInitFromStorage","WAWebOffdStorage","WAWebOfflineHandler","WAWebOfflineResumeMainThread","WAWebPageLoadLogging","WAWebPassiveModeManager","WAWebPersistedJobManager","WAWebPonyfillsFetch","WAWebPremiumAccessEngine","WAWebPrimaryFeatures","WAWebPushNotificationsGatingUtils","WAWebQplInitMd","WAWebRegisterPassiveTasks","WAWebSWBus","WAWebSWBusActions","WAWebServerPropsModel","WAWebSignalStoreApi","WAWebSocketModel","WAWebSubscribePushManagerAction","WAWebSubscriptions","WAWebSyncBootstrap","WAWebSyncContactsJob","WAWebSyncd","WAWebTasksDefinitions","WAWebTimeSpentLoggingSession","WAWebTos","WAWebURLUtils","WAWebUpdateServerPropsJob","WAWebUserPrefsCookie","WAWebUserPrefsGeneral","WAWebUserPrefsIndexedDBStorage","WAWebUserPrefsKeys","WAWebUserPrefsLocales","WAWebUserPrefsMeUser","WAWebUserPrefsMultiDevice","WAWebWamGlobals","WAWebWamOfflineResumeReporter","WAWebWamProcessWorkerData","asyncToGeneratorRuntime","cr:3979","cr:4066","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[push-notification] Failed to close existing notifications, error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[push-notification] Failed to request stopComms for service worker, error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Chatd login cookie request errored with error msg ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Requesting chatd login cookie complete"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["init worker: error while calling startIndexer from initialSetup: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["init worker: startIndexer from initialSetup"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync][continueProgressiveHistorySyncProcessingV2] start backend"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Requesting chatd login cookie"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bootstrap] need to sync critical data: false"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[startBackend]: connected as ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["startBackendRegistered: chatd user not registered"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["storage initialization error, logging out"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[StartBackend] initial setup failed:"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[StartBackend]: complete initial setup"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[StartBackend]: start initial setup"]);w=function(){return a};return a}d("WAWebCmd").Cmd.once("offline_delivery_end",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{d("WALogger").LOG(w()),yield G(),d("WALogger").LOG(v())}catch(a){d("WALogger").LOG(u()).devConsole(a)}}));d("WAWebCmd").Cmd.on("storage_initialization_error",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("WAWebUserPrefsMultiDevice").isRegistered()&&d("WAWebLogoutReason").getPrevLogoutReasonCode()===d("WAWebLogoutReasonConstants").LOGOUT_REASON_CODE.CLIENT_FATAL)return;d("WALogger").LOG(t());yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData(d("WAWebLogoutReasonConstants").LogoutReason.ClientFatalError);d("WAWebJestE2ELogUtils").maybeLogToJestE2eJSConsole("logging out due to storage initialization error");d("WAWebCmd").Cmd.logout()}));d("WAWebCmd").Cmd.on("open_socket_stream",function(){!d("WAWebCmd").Cmd.isOfflineDeliveryEnd?d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logSocketConnectT():d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&(d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.resetEvent(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logSocketConnectT())});var x=function(){void c("WAWebCommonCTWADataSharing").fetchDataSharingSettingAndUpdateModel()};function a(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WAWebPageLoadLogging").startPageLoadQplMeasure("startBackend");var a=(yield z());d("WAWebPageLoadLogging").endPageLoadQplMeasure("startBackend");return a});return y.apply(this,arguments)}function z(){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo();if(!a){d("WALogger").LOG(s());return}d("WALogger").LOG(r(),d("WAWebUserPrefsMeUser").assertGetMe());try{yield d("WAPromiseTimeout").promiseTimeout(d("WAWebModelStorage").initialize(),20*1e3),yield d("WAPromiseTimeout").promiseTimeout(d("WAWebOffdStorage").initialize(),20*1e3),d("WAWebCrashlog").registerCrashlogUploadIsUserInExternalBetaFunction(d("WAWebUserPrefsGeneral").getWhatsAppWebExternalBetaJoinedIdb)}catch(a){d("WAWebCmd").Cmd.storageInitializationError()}d("WAWebInitWaitForEvents").initOfflineResumeWaitForEvents();void d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.setLastPushCompleteTimestamp();yield K();yield d("WAWebPrimaryFeatures").loadPrimaryFeatures();d("WAWebMediaHosts").mediaHosts.maybeLoadMediaConnFromStorage();yield M();D();d("WAWebABPropsWamGlobals").setAbPropDependingGlobalWamAttributes();yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").KEYS.LANG,c("WAWebUserPrefsLocales").getLangPref()||"en");d("WAWebTimeSpentLoggingSession").restoreTimeSpentSession();yield d("WAWebChatThreadLogging").initChatThreadLogging();yield d("WAWebPersistedJobManager").startWebPersistedJobManager();d("WAWebOfflineResumeMainThread").setupMainThreadResume(d("WAWebOfflineHandler").OfflineMessageHandler);yield d("WAComms").startHandlingRequests();yield d("WAWebDbEncryptionKey").DbEncKeyStore.waitForFinalDbMsgEncKey();c("gkx")("26260")&&(Boolean(b("cr:3979")==null?void 0:b("cr:3979").getDebugEnableOfflineMock())&&(yield b("cr:4066")==null?void 0:b("cr:4066")()));yield d("WAWebPassiveModeManager").PassiveTaskManager.waitForPassiveTaskEnd();yield d("WAWebSyncd").initialize();a=!(yield c("WAWebSyncBootstrap").isCriticalDataSynced());a?yield c("WAWebSyncBootstrap").syncCriticalData():d("WALogger").LOG(q());d("WAWebBackendApi").frontendFireAndForget("handleDeferredMessages",{});d("WAWebServerPropsModel").ServerProps.serverPropsVersion==null&&(yield d("WAWebUpdateServerPropsJob").queryServerProps());yield E();void d("WAWebTos").TosManager.run();d("WAWebQplInitMd").startQPL();yield d("WAWebPremiumAccessEngine").initialize(d("WAWebBizGatingUtils").getBillingPremiumAccessConfig());void d("WAWebSubscriptions").runSubscriptionsManager();void d("WAWebSubscribePushManagerAction").updatePushManager();void d("WAWebBackgroundSyncAction").updatePeriodicBackgroundSyncRegistration();void d("WAWebMergeContactRecordsById").mergeContactRecordsById();x();void d("WAWebInitializeBots").initializeBots();d("WAWebUserPrefsCookie").deleteAppBuildCookie()});return A.apply(this,arguments)}function B(a){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a={passive:!1,pull:!0});d("WAWebPageLoadLogging").startPageLoadQplMeasure("startWebComms");a=d("WAWebCommsConfig").getCommsConfig(a);!c("gkx")("26256")&&c("gkx")("26257")&&!c("gkx")("26258")&&!d("WAWebBuildConstants").LOCALHOST_ENV_CONFIG&&(d("WALogger").DEV(p()).tags("StartBackend"),yield I());yield c("WAWebEventsWaitForMain")();d("WAComms").startComms(c("WAWebCommsHandleStanza"),a,function(a){return(h||(h=b("Promise"))).resolve(d("WAGzip").inflate(a))});yield d("WAComms").waitForConnection();d("WAWebPageLoadLogging").endPageLoadQplMeasure("startWebComms")});return C.apply(this,arguments)}function D(){var a;a=(a=d("WAWebUserPrefsMeUser").getMaybeMeUser())==null?void 0:a.user;a!=null&&d("WAWebWamGlobals").Global.set({psCountryCode:d("WAWebL10NCountryCodes").getCountryShortcodeByPhone(a)})}function E(){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;void d("WAWebBizUpdateContactsWithVerifiedNamesAction").applyContactBusinessProps();void (a=d("WAWebInitFromStorage")).restoreLabels();void a.restoreQuickReplies();void a.restoreLabelAssociations();void a.restoreCarts();void d("WAWebBootstrapPremiumMessages").restorePremiumMessages();d("WAWebBootstrapPremiumMessages").bindPremiumMessageListeners();yield a.restoreArchiveV2Settings();yield a.restoreAgents().then(d("WAWebBizAgentAction").initializeAgentLog);d("WAWebBizChatAssignmentAction").checkOrphanAssignments();void a.restoreChatAssignments();void d("WAWebCTWASuggestionInitFromStorage").restoreCTWASuggestions(d("WAWebBackendApi").frontendFireAndForget);void d("WAWebJobLoadQuickPromotions").loadQuickPromotions();void d("WAWebFetchAdEntryPointsConfiguration").fetchAdEntryPointsConfiguration()});return F.apply(this,arguments)}function G(){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){void d("WAWebApiContact").flushLidPnMappingsToDb(),d("WALogger").LOG(o()),void c("WAWebSyncBootstrap").continueProgressiveHistorySyncProcessingV2(d("WAWebHistorySyncNotificationUtils").HistorySyncScheduleSource.BackendStart),d("WALogger").LOG(n()),d("WAWebFtsClient").ftsClient.startIndexer()["catch"](function(a){d("WALogger").WARN(m(),a)}),void d("WAWebLazyLoadedMainRequires").requireStatusV3Collection().then(function(a){void a.sync().then(function(){void d("WAWebDeleteStatusAction").clearStatusForRemovedContact()})}),d("WAWebTasksDefinitions").registerTasks(),d("WAWebPushNotificationsGatingUtils").canSupportOfflineNotifications()&&d("WAWebWamProcessWorkerData").processWorkerWamData(!0),yield d("WAWebSyncContactsJob").runSyncDirtyContactsJob(),void d("WAWebInitFromStorage").restoreRecentStickers(),void d("WAWebInitFromStorage").restoreFavoriteStickers(),void d("WAWebAdvDeviceInfoCheckJob").scheduleAdvDeviceInfoCheck(),void d("WAWebInitFromStorage").restoreCommunityActivity(),void d("WAWebHistorySyncProgress").updateHistorySyncProgressModel(),void d("WAWebInitFromStorage").restoreMediaUploadResult(),void d("WAWebInitFromStorage").restoreUnjoinedSubgroups(),d("WAWebNewsletterGatingUtils").isNewsletterEnabled()&&void d("WAWebNewsletterMetadataInitFromStorage").restoreNewsletterMetadata(),d("WAWebInboxFiltersGatingUtils").inboxFavoritesEnabled()&&void d("WAWebInitFavoritesFromStorage").restoreFavorites()});return H.apply(this,arguments)}function I(){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo()),b=(yield d("WAWebUserPrefsMultiDevice").getMdLoginCookieRequestComplete()),e=d("WAWebUserPrefsMeUser").assertGetMe().toString();if(b||e==null||a==null)return;b=new Uint8Array([6,4]);var f=(yield self.crypto.subtle.digest({name:"SHA-256"},a.identityKeyPair.pubKey));e=new TextEncoder().encode(e);e=new(d("WABinary").Binary)(e).readBuffer();f=d("WABinary").Binary.build(f,e).readBuffer();e=d("WABinary").Binary.build(b,f).readBuffer();b=(yield d("WAWebCryptoCurve25519").calculateSignature(a.identityKeyPair,e));a=d("WABinary").Binary.build(b,f).readByteArray().buffer;e=d("WABase64").encodeB64UrlSafe(a);b={attestation:e};f=(yield d("WAWebUserPrefsMultiDevice").getRoutingInfo());a=f?f.edgeRouting:null;e=a?d("WABase64").encodeB64UrlSafe(a):null;e!=null&&(b.ED=e);f=c("gkx")("26258")?"https://web.whatsapp.com/ws/chat":"https://dev-web.whatsapp.com/ws/chat";a=c("WAWebURLUtils").build(f,b);try{e=(yield c("WAWebPonyfillsFetch")(a,{method:"post"}));e.ok&&(d("WALogger").DEV(l()).tags("StartBackend"),yield d("WAWebUserPrefsMultiDevice").setMdLoginCookieRequestComplete())}catch(a){d("WALogger").ERROR(k(),a.message).tags("WAWebStartBackend")}});return J.apply(this,arguments)}function K(){return L.apply(this,arguments)}function L(){L=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebPushNotificationsGatingUtils").canSupportOfflineNotifications()){var a=b("WAWebFeatureDetectionSwSupport");if(a.supported){var c;a=b("WAWebSWBus");var e=b("WAWebSWBusActions");((c=window.navigator.serviceWorker)==null?void 0:c.controller)&&(yield a.request(window.navigator.serviceWorker.controller,e.STOP_COMMS)["catch"](function(a){d("WALogger").WARN(j(),a)}));(c=window.navigator.serviceWorker)==null?void 0:(a=c.ready)==null?void 0:a.then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(a=(yield a==null?void 0:a.getNotifications==null?void 0:a.getNotifications()))!=null?a:[];a.forEach(function(a){return a.close()})});return function(b){return a.apply(this,arguments)}}())["catch"](function(a){d("WALogger").WARN(i(),a)})}}});return L.apply(this,arguments)}function M(){return N.apply(this,arguments)}function N(){N=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a={pull:!0};yield d("WAWebRegisterPassiveTasks").registerPassiveTaskForStartUp();yield B(a)});return N.apply(this,arguments)}g.startBackend=a;g.startWebComms=B}),98);
__d("WABackendHandleError",["Promise","WADeprecatedWapParser","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown error code: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid stanza sent (smax-invalid)"]);j=function(){return a};return a}var k={SMAX_INVALID:479},l=new(c("WADeprecatedWapParser"))("errorParser",function(a){a.assertTag("error");a=a.attrInt("code");switch(a){case k.SMAX_INVALID:return m();default:return n(a)}});function a(a){l.parse(a);return(h||(h=b("Promise"))).resolve("NO_ACK")}function m(){d("WALogger").ERROR(j()).devConsole("check tracelogs for more info").sendLogs("smax-invalid")}function n(a){d("WALogger").ERROR(i(),a).sendLogs("unknown-error-code")}g.backendErrorParser=l;g.handleError=a}),98);
__d("WASmaxInMdServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInMdPrimaryHelloNotifyCompanionRequest",["WAResultOrError","WASmaxInMdServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"link_code_companion_reg");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"link_code_pairing_wrapped_primary_ephemeral_pub");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"primary_identity_pub");if(!e.success)return e;var f=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"link_code_pairing_ref");if(!f.success)return f;var g=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","link_code_companion_reg");if(!g.success)return g;var h=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!h.success)return h;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,b.value,"stage","primary_hello");if(!b.success)return b;c=d("WASmaxParseUtils").contentBytes(c.value);if(!c.success)return c;e=d("WASmaxParseUtils").contentBytes(e.value);if(!e.success)return e;f=d("WASmaxParseUtils").contentBytes(f.value);if(!f.success)return f;a=d("WASmaxInMdServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({type:g.value,from:h.value,linkCodeCompanionRegStage:b.value,linkCodeCompanionRegLinkCodePairingWrappedPrimaryEphemeralPubElementValue:c.value,linkCodeCompanionRegPrimaryIdentityPubElementValue:e.value,linkCodeCompanionRegLinkCodePairingRefElementValue:f.value},a.value))}g.parsePrimaryHelloNotifyCompanionRequest=a}),98);
__d("WASmaxOutMdNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrDomainJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").DOMAIN_JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutMdPrimaryHelloNotifyCompanionResponseAck",["WASmaxJsx","WASmaxOutMdNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutMdNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makePrimaryHelloNotifyCompanionResponseAck=a}),98);
__d("WASmaxMdPrimaryHelloNotifyCompanionRPC",["WASmaxInMdPrimaryHelloNotifyCompanionRequest","WASmaxOutMdPrimaryHelloNotifyCompanionResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdPrimaryHelloNotifyCompanionRequest").parsePrimaryHelloNotifyCompanionRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("PrimaryHelloNotifyCompanion",{Request:b}));return{parsedRequest:b.value,makePrimaryHelloNotifyCompanionResponseAck:function(){return d("WASmaxOutMdPrimaryHelloNotifyCompanionResponseAck").makePrimaryHelloNotifyCompanionResponseAck(a)}}}g.receivePrimaryHelloNotifyCompanionRPC=a}),98);
__d("WASmaxInMdRefreshCodeNotifyCompanionRequest",["WAResultOrError","WASmaxInMdEnums","WASmaxInMdServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"link_code_companion_reg");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"link_code_pairing_ref");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","link_code_companion_reg");if(!e.success)return e;var f=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!f.success)return f;var g=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,b.value,"stage","refresh_code");if(!g.success)return g;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,b.value,"force_manual_refresh",d("WASmaxInMdEnums").ENUM_FALSE_TRUE);if(!b.success)return b;c=d("WASmaxParseUtils").contentBytes(c.value);if(!c.success)return c;a=d("WASmaxInMdServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({type:e.value,from:f.value,linkCodeCompanionRegStage:g.value,linkCodeCompanionRegForceManualRefresh:b.value,linkCodeCompanionRegLinkCodePairingRefElementValue:c.value},a.value))}g.parseRefreshCodeNotifyCompanionRequest=a}),98);
__d("WASmaxOutMdRefreshCodeNotifyCompanionResponseAck",["WASmaxJsx","WASmaxOutMdNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutMdNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeRefreshCodeNotifyCompanionResponseAck=a}),98);
__d("WASmaxMdRefreshCodeNotifyCompanionRPC",["WASmaxInMdRefreshCodeNotifyCompanionRequest","WASmaxOutMdRefreshCodeNotifyCompanionResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdRefreshCodeNotifyCompanionRequest").parseRefreshCodeNotifyCompanionRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RefreshCodeNotifyCompanion",{Request:b}));return{parsedRequest:b.value,makeRefreshCodeNotifyCompanionResponseAck:function(){return d("WASmaxOutMdRefreshCodeNotifyCompanionResponseAck").makeRefreshCodeNotifyCompanionResponseAck(a)}}}g.receiveRefreshCodeNotifyCompanionRPC=a}),98);
__d("WAWebAltDeviceLinkingBase32Encode",[],(function(a,b,c,d,e,f){var g="123456789ABCDEFGHJKLMNPQRSTVWXYZ";function a(a){a=new DataView(a.buffer,a.byteOffset,a.byteLength);var b=0,c=0,d="";for(var e=0;e<a.byteLength;e++){c=c<<8|a.getUint8(e);b+=8;while(b>=5)d+=g[c>>>b-5&31],b-=5}b>0&&(d+=g[c<<5-b&31]);return d}f.bytesToCrockford=a}),66);
__d("WAWebAltDeviceLinkingAlgorithm",["WAArrayBufferUtils","WABinary","WAByteArray","WACryptoHkdf","WALogger","WAWebAltDeviceLinkingApi","WAWebAltDeviceLinkingBase32Encode","WAWebCryptoCurve25519","WAWebSignalStoreApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: encrypt key bundle"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: decrypt primary hello"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: encrypt companion hello"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: create adv secret material"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: generate random code"]);l=function(){return a};return a}function m(){d("WALogger").LOG(l());var a=new Uint8Array(5);self.crypto.getRandomValues(a);return d("WAWebAltDeviceLinkingBase32Encode").bytesToCrockford(a)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{return yield a()}catch(c){(a=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:a.addPoint(b);throw c}});return o.apply(this,arguments)}function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c===void 0&&(c=!1);b=new(d("WABinary").Binary)(b);b=(yield self.crypto.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:b.readBuffer(),iterations:2<<16},a,{name:"AES-CTR",length:256},c,["encrypt","decrypt"]));return b});return q.apply(this,arguments)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("WALogger").LOG(j());b={name:"AES-CTR",length:64,counter:b};b=(yield self.crypto.subtle.encrypt(b,c,a));return b});return s.apply(this,arguments)}function t(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("WALogger").LOG(i());var e={name:"AES-CTR",length:64,counter:b};b=(yield n(function(){return self.crypto.subtle.decrypt(e,c,a)},"fail decrypt primary ephemeral pub"));return b});return u.apply(this,arguments)}function a(){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=m(),b=d("WAWebCryptoCurve25519").keyPair(),c=new Uint8Array(32);self.crypto.getRandomValues(c);var e=new Uint8Array(16);self.crypto.getRandomValues(e);b=(yield w(a,b,c,e));return babelHelpers["extends"]({},b,{linkCodePairingSecret:a})});return v.apply(this,arguments)}function w(a,b,c,d){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){a=(yield self.crypto.subtle.importKey("raw",new TextEncoder().encode(a),{name:"PBKDF2"},!1,["deriveKey"]));var f=(yield p(a,c)),g=(yield n(function(){return r(b.pubKey,e,f)},"fail encrypt companion hello")),h=new(d("WABinary").Binary)();h.writeByteArray(c);h.writeByteArray(e);h.writeByteArray(new Uint8Array(g));c=h.readBuffer();return{linkCodePairingWrappedCompanionEphemeralPub:c,linkCodeKey:a,linkCodePairingCompanionADVEphemeralKeyPair:b}});return x.apply(this,arguments)}function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("WACryptoHkdf").extractWithSaltAndExpand(a,b,"link_code_pairing_key_bundle_encryption_key",32));return a});return z.apply(this,arguments)}function A(a,b,c){return d("WAArrayBufferUtils").concatBuffers([a,b,d("WAByteArray").uint8ArrayToBuffer(c)])}function B(a,b,c){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("WALogger").LOG(h());var e=(yield self.crypto.subtle.importKey("raw",a,{name:"AES-GCM"},!1,["encrypt"])),f={name:"AES-GCM",iv:b};a=(yield n(function(){return self.crypto.subtle.encrypt(f,e,c)},"fail encrypt wrapped key bundle"));return a});return C.apply(this,arguments)}function e(a,b,c){d("WALogger").LOG(k());a=d("WAArrayBufferUtils").concatBuffers([a,b,d("WAByteArray").uint8ArrayToBuffer(c)]);return a}function f(a){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WACryptoHkdf").extractWithSaltAndExpand(a,null,"adv_secret",32));return a});return D.apply(this,arguments)}function E(a,b,c,d){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo());if(g==null)throw c("err")("alt pairing: Did not find registration info");var h=new Uint8Array(32);self.crypto.getRandomValues(h);var i=new Uint8Array(32);self.crypto.getRandomValues(i);var j=new Uint8Array(12);self.crypto.getRandomValues(j);return G(a,b,e,f,g.identityKeyPair.pubKey,g.identityKeyPair.privKey,h,i,j)});return F.apply(this,arguments)}function G(a,b,c,d,e,f,g,h,i){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,i,j,k){a=new(d("WABinary").Binary)(a);var l=a.readByteArray(32),m=a.readByteArray(16),o=a.readByteArray(),q=(yield p(e,l)),r=(yield n(function(){return t(o,m,q)},"fail decrypt primary ephemeral pub"));if(r.byteLength===0)throw c("err")("alt pairing: linkCodePairingDecryptedPrimaryEphemeralPub is an empty buffer");a=(yield n(function(){return d("WAWebCryptoCurve25519").sharedSecret(r,f.privKey)},"fail generate ephemeral shared secret"));e=(yield y(a,j));l=A(g,b,i);e=(yield B(e,k,l));l=new(d("WABinary").Binary)();l.writeByteArray(j);l.writeByteArray(k);l.writeBuffer(e);j=(yield n(function(){return d("WAWebCryptoCurve25519").sharedSecret(b,h)},"fail generate identity shared secret"));k=d("WAArrayBufferUtils").concatBuffers([a,j,d("WAByteArray").uint8ArrayToBuffer(i)]);e=(yield d("WACryptoHkdf").extractWithSaltAndExpand(k,null,"adv_secret",32));a=l.readBuffer();return{companionIdentityPublic:g,linkCodePairingWrappedKeyBundle:a,advSecret:e}});return H.apply(this,arguments)}g.generateRandomCode=m;g.deriveKey=p;g.encryptCompanionHello=r;g.decryptPrimaryHello=t;g.companionHello=a;g.companionHelloInternal=w;g.getBundleEncryptionKey=y;g.getKeyBundle=A;g.encryptKeyBundle=B;g.createAdvSecretMaterial=e;g.createAdvSecret=f;g.companionFinish=E;g.companionFinishInternal=G}),98);
__d("WASmaxInMdIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInMdIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInMdIQErrorInternalServerErrorOrBadRequestMixinGroup",["WAResultOrError","WASmaxInMdIQErrorBadRequestMixin","WASmaxInMdIQErrorInternalServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInMdIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorBadRequest"],[b,c])}g.parseIQErrorInternalServerErrorOrBadRequestMixinGroup=a}),98);
__d("WASmaxInMdIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInMdCompanionFinishResponseError",["WAResultOrError","WASmaxInMdIQErrorInternalServerErrorOrBadRequestMixinGroup","WASmaxInMdIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInMdIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInMdIQErrorInternalServerErrorOrBadRequestMixinGroup").parseIQErrorInternalServerErrorOrBadRequestMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorInternalServerErrorOrBadRequestMixinGroup:b.value}))}g.parseCompanionFinishResponseError=a}),98);
__d("WASmaxInMdIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInMdCompanionFinishResponseSuccess",["WASmaxInMdIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInMdIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseCompanionFinishResponseSuccess=a}),98);
__d("WASmaxOutMdBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutMdCompanionFinishRequest",["WASmaxJsx","WASmaxOutMdBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b,c=a.linkCodeCompanionRegJid,e=a.linkCodePairingWrappedKeyBundleElementValue,f=a.companionIdentityPublicElementValue;a=a.linkCodePairingRefElementValue;c=d("WASmaxOutMdBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin((b=d("WASmaxJsx")).smax("iq",{xmlns:"md",to:d("WAWap").S_WHATSAPP_NET},b.smax("link_code_companion_reg",{jid:d("WAWap").USER_JID(c),stage:"companion_finish"},b.smax("link_code_pairing_wrapped_key_bundle",null,e),b.smax("companion_identity_public",null,f),b.smax("link_code_pairing_ref",null,a))));return c}g.makeCompanionFinishRequest=a}),98);
__d("WASmaxMdCompanionFinishRPC",["WAComms","WASmaxInMdCompanionFinishResponseError","WASmaxInMdCompanionFinishResponseSuccess","WASmaxOutMdCompanionFinishRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutMdCompanionFinishRequest").makeCompanionFinishRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInMdCompanionFinishResponseSuccess").parseCompanionFinishResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"CompanionFinishResponseSuccess",value:g.value});case 7:h=d("WASmaxInMdCompanionFinishResponseError").parseCompanionFinishResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"CompanionFinishResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("CompanionFinish",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendCompanionFinishRPC=a}),98);
__d("WASmaxInMdIQErrorNonSupportedPrimaryMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",452);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","primary-too-old");return!a.success?a:d("WAResultOrError").makeResult({code:b.value,text:a.value})}g.parseIQErrorNonSupportedPrimaryMixin=a}),98);
__d("WASmaxInMdIQErrorNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-allowed");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",405);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAllowedMixin=a}),98);
__d("WASmaxInMdIQErrorResourceLimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","resource-limit");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",419);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorResourceLimitMixin=a}),98);
__d("WASmaxInMdPrimarySetIQErrorCompanionNotConnectedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",454);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","companion-not-connected");return!a.success?a:d("WAResultOrError").makeResult({code:b.value,text:a.value})}g.parsePrimarySetIQErrorCompanionNotConnectedMixin=a}),98);
__d("WASmaxInMdIqMixinErrors",["WAResultOrError","WASmaxInMdIQErrorBadRequestMixin","WASmaxInMdIQErrorInternalServerErrorMixin","WASmaxInMdIQErrorNonSupportedPrimaryMixin","WASmaxInMdIQErrorNotAllowedMixin","WASmaxInMdIQErrorResourceLimitMixin","WASmaxInMdPrimarySetIQErrorCompanionNotConnectedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInMdIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:c.value});var e=d("WASmaxInMdIQErrorResourceLimitMixin").parseIQErrorResourceLimitMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorResourceLimit",value:e.value});var f=d("WASmaxInMdIQErrorNonSupportedPrimaryMixin").parseIQErrorNonSupportedPrimaryMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorNonSupportedPrimary",value:f.value});var g=d("WASmaxInMdPrimarySetIQErrorCompanionNotConnectedMixin").parsePrimarySetIQErrorCompanionNotConnectedMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"PrimarySetIQErrorCompanionNotConnected",value:g.value});var h=d("WASmaxInMdIQErrorNotAllowedMixin").parseIQErrorNotAllowedMixin(a);return h.success?d("WAResultOrError").makeResult({name:"IQErrorNotAllowed",value:h.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorBadRequest","IQErrorResourceLimit","IQErrorNonSupportedPrimary","IQErrorCompanionNotConnected","IQErrorNotAllowed"],[b,c,e,f,g,h])}g.parseIqMixinErrors=a}),98);
__d("WASmaxInMdCompanionHelloResponseError",["WAResultOrError","WASmaxInMdIQErrorResponseMixin","WASmaxInMdIqMixinErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInMdIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInMdIqMixinErrors").parseIqMixinErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIqMixinErrors:b.value}))}g.parseCompanionHelloResponseError=a}),98);
__d("WASmaxInMdCompanionHelloResponseNotifyCompanion",["WAResultOrError","WASmaxInMdIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"link_code_companion_reg");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"link_code_pairing_ref");if(!e.success)return e;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"stage","companion_hello");if(!c.success)return c;e=d("WASmaxParseUtils").contentBytes(e.value);if(!e.success)return e;a=d("WASmaxInMdIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({linkCodeCompanionRegStage:c.value,linkCodeCompanionRegLinkCodePairingRefElementValue:e.value},a.value))}g.parseCompanionHelloResponseNotifyCompanion=a}),98);
__d("WASmaxOutMdCompanionHelloRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutMdBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.linkCodePairingNonceElementValue;a=d("WASmaxJsx").smax("link_code_pairing_nonce",null,a);return a}function a(a){var b,c=a.linkCodePairingNonceArgs,e=a.linkCodeCompanionRegJid,f=a.linkCodeCompanionRegShouldShowPushNotification,g=a.linkCodePairingWrappedCompanionEphemeralPubElementValue,i=a.companionServerAuthKeyPubElementValue,j=a.companionPlatformIdElementValue;a=a.companionPlatformDisplayElementValue;e=d("WASmaxOutMdBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin((b=d("WASmaxJsx")).smax("iq",{xmlns:"md",to:d("WAWap").S_WHATSAPP_NET},b.smax("link_code_companion_reg",{jid:d("WAWap").USER_JID(e),stage:"companion_hello",should_show_push_notification:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,f)},b.smax("link_code_pairing_wrapped_companion_ephemeral_pub",null,g),b.smax("companion_server_auth_key_pub",null,i),b.smax("companion_platform_id",null,j),b.smax("companion_platform_display",null,a),d("WASmaxChildren").OPTIONAL_CHILD(h,c))));return e}g.makeCompanionHelloRequestLinkCodeCompanionRegLinkCodePairingNonce=h;g.makeCompanionHelloRequest=a}),98);
__d("WASmaxMdCompanionHelloRPC",["WAComms","WASmaxInMdCompanionHelloResponseError","WASmaxInMdCompanionHelloResponseNotifyCompanion","WASmaxOutMdCompanionHelloRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutMdCompanionHelloRequest").makeCompanionHelloRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInMdCompanionHelloResponseNotifyCompanion").parseCompanionHelloResponseNotifyCompanion(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"CompanionHelloResponseNotifyCompanion",value:g.value});case 7:h=d("WASmaxInMdCompanionHelloResponseError").parseCompanionHelloResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"CompanionHelloResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("CompanionHello",{NotifyCompanion:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendCompanionHelloRPC=a}),98);
__d("WASmaxInMdIQErrorBadRequestOrInternalServerErrorMixinGroup",["WAResultOrError","WASmaxInMdIQErrorBadRequestMixin","WASmaxInMdIQErrorInternalServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInMdIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorInternalServerError"],[b,c])}g.parseIQErrorBadRequestOrInternalServerErrorMixinGroup=a}),98);
__d("WASmaxInMdGetCountryCodeResponseError",["WAResultOrError","WASmaxInMdIQErrorBadRequestOrInternalServerErrorMixinGroup","WASmaxInMdIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInMdIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInMdIQErrorBadRequestOrInternalServerErrorMixinGroup").parseIQErrorBadRequestOrInternalServerErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrInternalServerErrorMixinGroup:b.value}))}g.parseGetCountryCodeResponseError=a}),98);
__d("WASmaxInMdGetCountryCodeResponseGetCountryCodeResponse",["WAResultOrError","WASmaxInMdIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"country_code");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(c.value,"iso");if(!c.success)return c;a=d("WASmaxInMdIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({countryCodeIso:c.value},a.value))}g.parseGetCountryCodeResponseGetCountryCodeResponse=a}),98);
__d("WASmaxOutMdBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutMdGetCountryCodeRequest",["WASmaxJsx","WASmaxOutMdBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutMdBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"md"},d("WASmaxJsx").smax("link_code_companion_reg",{stage:"get_country_code"})));return a}g.makeGetCountryCodeRequest=a}),98);
__d("WASmaxMdGetCountryCodeRPC",["WAComms","WASmaxInMdGetCountryCodeResponseError","WASmaxInMdGetCountryCodeResponseGetCountryCodeResponse","WASmaxOutMdGetCountryCodeRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c=d("WASmaxOutMdGetCountryCodeRequest").makeGetCountryCodeRequest();h.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(c,a));case 3:e=h.sent;f=d("WASmaxInMdGetCountryCodeResponseGetCountryCodeResponse").parseGetCountryCodeResponseGetCountryCodeResponse(e,c);if(!f.success){h.next=7;break}return h.abrupt("return",{name:"GetCountryCodeResponseGetCountryCodeResponse",value:f.value});case 7:g=d("WASmaxInMdGetCountryCodeResponseError").parseGetCountryCodeResponseError(e,c);if(!g.success){h.next=10;break}return h.abrupt("return",{name:"GetCountryCodeResponseError",value:g.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetCountryCode",{GetCountryCodeResponse:f,Error:g}));case 11:case"end":return h.stop()}},null,this)}g.sendGetCountryCodeRPC=a}),98);
__d("WAWebCompanionRegClientUtils",["$InternalEnum","WAWebMiscBrowserUtils"],(function(a,b,c,d,e,f,g){var h=b("$InternalEnum")({UNKNOWN:0,CHROME:1,EDGE:2,FIREFOX:3,IE:4,OPERA:5,SAFARI:6,ELECTRON:7,UWP:8,OTHER_WEB_CLIENT:9});d=String(a());function a(){var a=c("WAWebMiscBrowserUtils").info().name;if(!a)return h.UNKNOWN;switch(a){case"Chrome":return h.CHROME;case"Firefox":return h.FIREFOX;case"IE":return h.IE;case"Opera":return h.OPERA;case"Safari":return h.SAFARI;case"Edge":return h.EDGE;case"electron":return h.ELECTRON;default:return h.OTHER_WEB_CLIENT}}g.DEVICE_PLATFORM=d;g.getCompanionWebClientFromBrowser=a}),98);
__d("WAWebAltDeviceLinkingIq",["WALogger","WASmaxMdCompanionFinishRPC","WASmaxMdCompanionHelloRPC","WASmaxMdGetCountryCodeRPC","WAWebCompanionRegClientUtils","WAWebMiscBrowserUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt device linking: sendGetCountryCodeRPC failed with error: ",""]);h=function(){return a};return a}var i=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.name="CompanionHelloError";a.type=c;return a}return a}(babelHelpers.wrapNativeSuper(Error)),j=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="CompanionFinishError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error));function a(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield d("WASmaxMdGetCountryCodeRPC").sendGetCountryCodeRPC());if(a.name==="GetCountryCodeResponseGetCountryCodeResponse")return{enabled:!0,countryCode:a.value.countryCodeIso}}catch(a){d("WALogger").ERROR(h(),a).sendLogs("alt device linking: sendGetCountryCodeRPC failed")}return{enabled:!1}});return k.apply(this,arguments)}function e(a,b,c,d){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){a=(yield d("WASmaxMdCompanionHelloRPC").sendCompanionHelloRPC({linkCodePairingNonceArgs:{linkCodePairingNonceElementValue:new Uint8Array(1)},linkCodeCompanionRegJid:a,linkCodePairingWrappedCompanionEphemeralPubElementValue:new Uint8Array(e),companionServerAuthKeyPubElementValue:new Uint8Array(f),companionPlatformIdElementValue:b("WAWebCompanionRegClientUtils").DEVICE_PLATFORM,companionPlatformDisplayElementValue:c("WAWebMiscBrowserUtils").info().name+" ("+c("WAWebMiscBrowserUtils").info().os+")",linkCodeCompanionRegShouldShowPushNotification:g?"true":"false"}));if(a.name==="CompanionHelloResponseNotifyCompanion")return a.value.linkCodeCompanionRegLinkCodePairingRefElementValue;else if(a.name==="CompanionHelloResponseError")throw new i("alt pairing: Got an error from alt paring: companion hello: "+a.value.errorIqMixinErrors.name,a.value.errorIqMixinErrors);throw new i("alt pairing: Got an unknown error from alt paring: companion hello")});return l.apply(this,arguments)}function f(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){e=(yield d("WASmaxMdCompanionFinishRPC").sendCompanionFinishRPC({linkCodeCompanionRegJid:e,linkCodePairingWrappedKeyBundleElementValue:new Uint8Array(a),companionIdentityPublicElementValue:new Uint8Array(b),linkCodePairingRefElementValue:c}));if(e.name==="CompanionFinishResponseSuccess")return;throw new j("alt pairing: Got an error from alt paring: companion finish")});return m.apply(this,arguments)}g.CompanionHelloError=i;g.CompanionFinishError=j;g.genDoesServerEnableAltDeviceLinking=a;g.sendCompanionHello=e;g.sendCompanionFinish=f}),98);
__d("WAWebAltDeviceLinkingApi",["invariant","$InternalEnum","Promise","WABase64","WAByteArray","WACryptoUtils","WALogger","WAQplTypes","WATimeUtils","WAWebAdvSignatureApi","WAWebAltDeviceLinkingAlgorithm","WAWebAltDeviceLinkingIq","WAWebBackendApi","WAWebJidUtils","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebUserPrefsInfoStore","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g,h){var i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: sent companion finish to server"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: completed companion finish local algorithm"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: cached companion hello ref: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: handling primary hello"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: companion hello ref received: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: sent companion hello"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: completed companion hello generation"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: start linking flow"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: initialize QR linking"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: initialize alt linking"]);s=function(){return a};return a}var t=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="MissingCachedRefError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),u=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="NoiseInfoIsNullError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),v=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="InvalidRefError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),w=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="OldCodeError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),x=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="MaxPrimaryHelloError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),y=b("$InternalEnum").Mirrored(["QR_CODE","ALT_DEVICE_LINKING"]),z=b("$InternalEnum").Mirrored(["NotStarted","Initialized","AfterSendCompanionHello","AfterSendCompanionFinish"]),A=function(){function a(){this.clear()}var b=a.prototype;b.clear=function(){this.helloCached=null,this.ref=null,this.phone=null,this.stage=z.NotStarted,this.codeGenerationTs=null,this.primaryHelloAttemptCount=0,this.marker!=null&&(this.marker.end(d("WAQplTypes").QuickLogActionType.ABORTED),this.marker=null)};return a}(),B=180,C=3,D=new A(),E=y.QR_CODE;function F(){return E}function G(a){E=a}function a(){return D.ref}function H(){return D.marker}function e(){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(s()),D.clear(),D.marker=d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.ALTERNATIVE_DEVICE_LINKING),yield d("WAWebUserPrefsMultiDevice").setADVSecretKey(),D.stage=z.Initialized,G(y.ALT_DEVICE_LINKING)});return I.apply(this,arguments)}function f(){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(r());if(F()===y.ALT_DEVICE_LINKING){var a;(a=H())==null?void 0:a.addPoint("switch_to_qr")}D.clear();yield d("WAWebAdvSignatureApi").generateADVSecretKey();D.stage=z.NotStarted;G(y.QR_CODE)});return J.apply(this,arguments)}function K(a,b){return L.apply(this,arguments)}function L(){L=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").LOG(q());var c=(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get());if(c==null)throw new u("alt pairing: noise info is null");D.phone=a;D.codeGenerationTs=d("WATimeUtils").unixTime();return M(D,c,b)});return L.apply(this,arguments)}function M(a,b,c){return N.apply(this,arguments)}function N(){N=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f;if(!c("gkx")("26258")){var g;(g=D.marker)==null?void 0:g.annotate({string:{phone:a.phone}})}a.stage===z.Initialized||h(0,75727,a.stage);(g=D.marker)==null?void 0:g.addPoint("generate_code_start");g=(yield d("WAWebAltDeviceLinkingAlgorithm").companionHello());a.helloCached=g;(f=D.marker)==null?void 0:f.addPoint("generate_code_end");d("WALogger").LOG(p());(f=D.marker)==null?void 0:f.addPoint("send_companion_hello_start");a.phone!=null||h(0,67482);a.ref=(yield d("WAWebAltDeviceLinkingIq").sendCompanionHello(d("WAWebJidUtils").toPhoneUserJid(a.phone),g.linkCodePairingWrappedCompanionEphemeralPub,b.staticKeyPair.pubKey,e));(f=D.marker)==null?void 0:f.addPoint("send_companion_hello_end");d("WALogger").LOG(o());if(a.ref==null)throw new t("alt pairing:could not get ref from companion hello");c("gkx")("26258")||d("WALogger").LOG(n(),a.ref);a.stage=z.AfterSendCompanionHello;return g.linkCodePairingSecret});return N.apply(this,arguments)}function O(a){return P.apply(this,arguments)}function P(){P=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(m());d("WAWebBackendApi").frontendFireAndForget("primaryHelloReceivedAltLinking",{});try{return yield S(a,D,d("WATimeUtils").unixTime())}catch(a){d("WAWebBackendApi").frontendFireAndForget("errorAltLinking",{});return(i||(i=b("Promise"))).reject(a)}});return P.apply(this,arguments)}function Q(a){return R.apply(this,arguments)}function R(){R=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebAdvSignatureApi").generateADVSecretKey(),a.stage=z.AfterSendCompanionHello});return R.apply(this,arguments)}function S(a,b,c){return T.apply(this,arguments)}function T(){T=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f;(f=D.marker)==null?void 0:f.addPoint("handle_primary_hello_start");b.primaryHelloAttemptCount++;if(b.stage===z.AfterSendCompanionFinish)if(b.primaryHelloAttemptCount<=C)yield Q(b);else throw new x("alt pairing: reached max allowed primary hello attempts per code");b.stage===z.AfterSendCompanionHello||h(0,75728,b.stage);c("gkx")("26258")||d("WALogger").LOG(l(),b.ref);if(b.ref==null)throw new t("alt pairing:could not get ref from companion hello");if(!d("WACryptoUtils").uint8ArraysEqual(b.ref,a.linkCodeCompanionRegLinkCodePairingRefElementValue))throw new v("alt pairing: handle primary hello: received unexpected ref");if(b.helloCached==null)throw c("err")("alt pairing: cannot find cached hello data");if(b.codeGenerationTs==null)throw c("err")("alt pairing: cannot find codeGenerationTs");if(e-b.codeGenerationTs>B)throw new w("alt pairing: cannot process primaryHello for an old code");f=b.helloCached;e=(yield d("WAWebAltDeviceLinkingAlgorithm").companionFinish(d("WAByteArray").uint8ArrayToBuffer(a.linkCodeCompanionRegLinkCodePairingWrappedPrimaryEphemeralPubElementValue),d("WAByteArray").uint8ArrayToBuffer(a.linkCodeCompanionRegPrimaryIdentityPubElementValue),f.linkCodeKey,f.linkCodePairingCompanionADVEphemeralKeyPair));d("WALogger").LOG(k());yield d("WAWebUserPrefsMultiDevice").setADVSecretKey(d("WABase64").encodeB64(e.advSecret));a=b.ref;if(a==null)throw new t("alt pairing: cannot find cached ref");f=b.phone;if(f==null)throw new t("alt pairing: phone is empty");yield d("WAWebAltDeviceLinkingIq").sendCompanionFinish(e.linkCodePairingWrappedKeyBundle,e.companionIdentityPublic,a,d("WAWebJidUtils").toPhoneUserJid(f));d("WALogger").LOG(j());b.stage=z.AfterSendCompanionFinish;(e=D.marker)==null?void 0:e.addPoint("handle_primary_hello_end")});return T.apply(this,arguments)}g.MissingCachedRefError=t;g.NoiseInfoIsNullError=u;g.InvalidRefError=v;g.OldCodeError=w;g.MaxPrimaryHelloError=x;g.PairingType=y;g.AltPairingStage=z;g.PairingState=A;g.MAX_SECONDS_CODE_IS_VALID=B;g.getPairingType=F;g.setPairingType=G;g.getCurrentRef=a;g.getCurrentMarker=H;g.initializeAltDeviceLinking=e;g.initializeQRLinking=f;g.startAltLinkingFlow=K;g.startAltLinkingFlowInternal=M;g.handlePrimaryHello=O;g.handlePrimaryHelloInternal=S}),98);
__d("WAWebAltDeviceLinkingHandleNotification",["WACryptoUtils","WASmaxMdPrimaryHelloNotifyCompanionRPC","WASmaxMdRefreshCodeNotifyCompanionRPC","WASmaxOutMessageFallbackDeliverResponseBadStanza","WAWebAltDeviceLinkingApi","WAWebBackendApi","err"],(function(a,b,c,d,e,f,g){var h;function a(){return h}function b(a){var b=a.content;if(!Array.isArray(b)||!b.length)return d("WASmaxOutMessageFallbackDeliverResponseBadStanza").makeDeliverResponseBadStanza({ackError:487},a);b=b[0].attrs;if(b.stage==="primary_hello")return i(a);else if(b.stage==="refresh_code")return j(a);return d("WASmaxOutMessageFallbackDeliverResponseBadStanza").makeDeliverResponseBadStanza({ackError:487},a)}function i(a){a=d("WASmaxMdPrimaryHelloNotifyCompanionRPC").receivePrimaryHelloNotifyCompanionRPC(a);var b=a.parsedRequest;a=a.makePrimaryHelloNotifyCompanionResponseAck;if(!b){d("WAWebBackendApi").frontendFireAndForget("errorAltLinking",{});throw c("err")("alt pairing: could not parse primary hello")}try{h=d("WAWebAltDeviceLinkingApi").handlePrimaryHello(b);return a()}catch(a){(b=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:b.addPoint("primary_hello_error");throw a}}function j(a){a=d("WASmaxMdRefreshCodeNotifyCompanionRPC").receiveRefreshCodeNotifyCompanionRPC(a);var b=a.parsedRequest;a=a.makeRefreshCodeNotifyCompanionResponseAck;if(!b)throw c("err")("alt pairing: could not parse refresh code");var e=d("WAWebAltDeviceLinkingApi").getCurrentRef();if(e!=null&&d("WACryptoUtils").uint8ArraysEqual(e,b.linkCodeCompanionRegLinkCodePairingRefElementValue))if(b.linkCodeCompanionRegForceManualRefresh==="true"){(e=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:e.addPoint("receive_force_refresh_code");d("WAWebBackendApi").frontendFireAndForget("forceManualRefresh",{ref:b.linkCodeCompanionRegLinkCodePairingRefElementValue})}else{(e=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:e.addPoint("receive_refresh_code");d("WAWebBackendApi").frontendFireAndForget("refreshAltLinkingCode",{ref:b.linkCodeCompanionRegLinkCodePairingRefElementValue})}return a()}g.getPrimaryHello=a;g.handleAltDeviceLinkingNotification=b;g.handlePrimaryHelloNotification=i;g.handleRefreshCodeNotification=j}),98);
__d("WAWebHandleAboutNotification",["$InternalEnum","Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebApiContact","WAWebCommsWapMd","WAWebJidToWid","WAWebSchemaContact","WAWebStatusCollection","WAWebStatusContactAction","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAboutNotification: unhandled notification of\n        type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAboutNotification: get status update for unknown contact ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["could not find side contact hash for status update operation"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAboutNotification: received ","\n    for ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);n=function(){return a};return a}var o=b("$InternalEnum")({CHANGE:"change",SIDE_LIST_CHANGE:"sideListChange",UNKNOWN:"unknown"}),p=new(c("WADeprecatedWapParser"))("incomingAboutNotification",function(a){a.assertTag("notification");var b={stanzaId:a.attrString("id")},c=a.hasChild("set")&&a.child("set");if(c&&!c.hasAttr("hash"))return babelHelpers["extends"]({type:o.CHANGE,from:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("from")),pushname:a.attrString("notify"),content:c.contentString(),ts:a.attrTime("t")},b);return c&&c.hasAttr("hash")?babelHelpers["extends"]({type:o.SIDE_LIST_CHANGE,from:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("from")),hash:c.attrString("hash")},b):babelHelpers["extends"]({type:o.UNKNOWN,from:a.attrString("from")},b)});function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(l(),a.type,a.from.toString());switch(a.type){case o.SIDE_LIST_CHANGE:var b=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],a.hash));if(b.length===0)d("WALogger").WARN(k());else{b=d("WAWebWidFactory").createWid(b[0].id);var e=d("WAWebStatusCollection").StatusCollection.get(b);b=e==null?null:d("WAWebStatusContactAction").getStatus(b).then(function(a){e.set({status:a.status})});yield b}break;case o.CHANGE:b=a.from;if(!(b instanceof c("WAWebWid")))break;var f=[b];if(b.isLid()){b=d("WAWebApiContact").getPhoneNumber(d("WAWebWidFactory").toUserWid(b));b!=null&&f.push(b)}for(b of f){f=d("WAWebStatusCollection").StatusCollection.get(b);f&&a.content!=null?f.status=a.content:d("WALogger").WARN(j(),b.toLogString())}break;default:d("WALogger").WARN(i(),a.type);break}return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),to:a.from instanceof c("WAWebWid")?d("WAWebCommsWapMd").JID(a.from):d("WAWap").CUSTOM_STRING(a.from),"class":"notification",type:"status"})});return r.apply(this,arguments)}function a(a){var c=p.parse(a);if(c.error){d("WALogger").DEV(n(),a.toString());d("WALogger").ERROR(m(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}return q(c.success)}g.NotificationType=o;g.handleAboutNotification=a}),98);
__d("WAWebProcessAppdata",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g;function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (g||(g=b("Promise"))).resolve();return{hasInactiveMsg:!1}});return h.apply(this,arguments)}f.processDecryptedAppdataProto=a}),66);
__d("WAWebHandleAppdata",["Promise","WADeprecatedWapParser","WALogger","WATimeUtils","WAWebBackendJobs.flow","WAWebGetMessageCache","WAWebHandleMsgCommon","WAWebHandleMsgParser","WAWebHandleMsgSendAck","WAWebHandleMsgSendReceipt","WAWebHandleMsgTypes.flow","WAWebJidToWid","WAWebMessageThread","WAWebMsgProcessingApiUtils","WAWebMsgProcessingDecryptApi","WAWebOfflineHandler","WAWebProcessAppdata","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: msgId::",', start processing appdata, offline="','"']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: msgId::",", msgMeta is unavailable, also not showing placeholder for appdata"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: error while parsing appdata for ack only: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: error while parsing: ",""]);m=function(){return a};return a}var n=new(c("WADeprecatedWapParser"))("incomingAppdataParser",function(a){a.assertTag("appdata");a.hasAttr("to")&&a.assertAttr("to",d("WAWebUserPrefsMeUser").assertGetMe().toJid());var b=a.mapChildrenWithTag("enc",function(a){return{e2eType:a.attrEnumValues("type",d("WAWebBackendJobs.flow").CiphertextType.members()),encMediaType:d("WAWebBackendJobs.flow").EncMediaType.cast(a.maybeAttrString("mediatype")),ciphertext:a.contentBytes(),retryCount:a.hasAttr("count")?a.attrInt("count"):0,hideFail:a.maybeAttrString("decrypt-fail")==="hide"}}),c=a.maybeChild("device-identity");c=c?c.contentBytes():null;var e=d("WAWebHandleMsgParser").parseMessageInfo(a,b),f=d("WAWebHandleMsgParser").parseMessageMeta(a,b),g=d("WAWebHandleMsgParser").parseBizInfo(a);a=(a=(a=a.maybeChild("rcat"))==null?void 0:a.contentBytes())!=null?a:null;return{encs:b,bizInfo:g,msgInfo:e,msgMeta:f,deviceIdentity:c,rcat:a}}),o=new(c("WADeprecatedWapParser"))("incomingMsgParserForAckOnly",function(a){a.assertTag("appdata");return{externalId:a.attrString("id"),from:d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),participant:a.hasAttr("participant")?d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("participant")):null}});function p(a,c){d("WALogger").DEV(m(),c.toString()).tags("appdata");c=o.parse(c);if(c.error){d("WALogger").DEV(l(),c.error).tags("appdata");return(h||(h=b("Promise"))).reject(a.error)}a=c.success;c=a.externalId;var e=a.from;a=a.participant;return(h||(h=b("Promise"))).resolve(d("WAWebHandleMsgSendAck").sendAck(c,e,null,a))}function a(a){var c=n.parse(a);if(c.error)return p(c,a);var e=c.success;d("WALogger").DEV(k(),e);var f=e.msgMeta,g=e.msgInfo;g.clientReceivedTsMillis=d("WATimeUtils").unixTimeMs();g.offline!=null&&(d("WAWebOfflineHandler").OfflineMessageHandler.addOfflinePendingMessage(),d("WAWebOfflineHandler").OfflineMessageHandler.offlineStanzaReceivedAfterComplete());d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()&&delete e.msgInfo.offline;return d("WAWebMessageThread").handleMessage(g.chat.toString(),!!e.msgInfo.offline,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;g.msgProcessStartTsMillis=d("WATimeUtils").unixTimeMs();if(f.isUnavailable){d("WALogger").LOG(j(),g.externalId).tags("appdata");return}d("WALogger").LOG(i(),g.externalId,(a=g.offline)!=null?a:"").tags("appdata");a=(yield d("WAWebMsgProcessingDecryptApi").decryptE2EPayload(e,d("WAWebProcessAppdata").processDecryptedAppdataProto));g.offline!=null?(d("WAWebOfflineHandler").OfflineMessageHandler.processMessageDecryptResult(a.result),a.result!==d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS||g.category===d("WAWebHandleMsgCommon").CATEGORY_PEER?d("WAWebHandleMsgSendReceipt").sendReceipt(g,f,a):d("WAWebGetMessageCache").getMessageCache().addMessages([{receiptInfo:{externalId:g.externalId,from:d("WAWebMsgProcessingApiUtils").getFrom(g),author:g.author}}],!1)):d("WAWebHandleMsgSendReceipt").sendReceipt(g,f,a)}))}g["default"]=a}),98);
__d("WASmaxInBizCtwaAdAccountServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountNonceNotificationRequest",["WAResultOrError","WASmaxInBizCtwaAdAccountServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"wa_ad_account_nonce");if(!b.success)return b;var c=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","business");if(!f.success)return f;b=d("WASmaxParseUtils").contentString(b.value);if(!b.success)return b;a=d("WASmaxInBizCtwaAdAccountServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,to:e.value,type:f.value,waAdAccountNonceElementValue:b.value},a.value))}g.parseNonceNotificationRequest=a}),98);
__d("WASmaxBizCtwaAdAccountNonceNotificationRPC",["WASmaxInBizCtwaAdAccountNonceNotificationRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInBizCtwaAdAccountNonceNotificationRequest").parseNonceNotificationRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("NonceNotification",{Request:a}));return{parsedRequest:a.value}}g.receiveNonceNotificationRPC=a}),98);
__d("WASmaxInBizSettingsServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInBizSettingsSyncPrivacySettingRequest",["WAResultOrError","WASmaxInBizSettingsServerNotificationMixin","WASmaxInBizSettingsSmbDataSharingSettingMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"privacy");if(!b.success)return b;var c=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","business");if(!f.success)return f;b=d("WASmaxInBizSettingsSmbDataSharingSettingMixin").parseSmbDataSharingSettingMixin(b.value);a=d("WASmaxInBizSettingsServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,to:e.value,type:f.value,privacySmbDataSharingSettingMixin:b.success?b.value:null},a.value))}g.parseSyncPrivacySettingRequest=a}),98);
__d("WASmaxBizSettingsSyncPrivacySettingRPC",["WASmaxInBizSettingsSyncPrivacySettingRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInBizSettingsSyncPrivacySettingRequest").parseSyncPrivacySettingRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SyncPrivacySetting",{Request:a}));return{parsedRequest:a.value}}g.receiveSyncPrivacySettingRPC=a}),98);
__d("WAWebCTWAParsePrivacy",["WALogger","WASmaxBizSettingsSyncPrivacySettingRPC"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWAPrivacy: Could not parse RPC response"]);h=function(){return a};return a}function a(a){try{a=d("WASmaxBizSettingsSyncPrivacySettingRPC").receiveSyncPrivacySettingRPC(a.node());a=a.parsedRequest;a=(a=a.privacySmbDataSharingSettingMixin)==null?void 0:a.value;return a==null?null:{smbDataSharingSetting:a}}catch(a){d("WALogger").ERROR(h());return null}}g.parseCTWAPrivacy=a}),98);
__d("WASmaxInBizCtwaActionEnums",[],(function(a,b,c,d,e,f){a={"false":"false","true":"true"};b={info:"info",warning:"warning"};f.ENUM_FALSE_TRUE=a;f.ENUM_INFO_WARNING=b}),66);
__d("WASmaxInBizCtwaActionLocalisationMetadataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"parameter");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");return!a.success?a:d("WAResultOrError").makeResult({name:b.value,value:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"localisation_metadata");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"uid");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"translation_project");if(!c.success)return c;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"parameter",0,20,h);return!a.success?a:d("WAResultOrError").makeResult({uid:b.value,translationProject:c.value,parameter:a.value})}g.parseLocalisationMetadataParameter=h;g.parseLocalisationMetadataMixin=a}),98);
__d("WASmaxInBizCtwaActionNativeActionsMixinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"native_action");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"platform");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"min_app_version");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(a,"local_link");if(!e.success)return e;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"universal_link");return!a.success?a:d("WAResultOrError").makeResult({platform:b.value,minAppVersion:c.value,localLink:e.value,universalLink:a.value})}function a(a){a=d("WASmaxParseUtils").mapChildrenWithTag(a,"native_action",0,50,h);return!a.success?a:d("WAResultOrError").makeResult({nativeAction:a.value})}g.parseNativeActionsMixinNativeAction=h;g.parseNativeActionsMixinMixin=a}),98);
__d("WASmaxInBizCtwaActionServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInBizCtwaActionBannerSuggestionRequest",["WAResultOrError","WASmaxInBizCtwaActionEnums","WASmaxInBizCtwaActionLocalisationMetadataMixin","WASmaxInBizCtwaActionNativeActionsMixinMixin","WASmaxInBizCtwaActionServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"action");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"deep_link");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"local_link");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"local_android_link");return!a.success?a:d("WAResultOrError").makeResult({deepLink:b.value,localLink:c.value,localAndroidLink:a.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"localised_heading");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"localisation_metadata");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");if(!a.success)return a;b=d("WASmaxInBizCtwaActionLocalisationMetadataMixin").parseLocalisationMetadataMixin(b.value);return!b.success?b:d("WAResultOrError").makeResult({value:a.value,localisationMetadataLocalisationMetadataMixin:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"localised_body");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"localisation_metadata");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");if(!a.success)return a;b=d("WASmaxInBizCtwaActionLocalisationMetadataMixin").parseLocalisationMetadataMixin(b.value);return!b.success?b:d("WAResultOrError").makeResult({value:a.value,localisationMetadataLocalisationMetadataMixin:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"localised_highlight");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"localisation_metadata");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");if(!a.success)return a;b=d("WASmaxInBizCtwaActionLocalisationMetadataMixin").parseLocalisationMetadataMixin(b.value);return!b.success?b:d("WAResultOrError").makeResult({value:a.value,localisationMetadataLocalisationMetadataMixin:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"banner");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"config");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a,"content");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"heading");if(!e.success)return e;var f=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"body");if(!f.success)return f;var g=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"highlight");if(!g.success)return g;var l=d("WASmaxParseUtils").optionalChildWithTag(a,"action",h);if(!l.success)return l;var m=d("WASmaxParseUtils").optionalChildWithTag(c.value,"localised_heading",i);if(!m.success)return m;var n=d("WASmaxParseUtils").optionalChildWithTag(c.value,"localised_body",j);if(!n.success)return n;var o=d("WASmaxParseUtils").optionalChildWithTag(c.value,"localised_highlight",k);if(!o.success)return o;var p=d("WASmaxParseUtils").attrIntRange(b.value,"expires_at",1,void 0);if(!p.success)return p;var q=d("WASmaxParseUtils").attrStringEnum(b.value,"display",d("WASmaxInBizCtwaActionEnums").ENUM_INFO_WARNING);if(!q.success)return q;b=d("WASmaxParseUtils").attrStringEnum(b.value,"revoked",d("WASmaxInBizCtwaActionEnums").ENUM_FALSE_TRUE);if(!b.success)return b;c=d("WASmaxParseUtils").attrString(c.value,"locale");if(!c.success)return c;e=d("WASmaxParseUtils").contentString(e.value);if(!e.success)return e;f=d("WASmaxParseUtils").contentString(f.value);if(!f.success)return f;g=d("WASmaxParseUtils").contentString(g.value);if(!g.success)return g;a=d("WASmaxInBizCtwaActionNativeActionsMixinMixin").parseNativeActionsMixinMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({configExpiresAt:p.value,configDisplay:q.value,configRevoked:b.value,contentLocale:c.value,contentHeadingElementValue:e.value,contentBodyElementValue:f.value,contentHighlightElementValue:g.value},a.value,{action:l.value,contentLocalisedHeading:m.value,contentLocalisedBody:n.value,contentLocalisedHighlight:o.value}))}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"ctwa_suggestion");if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(b.value,"banner",l);if(!c.success)return c;var e=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!e.success)return e;var f=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!f.success)return f;var g=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","business");if(!g.success)return g;b=d("WASmaxParseUtils").attrString(b.value,"target_entity_id");if(!b.success)return b;a=d("WASmaxInBizCtwaActionServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:e.value,to:f.value,type:g.value,ctwaSuggestionTargetEntityId:b.value},a.value,{ctwaSuggestionBanner:c.value}))}g.parseBannerSuggestionRequestCtwaSuggestionBannerAction=h;g.parseBannerSuggestionRequestCtwaSuggestionBannerContentLocalisedHeading=i;g.parseBannerSuggestionRequestCtwaSuggestionBannerContentLocalisedBody=j;g.parseBannerSuggestionRequestCtwaSuggestionBannerContentLocalisedHighlight=k;g.parseBannerSuggestionRequestCtwaSuggestionBanner=l;g.parseBannerSuggestionRequest=a}),98);
__d("WASmaxBizCtwaActionBannerSuggestionRPC",["WASmaxInBizCtwaActionBannerSuggestionRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInBizCtwaActionBannerSuggestionRequest").parseBannerSuggestionRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("BannerSuggestion",{Request:a}));return{parsedRequest:a.value}}g.receiveBannerSuggestionRPC=a}),98);
__d("WAWebWamEnumPreferredLinkType",[],(function(a,b,c,d,e,f){a=Object.freeze({LOCAL:0,UNIVERSAL:1});f.PREFERRED_LINK_TYPE=a}),66);
__d("WAWebCtwaActionBannerUnderstandWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumPreferredLinkType"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({CtwaActionBannerUnderstand:[3586,{bannerIdentifier:[1,a.TYPES.STRING],bannerLocale:[2,a.TYPES.STRING],clientLocale:[3,a.TYPES.STRING],hasLocalLink:[4,a.TYPES.BOOLEAN],hasUniversalLink:[5,a.TYPES.BOOLEAN],invalidLink:[6,a.TYPES.STRING],lwiFlowIdentifier:[7,a.TYPES.STRING],preferredLink:[8,d("WAWebWamEnumPreferredLinkType").PREFERRED_LINK_TYPE],validLocale:[9,a.TYPES.BOOLEAN],validNotification:[10,a.TYPES.BOOLEAN]},[1,1,1],"private",0]},{CtwaActionBannerUnderstand:[]});g.CtwaActionBannerUnderstandWamEvent=b}),98);
__d("WAWebCTWAParseSuggestion",["WALogger","WASmaxBizCtwaActionBannerSuggestionRPC","WATimeUtils","WAWebApiParse","WAWebBizGatingUtils","WAWebCtwaActionBannerUnderstandWamEvent","WAWebL10N","WAWebUpdaterVersion"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: invalid deep link (",", ",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: manage ads not enabled (",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: invalid link (",")"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: app version too old (",")"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: too many actions (",")"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," (",")"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose([""," (",")"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: locale mismatch (",")"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: missing banner data (",")"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: metric failed"]);q=function(){return a};return a}var r="recreate_ad",s="manage_ads",t="parseCTWASuggestion: missing action link";function u(a){if(!d("WAWebBizGatingUtils").adsActionBannersLoggingEnabled())return;var b=new(d("WAWebCtwaActionBannerUnderstandWamEvent").CtwaActionBannerUnderstandWamEvent)();b.bannerIdentifier=a.bannerIdentifier;b.validNotification=a.validNotification;a.clientLocale!=null&&(b.clientLocale=a.clientLocale);a.bannerLocale!=null&&(b.bannerLocale=a.bannerLocale);a.validLocale!=null&&(b.validLocale=a.validLocale);b.commitAndWaitForFlush()["catch"](function(a){d("WALogger").ERROR(q()).devConsole(a)})}function v(a){a=a.split("-");return a[1]}function a(a){a=d("WASmaxBizCtwaActionBannerSuggestionRPC").receiveBannerSuggestionRPC(a.node());a=a.parsedRequest;var b=a.ctwaSuggestionTargetEntityId,e=a.ctwaSuggestionBanner;a=a.t;var f=v(b);if(e==null){u({bannerIdentifier:b,validNotification:!1});d("WALogger").ERROR(p(),f).sendLogs("parseCTWASuggestion-missing-banner-data-"+f);return}if(e.configRevoked==="true")return{type:"revokedBanner",id:b};var g=e.contentLocale,q=c("WAWebL10N").getNormalizedLocale(),w=function(a){var c=a.validNotification;a=a.validLocale;u({bannerIdentifier:b,validNotification:c,clientLocale:q,bannerLocale:g,validLocale:a})};if(c("WAWebL10N").normalizeLocaleToWajsLocale(g)!==q){w({validNotification:!1,validLocale:!1});d("WALogger").WARN(o(),f);return}var x=e.configExpiresAt,y=e.contentHeadingElementValue,z=e.contentBodyElementValue,A=e.contentHighlightElementValue,B=e.configDisplay;e=e.nativeAction;e=e.filter(function(a){return a.platform==="web"});if(e.length===0){w({validNotification:!1,validLocale:!0});b.endsWith(r)||b.includes(s)?d("WALogger").ERROR(n(),t,f).sendLogs("parseCTWASuggestion-missing-action-link-${bannerType}"):d("WALogger").WARN(m(),t,f);return}else if(e.length>1){w({validNotification:!1,validLocale:!0});d("WALogger").ERROR(l(),f).sendLogs("parseCTWASuggestion-too-many-actions-${bannerType}");return}e=e[0];var C=e.minAppVersion;C=new(d("WAWebUpdaterVersion").Version)(C);var D=new(d("WAWebUpdaterVersion").Version)(d("WAWebUpdaterVersion").SANITIZED_VERSION_STR);if(D.lt(C)){d("WALogger").WARN(k(),f);return}D=e.localLink;C=d("WAWebApiParse").parseAPICmd(D);if(C.resultType==="INVALID"){if(!D.startsWith("https://")){w({validNotification:!1,validLocale:!0});d("WALogger").ERROR(j(),f).sendLogs("parseCTWASuggestion-invalid-link-${bannerType}");return}}else if(C.resultType==="MANAGE_ADS"){if(!d("WAWebBizGatingUtils").adsActionManageAdsBannerEnabled()){w({validNotification:!1,validLocale:!0});d("WALogger").WARN(i(),f);return}}else{C.resultType;w({validNotification:!1,validLocale:!0});d("WALogger").ERROR(h(),f,C.resultType).sendLogs("parseCTWASuggestion-invalid-deep-link-${bannerType}");return}w({validNotification:!0,validLocale:!0});return{type:"banner",id:b,expiresAt:d("WATimeUtils").castToUnixTime(x),heading:y,body:z,highlight:A,actionLink:D,display:B,ts:d("WATimeUtils").castToUnixTime(a)}}g.parseCTWASuggestion=a}),98);
__d("WAWebHandleBusinessRemoval",["Promise","WAWebBizCreateBizStateChangeNotificationMsgsAction","WAWebContactCollection","WAWebModelStorageUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield a.get(b.user));if(c==null)return;c.isBusiness=!1;c.verifiedLevel=0;c.verifiedName="";return a.merge(b.user,c)});return j.apply(this,arguments)}function k(a,b){return a.remove(b.user)}var l={isBusiness:!1};function m(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){e=d("WAWebContactCollection").ContactCollection.get(a);f=e?{isBusiness:e.isBusiness,privacyMode:e.privacyMode}:l;yield d("WAWebModelStorageUtils").getStorage().lock(["contact","verified-business-name"],function(c){var d=c[0];c=c[1];return(h||(h=b("Promise"))).all([i(d,a),k(c,a)])});e=d("WAWebContactCollection").ContactCollection.get(a);e!=null&&e.set({isBusiness:!1,verifiedLevel:null,verifiedName:null});return c("WAWebBizCreateBizStateChangeNotificationMsgsAction")(a,f,l)});return n.apply(this,arguments)}function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.type!=="remove_hash")throw c("err")("Invalid notification type");var e=d("WAWebContactCollection").ContactCollection.resolveWidsFromHash(a.hash);if(!e)return!1;yield (h||(h=b("Promise"))).all(e.map(function(b){return m(b,a.stanzaId,a.ts)}));return!0});return o.apply(this,arguments)}function e(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.type!=="remove_jid")throw c("err")("Invalid notification type");yield m(a.jid,a.stanzaId,a.ts)});return p.apply(this,arguments)}g.handleBusinessRemoval=m;g.handleBusinessRemovalNotificationHash=a;g.handleBusinessRemovalNotificationContact=e}),98);
__d("WAWebHandleBusinessNameChange",["Promise","WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebApiVerifiedBusinessName","WAWebBizCreateBizStateChangeNotificationMsgsAction","WAWebBizUpdateContactsWithVerifiedNamesAction","WAWebCommonParsersVerifiedName","WAWebCommsWapMd","WAWebContactCollection","WAWebHandleBusinessRemoval","WAWebModelStorageUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["verified name notification not found"]);i=function(){return a};return a}function j(a,c,e,f,g,i){var j=d("WAWebContactCollection").ContactCollection.get(a);j!=null&&d("WAWebBizUpdateContactsWithVerifiedNamesAction").updateContactsWithVerifiedNames([{id:a,name:e,level:c,isApi:f,isSmb:g,privacyMode:i}],[j]);return(h||(h=b("Promise"))).resolve()}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebModelStorageUtils").getStorage().lock(["verified-business-name"],function(){return d("WAWebApiVerifiedBusinessName").createOrUpdateVerifiedBusinessName(a.wid,{level:a.level,serial:parseInt(a.serial||"0",10),name:a.verifiedName,isApi:a.isApi,isSmb:a.isSmb,privacyMode:a.privacyMode?{actualActors:a.privacyMode.actualActors,hostStorage:a.privacyMode.hostStorage,privacyModeTs:a.privacyMode.privacyModeTs}:null})});var e=[],f=d("WAWebContactCollection").ContactCollection.get(a.wid);f!=null&&e.push(c("WAWebBizCreateBizStateChangeNotificationMsgsAction")(a.wid,{isBusiness:f.isBusiness,privacyMode:f.privacyMode},{isBusiness:!0,privacyMode:a.privacyMode}));e.push(j(a.wid,a.level,a.verifiedName,a.isApi,a.isSmb,a.privacyMode));yield (h||(h=b("Promise"))).all(e)});return l.apply(this,arguments)}var m=new(c("WADeprecatedWapParser"))("verifiedNameParser",function(a){return c("WAWebCommonParsersVerifiedName")(a.child("verified_name"))});function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=d("WAWap")).wap("iq",{to:b.S_WHATSAPP_NET,type:"get",xmlns:"w:biz",id:b.generateId()},b.wap("verified_name",{jid:d("WAWebCommsWapMd").DEVICE_JID(a)}));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(b,m));if(!a.success){if(a.errorCode===404){d("WALogger").WARN(i());return}throw c("err")("Could not send IQ in retrieveBusinessDetails")}return a.result});return o.apply(this,arguments)}function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.type!=="verified_name_hash")throw c("err")("Invalid notification type");var e=d("WAWebContactCollection").ContactCollection.resolveWidsFromHash(a.hash);if(!e)return!1;e=(yield (h||(h=b("Promise"))).all(e.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield n(a));return{wid:a,verifiedName:b}});return function(b){return a.apply(this,arguments)}}())));e.length&&(yield (h||(h=b("Promise"))).all(e.map(function(b){var c=b.wid;b=b.verifiedName;if(b){var e=b.name,f=b.level,g=b.serial,h=b.isApi,i=b.isSmb,j=b.privacyMode;return k({wid:c,verifiedName:e,level:f,stanzaId:a.stanzaId,ts:a.ts,serial:g,isApi:h,isSmb:i,privacyMode:j})}else if(b===void 0)return d("WAWebHandleBusinessRemoval").handleBusinessRemoval(c,a.stanzaId,a.ts)})));return!0});return p.apply(this,arguments)}function e(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.jid,c=a.stanzaId,e=a.ts;a=a.verifiedName;var f=a.serial;f=f===void 0?"":f;var g=a.level,h=a.isApi,i=a.isSmb,j=a.privacyMode;a=a.name;if(!a){var l;if(((l=d("WAWebContactCollection").ContactCollection.get(b))==null?void 0:l.verifiedName)!=null){a=((l=d("WAWebContactCollection").ContactCollection.get(b))==null?void 0:l.verifiedName)||""}else{l=(yield n(b));if(!l)return;a=l.name}}return k({verifiedName:a,level:g,stanzaId:c,ts:e,wid:b,serial:f,isApi:h,isSmb:i,privacyMode:j})});return q.apply(this,arguments)}g.handleVerifiedBusinessNameNotificationHash=a;g.handleVerifiedBusinessNameNotificationContact=e}),98);
__d("WAWebHandleBusinessProductCatalogNotification",["Promise","WAWebCatalogCollection","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=d("WAWebCatalogCollection").CatalogCollection.get(d("WAWebUserPrefsMeUser").getMeUser().toString());if(c){var e=[];a.forEach(function(a){e.push(c.refreshProduct(a))});yield (h||(h=b("Promise"))).all(e)}});return i.apply(this,arguments)}function c(a){var c=d("WAWebCatalogCollection").CatalogCollection.get(d("WAWebUserPrefsMeUser").getMeUser().toString());if(c==null?void 0:c.collections)for(var e=0;e<a.collectionIds.length;e++){var f=c.collections.get(a.collectionIds[e]);f&&f.set(a.reviewStatuses[e])}return(h||(h=b("Promise"))).resolve()}g.handleProductNotification=a;g.handleCollectionNotification=c}),98);
__d("WAWebHandleBusinessProfile",["Promise","WAWebBusinessProfileCollection","WAWebContactCollection","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.from;a=d("WAWebWidFactory").createWidFromWidLike(a.toString());yield k([a])});return i.apply(this,arguments)}function c(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.hash;a=d("WAWebContactCollection").ContactCollection.resolveWidsFromHash(a);if(!a)return!1;yield k(a);return!0});return j.apply(this,arguments)}function k(a){a=a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=Boolean(d("WAWebBusinessProfileCollection").BusinessProfileCollection.getValid(a));a=(yield d("WAWebBusinessProfileCollection").BusinessProfileCollection.update(a));a=Array.isArray(a)?a:[a];for(a of a)b||(a.stale=!0)});return function(b){return a.apply(this,arguments)}}());return(h||(h=b("Promise"))).all(a)}g.handleBusinessProfile=a;g.handleBusinessProfileHash=c}),98);
__d("WAWebHandleCTWASuggestion",["WALogger","WATimeUtils","WAWebBackendApi","WAWebBizGatingUtils","WAWebSchemaCTWASuggestion","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleCTWASuggestion: suggestion de-duped"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleCTWASuggestion: expired"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.type==="banner"?yield k(a):(a.type,yield m(a))});return j.apply(this,arguments)}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebBizGatingUtils").adsActionBannersEnabled())return;if(!d("WATimeUtils").isInFuture(a.expiresAt)){d("WALogger").WARN(i()).devConsole(a);return}try{yield d("WAWebSchemaCTWASuggestion").getCTWASuggestionTable().create(a)}catch(b){d("WALogger").WARN(h()).devConsole(a);return}d("WAWebBackendApi").frontendFireAndForget("newCTWASuggestion",{suggestion:a})});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebSchemaCTWASuggestion").getCTWASuggestionTable().remove(a.id),d("WAWebBackendApi").frontendFireAndForget("revokeCTWASuggestion",{suggestion:a})});return n.apply(this,arguments)}g.handleCTWASuggestion=a}),98);
__d("WAWebHandlePrivacySettingsNotification",["WAWebBackendApi"],(function(a,b,c,d,e,f,g){function a(a){d("WAWebBackendApi").frontendFireAndForget("smbDataSharingSettingUpdate",{smbDataSharingSettingValue:a})}g.handleSmbDataSharingSettingNotification=a}),98);
__d("WAWebHandleBusinessNotification",["WADeprecatedWapParser","WALogger","WASmaxBizCtwaAdAccountNonceNotificationRPC","WAWap","WAWebBackendJobsCommon","WAWebBizGatingUtils","WAWebCTWABizAccessTokenNonceManager","WAWebCTWAParsePrivacy","WAWebCTWAParseSuggestion","WAWebCommonParsersVerifiedName","WAWebHandleBusinessNameChange","WAWebHandleBusinessProductCatalogNotification","WAWebHandleBusinessProfile","WAWebHandleBusinessRemoval","WAWebHandleCTWASuggestion","WAWebHandlePrivacySettingsNotification","WAWebJidToWid","WAWebOrchestratorNonPersistedJob","WAWebProductTypes.flow","WAWebSubscriptions","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["business notification received, node: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("businessNotificationParser",function(a){a.assertTag("notification");var b=a.attrString("id"),e=a.attrWapJid("from"),f=a.attrTime("t");b={stanzaId:b,from:e,ts:f};if(a.hasChild("remove")){e=a.child("remove");return e.hasAttr("jid")?babelHelpers["extends"]({type:"remove_jid",jid:d("WAWebJidToWid").chatJidToChatWid(e.attrChatJid("jid"))},b):babelHelpers["extends"]({type:"remove_hash",hash:e.attrString("hash")},b)}else if(a.hasChild("verified_name")){e=a.child("verified_name");return e.hasAttr("jid")?babelHelpers["extends"]({type:"verified_name_jid",jid:d("WAWebJidToWid").chatJidToChatWid(e.attrChatJid("jid")),verifiedName:c("WAWebCommonParsersVerifiedName")(e)},b):babelHelpers["extends"]({type:"verified_name_hash",hash:e.attrString("hash")},b)}else if(a.hasChild("profile")){f=a.child("profile");e=f.maybeAttrString("hash");return e?babelHelpers["extends"]({type:"profile_hash",hash:e},b):babelHelpers["extends"]({type:"profile"},b)}else if(a.hasChild("product_catalog")){f=a.child("product_catalog");if(f.hasChild("product")){var g=[];f.forEachChildWithTag("product",function(a){a=a.child("id").contentString();g.push(a)});return babelHelpers["extends"]({type:"product",productsIds:g},b)}else if(f.hasChild("collection")){var h=[],i=[];f.forEachChildWithTag("collection",function(a){if(a.hasChild("status_info")){var b;b={reviewStatus:(b=d("WAWebProductTypes.flow").asProductReviewType(a.child("status_info").child("status").contentString()))!=null?b:"APPROVED",rejectReason:(b=a.child("status_info").maybeChild("reject_reason"))==null?void 0:b.contentString(),commerceUrl:(b=a.child("status_info").maybeChild("commerce_url"))==null?void 0:b.contentString()};h.push(a.attrString("id"));i.push(b)}});return babelHelpers["extends"]({type:"collection",collectionIds:h,reviewStatuses:i},b)}}else if(a.hasChild("subscriptions")){e=a.child("subscriptions");var j=[];e.forEachChildWithTag("subscription",function(a){var b=a.attrString("status"),c=a.maybeAttrInt("subscription_end_time");a=a.attrString("id");j.push({id:a,status:b,expirationDate:c})});return babelHelpers["extends"]({type:"subscriptions",subscriptions:j},b)}else if(a.hasChild("ctwa_suggestion")){if(d("WAWebBizGatingUtils").adsActionBannersEnabled()){f=d("WAWebCTWAParseSuggestion").parseCTWASuggestion(a);if(f!=null)return babelHelpers["extends"]({type:"ctwa_suggestion",suggestion:f},b)}}else if(a.hasChild("privacy")){if(d("WAWebBizGatingUtils").smbDataSharingConsentEnabled()){e=d("WAWebCTWAParsePrivacy").parseCTWAPrivacy(a);if(e!=null)return babelHelpers["extends"]({type:"privacy",privacy:e},b)}}else if(a.hasChild("wa_ad_account_nonce")){f=d("WASmaxBizCtwaAdAccountNonceNotificationRPC").receiveNonceNotificationRPC(a.node());return babelHelpers["extends"]({type:"wa_ad_account_nonce",nonce:d("WAWebCTWABizAccessTokenNonceManager").castToNonce(f.parsedRequest.waAdAccountNonceElementValue)},b)}return babelHelpers["extends"]({type:"unknown"},b)});function l(a,b,c){return c?d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),to:b,"class":"notification",type:"business"},d("WAWap").wap("user",{side_list:"out"})):d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),to:b,"class":"notification",type:"business"})}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(j(),a);var b=k.parse(a);if(b.error){d("WALogger").DEV(i(),a.toString());d("WALogger").ERROR(h(),b.error.toString());throw b.error}a=b.success;switch(a.type){case"verified_name_hash":b=(yield d("WAWebHandleBusinessNameChange").handleVerifiedBusinessNameNotificationHash(a));return l(a.stanzaId,a.from,!b);case"verified_name_jid":yield d("WAWebHandleBusinessNameChange").handleVerifiedBusinessNameNotificationContact(a);return l(a.stanzaId,a.from,!1);case"remove_hash":b=(yield d("WAWebHandleBusinessRemoval").handleBusinessRemovalNotificationHash(a));return l(a.stanzaId,a.from,!b);case"remove_jid":yield d("WAWebHandleBusinessRemoval").handleBusinessRemovalNotificationContact(a);return l(a.stanzaId,a.from,!1);case"profile":yield d("WAWebHandleBusinessProfile").handleBusinessProfile(a);return l(a.stanzaId,a.from,!1);case"profile_hash":b=(yield d("WAWebHandleBusinessProfile").handleBusinessProfileHash(a));return l(a.stanzaId,a.from,!b);case"product":yield d("WAWebHandleBusinessProductCatalogNotification").handleProductNotification(a.productsIds);return l(a.stanzaId,a.from,!1);case"collection":yield d("WAWebHandleBusinessProductCatalogNotification").handleCollectionNotification(a);return l(a.stanzaId,a.from,!1);case"subscriptions":yield d("WAWebSubscriptions").applySubscriptions(a.subscriptions);return l(a.stanzaId,a.from,!1);case"ctwa_suggestion":yield d("WAWebHandleCTWASuggestion").handleCTWASuggestion(a.suggestion);return l(a.stanzaId,a.from,!1);case"privacy":d("WAWebHandlePrivacySettingsNotification").handleSmbDataSharingSettingNotification(a.privacy.smbDataSharingSetting);return l(a.stanzaId,a.from,!1);case"wa_ad_account_nonce":d("WAWebCTWABizAccessTokenNonceManager").setNonceFromPushNotification(a.nonce);return l(a.stanzaId,a.from,!1);default:a.type;return l(a.stanzaId,a.from,!1)}});return n.apply(this,arguments)}function a(a){var b=d("WAWebBackendJobsCommon").getNonCriticalNotificationPriority(Boolean(a.attrs.offline));return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("handleBusinessNotification",function(a){return m(a.node)},{priority:b}).waitUntilCompleted({node:a})}g.handleBusinessNotification=m;g.handleBusinessNotificationJob=a}),98);
__d("WAWebHandleChatState",["WAWebChangePresenceHandlerAction","WAWebJidToWid","WAWebUpdateLidMetadataJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.jid;a=a.status;b=d("WAWebJidToWid").userJidToUserWid(b);yield c("WAWebChangePresenceHandlerAction")({id:b,type:a});return"NO_ACK"});return function(b){return a.apply(this,arguments)}}();e=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.jid,e=a.status,f=a.participant;a=a.participantPn;b=d("WAWebJidToWid").chatJidToChatWid(b);f=d("WAWebJidToWid").userJidToUserWid(f);a=a==null?null:d("WAWebJidToWid").userJidToUserWid(a);a!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:f,pn:a}],!0));yield c("WAWebChangePresenceHandlerAction")({id:b,type:e,participant:f});return"NO_ACK"});return function(b){return a.apply(this,arguments)}}();g.handleIndividualChatState=a;g.handleGroupChatState=e}),98);
__d("WAWebHandleContactNotification",["Promise","WADeprecatedWapParser","WALogger","WANullthrows","WAWap","WAWebBackendJobsCommon","WAWebChangeProfilePicThumb","WAWebChatCollection","WAWebContactCollection","WAWebContactGetters","WAWebContactSyncBridge","WAWebContactTextStatusBridge","WAWebHandleSingleMsg","WAWebJidToWid","WAWebMsgKey","WAWebMsgType","WAWebOrchestratorNonPersistedJob","WAWebPresenceCollection","WAWebProfilePicConstants","WAWebSchemaChat","WAWebStatusCollection","WAWebStatusContactAction","WAWebTextStatusGatingUtils","WAWebUpdateLidMetadataJob","WAWebUpdateTextStatusForContact","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleContactsNotification: unhandled notification of type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["received contact sync notification"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleContactsNotification: an update command does not include jid"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["notification.oldJid is null"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(['Unexpected "contacts" notification']);o=function(){return a};return a}var p=new(c("WADeprecatedWapParser"))("incomingContactsNotification",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrWapJid("from"),e=a.attrTime("t"),f=a.attrString("t");c={from:c,ts:e,rawTs:f,stanzaId:b};if(a.hasChild("update")){var g=a.child("update");if(g.hasAttr("jid"))return babelHelpers["extends"]({type:"update",jid:d("WAWebJidToWid").userJidToUserWid(g.attrUserJid("jid"))},c);else if(g.hasAttr("hash")){e=d("WAWebContactCollection").ContactCollection.findFirst(function(a){return((a=d("WAWebContactGetters").getUserhash(a))==null?void 0:a.slice(0,4))===g.attrString("hash")});return e==null?babelHelpers["extends"]({type:"empty",jid:null},c):babelHelpers["extends"]({type:"update",jid:e.id},c)}return babelHelpers["extends"]({type:"empty",jid:null},c)}else if(a.hasChild("add")){f=a.child("add");return babelHelpers["extends"]({type:"add",hash:f.hasContent()?f.contentBytes():null,jid:null},c)}else if(a.hasChild("remove")){b=a.child("remove");return babelHelpers["extends"]({type:"remove",jid:d("WAWebJidToWid").userJidToUserWid(b.attrUserJid("jid"))},c)}else if(a.hasChild("modify")){e=a.child("modify");return babelHelpers["extends"]({type:"modify",jid:d("WAWebJidToWid").userJidToUserWid(e.attrUserJid("new")),oldJid:d("WAWebJidToWid").userJidToUserWid(e.attrUserJid("old")),lid:e.maybeAttrUserJid("new_lid")?d("WAWebJidToWid").userJidToUserWid(e.attrUserJid("new_lid")):null,oldLid:e.maybeAttrUserJid("old_lid")?d("WAWebJidToWid").userJidToUserWid(e.attrUserJid("old_lid")):null},c)}else if(a.hasChild("sync")){f=a.child("sync");return babelHelpers["extends"]({type:"sync",after:f.attrTime("after"),jid:null},c)}d("WALogger").WARN(o());return babelHelpers["extends"]({type:"empty",jid:null},c)});function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.type!=="modify")throw c("err")("Error: genContactChangeNotificationMsg invalid type");else{var e=d("WAWebUserPrefsMeUser").getMeUser(),f=c("WANullthrows")(b.oldJid),g=c("WANullthrows")(b.jid);if(b.lid!=null&&b.oldLid!=null){var h=b.oldLid,i=b.lid;h=[f,g,h,i]}else h=[f,g];return{id:new(c("WAWebMsgKey"))({remote:a,fromMe:!1,id:yield c("WAWebMsgKey").newId()}),from:a,subtype:"change_number",t:b.ts,to:e,type:"notification_template",kind:d("WAWebMsgType").MsgKind.NotificationTemplate,templateParams:h}}});return r.apply(this,arguments)}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield q(a,b));yield d("WAWebHandleSingleMsg").handleSingleMsg(a,b,"changeNumberNotification")});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.oldJid){var c=a.oldJid,e=a.jid,f=a.oldLid!=null?a.oldLid:null,g=a.lid!=null?a.lid:null,i=[],j=d("WAWebChatCollection").ChatCollection.get(c);j&&i.push({id:c.toString(),changeNumberNewJid:e.toString(),changeNumberOldJid:void 0});j=d("WAWebChatCollection").ChatCollection.get(e);j&&i.push({id:e.toString(),changeNumberNewJid:void 0,changeNumberOldJid:c.toString()});d("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(i).then(function(){i.forEach(function(a){var b=d("WAWebChatCollection").ChatCollection.get(a.id);if(b){var c=a.changeNumberNewJid;a=a.changeNumberOldJid;b.changeNumberNewJid=c!=null?d("WAWebWidFactory").createWid(c):void 0;b.changeNumberOldJid=a!=null?d("WAWebWidFactory").createWid(a):void 0}})});if(f!=null&&g!=null){yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:(j=d("WAWebWidFactory")).toUserWid(f),pn:j.toUserWid(c)},{lid:j.toUserWid(g),pn:j.toUserWid(e)}],!0)}yield (h||(h=b("Promise"))).all([s(c,a),s(e,a)])}else d("WALogger").LOG(n()).devConsole(a)});return v.apply(this,arguments)}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=p.parse(a);if(c.error){d("WALogger").DEV(m(),a.toString());d("WALogger").ERROR(l(),c.error.toString());throw c.error}a=c.success;c=a.jid;switch(a.type){case"update":if(!c){d("WALogger").WARN(k());return n(a)}var e=d("WAWebPresenceCollection").PresenceCollection.get(c);e&&e.reset();var f=d("WAWebStatusCollection").StatusCollection.get(c);e=f==null?null:d("WAWebStatusContactAction").getStatus(c).then(function(a){f.set({status:a.status})});c=d("WAWebContactCollection").ContactCollection.get(c);var g;c&&d("WAWebTextStatusGatingUtils").receiveTextStatusEnabled()&&(g=d("WAWebContactTextStatusBridge").getTextStatus(c.id,c.textStatusLastUpdateTime).then(function(a){var b=a.text,c=a.emoji,e=a.ephemeralDurationSeconds,f=a.lastUpdateTime;a=a.id;return d("WAWebUpdateTextStatusForContact").updateTextStatusForContact(a,b,c,e,f!=null?Number(f):void 0)}));c=d("WAWebChangeProfilePicThumb").changeProfilePicThumb(a.jid,d("WAWebProfilePicConstants").ProfilePicCommand.Set);yield (h||(h=b("Promise"))).all([c,e,g]);return n(a);case"modify":yield u(a);return n(a);case"sync":d("WALogger").LOG(j()).tags("contact-sync");yield d("WAWebContactSyncBridge").contactSync();return n(a);default:d("WALogger").LOG(i(),a.type);return n(a)}function n(a,b){return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),to:a.from,"class":"notification",type:"contacts"},b)}});return x.apply(this,arguments)}function a(a){var b=d("WAWebBackendJobsCommon").getNonCriticalNotificationPriority(Boolean(a.attrs.offline));return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("handleContactNotification",function(a){return w(a.node)},{priority:b}).waitUntilCompleted({node:a})}g["default"]=a}),98);
__d("WAWebHandleDeviceNotification",["Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebAdvHandlerApi","WAWebApiPendingDeviceSync","WAWebCommsWapMd","WAWebJidToWid","WAWebJidUtils","WAWebOfflineDeviceCache","WAWebOfflineHandler","WAWebSchemaContact","WAWebSyncDeviceAdvDeviceListJob","WAWebUpdateLidMetadataJob","WAWebVoip","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification - unknown notification type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification - update error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["could not find side contact hash for device update operation"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification - remove error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification - add error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(['Unknown Devices Notification: Devices notification without "remove" and "add" nodes']);p=function(){return a};return a}var q={add:"add",remove:"remove",update:"update"},r=new(c("WADeprecatedWapParser"))("incomingDevicesNotification",function(a){a.assertTag("notification");a.assertTag("notification");a.assertAttr("type","devices");var b,c,e,f=[],g=null;if(a.hasChild("remove"))c=q.remove,b=a.child("remove");else if(a.hasChild("add"))c=q.add,b=a.child("add");else if(a.hasChild("update"))c=q.update,b=a.child("update");else{d("WALogger").WARN(p());throw a.createParseError("Failed to parse devices notification")}if(c===q.add||c===q.remove){var h=b.maybeChild("key-index-list");if(!h)throw a.createParseError("key index node is required to handle device add or remove notification");var i=h.attrTime("ts");if(c===q.remove&&!i)throw a.createParseError("timestamp is required to handle device remove notification");e={ts:i,signedKeyIndexBytes:c===q.add?h.contentBytes():null};i=b.child("device");h=d("WAWebJidUtils").extractDeviceId(i.attrDeviceJid("jid"));var j=i.hasAttr("lid")?d("WAWebJidUtils").extractDeviceId(i.attrDeviceJid("lid")):null;i=i.hasAttr("key-index")?i.attrInt("key-index"):null;f=[{id:h,keyIndex:i}];j!=null&&(g=[{id:j,keyIndex:i}])}return{type:c,stanzaId:a.attrString("id"),hash:b.attrString(c===q.update?"hash":"device_hash"),lidHash:b.hasAttr("device_lid_hash")?b.attrString(c===q.update?"hash":"device_lid_hash"):null,user:d("WAWebJidToWid").deviceJidToUserWid(a.attrDeviceJid("from")),lidUser:a.hasAttr("lid")?d("WAWebJidToWid").deviceJidToUserWid(a.attrDeviceJid("lid")):null,deviceList:f,lidDeviceList:g,keyIndex:e}});function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=r.parse(a);if(e.error){d("WALogger").DEV(o(),a.toString());d("WALogger").ERROR(n(),e.error.toString());throw e.error}var f=e.success,g=d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").USER_JID(f.user),id:d("WAWap").CUSTOM_STRING(f.stanzaId),"class":"notification"});a={wid:f.user,devices:{deviceList:f.deviceList,keyIndex:f.keyIndex},type:f.type,hash:f.hash};e=f.lidUser!=null&&f.lidHash!=null&&f.lidDeviceList!=null?{wid:f.lidUser,devices:{deviceList:f.lidDeviceList,keyIndex:f.keyIndex},type:f.type,hash:f.lidHash}:null;a=[a,e].filter(Boolean);e=[];f.lidUser!=null&&f.user!=null&&e.push({lid:f.lidUser,pn:f.user});if(!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()){e.length>0&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob(e,!1));a.forEach(function(a){a=a.wid;return d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(a.toString(),g)});return"NO_ACK"}e.length>0&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob(e,!0));yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.wid,g=a.devices,n=a.type;a=a.hash;if(d("WAWebOfflineHandler").OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())yield d("WAWebApiPendingDeviceSync").addUserToPendingDeviceSync([e.toString()]);else if(f.type===q.add)try{yield d("WAWebAdvHandlerApi").handleADVDeviceNotification({wid:e,devices:g,type:n})}catch(a){d("WALogger").WARN(m(),a)}else if(f.type===q.remove)try{yield d("WAWebAdvHandlerApi").handleADVDeviceNotification({wid:e,devices:g,type:n});n=((g=f.deviceList)==null?void 0:g.map(function(a){return a.id}))||[];var o=e.user,p=e.server;yield (h||(h=b("Promise"))).all(n.map(function(a){a=d("WAWebWidFactory").createDeviceWidFromUserAndDevice(o,p,a);c("WAWebVoip").Voip.notifyDeviceIdentityChangedOrDeleted(a,!0)}))}catch(a){d("WALogger").WARN(l(),a)}else if(f.type===q.update){g=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],a));if(g.length===0)d("WALogger").WARN(k());else try{yield d("WAWebSyncDeviceAdvDeviceListJob").syncDeviceListJob([d("WAWebWidFactory").createWid(g[0].id)],"notification",null)}catch(a){d("WALogger").WARN(j(),a)}}else d("WALogger").WARN(i(),f.type)});return function(b){return a.apply(this,arguments)}}()));return g});return s.apply(this,arguments)}g.handleDevicesNotification=a}),98);
__d("WAWebHandleDeviceSwitchingNotification",["WADeprecatedWapParser","WALogger","WATimeUtils","WAWap","WAWebABProps","WAWebBackendApi","WAWebUserPrefsMeUser","WAWebWaOldCodeWamEvent","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["OTP code has expired, expiry time: "," and current time: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeviceSwitching notification received, node: ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("incomingDeviceSwitchingNotificationParser",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrWapJid("from");a=a.child("wa_old_registration");var d=a.attrString("code"),e=a.attrTime("expiry_t"),f=a.attrTime("ts");a=a.attrString("device_id");return{stanzaId:b,from:c,code:d,expiryTime:e,ts:f,deviceId:a}});function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(k(),a);var b=l.parse(a);if(b.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),b.error.toString());throw b.error}a=b.success;b=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification",type:"registration",to:a.from});if(!d("WAWebABProps").getABPropConfigValue("web_device_switching"))return b;var c=a.expiryTime,e=d("WATimeUtils").unixTime();if(e>c){d("WALogger").LOG(h(),c,e);return b}c=a.code;d("WAWebBackendApi").frontendFireAndForget("showDeviceSwitchOtp",{otpCode:c});e=d("WAWebUserPrefsMeUser").assertGetMe().getDeviceId().toString();new(d("WAWebWaOldCodeWamEvent").WaOldCodeWamEvent)({deviceId:e}).commit();return b});return m.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleDigestKey",["Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebDigestKeyJob"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("digestKeyParser",function(a){a.assertTag("notification");a.assertAttr("type","encrypt");a.assertFromServer();a.child("digest").assertTag("digest");return{stanzaId:a.attrString("id")}});function a(a){var c=k.parse(a);if(c.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}a=c.success;var e=d("WAWap").wap("ack",{to:d("WAWap").S_WHATSAPP_NET,id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification"});return d("WAWebDigestKeyJob").digestKey().then(function(){return e})}g["default"]=a}),98);
__d("WAWebHandleDisappearingModeNotification",["WADeprecatedWapParser","WAJobOrchestratorTypes","WALogger","WAWap","WAWebCommsWapMd","WAWebJidToWid","WAWebOrchestratorNonPersistedJob","WAWebUpdateDisappearingModeForContact","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDisappearingModeNotification: received d=",":t=","\n    for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("disappearingModeNotification",function(a){a.assertTag("notification");var b=a.child("disappearing_mode");return{stanzaId:a.attrString("id"),from:d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("from")),duration:b.attrInt("duration",0),ts:b.attrTime("t")}});function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.duration,c=a.from,e=a.stanzaId;a=a.ts;d("WALogger").LOG(h(),b,a,c.toString()).tags("DM","DDM");yield d("WAWebUpdateDisappearingModeForContact").updateDisappearingModeForContact(c,b,a);return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e),to:d("WAWebCommsWapMd").JID(c),"class":"notification",type:"disappearing_mode"})});return m.apply(this,arguments)}function a(a){var b=d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW;return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("handleDisappearingModeNotification",function(){var b=k.parse(a);if(b.error){d("WALogger").DEV(j(),a.toString()).tags("DM","DDM");d("WALogger").ERROR(i(),b.error.toString());return Promise.reject(b.error)}return l(b.success)},{priority:b}).waitUntilCompleted({node:a})}g.handleDisappearingModeNotificationJob=a}),98);
__d("WAWebE2ETestPairingConstants",[],(function(a,b,c,d,e,f){a="jest_e2e_pairing_attempt_ongoing";b="jest_e2e_first_read_done";f.PAIRING_ATTEMPT_ONGOING_KEY=a;f.FIRST_QRCODE_READ_DONE=b}),66);
__d("WAWebLazyPoll",["WALogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Manually Resumed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Manually Paused"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Polling..."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Active Resuming"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Inactive slowing down"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Inactive paused"]);m=function(){return a};return a}a=function(){function a(a){var b=a.name,d=a.handler;d=d===void 0?null:d;var e=a.interval;e=e===void 0?3600:e;var f=a.restingInterval;f=f===void 0?18e3:f;var g=a.sleepWhileResting;g=g===void 0?!1:g;a=a.randomIntervalExtension;a=a===void 0?0:a;this.$6=!1;this.$7=!1;this.$1=b;this.$2=e*1e3;this.$3=f*1e3;this.$4=g;this.$5=a*1e3;this.$12();if(typeof d==="function")this.poll(d);else if(d!=null)throw c("err")("Poll handler must be a function or null")}var e=a.prototype;e.$13=function(){return Math.ceil(Math.random()*this.$5)};e.$14=function(){return(this.$7?this.$3:this.$2)+this.$13()};e.$12=function(){var a=this;document.addEventListener("visibilitychange",function(){if(a.$11)return;document.hidden?a.$4?(d("WALogger").LOG(m(),a.$1),a.$15()):(d("WALogger").LOG(l(),a.$1),a.$7=!0):a.$9&&(d("WALogger").LOG(k(),a.$1),a.$16())},!1)};e.$17=function(){if(!this.$10)return!0;var a=Date.now()-this.$10;return a>=this.$14()};e.$15=function(){self.clearTimeout(this.$8),this.$6=!1};e.$16=function(){this.$7=!1,this.$6=!0,this.$18()};e.$18=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;this.$6&&(this.$17()&&(d("WALogger").LOG(j(),this.$1),yield this.$9(),this.$10=Date.now()),self.clearTimeout(this.$8),this.$8=self.setTimeout(function(){return a.$18()},this.$14()))});function c(){return a.apply(this,arguments)}return c}();e.poll=function(a){if(this.$9!=null){this.resume();return}this.$9=a;this.$6=!0;this.$18()};e.pause=function(){d("WALogger").LOG(i(),this.$1),this.$11=!0,this.$15()};e.resume=function(){d("WALogger").LOG(h(),this.$1),this.$11=!1,this.$16()};return a}();g["default"]=a}),98);
__d("WAWebUpdaterUpdatePoll",["JSResource","WALogger","WATimeUtils","WAWebBuildConstants","WAWebLazyPoll","WAWebPonyfillsFetch","WAWebStreamModel","WAWebUpdater","WAWebUpdaterVersion","WAWebWamPlatform","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updater: App will update. ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updater: Version check failed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updater: Checked at "," ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update check skipped because user is offline."]);k=function(){return a};return a}var l=d("WAWebBuildConstants").DYN_ORIGIN+"check-update";e=1800;f=3600;var m=e*.1,n=Date.now(),o=d("WATimeUtils").DAY_MILLISECONDS*3,p={WEB:"web",PWA:"web",DARWIN:"darwin",MACSTORE:"darwin-store",DARWIN_BETA:"darwin-beta"},q=function(a){return[a.isBroken,a.isBelowSoft,a.isBelowHard,a.beta].some(Boolean)};e=new(c("WAWebLazyPoll"))({name:"updater",interval:e,restingInterval:f,randomIntervalExtension:m});function a(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!c("gkx")("26257")&&!c("gkx")("26260")){if(Date.now()-n>o){d("WAWebUpdater").Updater.showSoftUpdateBanner();return!0}return!1}var a=p[d("WAWebWamPlatform").getWamPlatform()],e=d("WAWebUpdaterVersion").SANITIZED_VERSION_STR,f=null;if(!navigator.onLine){d("WALogger").LOG(k());return!1}try{var g=(yield c("WAWebPonyfillsFetch")(l+"?version="+e+"&platform="+a));if(!g.ok)throw c("err")(g.statusText);f=(yield g.json());g=new Date().toISOString();d("WALogger").LOG(j(),g,JSON.stringify({response:f,version:e}))}catch(a){d("WALogger").ERROR(i()).devConsole(a)}if(!f||!q(f))return!1;if(c("gkx")("26259")){g=(yield c("JSResource")("WAWebChatCollection").__setRef("WAWebUpdaterUpdatePoll").load());g=g.ChatCollection;if(f.beta&&g.get("16509655277-1417824428@g.us")===void 0)return!1}g=f;var m=g.isBelowHard,r=g.isBelowSoft,s=g.hardUpdateTime,t=g.currentVersion,u=g.isBroken;g=g.beta;d("WALogger").LOG(h(),JSON.stringify({response:f,version:e}));f=m?s:null;if(a==="web")d("WAWebUpdater").Updater.update(t,r,f);else if(u){e=b("WAWebStreamModel").Stream;e!=null&&(e.needsManualDownload=!0)}else d("WAWebUpdater").Updater.update(void 0,r,f,g);return!0});return r.apply(this,arguments)}g.PLATFORMS=p;g.hasUpdate=q;g.updatePoll=e;g.checkForUpdates=a}),98);
__d("WAWebHandleFailure",["Promise","WAComms","WADeprecatedWapParser","WALogger","WAWebCmd","WAWebE2ETestPairingConstants","WAWebFailureErrorCodes","WAWebJestE2ELogUtils","WAWebL10N","WAWebLocalStorage","WAWebLogoutReasonConstants","WAWebSocketModel","WAWebUpdater","WAWebUpdaterUpdatePoll","WAWebUpdaterVersion","WAWebWamPlatform","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["failure reason "," not implemented yet"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleFailure: got failure code ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleFailure: got failure code ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Incorrect temporary ban data "," ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Client too old or bad user agent, attempting to update the app"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["received failure stanza, reason: ",", logging out"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["received failure stanza, reason: ",", logging out"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose([""," parsing ",""]);p=function(){return a};return a}var q=new(c("WADeprecatedWapParser"))("failureParser",function(a){a.assertTag("failure");return{reason:a.attrInt("reason",400,599),location:a.attrString("location"),code:a.hasAttr("code")?a.attrInt("code"):null,expire:a.hasAttr("expire")?a.attrInt("expire"):null,message:a.maybeAttrString("message"),url:a.maybeAttrString("url"),logoutMessageHeader:a.maybeAttrString("logout_message_header"),logoutMessageSubtext:a.maybeAttrString("logout_message_subtext"),logoutMessageLocale:a.maybeAttrString("logout_message_locale")}});function a(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){c("gkx")("26256")&&(d("WAWebJestE2ELogUtils").maybeLogToJestE2eJSConsole("received failure stanza, "+a.toString()),c("WAWebLocalStorage")==null?void 0:c("WAWebLocalStorage").removeItem(d("WAWebE2ETestPairingConstants").PAIRING_ATTEMPT_ONGOING_KEY));var e=q.parse(a);if(e.error){d("WALogger").ERROR(p(),e.error.toString(),a.toString());return(h||(h=b("Promise"))).reject(e.error)}switch(e.success.reason){case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_LOCKED:d("WALogger").LOG(o(),e.success.reason);a=e.success;var f=a.logoutMessageHeader,g=a.logoutMessageSubtext;a=a.logoutMessageLocale;var r=null;a===c("WAWebL10N").getNormalizedLocale()&&(f!=null||g!=null)&&(r={logoutMessageHeader:f,logoutMessageSubtext:g});yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData(d("WAWebLogoutReasonConstants").LogoutReason.AccountLocked,r);d("WAWebCmd").Cmd.logout();break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_NOT_AUTHORIZED:case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_BANNED:d("WALogger").LOG(n(),e.success.reason);yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData();d("WAWebCmd").Cmd.logout();break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_CLIENT_TOO_OLD:case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_BAD_USER_AGENT:d("WALogger").LOG(m());a=d("WAWebUpdaterVersion").SANITIZED_VERSION_STR;f=d("WAWebUpdaterUpdatePoll").PLATFORMS[d("WAWebWamPlatform").getWamPlatform()];f==="web"?d("WAWebUpdater").Updater.update(a,!1,0):d("WAWebUpdater").Updater.update(void 0,!1,0,!1);d("WAComms").stopComms();break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_TEMP_BANNED:g=e.success;r=g.code;f=g.expire;a=g.message;g=g.url;if(r!=null&&f!=null)d("WAWebCmd").Cmd.onTemporaryBan({banned:!0,code:r,message:a,url:g,expire:f});else{d("WALogger").ERROR(l(),r,f);throw c("err")("handleFailure: wrong temp ban data")}break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_GENERIC_FAILURE:case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_INTERNAL_SERVER_ERROR:case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_EXPERIMENTAL:d("WALogger").WARN(k(),e.success.reason);break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_SERVICE_UNAVAILABLE:d("WALogger").WARN(j(),e.success.reason);d("WAWebCmd").Cmd.showServiceUnavailableError();break;default:d("WALogger").WARN(i(),e.success.reason);return(h||(h=b("Promise"))).reject(c("err")("failure reason "+e.success.reason+" not implemented yet"))}});return r.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleGrowthNotification",["WADeprecatedWapParser","WALogger","WATimeUtils","WAWap","WAWebABProps","WAWebChatFindBridge","WAWebChatMessageCountsWamEvent","WAWebChatThreadLogging","WAWebCreateChat","WAWebHandleSingleMsg","WAWebJidToWid","WAWebMsgKey","WAWebMsgType","WAWebNotificationDeliveryWamEvent","WAWebUserPrefsMeUser","WAWebWamEnumNotificationTypeEnum","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to create new chat thread with receiver - {receiverId}"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to create new chat thread with receiver - {receiverId}"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid receiver id"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid receiver id"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Growth notification received, node: ",""]);n=function(){return a};return a}var o={contacts:"contacts","w:growth":"w:growth"},p=new(c("WADeprecatedWapParser"))("incomingGrowthNotificationParser",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrWapJid("from"),d=a.attrEnum("type",o);b={stanzaId:b,from:c,type:d};if(a.hasChild("invite")){c=a.child("invite");if(c.hasChild("receiver")){d=c.child("receiver");return babelHelpers["extends"]({receiverId:d.hasAttr("user")?d.attrUserJid("user"):null,reason:d.hasAttr("reason")?d.attrString("reason"):""},b)}}return b});function a(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(n(),a);var b=p.parse(a);if(b.error){d("WALogger").DEV(m(),a.toString());d("WALogger").ERROR(l(),b.error.toString());throw b.error}a=b.success;b=a.type;if(d("WAWebABProps").getABPropConfigValue("chat_upsell_for_1on1_invites")&&b==="contacts"){if(!("receiverId"in a)||a.receiverId==null){d("WALogger").DEV(k());d("WALogger").ERROR(j());return}var c=d("WAWebJidToWid").userJidToUserWid(a.receiverId),e="reason"in a&&a.reason==="clicked_invite_link";yield r(c,e)}return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification",type:b,to:a.from})});return q.apply(this,arguments)}function r(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("WAWebChatFindBridge").findLocal(a.toString()));if(c==null){yield d("WAWebCreateChat").createChat(a,"createChatOnInviteAccept");c=(yield d("WAWebChatFindBridge").findLocal(a.toString()));if(c==null){d("WALogger").DEV(i());d("WALogger").ERROR(h());return}a=c.id;b=(yield t(a,b));c=(yield d("WAWebChatThreadLogging").getChatThreadID(c.id.toJid()));new(d("WAWebNotificationDeliveryWamEvent").NotificationDeliveryWamEvent)({threadId:c,uiNotificationType:d("WAWebWamEnumNotificationTypeEnum").NOTIFICATION_TYPE_ENUM.INVITE_JOINED}).commit();yield d("WAWebHandleSingleMsg").handleSingleMsg(a,b);new(d("WAWebChatMessageCountsWamEvent").ChatMessageCountsWamEvent)({isInviteCreatedThread:!0}).commit()}return});return s.apply(this,arguments)}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return{id:new(c("WAWebMsgKey"))({remote:a,fromMe:!1,id:yield c("WAWebMsgKey").newId()}),from:a,subtype:"sender_invite",to:d("WAWebUserPrefsMeUser").getMeUser(),type:"notification_template",kind:d("WAWebMsgType").MsgKind.NotificationTemplate,t:d("WATimeUtils").unixTime(),templateParams:[b.toString()]}});return u.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInClientExpirationClientExpirationRequest",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ib");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"client_expiration");if(!b.success)return b;a=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!a.success)return a;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,b.value,"t",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({from:a.value,clientExpirationT:b.value})}g.parseClientExpirationRequest=a}),98);
__d("WASmaxClientExpirationClientExpirationRPC",["WASmaxInClientExpirationClientExpirationRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInClientExpirationClientExpirationRequest").parseClientExpirationRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ClientExpiration",{Request:a}));return{parsedRequest:a.value}}g.receiveClientExpirationRPC=a}),98);
__d("WAWebClearDirtyBitsJob",["WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["clearDirtyBits: failed with error"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["clearDirtyBits: success for type: ",""]);i=function(){return a};return a}var j=new(c("WADeprecatedWapParser"))("cleanDirtyReplyParser",function(a){a.assertAttr("type","result");return{}});function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var b=a.map(function(a){return d("WAWap").wap("clean",{type:d("WAWap").CUSTOM_STRING(a.type),timestamp:d("WAWap").INT(a.timestamp)})});b=d("WAWap").wap("iq",{to:d("WAWap").S_WHATSAPP_NET,type:"set",xmlns:"urn:xmpp:whatsapp:dirty",id:d("WAWap").generateId()},b);try{yield d("WADeprecatedSendIq").deprecatedSendIq(b,j),d("WALogger").LOG(i(),a.map(function(a){return a.type}).join(","))}catch(a){d("WALogger").WARN(h()).devConsole(a)}});return k.apply(this,arguments)}g.clearDirtyBits=a}),98);
__d("WAWebHandleDirtyBits",["Promise","WALogger","WASyncd","WASyncdConst","WAWebAccountSyncJob","WAWebApiPendingDeviceSync","WAWebBackendApi","WAWebClearDirtyBitsJob","WAWebCmd","WAWebEventsWaitForOfflineDeliveryEnd","WAWebMdAppStateDirtyBitsWamEvent","WAWebNewsletterGatingUtils","WAWebOfflineDeviceCache","WAWebOfflineHandler","WAWebPDFNTypes","WAWebQueryAndUpdateGroupMetadataJob","WAWebQueryAndUpdateNewslettersMetadataAction","WAWebTos","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDirtyBits: handle dirty bits, supported: ",", unsupported: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDeviceDirtyBit: offline resume manager not initialized"]);j=function(){return a};return a}var k={groups:"groups",account_sync:"account_sync",syncd_app_state:"syncd_app_state",newsletter_metadata:"newsletter_metadata"};c={devices:"devices",picture:"picture",privacy:"privacy",blocklist:"blocklist",notice:"notice"};function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=[]);a=a.map(function(a){return d("WAWebAccountSyncJob").AccountSyncType.cast(a)}).filter(Boolean);a.length===0&&(a=Array.from(d("WAWebAccountSyncJob").AccountSyncType.members()));yield (h||(h=b("Promise"))).all(a.map(function(a){if(a===d("WAWebAccountSyncJob").AccountSyncType.DEVICES)return p();else if(a===d("WAWebAccountSyncJob").AccountSyncType.PICTURE)return d("WAWebAccountSyncJob").getAndUpdateProfilePicture();else a===d("WAWebAccountSyncJob").AccountSyncType.PRIVACY?d("WAWebAccountSyncJob").updatePrivacySettings():a===d("WAWebAccountSyncJob").AccountSyncType.BLOCKLIST?d("WAWebAccountSyncJob").updateBlocklist():a===d("WAWebAccountSyncJob").AccountSyncType.NOTICE&&void q()}))});return m.apply(this,arguments)}function n(a){return a.patches!=null&&a.patches.length>0||a.snapshot!=null}function o(){d("WAWebCmd").Cmd.once(d("WAWebCmd").APP_STATE_SYNC_COMPLETED,function(a){a=a.some(n);new(d("WAWebMdAppStateDirtyBitsWamEvent").MdAppStateDirtyBitsWamEvent)({dirtyBitsFalsePositive:!a}).commit()});return d("WASyncd").markCollectionsForSync(Array.from(d("WASyncdConst").CollectionName.members()))}function p(){if(!d("WAWebOfflineHandler").OfflineMessageHandler.hasInitOfflineResumeManager()){d("WALogger").ERROR(j()).tags("non-sad").sendLogs("handleDeviceDirtyBit: offline resume manager not initialized",.001);return d("WAWebAccountSyncJob").getDevices("notification")}var a=String(d("WAWebUserPrefsMeUser").getMeUser());if(!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()){d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(a,null);return(h||(h=b("Promise"))).resolve()}else if(d("WAWebOfflineHandler").OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return d("WAWebApiPendingDeviceSync").addUserToPendingDeviceSync([a]);return d("WAWebAccountSyncJob").getDevices("notification")}function q(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebTos").TosManager.run();var a=[d("WAWebNewsletterGatingUtils").getNewsletterProducerTos(),d("WAWebNewsletterGatingUtils").getNewsletterConsumerTos(),d("WAWebNewsletterGatingUtils").getNewsletterAdminInviteTos()],b=[];a.map(function(a){a={id:a,accepted:d("WAWebTos").TosManager.getState(a)===d("WAWebPDFNTypes").NOTICE_STATUS.ACCEPTED};b.push(a)});return d("WAWebBackendApi").frontendFireAndForget("updateUserDisclosures",{userDisclosures:b})});return r.apply(this,arguments)}function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.supported,e=a.unsupported,f=a.protocols;d("WALogger").LOG(i(),c.map(function(a){return a.type}).join(","),e.map(function(a){return a.type}).join(","));a=[].concat(e,c);yield (h||(h=b("Promise"))).all(c.map(function(a){a=a.type;if(a===k.groups)return d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd().then(function(){return d("WAWebQueryAndUpdateGroupMetadataJob").queryAndUpdateAllGroupMetadata()});else if(a===k.newsletter_metadata)return d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd().then(function(){return d("WAWebQueryAndUpdateNewslettersMetadataAction").queryAndUpdateAllNewsletterMetadataAction(d("WAWebQueryAndUpdateNewslettersMetadataAction").NewsletterMetadataUpdateEntryPoint.DirtyBit,{messageCount:1})});else if(a===k.account_sync)return l(f);else if(a===k.syncd_app_state)return o()}));return d("WAWebClearDirtyBitsJob").clearDirtyBits(a)});return s.apply(this,arguments)}g.SUPPORTED_DIRTY_TYPE=k;g.SUPPORTED_DIRTY_PROTOCOLS=c;g.handleDirtyBits=a}),98);
__d("WAWebHandleServerClientExpiration",["WATimeUtils","WAWebBuildConstants","WAWebCmd","WAWebUpdaterHardExpireTime","WAWebUserPrefsMultiDevice"],(function(a,b,c,d,e,f,g){function a(a){var b=parseInt(c("WAWebUpdaterHardExpireTime"),10);if(a==null)d("WAWebUserPrefsMultiDevice").clearServerClientExpirationOverride();else{var e;e=(e=d("WAWebUserPrefsMultiDevice").getServerClientExpirationOverride())==null?void 0:e.timestamp;if(e!=null&&a>=e||a>=b)return;e=d("WATimeUtils").futureUnixTime(3*d("WATimeUtils").DAY_SECONDS);e=Math.max(e,Math.min(a,b));d("WAWebUserPrefsMultiDevice").setServerClientExpirationOverride(""+e,d("WAWebBuildConstants").VERSION_BASE);d("WAWebCmd").Cmd.serverUpdatedClientExpiration()}}g.handleServerClientExpiration=a}),98);
__d("WAWebMdAppStateOfflineNotificationsWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdAppStateOfflineNotifications:[2602,{redundantCount:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,20,1e3],"regular"]},{MdAppStateOfflineNotifications:[]});g.MdAppStateOfflineNotificationsWamEvent=a}),98);
__d("WAWebHandleServerSyncNotification",["Promise","WADeprecatedWapParser","WALogger","WASyncd","WASyncdCollectionUtils","WASyncdConst","WAWap","WAWebMdAppStateOfflineNotificationsWamEvent","WAWebSyncBootstrap"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unknown collection name in notification: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: filtered non critical collections during bootstrap. new collections: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: incoming sync notification for collections\n    ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(['handleServerSyncNotification: "from" is not domain jid "s.whatsapp.net"']);n=function(){return a};return a}var o=new Map(),p=new(c("WADeprecatedWapParser"))("serverSyncNotification",function(a){a.assertTag("notification");if(!a.hasChild("collection"))throw a.createParseError("Server sync notification does not contain any collections");var b=a.attrString("id"),c=new Map(a.mapChildrenWithTag("collection",function(a){return[a.attrString("name"),a.attrInt("version")]})),e=a.hasAttr("offline");a=a.attrString("from");a!==d("WAWap").S_WHATSAPP_NET.toString()&&d("WALogger").ERROR(n());return{changedCollections:c,stanzaId:b,offline:e}});function q(a){if(a.changedCollections){var e=new Map();for(var f=a.changedCollections,g=Array.isArray(f),i=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(g){if(i>=f.length)break;j=f[i++]}else{i=f.next();if(i.done)break;j=i.value}j=j;var n=j[0];j=j[1];var p=d("WASyncdConst").CollectionName.cast(n);p!=null?e.set(p,j):d("WALogger").WARN(k(),n)}p=Array.from(e.keys());a.offline&&p.forEach(function(a){var b=o.get(a);b!=null?o.set(a,b+1):o.set(a,1)});d("WALogger").LOG(m(),Array.from(e.entries()).map(function(b){var a=b[0];b=b[1];return a+" v"+b}).join("\n"));c("WAWebSyncBootstrap").isSyncDCriticalDataSyncInProcess()&&(p=p.filter(function(a){return d("WASyncdCollectionUtils").isCriticalCollection(a)}),d("WALogger").LOG(l(),p));void d("WASyncd").markCollectionsForSync(p,e)}return(h||(h=b("Promise"))).resolve(d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification",type:"server_sync",to:d("WAWap").S_WHATSAPP_NET}))}function a(){if(o.size<1)return;var a=0;Array.from(o.entries()).forEach(function(b){b=b[1];a+=b-1});new(d("WAWebMdAppStateOfflineNotificationsWamEvent").MdAppStateOfflineNotificationsWamEvent)({redundantCount:a}).commit();o.clear()}function e(a){var c=p.parse(a);if(c.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}return q(c.success)}g.reportOfflineNotifications=a;g.handleServerSyncNotification=e}),98);
__d("WAWebParseThreadMetadata",["WAWebHandleInfoBulletinTypes.flow"],(function(a,b,c,d,e,f,g){function a(a){a=a.child(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.THREAD_META);var b={};a.forEachChildWithTag("item",function(a){var c=a.attrChatJid("from");a=a.attrTime("t");b[String(c)]=a});return{chatTimestamp:b}}g.parseThreadMetadata=a}),98);
__d("WAWebHandleInfoBulletin",["WADeprecatedWapParser","WALogger","WASmaxClientExpirationClientExpirationRPC","WATimeUtils","WAWebHandleDirtyBits","WAWebHandleInfoBulletinTypes.flow","WAWebHandleRoutingInfo","WAWebHandleServerClientExpiration","WAWebHandleServerSyncNotification","WAWebMessageDedupUtils","WAWebOfflineHandler","WAWebParseThreadMetadata","WAWebThreadMetadata","WAWebTos","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin unrecognized info bulletin"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("infoBulletinParser",function(a){a.assertTag("ib");a.assertFromServer();if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.DIRTY)){var b=[],c=[],e=[];a.forEachChildWithTag(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.DIRTY,function(a){var f={type:a.attrString("type"),timestamp:a.attrInt("timestamp")};if(f.type==="account_sync"){a=a.mapChildren(function(a){return a.tag()});a.forEach(function(a){Object.prototype.hasOwnProperty.call(d("WAWebHandleDirtyBits").SUPPORTED_DIRTY_PROTOCOLS,a)&&e.push(a)});c.push(f)}else Object.prototype.hasOwnProperty.call(d("WAWebHandleDirtyBits").SUPPORTED_DIRTY_TYPE,f.type)?c.push(f):b.push(f)});return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.DIRTY,supported:c,unsupported:b,protocols:e}}else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.ROUTING)){var f=a.child(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.ROUTING);return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.ROUTING,edgeRouting:f.child("routing_info").contentBytes(),domain:f.hasChild("dns_domain")?f.child("dns_domain").contentEnum(d("WAWebHandleRoutingInfo").DOMAINS):null}}else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE))return{count:a.child(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE).attrInt("count"),type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE};else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE_PRIORITY_COMPLETE))return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE_PRIORITY_COMPLETE};else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE_PREVIEW)){return{count:{message:a.child((f=d("WAWebHandleInfoBulletinTypes.flow")).INFO_TYPE.OFFLINE_PREVIEW).attrInt("message"),receipt:a.child(f.INFO_TYPE.OFFLINE_PREVIEW).attrInt("receipt"),notification:a.child(f.INFO_TYPE.OFFLINE_PREVIEW).attrInt("notification")},type:f.INFO_TYPE.OFFLINE_PREVIEW}}else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.TOS)){var g=[];a.child("tos").forEachChildWithTag("notice",function(a){g.push(a.attrString("id"))});return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.TOS,noticeIds:g}}else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.THREAD_META))return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.THREAD_META,threadMeta:d("WAWebParseThreadMetadata").parseThreadMetadata(a)};else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.CLIENT_EXPIRATION)){f=d("WASmaxClientExpirationClientExpirationRPC").receiveClientExpirationRPC(a.getNode());a=f.parsedRequest.clientExpirationT;f=a!=null?d("WATimeUtils").castToUnixTime(a):null;return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.CLIENT_EXPIRATION,newClientExpirationTime:f}}return null});function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=k.parse(a);if(b.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),b.error.toString());throw b.error}a=b.success;if(!a){d("WALogger").WARN(h());return}switch(a.type){case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.DIRTY:yield d("WAWebHandleDirtyBits").handleDirtyBits(a);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.ROUTING:yield d("WAWebHandleRoutingInfo").handleRoutingInfo(a);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE:d("WAWebOfflineHandler").OfflineMessageHandler.processOfflineIb(a.count);d("WAWebHandleServerSyncNotification").reportOfflineNotifications();d("WAWebMessageDedupUtils").maybeClearPendingMessages(a.count);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE_PREVIEW:yield d("WAWebOfflineHandler").OfflineMessageHandler.processOfflinePreviewIb(a.count);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.TOS:d("WAWebTos").TosManager.maybeUpdateServer(a.noticeIds);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.THREAD_META:d("WAWebThreadMetadata").setOfflineThreadMeta(a.threadMeta);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.CLIENT_EXPIRATION:d("WAWebHandleServerClientExpiration").handleServerClientExpiration(a.newClientExpirationTime);return"NO_ACK";default:return}});return l.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleMediaRetryNotification",["WABase64","WADeprecatedWapParser","WALogger","WANullthrows","WAWap","WAWebCommsWapMd","WAWebCryptoMediaRetry","WAWebProtobufsMmsRetry.pb","WAWebRequestMediaReuploadManager","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: ",": id mismatch"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: ",": mediaKey is not found"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: ",": received error code: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: received from not self-primary"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: received from not self-primary: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: parsing error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: error while parsing: ",""]);n=function(){return a};return a}var o=new(c("WADeprecatedWapParser"))("mediaRetryNotification",function(a){a.assertTag("notification");var b=a.maybeChild("error"),c=a.attrWapJid("from"),e;a.hasAttr("participant")&&(e=a.attrWapJid("participant"));if(b)return{from:c,participant:e,msgId:a.attrString("id"),ciphertext:null,iv:null,errorCode:d("WAWebProtobufsMmsRetry.pb").MediaRetryNotification$ResultType.cast(b.attrInt("code"))};b=a.child("encrypt");return{from:c,participant:e,msgId:a.attrString("id"),ciphertext:b.child("enc_p").contentBytes(),iv:b.child("enc_iv").contentBytes(d("WAWebCryptoMediaRetry").ENC_IV_SIZE),errorCode:null}});function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=o.parse(a);if(b.error){d("WALogger").DEV(n(),a.toString());d("WALogger").ERROR(m(),b.error.toString());throw b.error}a=b.success;var e=a.from,f=a.participant,g=a.msgId;a=a.errorCode;(e==null||!d("WAWebWidFactory").createDeviceWid(e.toString()).equals(d("WAWebUserPrefsMeUser").getMeUser()))&&(d("WALogger").LOG(l(),e),d("WALogger").WARN(k()).sendLogs("media-retry-notification-not-from-self-primary"));e=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(g),"class":"notification",type:"mediaretry",to:e!=null?e:d("WAWebCommsWapMd").USER_JID(d("WAWebUserPrefsMeUser").getMeUser()),participant:f||d("WAWap").DROP_ATTR});if(a!=null){d("WALogger").LOG(j(),g,a);d("WAWebRequestMediaReuploadManager").RequestMediaReuploadManager.resolveMediaReupload({msgId:g,result:a});return e}f=b.success;a=f.ciphertext;b=f.iv;f=d("WAWebRequestMediaReuploadManager").RequestMediaReuploadManager.getMediaKey(g);if(!f){d("WALogger").WARN(i(),g);return e}f=(yield d("WAWebCryptoMediaRetry").decryptMediaRetryNotification(d("WABase64").decodeB64(f),g,c("WANullthrows")(b),c("WANullthrows")(a)));b=f.stanzaId;a=f.directPath;f=f.result;if(b!==g){d("WALogger").LOG(h(),g);throw c("err")("handleMediaRetryNotification: msg id does not match")}d("WAWebRequestMediaReuploadManager").RequestMediaReuploadManager.resolveMediaReupload({msgId:g,result:f,directPath:a});return e});return p.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebMexGroupPropertyUpdateNotificationHandler",["WALogger","WATimeUtils","WAWebGroupType","WAWebHandleGroupNotification","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][group-property-update][notification] Failed to changed update group property"]);h=function(){return a};return a}function i(a){return c("err")("[mex][group-property-update][notification] unexpected null "+a+" in xwa2_notify_group_on_prop_change")}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_group_on_prop_change;b=a.id;var c=a.update_time,e=a.updated_by;a=a.properties;if(b==null)throw i("id");if(c==null)throw i("update_time");if(e==null)throw i("updated_by");if(a==null)throw i("properties");var f=e.id;e=e.notify_name;a=a.allow_non_admin_sub_group_creation;if(f==null)throw i("author_id");var g;a!=null&&(g={actionType:d("WAWebGroupType").GROUP_ACTIONS.ALLOW_NON_ADMIN_SUB_GROUP_CREATION,value:a});if(g==null)return;a=d("WAWebWidFactory").createWid(f);f={chatId:d("WAWebWidFactory").createWid(b),ts:d("WATimeUtils").castMilliSecondsToUnixTime(Number(c)),actions:[g],author:a,authorPhoneNumber:a,isLidAddressingMode:!1,pushname:e,externalId:"",offline:null};try{yield d("WAWebHandleGroupNotification").handleAction(f,g,!1)}catch(a){d("WALogger").ERROR(h()).tags("mex").devConsole(a).sendLogs("mex-group-property-update-notification-fail")}});return j.apply(this,arguments)}g.mexHandleGroupPropertyUpdate=a}),98);
__d("WAWebMexNewsletterAdminInviteRevokeNotificationHandler",["WAJids","WALogger","WATimeUtils","WAWebApiContact","WAWebBackendApi","WAWebDBProcessMessage","WAWebJidToWid","WAWebNewsletterDBUtils","WAWebNewsletterGatingUtils","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[handleNewsletterAdminInviteRevoke] actor or user lid not mapped"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[handleNewsletterAdminInviteRevoke] actor or user is null"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!d("WAWebNewsletterGatingUtils").isNewsletterMultiAdminM1ImprovementsEnabled())return;a=b.xwa2_notify_newsletter_admin_invite_revoke;b=a.id;var c=a.actor;a=a.user;a=a.id;c=c.id;if(c==null||a==null){d("WALogger").ERROR(i()).tags("mex","newsletter").sendLogs("newsletter-mex-admin-invite-revoke-null-actor-or-user");return}b=d("WAJids").toNewsletterJid(b);b=d("WAWebJidToWid").newsletterJidToWid(b);a=d("WAWebWidFactory").toUserWid(d("WAWebWidFactory").createWid(a));c=d("WAWebWidFactory").toUserWid(d("WAWebWidFactory").createWid(c));var e=d("WAWebApiContact").getPhoneNumber(a);c=d("WAWebApiContact").getPhoneNumber(c);if(e==null||c==null){d("WALogger").ERROR(h()).tags("mex","newsletter").sendLogs("newsletter-mex-admin-invite-revoke-actor-or-user-lid-unmapped");return}a=d("WAWebUserPrefsMeUser").isMeAccount(a)?c:e;e=(yield d("WAWebNewsletterDBUtils").getUnexpiredNewsletterAdminInviteMessageRecordsFromChat(d("WAWebWidFactory").toNewsletterWid(b),a,c));e.forEach(function(a){var b;if(((b=a.newsletterAdminInviteInfo)==null?void 0:b.inviteExpiration)==null)return;a.newsletterAdminInviteInfo.inviteExpiration=d("WATimeUtils").castToUnixTime(0)});yield d("WAWebDBProcessMessage").updateExistingMessages(e,a);d("WAWebBackendApi").frontendFireAndForget("expireNewsletterAdminInvites",{expiredMsgData:e});return});return j.apply(this,arguments)}g.handleNewsletterAdminInviteRevoke=a}),98);
__d("WASmaxInNewslettersServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInNewslettersCommonNotificationMixin",["WAResultOrError","WASmaxInNewslettersServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseJid").attrNewsletterJid(a,"from");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","newsletter");if(!c.success)return c;a=d("WASmaxInNewslettersServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:b.value,type:c.value},a.value))}g.parseCommonNotificationMixin=a}),98);
__d("WASmaxInNewslettersNewsletterMessageDeliveryUpdateMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"issue");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"server_id",0,void 0);if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(b.value,"code",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({serverId:a.value,issueCode:b.value})}g.parseNewsletterMessageDeliveryUpdateMixin=a}),98);
__d("WASmaxInNewslettersMessageDeliveryUpdateNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNotificationMixin","WASmaxInNewslettersNewsletterMessageDeliveryUpdateMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxInNewslettersNewsletterMessageDeliveryUpdateMixin").parseNewsletterMessageDeliveryUpdateMixin(a);return!b.success?b:b}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"message_delivery_updates");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"messages");if(!b.success)return b;a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"message",1,300,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{messageDeliveryUpdatesMessagesMessage:b.value}))}g.parseMessageDeliveryUpdateNotificationRequestMessageDeliveryUpdatesMessagesMessage=h;g.parseMessageDeliveryUpdateNotificationRequest=a}),98);
__d("WASmaxOutNewslettersNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrNewsletterJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutNewslettersMessageDeliveryUpdateNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeMessageDeliveryUpdateNotificationResponseAck=a}),98);
__d("WASmaxNewslettersMessageDeliveryUpdateNotificationRPC",["WASmaxInNewslettersMessageDeliveryUpdateNotificationRequest","WASmaxOutNewslettersMessageDeliveryUpdateNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersMessageDeliveryUpdateNotificationRequest").parseMessageDeliveryUpdateNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("MessageDeliveryUpdateNotification",{Request:b}));return{parsedRequest:b.value,makeMessageDeliveryUpdateNotificationResponseAck:function(){return d("WASmaxOutNewslettersMessageDeliveryUpdateNotificationResponseAck").makeMessageDeliveryUpdateNotificationResponseAck(a)}}}g.receiveMessageDeliveryUpdateNotificationRPC=a}),98);
__d("WAWebNewsletterHandleMessageDeliveryUpdateNotification",["WAJobOrchestratorTypes","WALogger","WASmaxNewslettersMessageDeliveryUpdateNotificationRPC","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterGatingUtils","WAWebNewsletterMessageDeliveryUpdateToModelUtils","WAWebNewsletterMetadataJob","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][message-delivery-update-notification] Failed to update the db records"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxNewslettersMessageDeliveryUpdateNotificationRPC").receiveMessageDeliveryUpdateNotificationRPC(a);var b=a.makeMessageDeliveryUpdateNotificationResponseAck;a=a.parsedRequest;if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return b();try{yield j(a.from,a.messageDeliveryUpdatesMessagesMessage,a.t)}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-message-delivery-update-notification-db-fail")}return b()});return i.apply(this,arguments)}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=d("WAWebJidToWid").newsletterJidToWid(a);b=b.reduce(function(a,b){if(b.issueCode===0)a.updatesToRemove.push(b.serverId);else{b={id:b.serverId,code:b.issueCode};c!=null&&(b.t=c);a.updatesToAdd.push(b)}return a},{updatesToAdd:[],updatesToRemove:[]});var f=b.updatesToAdd;b=b.updatesToRemove;void d("WAWebNewsletterMetadataJob").updateNewsletterMessageDeliveryUpdates(a,f,b,d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH);f=(yield d("WAWebNewsletterMessageDeliveryUpdateToModelUtils").getMessageDeliveryUpdatesModelToUpdate(a,f,b));b=f.modelUpdatesToAdd;f=f.modelUpdatesToRemove;yield d("WAWebBackendApi").frontendSendAndReceive("updateNewsletterMessageDeliveryUpdate",{id:e,modelUpdatesToAdd:b,modelUpdatesToRemove:f});e=d("WAWebNux").getNewsletterAlertsBannerNuxKey(a);d("WAWebUserPrefsNuxPreferences").resetNux(e)});return k.apply(this,arguments)}g.handleNewsletterMessageDeliveryUpdateNotification=a;g.handleNewsletterMessageDeliveryUpdateNotificationImpl=j}),98);
__d("WAWebMexNewsletterAdminNotificationHandler",["WALogger","WAWebBackendApi","WAWebCommonNewsletterEnums","WAWebJidToWid","WAWebNewsletterAdminNotificationJob","WAWebNewsletterGatingUtils","WAWebNewsletterHandleMessageDeliveryUpdateNotification","WAWebNewsletterValidationUtils","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][admin-metadata] Failed to persist admin metadata notification information on db"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["unexpected null id in xwa2_notify_newsletter_on_admin_metadata_update"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!d("WAWebNewsletterGatingUtils").isNewsletterGeosuspendAdminAlertsEnabled())return;a=b.xwa2_notify_newsletter_on_admin_metadata_update;b=a.id;var c=a.thread_metadata;a=a.messages;try{if(b==null){d("WALogger").ERROR(i()).tags("mex","newsletter").devConsole("unexpected null id in xwa2_notify_newsletter_on_admin_metadata_update").sendLogs("newsletter-mex-admin-metadata-notification-unexpected-null-id");return}yield k(b,c);yield m(b,a)}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-admin-metadata-notification-db-fail")}});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if((b==null?void 0:b.geo_states)==null)return;b=b.geo_states;a=d("WAWebNewsletterValidationUtils").toNewsletterJidOrThrow(a);var c=d("WAWebJidToWid").newsletterJidToWid(a);b=b.reduce(function(a,b){var c=b.country_code;d("WAWebCommonNewsletterEnums").NewsletterState.cast((b=b.state.type)==null?void 0:b.toLowerCase())===d("WAWebCommonNewsletterEnums").NewsletterState.GeoSuspended?a.countriesToAdd.push(c):a.countriesToRemove.push(c);return a},{countriesToAdd:[],countriesToRemove:[]});var e=b.countriesToAdd;b=b.countriesToRemove;if(e.length>0){yield d("WAWebNewsletterAdminNotificationJob").updateGeosuspendedCountry(a,e,!0);d("WAWebBackendApi").frontendFireAndForget("updateGeosuspendedCountry",{id:c,countryCodes:e,toAdd:!0});e=d("WAWebNux").getNewsletterAlertsBannerNuxKey(a);d("WAWebUserPrefsNuxPreferences").resetNux(e)}b.length>0&&(yield d("WAWebNewsletterAdminNotificationJob").updateGeosuspendedCountry(a,b,!1),d("WAWebBackendApi").frontendFireAndForget("updateGeosuspendedCountry",{id:c,countryCodes:b,toAdd:!1}))});return l.apply(this,arguments)}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b==null)return;a=d("WAWebNewsletterValidationUtils").toNewsletterJidOrThrow(a);b=b.edges.map(function(a){a=a.node;var b=a.message_delivery_update.issue.code,d;switch(b){case"NEEDS_REVIEW":d=1;break;case"NONE":d=0;break;default:throw c("err")("Unexpected mex issue code: "+b)}return{serverId:parseInt(a.server_id,10),issueCode:d}});yield d("WAWebNewsletterHandleMessageDeliveryUpdateNotification").handleNewsletterMessageDeliveryUpdateNotificationImpl(a,b)});return n.apply(this,arguments)}g.mexHandleNewsletterAdminNotification=a}),98);
__d("WASmaxInNewslettersNewsletterReactionsBlocklistMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"reaction");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"code");return!b.success?b:d("WAResultOrError").makeResult({code:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"reactions");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"mode","blocklist");if(!b.success)return b;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"reaction",1,1e3,h);return!a.success?a:d("WAResultOrError").makeResult({mode:b.value,reaction:a.value})}g.parseNewsletterReactionsBlocklistReaction=h;g.parseNewsletterReactionsBlocklistMixin=a}),98);
__d("WASmaxInNewslettersNewsletterReactionsModeOthersMixin",["WAResultOrError","WASmaxInNewslettersEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"reactions");if(!b.success)return b;b=d("WASmaxParseUtils").attrStringEnum(a,"mode",d("WASmaxInNewslettersEnums").ENUM_ALL_BASIC_NONE);return!b.success?b:d("WAResultOrError").makeResult({mode:b.value})}g.parseNewsletterReactionsModeOthersMixin=a}),98);
__d("WASmaxInNewslettersNewsletterReactionsModeOthersOrBlocklistMixinGroup",["WAResultOrError","WASmaxInNewslettersNewsletterReactionsBlocklistMixin","WASmaxInNewslettersNewsletterReactionsModeOthersMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersNewsletterReactionsModeOthersMixin").parseNewsletterReactionsModeOthersMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"NewsletterReactionsModeOthers",value:b.value});var c=d("WASmaxInNewslettersNewsletterReactionsBlocklistMixin").parseNewsletterReactionsBlocklistMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NewsletterReactionsBlocklist",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["NewsletterReactionsModeOthers","NewsletterReactionsBlocklist"],[b,c])}g.parseNewsletterReactionsModeOthersOrBlocklistMixinGroup=a}),98);
__d("WASmaxInNewslettersNewsletterReactionSettingsMixin",["WAResultOrError","WASmaxInNewslettersNewsletterReactionsModeOthersOrBlocklistMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"settings");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"reactions");if(!b.success)return b;a=d("WASmaxInNewslettersNewsletterReactionsModeOthersOrBlocklistMixinGroup").parseNewsletterReactionsModeOthersOrBlocklistMixinGroup(b.value);return!a.success?a:d("WAResultOrError").makeResult({reactionsNewsletterReactionsModeOthersOrBlocklistMixinGroup:a.value})}g.parseNewsletterReactionSettingsMixin=a}),98);
__d("WASmaxInNewslettersNewsletterSettingsMetadataMixin",["WAResultOrError","WASmaxInNewslettersNewsletterReactionSettingsMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"metadata");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"settings");if(!b.success)return b;a=d("WASmaxInNewslettersNewsletterReactionSettingsMixin").parseNewsletterReactionSettingsMixin(b.value);return d("WAResultOrError").makeResult({settingsNewsletterReactionSettingsMixin:a.success?a.value:null})}g.parseNewsletterSettingsMetadataMixin=a}),98);
__d("WASmaxInNewslettersJoinNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNewsletterMetadataMixin","WASmaxInNewslettersCommonNotificationMixin","WASmaxInNewslettersNewsletterSettingsMetadataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"join");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"metadata");if(!b.success)return b;var c=d("WASmaxInNewslettersCommonNewsletterMetadataMixin").parseCommonNewsletterMetadataMixin(b.value);if(!c.success)return c;b=d("WASmaxInNewslettersNewsletterSettingsMetadataMixin").parseNewsletterSettingsMetadataMixin(b.value);a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({joinMetadataCommonNewsletterMetadataMixin:c.value,joinMetadataNewsletterSettingsMetadataMixin:b.success?b.value:null},a.value))}g.parseJoinNotificationRequest=a}),98);
__d("WASmaxOutNewslettersJoinNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeJoinNotificationResponseAck=a}),98);
__d("WASmaxNewslettersJoinNotificationRPC",["WASmaxInNewslettersJoinNotificationRequest","WASmaxOutNewslettersJoinNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersJoinNotificationRequest").parseJoinNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("JoinNotification",{Request:b}));return{parsedRequest:b.value,makeJoinNotificationResponseAck:function(){return d("WASmaxOutNewslettersJoinNotificationResponseAck").makeJoinNotificationResponseAck(a)}}}g.receiveJoinNotificationRPC=a}),98);
__d("WAWebNewsletterHandleJoinNotification",["Promise","WALogger","WASmaxNewslettersJoinNotificationRPC","WATimeUtils","WAWebBackendApi","WAWebCreateChat","WAWebNewsletterBackendAddOnsUtils","WAWebNewsletterBackendQueues","WAWebNewsletterGatingUtils","WAWebNewsletterGetMessagesJob","WAWebNewsletterMetadataJob","WAWebNewsletterModelUtils","WAWebNewsletterStorageUtils","WAWebNewsletterSystemMessages","WAWebNewsletterUpdateMsgsRecordsJob","WAWebNewsletterUpdateNewslettersRecordsJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][join-notification] Failed process join notification ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all([d("WAWebNewsletterBackendQueues").newsletterCreationQueue.wait(),d("WAWebNewsletterBackendQueues").newsletterSubscribeQueue.wait()]);a=d("WASmaxNewslettersJoinNotificationRPC").receiveJoinNotificationRPC(a);var c=a.makeJoinNotificationResponseAck;a=a.parsedRequest;if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return c();var e=a.joinMetadataCommonNewsletterMetadataMixin;e=babelHelpers["extends"]({},e,{idJid:a.from});e=d("WAWebNewsletterModelUtils").mapNewsletterToModels(e);var f=e.chat,g=e.metadata;e=e.pic;try{yield k(f,g,e,a.from)}catch(a){d("WALogger").ERROR(i(),a).tags("newsletter").devConsole(a).sendLogs("newsletter-join-notification-fail")}return c()});return j.apply(this,arguments)}function k(a,b,c,d){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){e=(yield m({chat:a,metadata:b,newsletterJid:e}));var f=e.msgsToStore;e=e.noEarlierMsgs;yield d("WAWebNewsletterUpdateNewslettersRecordsJob").updateNewsletterChatRecords([d("WAWebCreateChat").createNewsletterObjectForStorage(a)]);yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata(d("WAWebNewsletterStorageUtils").createNewsletterMetadataObjectForStorage(b));yield d("WAWebBackendApi").frontendSendAndReceive("joinNewsletter",{newsletter:a,metadata:b,pic:c,msgs:f,noEarlierMsgs:e})});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chat,c=a.metadata;a=a.newsletterJid;try{var e=d("WAWebNewsletterSystemMessages").genNewsletterCreationSystemMessages({id:b.id,name:b.name,t:c.creationTime,role:c.membershipType});a=(yield d("WAWebNewsletterGetMessagesJob").getNewsletterMessages(a,1));var f=a.msgs;e=f.length>0?[f,!1]:[e,!0];var g=e[0];e=e[1];b.t=o(c.creationTime,g);f.length>0&&(yield d("WAWebNewsletterBackendAddOnsUtils").updateAddOnDbRecords(a));yield d("WAWebNewsletterUpdateMsgsRecordsJob").addNewsletterMsgsRecords(g);return{msgsToStore:g,noEarlierMsgs:e}}catch(a){return{msgsToStore:[],noEarlierMsgs:!1}}});return n.apply(this,arguments)}function o(a,b){return d("WATimeUtils").castToUnixTime(Math.min(Math.max((a=a)!=null?a:0,Math.max.apply(Math,b.map(function(a){return(a=a.t)!=null?a:0}))),Date.now()/1e3))}g.handleNewsletterJoinNotification=a;g.handleNewsletterJoin=k}),98);
__d("WAWebMexNewsletterJoinHandler",["WALogger","WAWebMexNewsletterParseUtils","WAWebNewsletterGatingUtils","WAWebNewsletterHandleJoinNotification","WAWebNewsletterModelUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][join]"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return;a=d("WAWebMexNewsletterParseUtils").parseMexNewsletterResponse(b.xwa2_notify_newsletter_on_join);if(a==null)throw c("err")("cannot parse xwa2_notify_newsletter_on_join response");b=d("WAWebNewsletterModelUtils").mapNewsletterToModels(a);var e=b.chat,f=b.metadata;b=b.pic;try{return yield d("WAWebNewsletterHandleJoinNotification").handleNewsletterJoin(e,f,b,a.idJid)}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-notification-join-fail")}});return i.apply(this,arguments)}g.mexHandleNewsletterJoin=a}),98);
__d("WAWebMexNewsletterLeaveHandler",["WAJids","WALogger","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterDBUtils","WAWebNewsletterDeleteChatJob","WAWebNewsletterDeleteMessageAddOns","WAWebNewsletterMetadataJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][leave]"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_newsletter_on_leave.id;if(a==null)throw c("err")("unexpected null id in xwa2_notify_newsletter_on_leave");b=d("WAJids").toNewsletterJid(a);a=d("WAWebJidToWid").newsletterJidToWid(b);if(!(yield d("WAWebNewsletterDBUtils").doesNewsletterExistInStorage(b))){d("WAWebBackendApi").frontendFireAndForget("updateNewsletterSubscriberCount",{id:a,update:{increment:-1}});return}try{yield d("WAWebNewsletterMetadataJob").deleteNewsletterMetadata(b),yield d("WAWebNewsletterDeleteMessageAddOns").deleteNewsletterMessageAddOns(b),yield d("WAWebNewsletterDeleteChatJob").deleteNewsletterChat(a),d("WAWebBackendApi").frontendFireAndForget("deleteNewsletter",{id:a,keep:!0})}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-notification-leave-fail")}});return i.apply(this,arguments)}g.mexHandleNewsletterLeave=a}),98);
__d("WAWebNewsletterMetadataUpdateUtils",["WAWebBackendApi","WAWebContactProfilePicThumbBridge","WAWebDBBulkPersistProfilePic","WAWebNewsletterMetadataJob","WAWebNewsletterStorageUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata(d("WAWebNewsletterStorageUtils").createNewsletterMetadataObjectForStorage(b));if(Object.prototype.hasOwnProperty.call(c,"eurl")){var e=d("WAWebWidFactory").createWid(c.id.toString());yield d("WAWebDBBulkPersistProfilePic").bulkPersistProfilePicChanges([d("WAWebContactProfilePicThumbBridge").mapProfilePictureToProfilePicThumbRowType(e,{id:e,tag:(e=c.tag)!=null?e:void 0,eurl:(e=c.eurl)!=null?e:void 0,previewEurl:(e=c.previewEurl)!=null?e:void 0,stale:c.stale,eurlStale:!1,timestamp:(e=c.timestamp)!=null?e:Date.now()})])}yield d("WAWebBackendApi").frontendSendAndReceive("updateNewsletterMetadata",{metadata:b,newsletter:a,pic:c})});return h.apply(this,arguments)}g.updateNewsletterMetadataAndPic=a}),98);
__d("WAWebMexNewsletterMetadataUpdateNotificationHandler",["WAJids","WALogger","WAWebApiChat","WAWebJidToWid","WAWebMexNewsletterParseUtils","WAWebNewsletterMetadataUpdateUtils","WAWebNewsletterModelUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][metadata-update] Failed to update metadata change"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_newsletter_on_metadata_update;b=a.id;if(b==null)throw c("err")("unexpected null id in xwa2_notify_newsletter_on_metadata_update");b=d("WAJids").toNewsletterJid(b);b=d("WAWebJidToWid").newsletterJidToWid(b);b=(yield d("WAWebApiChat").getChatRecord(b));if(b==null)return;b=d("WAWebMexNewsletterParseUtils").parseMexNewsletterResponse(a);if(b==null)throw c("err")("Unexpected null metadata for newsletter update notification");try{a=d("WAWebNewsletterModelUtils").mapNewsletterToModels(b);b=a.chat;var e=a.metadata;a=a.pic;yield d("WAWebNewsletterMetadataUpdateUtils").updateNewsletterMetadataAndPic(b,e,a)}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-notification-metadata-update-fail")}});return i.apply(this,arguments)}g.mexHandleNewsletterMetadataUpdate=a}),98);
__d("WAWebMexNewsletterMutedChangeHandler",["WAJids","WALogger","WAWebBackendApi","WAWebCreateChat","WAWebNewsletterMetadataQueryJob","WAWebNewsletterModelUtils","WAWebNewsletterUpdateNewslettersRecordsJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][mute-unmute]"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_newsletter_on_mute_change;b=a.id;a=a.mute;if(b==null)throw c("err")("unexpected null id in xwa2_notify_newsletter_on_mute_change");var e;switch(a){case"ON":e="on";break;case"OFF":e="off";break;default:e="undefined"}a=d("WAWebNewsletterMetadataQueryJob").emptyNewsletterMetadataType(d("WAJids").toNewsletterJid(b));b=babelHelpers["extends"]({},a,{newsletterMutedMetadataMixin:{mutedState:e}});a=d("WAWebNewsletterModelUtils").mapNewsletterToModels(b);b=a.chat;var f=a.metadata;a=a.pic;try{yield d("WAWebNewsletterUpdateNewslettersRecordsJob").updateNewsletterChatRecords([d("WAWebCreateChat").createNewsletterObjectForStorage(b)]),yield d("WAWebBackendApi").frontendSendAndReceive("updateNewsletterMetadata",{metadata:f,newsletter:b,pic:a})}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-notification-mute-unmute-fail")}});return i.apply(this,arguments)}g.mexHandleNewsletterMutedChange=a}),98);
__d("WAWebMexNewsletterOwnerNotificationHandler",["WAJids","WALogger","WAWebBackendApi","WAWebJidToWid","WAWebMexNewsletterParseUtils","WAWebNewsletterAdminNotificationJob","WAWebNewsletterGatingUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["no updates were found in xwa2_notify_newsletter_owner_on_metadata_update"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["reaction setting did not contain updated value in xwa2_notify_newsletter_owner_on_metadata_update"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["description did not contain updated value in xwa2_notify_newsletter_owner_on_metadata_update"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["name did not contain updated value in xwa2_notify_newsletter_owner_on_metadata_update"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["no user found to be making this change in xwa2_notify_newsletter_owner_on_metadata_update"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["no changes found in xwa2_notify_newsletter_owner_on_metadata_update"]);m=function(){return a};return a}function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_newsletter_owner_on_metadata_update;b=a.id;var c=a.thread_metadata;a=a.actor;if(c==null){d("WALogger").ERROR(m()).tags("mex","newsletter").sendLogs("newsletter-mex-owner-metadata-notification-no-metadata-updates");return}yield o(b,c,a);if(!d("WAWebNewsletterGatingUtils").isNewsletterMultiAdminM1ImprovementsEnabled())return;a=a==null?void 0:a.id;if(a==null){d("WALogger").ERROR(l()).tags("mex","newsletter").sendLogs("newsletter-mex-owner-metadata-notification-no-actor");return}var e=[],f=c.name,g=c.description,n=c.picture,p=c.preview;c=c.settings;(n!=null||p!=null)&&e.push({item:"profile_picture"});if(f!=null){n=f.text;n==null?d("WALogger").ERROR(k()).tags("mex","newsletter").devConsole(f).sendLogs("newsletter-mex-owner-metadata-notification-no-updated-name-value"):e.push({item:"name",value:n})}if(g!=null){p=g.text;p==null?d("WALogger").ERROR(j()).tags("mex","newsletter").devConsole(g).sendLogs("newsletter-mex-owner-metadata-notification-no-updated-name-value"):e.push({item:"description",value:p})}f=c==null?void 0:c.reaction_codes;if(c!=null&&f!=null){n=d("WAWebMexNewsletterParseUtils").toReactionCodesSettingMixin(f.value);n==null?d("WALogger").ERROR(i()).tags("mex","newsletter").devConsole(f).sendLogs("newsletter-mex-owner-metadata-notification-no-updated-name-value"):e.push({item:"reaction_setting",value:n})}if(e.length===0){d("WALogger").ERROR(h()).tags("mex","newsletter").sendLogs("newsletter-mex-owner-metadata-notification-no-updates");return}g=d("WAJids").toNewsletterJid(b);p=d("WAWebJidToWid").newsletterJidToWid(g);c=d("WAWebWidFactory").createWid(a);f={newsletterId:d("WAWebWidFactory").toNewsletterWid(p),actorId:d("WAWebWidFactory").toUserWid(c),updates:e};d("WAWebBackendApi").frontendFireAndForget("displayNewsletterMetadataUpdateNotification",{notification:f})});return n.apply(this,arguments)}function o(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(((b=b.preview)==null?void 0:b.direct_path)!==""||c!=null)return;b=d("WAJids").toNewsletterJid(a);c=d("WAWebJidToWid").newsletterJidToWid(b);yield d("WAWebNewsletterAdminNotificationJob").updateProfilePictureDeletionAlertState(b);d("WAWebBackendApi").frontendFireAndForget("updateProfilePictureDeletionAlertState",{newsletterWid:d("WAWebWidFactory").toNewsletterWid(c)})});return p.apply(this,arguments)}g.mexHandleNewsletterOwnerNotification=a}),98);
__d("WAWebMexNewsletterRoleChangeNotificationHandler",["WALogger","WAWebBackendApi","WAWebMexNewsletterUtils","WAWebNewsletterMetadataJob","WAWebNewsletterStorageUtils","WAWebNewsletterValidationUtils","WAWebUserPrefsMeUser","WAWebUserPrefsNewsletter","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][admin-","] Failed to process "," notification, error parsing jid"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][admin-","] Failed to process "," notification, null payload"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c;a=b.xwa2_notify_newsletter_admin_promote!=null?"promote":"demote";c=(c=b.xwa2_notify_newsletter_admin_promote)!=null?c:b.xwa2_notify_newsletter_admin_demote;if(c==null){d("WALogger").ERROR(i(),a,a).tags("mex","newsletter").sendLogs("mex-newsletternotification-state-change-fail");return}try{var e=d("WAWebNewsletterValidationUtils").toNewsletterJidOrThrow(c.id),f=c.user.pn;if(f==null)return;f=d("WAWebWidFactory").createWid(f);c=d("WAWebMexNewsletterUtils").mapRoleToMembership(c.user_new_role);if(c==null)return;f.equals(d("WAWebUserPrefsMeUser").getMeUser())?(yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata({id:e,membershipType:d("WAWebNewsletterStorageUtils").mapNewsletterMembershipTypeForStorage(c)}),d("WAWebBackendApi").frontendFireAndForget("handleMyRoleChangeNotification",{jid:e})):f.equals(d("WAWebUserPrefsMeUser").getMeUser())||d("WAWebBackendApi").frontendFireAndForget("handleOtherUserRoleChangeNotification",{jid:e,userId:f,newRole:c});yield d("WAWebUserPrefsNewsletter").flushCachedNewsletterSubscribers(e);d("WAWebBackendApi").frontendFireAndForget("displayRoleChangeDesktopNotification",{notification:b})}catch(b){d("WALogger").ERROR(h(),a,a).tags("mex","newsletter").devConsole(b).sendLogs("mex-newsletternotification-state-change-fail-"+a)}});return j.apply(this,arguments)}g.mexHandleNewsletterRoleChange=a}),98);
__d("WAWebMexNewsletterStateChangeHandler",["WAJids","WALogger","WAWebApiChat","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterDeleteChatJob","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataJob","WAWebNewsletterMetadataQueryJob","WAWebNewsletterModelUtils","WAWebNewsletterStorageUtils","WAWebNewsletterSystemMessages","WAWebNewsletterUpdateMsgsRecordsJob","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][state-change] Failed to update to "," state"]);h=function(){return a};return a}function i(a){switch(a){case"ACTIVE":return"active";case"SUSPENDED":return"suspended";case"GEOSUSPENDED":return"geosuspended"}}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_newsletter_on_state_change;b=a.id;var e=a.is_requestor;a=a.state;if(b==null)throw c("err")("unexpected null id in xwa2_notify_newsletter_on_state_change");b=d("WAJids").toNewsletterJid(b);var f=d("WAWebJidToWid").newsletterJidToWid(b);e=e===!0;a=a==null?void 0:a.type;var g=(yield d("WAWebApiChat").getChatRecord(f));if(g==null)return;try{switch(a){case"DELETED":return yield k(e,b,f,g.name);case"ACTIVE":case"SUSPENDED":case"GEOSUSPENDED":e=i(a);f=d("WAWebNewsletterMetadataQueryJob").emptyNewsletterMetadataType(b);g=babelHelpers["extends"]({},f,{newsletterStateMetadataMixin:{stateType:e}});b=d("WAWebNewsletterModelUtils").mapNewsletterToModels(g);f=b.chat;e=b.metadata;g=b.pic;yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata(d("WAWebNewsletterStorageUtils").createNewsletterMetadataObjectForStorage(e));if(e.suspended===!0&&d("WAWebNewsletterGatingUtils").isNewsletterDSAEnforcementSuspensionEnabled()){b=d("WAWebNux").getNewsletterAlertsBannerNuxKey(e.id.toString());d("WAWebUserPrefsNuxPreferences").resetNux(b)}yield d("WAWebBackendApi").frontendSendAndReceive("updateNewsletterMetadata",{metadata:e,newsletter:f,pic:g});break;default:b=a==null?"null or undefined":a;throw c("err")("Unexpected state change type: "+b)}}catch(b){d("WALogger").ERROR(h(),a).tags("mex","newsletter").devConsole(b).sendLogs("mex-newsletternotification-state-change-fail")}});return j.apply(this,arguments)}function k(a,b,c,d){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){return a?m(b,c):o(b,c,d)});return l.apply(this,arguments)}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("WAWebNewsletterMetadataJob").deleteNewsletterMetadata(a.toString()),yield d("WAWebNewsletterDeleteChatJob").deleteNewsletterChat(b),yield d("WAWebNewsletterMetadataJob").deleteNewsletterPicture(a.toString()),yield d("WAWebBackendApi").frontendSendAndReceive("deleteNewsletter",{id:b,keep:!0})});return n.apply(this,arguments)}function o(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c=d("WAWebNewsletterSystemMessages").genNewsletterDeletionSystemMessages({id:a,name:c});yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata({id:a,terminated:!0});yield d("WAWebNewsletterUpdateMsgsRecordsJob").addNewsletterMsgsRecords(c);yield d("WAWebBackendApi").frontendSendAndReceive("terminateNewsletter",{id:b,msgs:c})});return p.apply(this,arguments)}g.mexHandleNewsletterStateChange=a}),98);
__d("WAWebMexTextStatusUpdateNotificationHandler",["WALogger","WAWebContactTextStatusBridge","WAWebSchemaContact","WAWebTextStatusGatingUtils","WAWebTextStatusParseUtils","WAWebUpdateTextStatusForContact","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][textStatus][notification][side-sub] Could not find side contact hash for text status update side sub operation"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][textStatus][notification][text-status-update] Failed to update text status change"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_text_status_on_update;b=a.jid;if(!d("WAWebTextStatusGatingUtils").receiveTextStatusEnabled())return;if(b==null)throw c("err")("unexpected null id in xwa2_notify_text_status_on_update");a=d("WAWebTextStatusParseUtils").parseTextStatusServerResponse(a);try{void d("WAWebUpdateTextStatusForContact").updateTextStatusForContact(d("WAWebWidFactory").createWid(b),a.textStatusString,a.textStatusEmoji,a.textStatusEphemeralDuration,a.textStatusLastUpdateTime)}catch(a){d("WALogger").ERROR(i()).tags("mex").devConsole(a).sendLogs("mex-text-status-notification-update-fail")}});return j.apply(this,arguments)}function e(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_text_status_on_update_side_sub;b=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],a.hash));if(b.length===0)d("WALogger").WARN(h());else{a=d("WAWebWidFactory").createWid(b[0].id);b=b[0].textStatusLastUpdateTime;return d("WAWebContactTextStatusBridge").getTextStatus(a,b).then(function(a){var b=a.text,c=a.emoji,e=a.ephemeralDurationSeconds,f=a.lastUpdateTime;a=a.id;return d("WAWebUpdateTextStatusForContact").updateTextStatusForContact(a,b,c,e,f)})}});return k.apply(this,arguments)}g.mexHandleTextStatusUpdate=a;g.mexHandleTextStatusUpdateSideSub=e}),98);
__d("WAWebMexUsernameUpdateNotificationHandler",["Promise","WALogger","WAWebChatCollection","WAWebContactSystemMsg","WAWebHandleSingleMsg","WAWebQueryExistsJob","WAWebSchemaContact","WAWebSetUsernameJob","WAWebUsernameGatingUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["could not find side contact hash for username change notification."]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][username][notification][username-change-side-subscriber] Received username change notification for side subscriber"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][username][notification][username-delete] Received username delete notification"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][username][notification][username-set] Received username change notification"]);l=function(){return a};return a}function a(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(!d("WAWebUsernameGatingUtils").usernameDisplayedEnabled())return;d("WALogger").LOG(l());a=c.xwa2_notify_username_on_change;c=a.username;a=a.lid;a=d("WAWebWidFactory").createUserWid(a);yield (h||(h=b("Promise"))).all([d("WAWebSetUsernameJob").setUsernamesJob([{userId:a,username:c}]),p(a,c)])});return m.apply(this,arguments)}function c(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(!d("WAWebUsernameGatingUtils").usernameDisplayedEnabled())return;d("WALogger").LOG(k());a=c.xwa2_notify_username_delete;c=a.lid;a=a.display_name;c=d("WAWebWidFactory").createUserWid(c);yield (h||(h=b("Promise"))).all([d("WAWebSetUsernameJob").deleteUsernamesJob([{userId:c,displayNameLID:a}]),p(c,"")])});return n.apply(this,arguments)}function e(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(!d("WAWebUsernameGatingUtils").usernameDisplayedEnabled())return;d("WALogger").LOG(j());a=c.xwa2_notify_username_on_update_side_sub.hash;c=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],a));if(c.length===0){d("WALogger").WARN(i());return}c=d("WAWebWidFactory").createUserWid((a=c[0])==null?void 0:a.id);a=(yield d("WAWebQueryExistsJob").queryWidUsernameExists(c));if(a!=null){a=a.username;yield (h||(h=b("Promise"))).all([p(c,(c=a)!=null?c:"")])}});return o.apply(this,arguments)}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=d("WAWebChatCollection").ChatCollection.get(a);if(c!=null){c=d("WAWebContactSystemMsg").genUsernameChangeSystemMsg(a,b);yield d("WAWebHandleSingleMsg").handleSingleMsg(a,c,"username_change_notification")}});return q.apply(this,arguments)}g.mexHandleUsernameChange=a;g.mexHandleUsernameDelete=c;g.mexHandleUsernameChangeForSideSub=e}),98);
__d("WAWebHandleMexNotification",["Promise","WADeprecatedWapParser","WALogger","WAParsableWapNode","WAWap","WAWebMexGroupPropertyUpdateNotificationHandler","WAWebMexNewsletterAdminInviteRevokeNotificationHandler","WAWebMexNewsletterAdminNotificationHandler","WAWebMexNewsletterJoinHandler","WAWebMexNewsletterLeaveHandler","WAWebMexNewsletterMetadataUpdateNotificationHandler","WAWebMexNewsletterMutedChangeHandler","WAWebMexNewsletterOwnerNotificationHandler","WAWebMexNewsletterRoleChangeNotificationHandler","WAWebMexNewsletterStateChangeHandler","WAWebMexRelayEnvironmentV2","WAWebMexTextStatusUpdateNotificationHandler","WAWebMexUsernameUpdateNotificationHandler","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][notification] handle MexNotificationEvent"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][notification][error]"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][notification] handled ",""]);k=function(){return a};return a}var l="mexNotificationParser",m=new(c("WADeprecatedWapParser"))(l,function(a){a.assertTag("notification");a.assertAttr("type","mex");var b=a.child("update"),c=a.attrString("id");a=a.attrWapJid("from");var e=b.attrString("op_name");b=b.contentString();var f;try{f=JSON.parse(b)}catch(a){throw new(d("WAParsableWapNode").XmppParsingFailure)(l,"JSON parsing error: "+a)}return{stanzaId:c,from:a,OperationName:e,mexResponse:f}});function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=m.parseOrThrow(a);try{var c=(yield o(b));d("WALogger").DEV(k(),b.OperationName).tags("mex").devConsole(c,b);return c}catch(c){d("WALogger").ERROR(j()).tags("mex","notification").devConsole(a,c).sendLogs("mex-notification-error-"+b.OperationName);if(c instanceof d("WAParsableWapNode").XmppParsingFailure)throw c;throw new(d("WAParsableWapNode").XmppParsingFailure)(l,"unexpected error: "+c)}});return n.apply(this,arguments)}function o(a){switch(a.OperationName){case"MexNotificationEvent":return p(a,s);case"NotificationNewsletterMuteChange":return p(a,d("WAWebMexNewsletterMutedChangeHandler").mexHandleNewsletterMutedChange);case"NotificationNewsletterJoin":return p(a,d("WAWebMexNewsletterJoinHandler").mexHandleNewsletterJoin);case"NotificationNewsletterLeave":return p(a,d("WAWebMexNewsletterLeaveHandler").mexHandleNewsletterLeave);case"NotificationNewsletterStateChange":return p(a,d("WAWebMexNewsletterStateChangeHandler").mexHandleNewsletterStateChange);case"NotificationNewsletterAdminMetadataUpdate":return p(a,d("WAWebMexNewsletterAdminNotificationHandler").mexHandleNewsletterAdminNotification);case"NotificationNewsletterOwnerUpdate":return p(a,d("WAWebMexNewsletterOwnerNotificationHandler").mexHandleNewsletterOwnerNotification);case"NotificationNewsletterUpdate":return p(a,d("WAWebMexNewsletterMetadataUpdateNotificationHandler").mexHandleNewsletterMetadataUpdate);case"NotificationNewsletterAdminPromote":return p(a,d("WAWebMexNewsletterRoleChangeNotificationHandler").mexHandleNewsletterRoleChange);case"NotificationNewsletterAdminDemote":return p(a,d("WAWebMexNewsletterRoleChangeNotificationHandler").mexHandleNewsletterRoleChange);case"NotificationNewsletterAdminInviteRevoke":return p(a,d("WAWebMexNewsletterAdminInviteRevokeNotificationHandler").handleNewsletterAdminInviteRevoke);case"TextStatusUpdateNotification":return p(a,d("WAWebMexTextStatusUpdateNotificationHandler").mexHandleTextStatusUpdate);case"TextStatusUpdateNotificationSideSub":return p(a,d("WAWebMexTextStatusUpdateNotificationHandler").mexHandleTextStatusUpdateSideSub);case"NotificationGroupPropertyUpdate":return p(a,d("WAWebMexGroupPropertyUpdateNotificationHandler").mexHandleGroupPropertyUpdate);case"UsernameChangeNotification":return p(a,d("WAWebMexUsernameUpdateNotificationHandler").mexHandleUsernameChange);case"UsernameDeleteNotification":return p(a,d("WAWebMexUsernameUpdateNotificationHandler").mexHandleUsernameDelete);case"UsernameChangeNotificationSideSub":return p(a,d("WAWebMexUsernameUpdateNotificationHandler").mexHandleUsernameChangeForSideSub);default:return(h||(h=b("Promise"))).reject(new(d("WAParsableWapNode").XmppParsingFailure)(l,"no concrete handler for: "+a.OperationName))}}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.mexResponse,e=d("WAWebMexRelayEnvironmentV2").parseFatalExtensionError(c.errors);if(e!=null)throw new(d("WAParsableWapNode").XmppParsingFailure)(l,"errors list in parsed json has fatal error");if(c.data!=null){yield b(a.from,c.data);return r(a.stanzaId,a.from)}throw new(d("WAParsableWapNode").XmppParsingFailure)(l,"null data in parsed json")});return q.apply(this,arguments)}function r(a,b){return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),to:b,"class":"notification",type:"mex"})}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").DEV(i()).tags("mex").devConsole(a,b)});return t.apply(this,arguments)}g.handleMexNotification=a}),98);
__d("WASmaxInNewslettersDeleteNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNotificationMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"delete");if(!b.success)return b;b=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"is_sender","true");if(!b.success)return b;a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({isSender:b.value},a.value))}g.parseDeleteNotificationRequest=a}),98);
__d("WASmaxOutNewslettersDeleteNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeDeleteNotificationResponseAck=a}),98);
__d("WASmaxNewslettersDeleteNotificationRPC",["WASmaxInNewslettersDeleteNotificationRequest","WASmaxOutNewslettersDeleteNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersDeleteNotificationRequest").parseDeleteNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("DeleteNotification",{Request:b}));return{parsedRequest:b.value,makeDeleteNotificationResponseAck:function(){return d("WASmaxOutNewslettersDeleteNotificationResponseAck").makeDeleteNotificationResponseAck(a)}}}g.receiveDeleteNotificationRPC=a}),98);
__d("WAWebNewsletterDeleteNotification",["WALogger","WASmaxNewslettersDeleteNotificationRPC","WAWebApiChat","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterBackendQueues","WAWebNewsletterDeleteChatJob","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataJob","WAWebNewsletterSystemMessages","WAWebNewsletterUpdateMsgsRecordsJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][metadata-notification] Failed to update the db records"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebNewsletterBackendQueues").newsletterDeleteQueue.wait();a=d("WASmaxNewslettersDeleteNotificationRPC").receiveDeleteNotificationRPC(a);var b=a.makeDeleteNotificationResponseAck;a=a.parsedRequest;var c=a.from,e=d("WAWebJidToWid").newsletterJidToWid(c),f=(yield d("WAWebApiChat").getChatRecord(e));if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled()||f==null)return b();try{a=a.isSender==="true";if(a){yield d("WAWebNewsletterMetadataJob").deleteNewsletterMetadata(c.toString());yield d("WAWebNewsletterDeleteChatJob").deleteNewsletterChat(e);yield d("WAWebNewsletterMetadataJob").deleteNewsletterPicture(c.toString());yield d("WAWebBackendApi").frontendSendAndReceive("deleteNewsletter",{id:e,keep:!1});return b()}a=d("WAWebNewsletterSystemMessages").genNewsletterDeletionSystemMessages({id:c,name:f.name});yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata({id:c,terminated:!0});yield d("WAWebNewsletterUpdateMsgsRecordsJob").addNewsletterMsgsRecords(a);yield d("WAWebBackendApi").frontendSendAndReceive("terminateNewsletter",{id:e,msgs:a})}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-delete-notification-db-fail")}return b()});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInNewslettersAdminNotificationGeosuspendedStateMixinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"country");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"iso_code");return!b.success?b:d("WAResultOrError").makeResult({isoCode:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"admin");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"geosuspended");if(!b.success)return b;a=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"country",1,250,h);return!a.success?a:d("WAResultOrError").makeResult({geosuspendedCountry:a.value})}g.parseAdminNotificationGeosuspendedStateMixinGeosuspendedCountry=h;g.parseAdminNotificationGeosuspendedStateMixinMixin=a}),98);
__d("WASmaxInNewslettersAdminNotificationGeounsuspendedStateMixinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"country");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"iso_code");return!b.success?b:d("WAResultOrError").makeResult({isoCode:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"admin");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"geounsuspended");if(!b.success)return b;a=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"country",1,250,h);return!a.success?a:d("WAResultOrError").makeResult({geounsuspendedCountry:a.value})}g.parseAdminNotificationGeounsuspendedStateMixinGeounsuspendedCountry=h;g.parseAdminNotificationGeounsuspendedStateMixinMixin=a}),98);
__d("WASmaxInNewslettersAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup",["WAResultOrError","WASmaxInNewslettersAdminNotificationGeosuspendedStateMixinMixin","WASmaxInNewslettersAdminNotificationGeounsuspendedStateMixinMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersAdminNotificationGeosuspendedStateMixinMixin").parseAdminNotificationGeosuspendedStateMixinMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AdminNotificationGeosuspendedStateMixin",value:b.value});var c=d("WASmaxInNewslettersAdminNotificationGeounsuspendedStateMixinMixin").parseAdminNotificationGeounsuspendedStateMixinMixin(a);return c.success?d("WAResultOrError").makeResult({name:"AdminNotificationGeounsuspendedStateMixin",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["AdminNotificationGeosuspendedStateMixin","AdminNotificationGeounsuspendedStateMixin"],[b,c])}g.parseAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup=a}),98);
__d("WASmaxInNewslettersAdminGeosuspendNotificationPayloadMixin",["WAResultOrError","WASmaxInNewslettersAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"admin");if(!b.success)return b;b=d("WASmaxInNewslettersAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup").parseAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({adminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup:b.value})}g.parseAdminGeosuspendNotificationPayloadMixin=a}),98);
__d("WASmaxInNewslettersAdminNotificationRequest",["WAResultOrError","WASmaxInNewslettersAdminGeosuspendNotificationPayloadMixin","WASmaxInNewslettersCommonNotificationMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"admin");if(!b.success)return b;b=d("WASmaxInNewslettersAdminGeosuspendNotificationPayloadMixin").parseAdminGeosuspendNotificationPayloadMixin(b.value);a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({adminAdminGeosuspendNotificationPayloadMixin:b.success?b.value:null},a.value))}g.parseAdminNotificationRequest=a}),98);
__d("WASmaxOutNewslettersAdminNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeAdminNotificationResponseAck=a}),98);
__d("WASmaxNewslettersAdminNotificationRPC",["WASmaxInNewslettersAdminNotificationRequest","WASmaxOutNewslettersAdminNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersAdminNotificationRequest").parseAdminNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("AdminNotification",{Request:b}));return{parsedRequest:b.value,makeAdminNotificationResponseAck:function(){return d("WASmaxOutNewslettersAdminNotificationResponseAck").makeAdminNotificationResponseAck(a)}}}g.receiveAdminNotificationRPC=a}),98);
__d("WAWebNewsletterHandleAdminNotification",["WALogger","WASmaxNewslettersAdminNotificationRPC","WAWebBackendApi","WAWebCountriesNativeCountryNames","WAWebJidToWid","WAWebNewsletterAdminNotificationJob","WAWebNewsletterGatingUtils","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][admin-notification] Failed to update the db records"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxNewslettersAdminNotificationRPC").receiveAdminNotificationRPC(a);var b=a.makeAdminNotificationResponseAck;a=a.parsedRequest;if(!d("WAWebNewsletterGatingUtils").isNewsletterGeosuspendAdminAlertsEnabled())return b();var e=a.from,f=d("WAWebJidToWid").newsletterJidToWid(e);try{a=(a=a.adminAdminGeosuspendNotificationPayloadMixin)==null?void 0:a.adminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup;if(a==null)return b();switch(a.name){case"AdminNotificationGeosuspendedStateMixin":var g=a.value;g=g.geosuspendedCountry.map(function(a){a=a.isoCode;return a in c("WAWebCountriesNativeCountryNames")?a:null}).filter(Boolean);if(g.length>0){yield d("WAWebNewsletterAdminNotificationJob").updateGeosuspendedCountry(e,g,!0);d("WAWebBackendApi").frontendFireAndForget("updateGeosuspendedCountry",{id:f,countryCodes:g,toAdd:!0});g=d("WAWebNux").getNewsletterAlertsBannerNuxKey(e);d("WAWebUserPrefsNuxPreferences").resetNux(g)}break;case"AdminNotificationGeounsuspendedStateMixin":g=a.value;a=g.geounsuspendedCountry.map(function(a){a=a.isoCode;return a in c("WAWebCountriesNativeCountryNames")?a:null}).filter(Boolean);a.length>0&&(yield d("WAWebNewsletterAdminNotificationJob").updateGeosuspendedCountry(e,a,!1),d("WAWebBackendApi").frontendFireAndForget("updateGeosuspendedCountry",{id:f,countryCodes:a,toAdd:!1}));break}}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-admin-notification-db-fail")}return b()});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInNewslettersLeaveNotificationRequest",["WASmaxInNewslettersCommonNotificationMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"leave");if(!b.success)return b;b=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!b.success?b:b}g.parseLeaveNotificationRequest=a}),98);
__d("WASmaxOutNewslettersLeaveNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeLeaveNotificationResponseAck=a}),98);
__d("WASmaxNewslettersLeaveNotificationRPC",["WASmaxInNewslettersLeaveNotificationRequest","WASmaxOutNewslettersLeaveNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersLeaveNotificationRequest").parseLeaveNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("LeaveNotification",{Request:b}));return{parsedRequest:b.value,makeLeaveNotificationResponseAck:function(){return d("WASmaxOutNewslettersLeaveNotificationResponseAck").makeLeaveNotificationResponseAck(a)}}}g.receiveLeaveNotificationRPC=a}),98);
__d("WAWebNewsletterHandleLeaveNotification",["WALogger","WASmaxNewslettersLeaveNotificationRPC","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterDBUtils","WAWebNewsletterDeleteChatJob","WAWebNewsletterDeleteMessageAddOns","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][leave-notification] Failed to update the db"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxNewslettersLeaveNotificationRPC").receiveLeaveNotificationRPC(a);var b=a.makeLeaveNotificationResponseAck;a=a.parsedRequest;a=a.from;if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return b();var c=d("WAWebJidToWid").newsletterJidToWid(a);if(!(yield d("WAWebNewsletterDBUtils").doesNewsletterExistInStorage(a))){d("WAWebBackendApi").frontendFireAndForget("updateNewsletterSubscriberCount",{id:c,update:{increment:-1}});return b()}try{yield d("WAWebNewsletterMetadataJob").deleteNewsletterMetadata(a),yield d("WAWebNewsletterDeleteMessageAddOns").deleteNewsletterMessageAddOns(a),yield d("WAWebNewsletterDeleteChatJob").deleteNewsletterChat(c),d("WAWebBackendApi").frontendFireAndForget("deleteNewsletter",{id:c,keep:!0})}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-leave-notification-db-fail")}return b()});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInNewslettersLiveUpdatesNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNotificationMixin","WASmaxInNewslettersNewsletterMessageResponsePayloadMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"live_updates");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"messages");if(!b.success)return b;b=d("WASmaxInNewslettersNewsletterMessageResponsePayloadMixin").parseNewsletterMessageResponsePayloadMixin(b.value);if(!b.success)return b;a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({liveUpdatesMessagesNewsletterMessageResponsePayloadMixin:b.value},a.value))}g.parseLiveUpdatesNotificationRequest=a}),98);
__d("WASmaxOutNewslettersLiveUpdatesNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeLiveUpdatesNotificationResponseAck=a}),98);
__d("WASmaxNewslettersLiveUpdatesNotificationRPC",["WASmaxInNewslettersLiveUpdatesNotificationRequest","WASmaxOutNewslettersLiveUpdatesNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersLiveUpdatesNotificationRequest").parseLiveUpdatesNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("LiveUpdatesNotification",{Request:b}));return{parsedRequest:b.value,makeLiveUpdatesNotificationResponseAck:function(){return d("WASmaxOutNewslettersLiveUpdatesNotificationResponseAck").makeLiveUpdatesNotificationResponseAck(a)}}}g.receiveLiveUpdatesNotificationRPC=a}),98);
__d("WAWebNewsletterHandleLiveUpdatesNotification",["WALogger","WANullthrows","WASmaxNewslettersLiveUpdatesNotificationRPC","WAWebBackendApi","WAWebNewsletterBackendAddOnsUtils","WAWebNewsletterGatingUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][live-updates-notification] Failed to handle the notification"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[liveUpdate] start"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(i());a=d("WASmaxNewslettersLiveUpdatesNotificationRPC").receiveLiveUpdatesNotificationRPC(a);var b=a.makeLiveUpdatesNotificationResponseAck;a=a.parsedRequest;try{if(!d("WAWebNewsletterGatingUtils").isNewsletterReactionEnabled())return b();var e=a.liveUpdatesMessagesNewsletterMessageResponsePayloadMixin.message,f=a.from;a=a.t;e=(yield d("WAWebNewsletterBackendAddOnsUtils").getMsgsAndAddOnsFromUpdates(e,d("WAWebWidFactory").createWid(c("WANullthrows")(f)),a));yield d("WAWebNewsletterBackendAddOnsUtils").updateAddOnDbRecords(babelHelpers["extends"]({},e,{timestamp:a}));d("WAWebBackendApi").frontendFireAndForget("updateNewsletterMessages",e);return b()}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-live-updates-db");return b()}});return j.apply(this,arguments)}g.handleNewsletterLiveUpdatesNotification=a}),98);
__d("WASmaxInNewslettersSetMetadataNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNewsletterMetadataMixin","WASmaxInNewslettersCommonNotificationMixin","WASmaxInNewslettersNewsletterSettingsMetadataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"metadata");if(!b.success)return b;var c=d("WASmaxInNewslettersCommonNewsletterMetadataMixin").parseCommonNewsletterMetadataMixin(b.value);if(!c.success)return c;b=d("WASmaxInNewslettersNewsletterSettingsMetadataMixin").parseNewsletterSettingsMetadataMixin(b.value);a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({metadataCommonNewsletterMetadataMixin:c.value,metadataNewsletterSettingsMetadataMixin:b.success?b.value:null},a.value))}g.parseSetMetadataNotificationRequest=a}),98);
__d("WASmaxOutNewslettersSetMetadataNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeSetMetadataNotificationResponseAck=a}),98);
__d("WASmaxNewslettersSetMetadataNotificationRPC",["WASmaxInNewslettersSetMetadataNotificationRequest","WASmaxOutNewslettersSetMetadataNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersSetMetadataNotificationRequest").parseSetMetadataNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SetMetadataNotification",{Request:b}));return{parsedRequest:b.value,makeSetMetadataNotificationResponseAck:function(){return d("WASmaxOutNewslettersSetMetadataNotificationResponseAck").makeSetMetadataNotificationResponseAck(a)}}}g.receiveSetMetadataNotificationRPC=a}),98);
__d("WAWebNewsletterHandleMetadataNotification",["WALogger","WASmaxNewslettersSetMetadataNotificationRPC","WAWebCreateChat","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataUpdateUtils","WAWebNewsletterModelUtils","WAWebNewsletterUpdateNewslettersRecordsJob","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][metadata-notification] Failed to process metadata notification: ",""]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxNewslettersSetMetadataNotificationRPC").receiveSetMetadataNotificationRPC(a);var b=a.makeSetMetadataNotificationResponseAck;a=a.parsedRequest;if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return b();a=babelHelpers["extends"]({},a.metadataCommonNewsletterMetadataMixin,{idJid:a.from,newsletterCreationTimeMetadataMixin:null});a=d("WAWebNewsletterModelUtils").mapNewsletterToModels(a);var c=a.chat,e=a.metadata;a=a.pic;try{yield d("WAWebNewsletterUpdateNewslettersRecordsJob").updateNewsletterChatRecords([d("WAWebCreateChat").createNewsletterObjectForStorage(c)]);yield d("WAWebNewsletterMetadataUpdateUtils").updateNewsletterMetadataAndPic(c,e,a);if(e.suspended===!0&&d("WAWebNewsletterGatingUtils").isNewsletterDSAEnforcementSuspensionEnabled()){c=d("WAWebNux").getNewsletterAlertsBannerNuxKey(e.id.toString());d("WAWebUserPrefsNuxPreferences").resetNux(c)}}catch(a){d("WALogger").ERROR(h(),a).tags("newsletter").devConsole(a).sendLogs("newsletter-metadata-notification-fail")}return b()});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebNewsletterNotificationQueue",["WAPromiseQueue"],(function(a,b,c,d,e,f,g){a=new(d("WAPromiseQueue").PromiseQueueMap)();g["default"]=a}),98);
__d("WAWebHandleNewsletterNotification",["$InternalEnum","WADeprecatedWapParser","WALogger","WAParsableWapNode","WAWebNewsletterDeleteNotification","WAWebNewsletterHandleAdminNotification","WAWebNewsletterHandleJoinNotification","WAWebNewsletterHandleLeaveNotification","WAWebNewsletterHandleLiveUpdatesNotification","WAWebNewsletterHandleMessageDeliveryUpdateNotification","WAWebNewsletterHandleMetadataNotification","WAWebNewsletterNotificationQueue","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][notification] Failed to parse notification"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][notification] Unexpected from "]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][notification] Failed to cast ",""]);j=function(){return a};return a}var k=b("$InternalEnum")({Join:"join",Metadata:"metadata",Leave:"leave",Delete:"delete",LiveUpdates:"live_updates",MessageDeliveryUpdates:"message_delivery_updates",Admin:"admin"}),l=new(c("WADeprecatedWapParser"))("incomingNewsletterNotificationParser",function(a){var b=a.mapFirstChild(function(a){return a.tag()}),e=k.cast(b),f=a.attrFromJid();if(e==null){d("WALogger").ERROR(j(),b).tags("newsletter").devConsole(a,b).sendLogs("newsletter-failed-to-cast-notification");throw c("err")("Failed to cast "+b)}if(f.type!=="newsletter"){d("WALogger").ERROR(i()).tags("newsletter").devConsole(f).sendLogs("newsletter-wrong-notification-sender-type-"+f.type);throw c("err")("Unexpected from "+f.type)}return{firstChildTag:e,from:f.newsletterJid}});function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var b=l.parseOrThrow(a),e=b.firstChildTag;b=b.from;return yield c("WAWebNewsletterNotificationQueue").enqueue(b,function(){switch(e){case k.Join:return d("WAWebNewsletterHandleJoinNotification").handleNewsletterJoinNotification(a);case k.Metadata:return c("WAWebNewsletterHandleMetadataNotification")(a);case k.Leave:return c("WAWebNewsletterHandleLeaveNotification")(a);case k.Delete:return c("WAWebNewsletterDeleteNotification")(a);case k.LiveUpdates:return d("WAWebNewsletterHandleLiveUpdatesNotification").handleNewsletterLiveUpdatesNotification(a);case k.MessageDeliveryUpdates:return d("WAWebNewsletterHandleMessageDeliveryUpdateNotification").handleNewsletterMessageDeliveryUpdateNotification(a);case k.Admin:return c("WAWebNewsletterHandleAdminNotification")(a)}})}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("failed-to-parse-newsletter-notification");throw new(d("WAParsableWapNode").XmppParsingFailure)("incomingNewsletterNotificationParser",a instanceof Error?a.name:typeof a+" was thrown rather than an Error")}});return m.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandlePairDevice",["Promise","WABinary","WALogger","WAShiftTimer","WASmaxMdSetToCompanionRPC","WAWebAdvSignatureApi","WAWebConnModel","WAWebNetworkStatus","WAWebSocketConstants","WAWebSocketModel","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePairDevice: error: ",""]);i=function(){return a};return a}var j=60*1e3,k=20*1e3,l=[],m=null;function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c;try{c=d("WASmaxMdSetToCompanionRPC").receiveSetToCompanionRPC(a)}catch(a){d("WALogger").ERROR(i(),a.toString());return(h||(h=b("Promise"))).reject(a)}a=c;var e=a.parsedRequest;a=a.makeSetToCompanionResponseClientResponse;e=e.pairDeviceRef.map(function(a){a=new(d("WABinary").Binary)(a.elementValue);return a.readString(a.size())});void o(e);return a()});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebAdvSignatureApi").generateADVSecretKey(),l=a,m||(m=new(d("WAShiftTimer").ShiftTimer)(function(){if(d("WAWebUserPrefsMultiDevice").isRegistered()||!c("WAWebNetworkStatus").online)m&&m.cancel(),m=null;else if(!l||!l.length)m&&m.cancel(),m=null,d("WAWebSocketModel").Socket.state=d("WAWebSocketConstants").SOCKET_STATE.UNPAIRED_IDLE;else{var a=l.length===6?j:k,b=l.shift();d("WAWebConnModel").Conn.set({ref:b,refTTL:a});d("WAWebSocketModel").Socket.state=d("WAWebSocketConstants").SOCKET_STATE.UNPAIRED;m&&m.onOrAfter(a)}})),m.forceRunNow()});return p.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandlePairSuccess",["invariant","Promise","WABase64","WABinary","WACryptoHmac","WALogger","WANullthrows","WAQplTypes","WASmaxMdSetRegRPC","WATimeUtils","WAWebAdvSignatureApi","WAWebAltDeviceLinkingApi","WAWebBizAgentAction","WAWebBizCoexGatingUtils","WAWebCompanionRegUtils","WAWebConnModel","WAWebCryptoCurve25519","WAWebE2ETestPairingConstants","WAWebJidToWid","WAWebLocalStorage","WAWebLogoutReasonConstants","WAWebMobilePlatforms","WAWebProtobufsAdv.pb","WAWebSignalCommonUtils","WAWebSignalStoreApi","WAWebSocketLogoutJob","WAWebUserPrefsHistorySync","WAWebUserPrefsMeUser","WAWebUserPrefsMultiDevice","WAWebWamDeviceLinkReporter","WAWebWamEnumMdLinkDeviceCompanionStage","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf","gkx"],(function(a,b,c,d,e,f,g,h){var i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error in handlePairSuccess, ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);l=function(){return a};return a}var m=!1;function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){c("gkx")("26256")&&(c("WAWebLocalStorage")==null?void 0:c("WAWebLocalStorage").removeItem(d("WAWebE2ETestPairingConstants").PAIRING_ATTEMPT_ONGOING_KEY));if(m||d("WAWebUserPrefsMultiDevice").isRegistered())return;m=!0;var e=d("WATimeUtils").unixTimeWithoutClockSkewCorrection(),f=null;try{f=d("WASmaxMdSetRegRPC").receiveSetRegRPC(a)}catch(c){d("WALogger").DEV(l(),a.toString());d("WALogger").ERROR(k(),c.toString());m=!1;return(i||(i=b("Promise"))).reject(c)}a=f;f=a.parsedRequest;var g=a.makeSetRegResponseClientResponse;a=a.makeSetRegResponseError;try{d("WAWebCompanionRegUtils").resetCompanionReg();d("WAWebUserPrefsMultiDevice").setPairingTimestamp(e);if(d("WAWebAltDeviceLinkingApi").getPairingType()===d("WAWebAltDeviceLinkingApi").PairingType.ALT_DEVICE_LINKING){var n;(n=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:n.addPoint("alt_linking_pair_success");(n=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:n.end(d("WAQplTypes").QuickLogActionType.SUCCESS)}n=f.pairSuccessDeviceJid;var o=f.pairSuccessDeviceIdentityElementValue,p=f.pairSuccessPlatformName;f=f.pairSuccessDeviceLid;d("WAWebConnModel").Conn.blockStoreAdds=!1;d("WAWebConnModel").Conn.platform=p;yield d("WAWebMobilePlatforms").setMobilePlatform(p);d("WAWebUserPrefsMeUser").setMe(d("WAWebJidToWid").deviceJidToDeviceWid(n));f!=null&&d("WAWebUserPrefsMeUser").setMeLid(d("WAWebJidToWid").deviceJidToDeviceWid(f));p=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentityHMACSpec,o);f=p.details;o=p.hmac;f!=null&&o!=null||h(0,56299);var q=new(d("WABinary").Binary)(f).readByteArray();d("WAWebBizCoexGatingUtils").smbHostedPrimaryPairingAllowed()&&(p.accountType===d("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(yield d("WAWebUserPrefsMultiDevice").setIsHostedMeAccount(),q=d("WABinary").Binary.build(d("WAWebAdvSignatureApi").ADV_HOSTED_PREFIX_DEVICE_IDENTITY_ACCOUNT_SIGNATURE,c("WANullthrows")(f)).readByteArray()));p=(yield d("WAWebAdvSignatureApi").getADVSecretKey());p=(yield d("WACryptoHmac").hmacSha256(p,q));q=d("WABase64").encodeB64(p);p=d("WABase64").encodeB64(o);if(q!==p){d("WAWebCompanionRegUtils").logoutAfterValidationFail();m=!1;return a()}o=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentitySpec,f);q=o.accountSignatureKey;q!=null||h(0,56344);p=o.accountSignature;p!=null||h(0,56295);f=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo());f!=null||h(0,56296);yield d("WAWebWamDeviceLinkReporter").initDeviceLinkEvent(q,f.identityKeyPair.pubKey,e);yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.PAIR_SUCCESS_RECEIVED);d("WAWebCompanionRegUtils").initDevicePairingLatencyMeasurement();p=d("WAWebAdvSignatureApi").verifyDeviceIdentityAccountSignature(o,f.identityKeyPair.pubKey,null);if(!p){yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent(401);d("WAWebCompanionRegUtils").logoutAfterValidationFail();m=!1;return a()}o.deviceSignature=(yield d("WAWebAdvSignatureApi").generateDeviceSignature(o,f.identityKeyPair,q));yield d("WAWebSignalStoreApi").waSignalStore.putIdentity(d("WAWebSignalCommonUtils").createSignalAddress(d("WAWebWidFactory").toUserWid(d("WAWebJidToWid").deviceJidToDeviceWid(n))).toString(),d("WAWebSignalCommonUtils").bufferToStr(d("WAWebCryptoCurve25519").toSignalCurvePubKey(q)));yield d("WAWebAdvSignatureApi").setADVSignedIdentity(o);p=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVDeviceIdentitySpec,o.details);a=p.keyIndex;a!=null||h(0,56297);o.accountSignatureKey=void 0;f=d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentitySpec,o).readByteArray();n=g({deviceIdentityElementValue:f,deviceIdentityKeyIndex:a});yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.PAIR_DEVICE_SIGN_SENT);q=(yield d("WAWebUserPrefsHistorySync").getInitialHistorySyncComplete());q!==!0&&d("WAWebCompanionRegUtils").startInitialHistorySyncTimeout();m=!1;d("WAWebBizAgentAction").setShouldLogAgentLogin({loginTimestamp:e});return n}catch(a){d("WALogger").ERROR(j(),a).verbose().devConsole(a).sendLogs("error in handlePairSuccess"),yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent(-1),yield d("WAWebSocketLogoutJob").socketLogout(d("WAWebLogoutReasonConstants").LogoutReason.UnknownCompanion)}});return n.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandlePreKeyLow",["WADeprecatedWapParser","WALogger","WAWap","WAWebEventsWaitForOfflineDeliveryEnd","WAWebSignalStoreApi","WAWebUploadPreKeysJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePreKeyLow: Parsing Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePreKeyLow: error while parsing: ",""]);i=function(){return a};return a}var j=new Set(),k=new(c("WADeprecatedWapParser"))("lowKeyParser",function(a){a.assertTag("notification");a.assertAttr("type","encrypt");a.assertFromServer();return{stanzaId:a.attrString("id"),numRemaining:a.child("count").attrInt("value")}});function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=k.parse(a);if(c.error){d("WALogger").DEV(i(),a.toString());d("WALogger").ERROR(h(),c.error.toString());throw c.error}else{a=c.success;var e=d("WAWap").wap("ack",{to:d("WAWap").S_WHATSAPP_NET,id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification"});if(j.has(b))return e;j.add(b);d("WAWebSignalStoreApi").waSignalStore.setServerHasPreKeys(!1);yield d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd();return d("WAWebUploadPreKeysJob").uploadPreKeys().then(function(){return e})["finally"](function(){return void j["delete"](b)})}});return l.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInPresenceEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={deny:"deny",error:"error",none:"none"};b={validators:[d("WAJids").validateGroupJid,d("WAJids").validateUserJid],typeName:"GroupJid|UserJid"};g.ENUM_DENY_ERROR_NONE=a;g.GROUPJID_USERJID=b}),98);
__d("WASmaxInPresenceAvailableMixin",["WAResultOrError","WASmaxInPresenceEnums","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"presence");if(!b.success)return b;b=d("WASmaxParseJid").attrJidEnum(a,"from",d("WASmaxInPresenceEnums").GROUPJID_USERJID);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"type","available");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"last");return!a.success?a:d("WAResultOrError").makeResult({from:b.value,type:c.value,last:a.value})}g.parseAvailableMixin=a}),98);
__d("WASmaxInPresenceLastSeenWithOtherValueMixin",["WAResultOrError","WASmaxInPresenceEnums","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"presence");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"from");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","unavailable");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"last",d("WASmaxInPresenceEnums").ENUM_DENY_ERROR_NONE);return!a.success?a:d("WAResultOrError").makeResult({from:b.value,type:c.value,last:a.value})}g.parseLastSeenWithOtherValueMixin=a}),98);
__d("WASmaxInPresenceUserUnavailableMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"presence");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"from");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","unavailable");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"last");return!a.success?a:d("WAResultOrError").makeResult({from:b.value,type:c.value,last:a.value})}g.parseUserUnavailableMixin=a}),98);
__d("WASmaxInPresenceAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup",["WAResultOrError","WASmaxInPresenceAvailableMixin","WASmaxInPresenceLastSeenWithOtherValueMixin","WASmaxInPresenceUserUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPresenceAvailableMixin").parseAvailableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"Available",value:b.value});var c=d("WASmaxInPresenceLastSeenWithOtherValueMixin").parseLastSeenWithOtherValueMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"LastSeenWithOtherValue",value:c.value});var e=d("WASmaxInPresenceUserUnavailableMixin").parseUserUnavailableMixin(a);return e.success?d("WAResultOrError").makeResult({name:"UserUnavailable",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["Available","LastSeenWithOtherValue","UserUnavailable"],[b,c,e])}g.parseAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup=a}),98);
__d("WASmaxInPresenceServerUpdateRequest",["WAResultOrError","WASmaxInPresenceAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"presence");if(!b.success)return b;b=d("WASmaxInPresenceAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup").parseAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({availableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup:b.value})}g.parseServerUpdateRequest=a}),98);
__d("WASmaxPresenceServerUpdateRPC",["WASmaxInPresenceServerUpdateRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInPresenceServerUpdateRequest").parseServerUpdateRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ServerUpdate",{Request:a}));return{parsedRequest:a.value}}g.receiveServerUpdateRPC=a}),98);
__d("WAWebHandlePresence",["Promise","WALogger","WASmaxPresenceServerUpdateRPC","WATimeUtils","WAWebChangePresenceHandlerAction","WAWebJidToWid"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(a){if(a!=null){if(!["deny","none","error"].includes(a))return d("WATimeUtils").castToUnixTime(Number(a))}else return d("WATimeUtils").unixTime()}function a(a){try{var e=d("WASmaxPresenceServerUpdateRPC").receiveServerUpdateRPC(a);e=e.parsedRequest.availableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup;e={id:d("WAWebJidToWid").chatJidToChatWid(e.value.from),type:e.value.type||"available",deny:e.value.last==="deny"||void 0,t:e.value.type==="unavailable"?k(e.value.last):void 0};return c("WAWebChangePresenceHandlerAction")(e)}catch(c){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),c.toString());return(h||(h=b("Promise"))).reject(c)}}g["default"]=a}),98);
__d("WAWebSetTcTokenChatAction",["WAArrayBufferUtils","WAWebApiOrphanTcToken","WAWebChatGetExistingBridge","WAWebSchemaChat","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(c==null)return;if(!a.isUserNotPSA())return;var e=(yield d("WAWebChatGetExistingBridge").getExisting(a));if(e==null){yield d("WAWebApiOrphanTcToken").createOrUpdateOrphanTcToken(a.toString(),{tcToken:c,tcTokenTimestamp:b});return}if(e.tcToken!=null&&d("WAArrayBufferUtils").arrayBuffersEqualUNSAFE(e.tcToken,c)||e.tcTokenTimestamp!=null&&e.tcTokenTimestamp>b)return;c={tcToken:c,tcTokenTimestamp:b};e.set(c);yield d("WAWebSchemaChat").getChatTable().merge(a.toString(),c)});return h.apply(this,arguments)}g.setTcToken=a}),98);
__d("WAWebHandlePrivacyTokensNotification",["Promise","WAByteArray","WADeprecatedWapParser","WALogger","WAWap","WAWebApiChat","WAWebEventsWaitForOfflineDeliveryEnd","WAWebJidToWid","WAWebPnhGatingUtils","WAWebPresenceCollection","WAWebSetTcTokenChatAction","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Privacy Tokens notification received, node: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["incomingPrivacyTokensParser - receiving an unknown token: ",""]);l=function(){return a};return a}var m=function(a){var b=d("WAByteArray").uint8ArrayToBuffer(a.contentBytes());return{type:"trusted_contact",content:b,ts:a.attrTime("t")}},n=new(c("WADeprecatedWapParser"))("incomingPrivacyTokensParser",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrUserJid("from");a=a.child("tokens");var e=[];a.forEachChildWithTag("token",function(a){var b=a.attrString("type");switch(b){case"trusted_contact":e.push(m(a));break;default:d("WALogger").LOG(l(),b)}});return{id:b,from:c,privacyTokens:e}});function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.ts;a=d("WAWebJidToWid").userJidToUserWid(a.from);b.type==="trusted_contact"&&(d("WAWebPnhGatingUtils").isMatFullyEnabled()&&a.isUser()&&(a=d("WAWebWidFactory").toUserWid(yield d("WAWebApiChat").getMatChatIncomingMessage(a))),yield d("WAWebSetTcTokenChatAction").setTcToken(a,c,b.content),yield d("WAWebPresenceCollection").PresenceCollection.reSubscribeWhenActive(a))});return p.apply(this,arguments)}function a(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(k(),a);var c=n.parse(a);if(c.error){d("WALogger").LOG(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());throw c.error}var e=c.success;a=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e.id),"class":"notification",to:d("WAWap").JID(e.from),type:"privacy_token"});yield d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd();yield (h||(h=b("Promise"))).all(e.privacyTokens.map(function(a){return o(e,a)}));return a});return q.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleProfilePicNotification",["Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebBackendJobsCommon","WAWebChangeProfilePicThumb","WAWebCommsWapMd","WAWebGroupSystemMsg","WAWebHandleSingleMsg","WAWebJidToWid","WAWebOrchestratorNonPersistedJob","WAWebProfilePicConstants","WAWebSchemaContact","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid type received"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["could not find side contact hash for profile pic update operation"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);l=function(){return a};return a}var m=new(c("WADeprecatedWapParser"))("incomingProfilePicNotificationParser",function(a){a.assertTag("notification");var b,c;if(a.hasChild("delete"))b="delete",c=a.child("delete");else if(a.hasChild("set"))b="set",c=a.child("set");else if(a.hasChild("request"))b="request",c=a.child("request"),c.assertAttr("jid",d("WAWebUserPrefsMeUser").assertGetMe().toJid());else return a["throw"]("Expected child type to be one of: set, delete, request");var e=a.attrString("id");return c.hasAttr("jid")?{type:b,from:d("WAWebJidToWid").chatJidToChatWid(a.attrChatJid("from")),jid:d("WAWebJidToWid").chatJidToChatWid(c.attrChatJid("jid")),author:c.hasAttr("author")?d("WAWebJidToWid").userJidToUserWid(c.attrUserJid("author")):null,ts:a.attrTime("t"),rawTs:a.attrString("t"),stanzaId:e,picId:b==="set"?c.attrInt("id",1):0}:{from:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("from")),jid:null,type:b,hash:c.attrString("hash"),ts:a.attrTime("t"),stanzaId:e}});function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=m.parse(a);if(c.error){d("WALogger").DEV(l(),a.toString());d("WALogger").ERROR(k(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}var e=c.success;a=(h||(h=b("Promise"))).resolve();if(e.jid||e.hash){var f;if(e.jid)f=e.jid;else{c=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],e.hash));c.length===0?d("WALogger").WARN(j()):f=d("WAWebWidFactory").createWid(c[0].id)}switch(e.type){case"delete":case"set":var g=e.type==="delete"?d("WAWebProfilePicConstants").ProfilePicCommand.Remove:d("WAWebProfilePicConstants").ProfilePicCommand.Set;f&&(a=d("WAWebChangeProfilePicThumb").changeProfilePicThumb(f,g).then(function(){if(!f.isGroup())return;if(e.ts!=null){var a=d("WAWebGroupSystemMsg").genGroupPicChangeNotificationMsg(f,g,e.ts,e.author||d("WAWebUserPrefsMeUser").getMeUser());return d("WAWebHandleSingleMsg").handleSingleMsg(f,a,"profilePicNotification")}}));break;case"request":break;default:d("WALogger").WARN(i()).devConsole(e.type)}}return a.then(function(){return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e.stanzaId),to:d("WAWebCommsWapMd").JID(e.from),"class":"notification",type:"picture"})})});return o.apply(this,arguments)}function a(a){var b=d("WAWebBackendJobsCommon").getNonCriticalNotificationPriority(Boolean(a.attrs.offline));return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("handleProfilePicNotification",function(a){return n(a.node)},{priority:b}).waitUntilCompleted({node:a})}g.handleProfilePicNotificationJob=a}),98);
__d("WAWebRevokeStatusPsaMsgAction",["Promise","WALogger","WAWebMessageStore","WAWebStatusV3Collection","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["revokeStatusPSA completed"]);i=function(){return a};return a}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b.length>0&&(a.revokeMsgs(b),yield d("WAWebMessageStore").removeMessagesFromHistory(b),d("WALogger").LOG(i()).tags("revoke-status-psa"))});return k.apply(this,arguments)}function a(){var a=d("WAWebStatusV3Collection").StatusV3Collection.getPSAStatus();if(!a)return(h||(h=b("Promise"))).resolve();var c=a.msgs.map(function(a){return a.id.toString()});return j(a,c)}function c(a){var c=d("WAWebStatusV3Collection").StatusV3Collection.getPSAStatus();if(!c)return(h||(h=b("Promise"))).resolve();var e=c.msgs.filter(function(b){return b.campaignId===a}).map(function(a){return a.id.toString()});return j(c,e)}g.revokeAllStatusPSA=a;g.revokeStatusPSA=c}),98);
__d("WAWebHandlePsa",["$InternalEnum","Promise","WAByteArray","WADeprecatedWapParser","WAJids","WALogger","WAWap","WAWebABProps","WAWebBackendJobs.flow","WAWebCommsWapMd","WAWebHandleMsgProcess","WAWebHandleMsgTypes.flow","WAWebJidToWid","WAWebRevokeStatusPsaMsgAction","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["PSA notification received, node: ",""]);k=function(){return a};return a}var l=b("$InternalEnum")({Image:"image",Video:"video",Text:"text"}),m=new(c("WADeprecatedWapParser"))("incomingCampaignParser",function(a){a.assertTag("notification");a.assertAttr("from",d("WAJids").STATUS_JID);var b=a.attrString("id"),c=d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("participant")),e=a.attrTime("t");a=a.child("campaign");var f=a.hasChild("revoke"),g=a.attrString("id"),h=a.maybeAttrInt("duration");a=a.mapChildrenWithTag("message",function(a){var b=a.child("media");b.attrEnumValues("mediatype",l.members());a={id:a.attrString("id"),ts:e,body:d("WAByteArray").uint8ArrayToBuffer(b.contentBytes())};return a});return{participant:c,stanzaId:b,campaignId:g,campaignDuration:h,revoke:f,ts:e,messages:a}});function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.participant,e=a.campaignId;a=a.campaignDuration;var f=b.id,g=b.ts;b=b.body;f={type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_STATUS,externalId:f,ts:g,edit:-1,isHsm:!1,count:null,chat:d("WAWebWidFactory").createWid(d("WAJids").STATUS_JID),author:c,pushname:null,isDirect:!1,campaignId:e,campaignDuration:a};g={retryCount:0,e2eType:d("WAWebBackendJobs.flow").CiphertextType.Msg,encMediaType:d("WAWebBackendJobs.flow").EncMediaType.Image,hideFail:!1};c={nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null,campaignId:null};yield d("WAWebHandleMsgProcess").processDecryptedMessageProto({decrypted:b,info:f,e2eInfo:g,bizInfo:c,hsmInfo:null,isPadded:!1})});return o.apply(this,arguments)}function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(k(),a);var c=m.parse(a);if(c.error){d("WALogger").LOG(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());throw c.error}var e=c.success;a=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e.stanzaId),participant:d("WAWebCommsWapMd").JID(e.participant),"class":"notification",type:"psa",to:d("WAWebCommsWapMd").JID(d("WAWebWidFactory").createWid(d("WAJids").STATUS_JID))});if(!d("WAWebABProps").getABPropConfigValue("web_status_psa"))return a;e.revoke?yield d("WAWebRevokeStatusPsaMsgAction").revokeStatusPSA(e.campaignId):yield (h||(h=b("Promise"))).all(e.messages.map(function(a){return n(e,a)}));return a});return p.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInQpSurfacesEnums",[],(function(a,b,c,d,e,f){a={"false":"false","true":"true"};f.ENUM_FALSE_TRUE=a}),66);
__d("WASmaxInQpSurfacesQPSurfacesMixin",["WAResultOrError","WASmaxInQpSurfacesEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"trigger");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");return!b.success?b:d("WAResultOrError").makeResult({name:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"header");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"title");return!b.success?b:d("WAResultOrError").makeResult({title:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"light");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytes(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"dark");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytes(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"image");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"light",j);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"dark",k);if(!c.success)return c;a=d("WASmaxParseUtils").attrString(a,"description");return!a.success?a:d("WAResultOrError").makeResult({description:a.value,light:b.value,dark:c.value})}function m(a){var b=d("WASmaxParseUtils").assertTag(a,"primary_action");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"universal_link");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"deep_link");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,universalLink:c.value,deepLink:a.value})}function n(a){var b=d("WASmaxParseUtils").assertTag(a,"secondary_action");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"universal_link");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"deep_link");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,universalLink:c.value,deepLink:a.value})}function o(a){var b=d("WASmaxParseUtils").assertTag(a,"colors");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"light");if(!b.success)return b;a=d("WASmaxParseUtils").flattenedChildWithTag(a,"dark");if(!a.success)return a;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"background");if(!c.success)return c;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"highlight");if(!b.success)return b;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a.value,"background");if(!e.success)return e;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a.value,"highlight");return!a.success?a:d("WAResultOrError").makeResult({lightBackground:c.value,lightHighlight:b.value,darkBackground:e.value,darkHighlight:a.value})}function p(a){var b=d("WASmaxParseUtils").assertTag(a,"attribute");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"key");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");return!a.success?a:d("WAResultOrError").makeResult({key:b.value,value:a.value})}function q(a){var b=d("WASmaxParseUtils").assertTag(a,"content_attributes");if(!b.success)return b;b=d("WASmaxParseUtils").mapChildrenWithTag(a,"attribute",0,50,p);return!b.success?b:d("WAResultOrError").makeResult({attribute:b.value})}function r(a){var b=d("WASmaxParseUtils").assertTag(a,"filter_rules");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytes(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function s(a){var b=d("WASmaxParseUtils").assertTag(a,"instance_log_data");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytes(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function t(a){var b=d("WASmaxParseUtils").assertTag(a,"promotion_config");if(!b.success)return b;b=d("WASmaxParseUtils").attrInt(a,"max_impressions");if(!b.success)return b;var c=d("WASmaxParseUtils").attrInt(a,"max_primary_clicks");if(!c.success)return c;var e=d("WASmaxParseUtils").attrInt(a,"max_secondary_clicks");if(!e.success)return e;a=d("WASmaxParseUtils").attrInt(a,"max_dismisses");return!a.success?a:d("WAResultOrError").makeResult({maxImpressions:b.value,maxPrimaryClicks:c.value,maxSecondaryClicks:e.value,maxDismisses:a.value})}function u(a){var b=d("WASmaxParseUtils").assertTag(a,"user_info");if(!b.success)return b;b=d("WASmaxParseUtils").attrInt(a,"impression_count");if(!b.success)return b;var c=d("WASmaxParseUtils").attrInt(a,"primary_click_count");if(!c.success)return c;var e=d("WASmaxParseUtils").attrInt(a,"secondary_click_count");if(!e.success)return e;a=d("WASmaxParseUtils").attrInt(a,"dismiss_click_count");return!a.success?a:d("WAResultOrError").makeResult({impressionCount:b.value,primaryClickCount:c.value,secondaryClickCount:e.value,dismissClickCount:a.value})}function v(a){var b=d("WASmaxParseUtils").assertTag(a,"pacing");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"promotion_config",t);if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(a,"user_info",u);return!a.success?a:d("WAResultOrError").makeResult({promotionConfig:b.value,userInfo:a.value})}function w(a){var b=d("WASmaxParseUtils").assertTag(a,"promotion");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"title");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a,"text");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(a,"qp_config");if(!e.success)return e;var f=d("WASmaxParseUtils").flattenedChildWithTag(e.value,"triggers");if(!f.success)return f;var g=d("WASmaxParseUtils").optionalChildWithTag(a,"header",i);if(!g.success)return g;var j=d("WASmaxParseUtils").optionalChildWithTag(a,"image",l);if(!j.success)return j;var k=d("WASmaxParseUtils").optionalChildWithTag(a,"primary_action",m);if(!k.success)return k;var p=d("WASmaxParseUtils").optionalChildWithTag(a,"secondary_action",n);if(!p.success)return p;var t=d("WASmaxParseUtils").optionalChildWithTag(a,"colors",o);if(!t.success)return t;var u=d("WASmaxParseUtils").optionalChildWithTag(a,"content_attributes",q);if(!u.success)return u;var w=d("WASmaxParseUtils").optionalChildWithTag(e.value,"filter_rules",r);if(!w.success)return w;var x=d("WASmaxParseUtils").optionalChildWithTag(e.value,"instance_log_data",s);if(!x.success)return x;var y=d("WASmaxParseUtils").optionalChildWithTag(e.value,"pacing",v);if(!y.success)return y;var z=d("WASmaxParseUtils").attrString(a,"id");if(!z.success)return z;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"instance_id");if(!a.success)return a;b=d("WASmaxParseUtils").contentString(b.value);if(!b.success)return b;c=d("WASmaxParseUtils").contentString(c.value);if(!c.success)return c;var A=d("WASmaxParseUtils").attrString(e.value,"template_name");if(!A.success)return A;var B=d("WASmaxParseUtils").attrInt(e.value,"start_time_seconds");if(!B.success)return B;var C=d("WASmaxParseUtils").attrInt(e.value,"end_time_seconds");if(!C.success)return C;var D=d("WASmaxParseUtils").attrInt(e.value,"ttl_seconds");if(!D.success)return D;var E=d("WASmaxParseUtils").attrStringEnum(e.value,"dismissable",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!E.success)return E;var F=d("WASmaxParseUtils").attrStringEnum(e.value,"force_pass",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!F.success)return F;var G=d("WASmaxParseUtils").attrInt(e.value,"surface_delay_time_seconds");if(!G.success)return G;var H=d("WASmaxParseUtils").attrStringEnum(e.value,"deterministic",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!H.success)return H;var I=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,e.value,"experiment_key");if(!I.success)return I;var J=d("WASmaxParseUtils").attrStringEnum(e.value,"exposure_holdout",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!J.success)return J;var K=d("WASmaxParseUtils").attrInt(e.value,"max_impressions");if(!K.success)return K;var L=d("WASmaxParseUtils").attrInt(e.value,"impression_cooldown");if(!L.success)return L;var M=d("WASmaxParseUtils").attrInt(e.value,"eligibility_duration_ms");if(!M.success)return M;var N=d("WASmaxParseUtils").attrInt(e.value,"priority");if(!N.success)return N;e=d("WASmaxParseUtils").attrStringEnum(e.value,"log_eligibility_waterfall",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!e.success)return e;f=d("WASmaxParseUtils").mapChildrenWithTag(f.value,"trigger",1,50,h);return!f.success?f:d("WAResultOrError").makeResult({id:z.value,instanceId:a.value,titleElementValue:b.value,textElementValue:c.value,qpConfigTemplateName:A.value,qpConfigStartTimeSeconds:B.value,qpConfigEndTimeSeconds:C.value,qpConfigTtlSeconds:D.value,qpConfigDismissable:E.value,qpConfigForcePass:F.value,qpConfigSurfaceDelayTimeSeconds:G.value,qpConfigDeterministic:H.value,qpConfigExperimentKey:I.value,qpConfigExposureHoldout:J.value,qpConfigMaxImpressions:K.value,qpConfigImpressionCooldown:L.value,qpConfigEligibilityDurationMs:M.value,qpConfigPriority:N.value,qpConfigLogEligibilityWaterfall:e.value,header:g.value,image:j.value,primaryAction:k.value,secondaryAction:p.value,colors:t.value,contentAttributes:u.value,qpConfigFilterRules:w.value,qpConfigInstanceLogData:x.value,qpConfigPacing:y.value,qpConfigTriggersTrigger:f.value})}function x(a){var b=d("WASmaxParseUtils").assertTag(a,"surface");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"id");if(!b.success)return b;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"promotion",0,100,w);return!a.success?a:d("WAResultOrError").makeResult({id:b.value,promotion:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"surfaces");if(!b.success)return b;b=d("WASmaxParseUtils").mapChildrenWithTag(a,"surface",0,100,x);return!b.success?b:d("WAResultOrError").makeResult({surface:b.value})}g.parseQPSurfacesSurfacePromotionQpConfigTriggersTrigger=h;g.parseQPSurfacesSurfacePromotionHeader=i;g.parseQPSurfacesSurfacePromotionImageLight=j;g.parseQPSurfacesSurfacePromotionImageDark=k;g.parseQPSurfacesSurfacePromotionImage=l;g.parseQPSurfacesSurfacePromotionPrimaryAction=m;g.parseQPSurfacesSurfacePromotionSecondaryAction=n;g.parseQPSurfacesSurfacePromotionColors=o;g.parseQPSurfacesSurfacePromotionContentAttributesAttribute=p;g.parseQPSurfacesSurfacePromotionContentAttributes=q;g.parseQPSurfacesSurfacePromotionQpConfigFilterRules=r;g.parseQPSurfacesSurfacePromotionQpConfigInstanceLogData=s;g.parseQPSurfacesSurfacePromotionQpConfigPacingPromotionConfig=t;g.parseQPSurfacesSurfacePromotionQpConfigPacingUserInfo=u;g.parseQPSurfacesSurfacePromotionQpConfigPacing=v;g.parseQPSurfacesSurfacePromotion=w;g.parseQPSurfacesSurface=x;g.parseQPSurfacesMixin=a}),98);
__d("WASmaxInQpSurfacesServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInQpSurfacesQPNotificationRequest",["WAResultOrError","WASmaxInQpSurfacesQPSurfacesMixin","WASmaxInQpSurfacesServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"surfaces");if(!b.success)return b;var c=d("WASmaxParseJid").attrUserJid(a,"from");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","psa");if(!e.success)return e;b=d("WASmaxInQpSurfacesQPSurfacesMixin").parseQPSurfacesMixin(b.value);if(!b.success)return b;a=d("WASmaxInQpSurfacesServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,type:e.value,surfacesQPSurfacesMixin:b.value},a.value))}g.parseQPNotificationRequest=a}),98);
__d("WASmaxOutQpSurfacesNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrUserJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").USER_JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutQpSurfacesQPNotificationResponseAck",["WASmaxJsx","WASmaxOutQpSurfacesNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutQpSurfacesNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeQPNotificationResponseAck=a}),98);
__d("WASmaxQpSurfacesQPNotificationRPC",["WASmaxInQpSurfacesQPNotificationRequest","WASmaxOutQpSurfacesQPNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInQpSurfacesQPNotificationRequest").parseQPNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("QPNotification",{Request:b}));return{parsedRequest:b.value,makeQPNotificationResponseAck:function(){return d("WASmaxOutQpSurfacesQPNotificationResponseAck").makeQPNotificationResponseAck(a)}}}g.receiveQPNotificationRPC=a}),98);
__d("WAWebParseQPSurfacesNotification",["WALogger","WASmaxQpSurfacesQPNotificationRPC","WATimeUtils","WAWebProtobufsQuickPromotionSurfaces.pb","decodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["loadQuickPromotions: Malformed filter rules node. Skipping the promotion"]);h=function(){return a};return a}function a(a){a=d("WASmaxQpSurfacesQPNotificationRPC").receiveQPNotificationRPC(a);var b=a.parsedRequest;a=a.makeQPNotificationResponseAck;var c=b.surfacesQPSurfacesMixin;b=b.t;c=c.surface;c=c.map(function(a){var b=a.promotion.reduce(function(a,b){var c=b.qpConfigFilterRules;if(c==null){b.qpConfigFilterRules;var e=babelHelpers.objectWithoutPropertiesLoose(b,["qpConfigFilterRules"]);a.push(e);return a}try{e=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterClauseSpec,c.elementValue);b.qpConfigFilterRules;c=babelHelpers.objectWithoutPropertiesLoose(b,["qpConfigFilterRules"]);b=babelHelpers["extends"]({},c,{qpConfigFilterRules:e});a.push(b)}catch(a){d("WALogger").WARN(h())}return a},[]);return{id:a.id,promotions:b}});return{surfaces:c,ts:d("WATimeUtils").castToUnixTime(b),makeAck:a}}g.parseQPSurfacesNotification=a}),98);
__d("WAWebHandleQPSurfacesNotification",["WALogger","WAWebBizGatingUtils","WAWebCTWAConstants","WAWebJobUpdateQPSurfaces","WAWebParseQPSurfacesNotification","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleQPSurfacesNotification: skipping QP surface ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleQPSurfacesNotification: unknown QP surface ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAWebParseQPSurfacesNotification").parseQPSurfacesNotification(a);var b=a.surfaces,c=a.makeAck;a=a.ts;c=c();if(!d("WAWebBizGatingUtils").qpSDKProcessingEnabled())return c;var e;d("WAWebBizGatingUtils").qpGraphQLEnabled()?e=b.filter(function(a){var b=d("WAWebCTWAConstants").KNOWN_QP_SURFACES.get(a.id);if(b==null){d("WALogger").WARN(i(),a.id);return!1}b=!d("WAWebBizGatingUtils").qpSurfaceIdsUsingGraphQL().has(b);b||d("WALogger").WARN(h(),a.id);return b}):e=b;yield d("WAWebJobUpdateQPSurfaces").updateQPSurfacesFromNotification(e,a);return c});return j.apply(this,arguments)}g.handleQPSurfacesNotification=a}),98);
__d("WAWebProcessRetryKeyBundle",["WALogger","WAWebAddonRetryRequestUtils","WAWebApiMessageInfoStore","WAWebApiParticipantStore","WAWebChatCollection","WAWebDBMessageSerialization","WAWebE2eRetryRejectWamEvent","WAWebMsgKey","WAWebMsgModel","WAWebMsgType","WAWebSchemaMessage","WAWebSendMsgTypes","WAWebSendStatusGatingUtils","WAWebSignal","WAWebUserPrefsMeUser","WAWebUserPrefsStatus","WAWebWamEnumDeviceType","WAWebWamEnumRetryRejectReason","WAWebWamMsgUtils","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateLocalSession: delete local session due to same base key"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateLocalSession: delete session because reg does not match, saved: ",", received: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateLocalSession: retryCount: ",", offline: ",", has keyBundle: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: update local session with the retry key bundle"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: update local session with the retry key bundle"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: delete session because reg does not match, saved: ",", received: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: missing session for retry"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: skip due to missing key bundle"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgIfAuthorized: ",", "," retry eligibility ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgIfAuthorized: msg missing rowId ","."]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgIfAuthorized: can not find msg ","."]);r=function(){return a};return a}function a(a,b,c,d,e){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var h=d("WAWebUserPrefsMeUser").getMaybeMeLidUser(),i=d("WAWebUserPrefsMeUser").getMeUser();h=e.isLid()&&h!=null?h:i;i=new(c("WAWebMsgKey"))({id:a,remote:b,fromMe:!0,participant:b.isUser()?void 0:h});var j;b=(yield d("WAWebAddonRetryRequestUtils").getSentAddonMsgRecord(i));if(b!=null)h=g==null?void 0:g.sentAddonRowId,j=b.selfMsgRow.rowId,b={type:d("WAWebSendMsgTypes").SendMessageRecordType.Addon,data:b.msgData};else{var k=(yield d("WAWebSchemaMessage").getMessageTable().get(String(i)));if(!k){d("WALogger").WARN(r(),i.toString());return null}h=g==null?void 0:g.rowId;j=k.type===d("WAWebMsgType").MSG_TYPE.REVOKED?k.protocolMessageRowId:k.rowId;g=new(d("WAWebMsgModel").Msg)(d("WAWebDBMessageSerialization").messageFromDbRow(k));b={type:d("WAWebSendMsgTypes").SendMessageRecordType.Message,data:g}}if(j==null){d("WALogger").WARN(q(),i.toString());return null}k=(yield d("WAWebApiMessageInfoStore").isRetryEligible(i,e,h,j));b.type===d("WAWebSendMsgTypes").SendMessageRecordType.Message&&(yield b.data.waitForPrep());d("WALogger").LOG(p(),a,String(e),k).tags("messaging");g=d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON.OTHER;i=!1;b.data.type===d("WAWebMsgType").MSG_TYPE.REVOKED&&(i=!0,b.data.type="protocol",b.data.subtype=b.data.subtype==="admin"?"admin_revoke":"sender_revoke");switch(k){case d("WAWebApiMessageInfoStore").RetryEligibilityResult.ELIGIBLE:return b;case d("WAWebApiMessageInfoStore").RetryEligibilityResult.INELIGIBLE_ALREADY_DELIVERED:g=d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON.DOUBLE_CHECKMARK;break;case d("WAWebApiMessageInfoStore").RetryEligibilityResult.INELIGIBLE_CHANGED_IDENTITY:g=d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON.IDENTITY_CHANGE;break;default:g=d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON.OTHER;break}new(d("WAWebE2eRetryRejectWamEvent").E2eRetryRejectWamEvent)({senderDeviceType:e.isCompanion()?d("WAWebWamEnumDeviceType").DEVICE_TYPE.COMPANION:d("WAWebWamEnumDeviceType").DEVICE_TYPE.PRIMARY,messageType:d("WAWebWamMsgUtils").getWamMessageType(b.data),msgRetryCount:f,retryRevoke:i,retryRejectReason:g}).commit();return null});return s.apply(this,arguments)}function t(a,b,c,d,e){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){if(c==null||!a||!a.key){d("WALogger").LOG(o());return!1}if(f){if(e==null){d("WALogger").LOG(n());yield d("WAWebSignal").Session.deleteRemoteInfo(b);return!1}else if(e!==c){d("WALogger").LOG(m(),e,c);yield d("WAWebSignal").Session.deleteRemoteInfo(b);return!1}d("WALogger").LOG(l());yield d("WAWebSignal").Session.createSignalSession(babelHelpers["extends"]({wid:b,regId:c},a));return!0}d("WALogger").LOG(k());yield d("WAWebSignal").Session.createSignalSession(babelHelpers["extends"]({wid:b,regId:c},a));return!0});return u.apply(this,arguments)}function e(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=e.from,g=e.keyBundle,k=e.offline,l=e.originalMsgId,m=e.participant,n=e.regId;e=e.retryCount;m=m||f;d("WALogger").LOG(j(),e,k.toString(),(!!g).toString());if(a.isGroup()){f=b("WAWebChatCollection").ChatCollection.get(a);f&&(m&&d("WAWebApiParticipantStore").markForgetSenderKey(f.id,[m]))}d("WAWebSendStatusGatingUtils").isStatusPostingEnabled()&&a.isStatusV3()&&(m&&void c("WAWebUserPrefsStatus").markForgetStatusSenderKey([m]));f=(yield d("WAWebSignal").Session.getRemoteRegId(m));if(d("WAWebWidFactory").toUserWid(m).equals(d("WAWebUserPrefsMeUser").getMeUser())&&f!==n)throw c("err")("updateLocalSession: detect registration Id change remote: "+n+", local: "+String(f)+" for peer device");a=(yield t(g,m,n,f,k));a||f!=null&&f!==n&&(d("WALogger").LOG(i(),f,n),yield d("WAWebSignal").Session.deleteRemoteSession(m));g=2;if(e===g)return d("WAWebSignal").Session.saveSessionBaseKey(m,l);else if(e>g){k=(yield d("WAWebSignal").Session.hasSameBaseKey(m,l));if(k){d("WALogger").LOG(h());return d("WAWebSignal").Session.deleteRemoteSession(m)}}});return v.apply(this,arguments)}g.getMsgIfAuthorized=a;g.processKeyBundle=t;g.updateLocalSession=e}),98);
__d("WAWebRetryRequestParser",["WADeprecatedWapParser","WAWebJidToWid","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){a=new(c("WADeprecatedWapParser"))("retryRequestParser",function(a){a.assertTag("receipt");a.assertAttr("type","retry");a.hasAttr("to")&&a.assertAttr("to",d("WAWebUserPrefsMeUser").assertGetMe().toJid());var b=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),c=a.hasAttr("participant")?d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("participant")):null,e=a.hasAttr("recipient")?d("WAWebJidToWid").deviceJidToUserWid(a.attrDeviceJid("recipient")):null,f=a.child("retry"),g=a.maybeChild("keys"),h=null;if(g!=null){var i=g.child("skey"),j=g.child("key");h={identity:g.child("identity").contentBytes(32),deviceIdentity:(g=g.maybeChild("device-identity"))==null?void 0:g.contentBytes(),skey:{id:i.child("id").contentUint(3),pubkey:i.child("value").contentBytes(32),signature:i.child("signature").contentBytes(64)},key:{id:j.child("id").contentUint(3),pubkey:j.child("value").contentBytes(32)}}}return{stanzaId:a.attrString("id"),originalMsgId:f.attrString("id"),ts:a.attrTime("t"),retryCount:f.hasAttr("count")?f.attrInt("count"):0,regId:a.child("registration").contentUint(4),offline:a.hasAttr("offline"),from:b,participant:c,recipient:e,keyBundle:h}});b=a;g["default"]=b}),98);
__d("WAWebSendRetryMsgJob",["invariant","WADeprecatedSendIq","WALogger","WAWebBotMessageSecret","WAWebCommsAckParser","WAWebOutgoingMessage","WAWebSendMsgCreateDeviceStanza","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendRetry: sending "," to ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendRetry: id "," to ",", requester: ",", count: ",""]);j=function(){return a};return a}function a(a,b,c,d,e){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){var g,k=e.data.id.id,l=b||a;g=e==null?void 0:(g=e.data)==null?void 0:g.messageSecret;g=g?new Uint8Array(yield d("WAWebBotMessageSecret").genBotMsgSecretFromMsgSecret(g)):null;d("WALogger").LOG(j(),k,a.toString(),l.toString(),f).tags("messaging");l=d("WAWebOutgoingMessage").createOutgoingMessageProtobuf(e);f={type:d("WAWebSendMsgCreateDeviceStanza").MsgType.Retry,retryCount:f};var m;a.isUser()?m=(yield d("WAWebSendMsgCreateDeviceStanza").createUserDeviceMsgStanza(a,c,e,l,f,g)):(b!=null||h(0,56263),m=(yield d("WAWebSendMsgCreateDeviceStanza").createGroupDeviceMsgStanza(a,b,e,l,f,g)));d("WALogger").LOG(i(),k,a.toString()).tags("messaging");e=b;l=a;(a==null?void 0:a.isBot())&&c!=null&&!(c==null?void 0:c.isBot())&&(e=a,c!=null||h(0,75958),l=c);return d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(m,d("WAWebCommsAckParser").toCoreAckTemplate({id:k,"class":"message",from:l,participant:e}))});return k.apply(this,arguments)}g.sendRetry=a}),98);
__d("WAWebHandleRetryRequest",["Promise","WAJids","WALogger","WAWap","WAWebApiDeviceList","WAWebCommsWapMd","WAWebManageE2ESessionsJob","WAWebMdRetryFromUnknownDeviceWamEvent","WAWebMessageThread","WAWebPostMessageHighRetryCountMetric","WAWebProcessRetryKeyBundle","WAWebRetryRequestParser","WAWebSendMsgQueueMap","WAWebSendRetryMsgJob","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebUserPrefsMeUser","WAWebWamEnumDeviceType","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest: no device "," found for "," for incoming retry request ."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest: no requester found for incoming retry request."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest: no chat found for incoming retry request."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest refusing retry attempt #",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["getActualChatId: from is a peer device, but without recipient"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMessageRetryRequest error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMessageRetryRequest "," retry not authorized"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received null stanzaID when handling message retry request"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);r=function(){return a};return a}function a(a){a=c("WAWebRetryRequestParser").parse(a);if(a.error){d("WALogger").ERROR(r(),a.error.toString());return(h||(h=b("Promise"))).reject(a.error)}var e=a.success,f=e.from,g=e.participant,i=e.recipient,j=e.retryCount;a=e.stanzaId;if(a==null){d("WALogger").WARN(q());return(h||(h=b("Promise"))).reject(c("err")("Received null stanzaID when handling message retry request"))}var k=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),to:d("WAWebCommsWapMd").JID(f),participant:g?d("WAWebCommsWapMd").DEVICE_JID(g):d("WAWap").DROP_ATTR,"class":"receipt",type:"retry"});a=v(f,i);return!a?(h||(h=b("Promise"))).resolve(k):d("WAWebMessageThread").handleMessage(String(a),!1,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield t(e));if(a==null)return k;var b=a.originalMsgId,c=a.chat,h=a.requester;a=a.identity;try{b=(yield d("WAWebProcessRetryKeyBundle").getMsgIfAuthorized(b,c,h,j,a));if(!b){d("WALogger").WARN(p(),b==null?void 0:b.type);return k}yield d("WAWebSendRetryMsgJob").sendRetry(f,g,i,b,j)}catch(a){d("WALogger").WARN(o(),a)}return k}))}function e(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield t(a));return a!=null});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.originalMsgId,e=a.from,f=a.participant,g=a.recipient,h=a.retryCount,n=a.offline;if(h>=d("WAWebPostMessageHighRetryCountMetric").MAX_RETRY){d("WALogger").LOG(m(),h);return}var o=v(e,g);if(!o){d("WALogger").WARN(l());return}var p=o.isUser()?e:f;if(!p){d("WALogger").WARN(k());return}h=p.device||0;try{g=(yield d("WAWebApiDeviceList").hasDevice(p,h));if(!g){d("WALogger").WARN(j(),h,p.user);new(d("WAWebMdRetryFromUnknownDeviceWamEvent").MdRetryFromUnknownDeviceWamEvent)({offline:n,senderType:h===d("WAJids").DEFAULT_DEVICE_ID?d("WAWebWamEnumDeviceType").DEVICE_TYPE.PRIMARY:d("WAWebWamEnumDeviceType").DEVICE_TYPE.COMPANION}).commit();return}return yield d("WAWebSendMsgQueueMap").sendMsgQueueMap.enqueue(o.toString(),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebProcessRetryKeyBundle").updateLocalSession(o,a);yield d("WAWebManageE2ESessionsJob").ensureE2ESessions([p]);var b=(yield d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().getIdentityWithRowId(d("WAWebSignalCommonUtils").createSignalAddress(p).toString()));return{originalMsgId:c,chat:o,requester:p,identity:b}}))}catch(a){d("WALogger").WARN(i(),a)}});return u.apply(this,arguments)}function v(a,b){if(a.isBot()&&b!=null)return b;if(a.isUser()){if(d("WAWebWidFactory").toUserWid(a).equals(d("WAWebUserPrefsMeUser").getMeUser())){if(!b){d("WALogger").WARN(n());return null}return b}return d("WAWebWidFactory").toUserWid(a)}return a}g.handleMessageRetryRequest=a;g.handleVoipRetryRequest=e}),98);
__d("WAWebHandleServerNotification",["$InternalEnum","Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebAbPropsSyncJob","WAWebCrashlog","WAWebUpdateServerPropsJob"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(['Unsupported notification with type "server",\n    blindly ack-ing it and doing nothing']);k=function(){return a};return a}var l=b("$InternalEnum")({LOG:"log",PROPS:"props",ABPROPS:"abprops"}),m=new(c("WADeprecatedWapParser"))("incomingServerNotificationParser",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrWapJid("from");if(a.hasChild(l.LOG))return{type:l.LOG,stanzaId:b,from:c};if(a.hasChild(l.PROPS))return{type:l.PROPS,stanzaId:b,from:c};return a.hasChild(l.ABPROPS)?{type:l.ABPROPS,stanzaId:b,from:c}:{type:null,stanzaId:b,from:c}});function n(a){var c=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification",type:"server",to:a.from});if(a.type==null){d("WALogger").WARN(k());return(h||(h=b("Promise"))).resolve(c)}switch(a.type){case l.LOG:void d("WAWebCrashlog").upload({reason:d("WAWebCrashlog").SERVER_REQUESTED,immediate:!0,isHighPri:!0});return(h||(h=b("Promise"))).resolve(c);case l.PROPS:return d("WAWebUpdateServerPropsJob").queryServerProps().then(function(){return c});case l.ABPROPS:return d("WAWebAbPropsSyncJob").syncABPropsTask(!1).then(function(){return c})}}function a(a){var c=m.parse(a);if(c.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}return n(c.success)}g.NotificationType=l;g.handleServerNotification=a}),98);
__d("WAWebHandleSuccess",["Promise","WACustomError","WADeprecatedWapParser","WALogger","WAPromiseTimeout","WAWebABPropsLocalStorage","WAWebAbPropsSyncJob","WAWebCmd","WAWebCryptoEncKeyHelper","WAWebDbEncryptionKey","WAWebMediaHosts","WAWebPageLoadLogging","WAWebPassiveModeManager","WAWebUpdateClockSkewUtils","WAWebUpdateMeLidUtils","WAWebUpdateServerPropsJob","WAWebUserPrefsGeneral","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetching mms4 hosts on startup failed: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetching mms4 hosts on startup exceeded timeout"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSuccess: failed to parse ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("successParser",function(a){a.assertTag("success");return{ts:a.attrTime("t"),propsVersion:a.attrInt("props"),companionEncStatic:a.maybeAttrString("companion_enc_static")||"NULL",lid:a.maybeAttrString("lid"),displayName:a.maybeAttrString("display_name"),abpropsRefreshId:a.maybeAttrInt("abprops")}});function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WAWebPageLoadLogging").addPageLoadQplPoint("success_received");a=l.parse(a);if(a.error){d("WALogger").ERROR(k(),a.error);return(h||(h=b("Promise"))).reject(a.error)}a=a.success;d("WAWebUpdateClockSkewUtils").updateClockSkew(a.ts);d("WAWebUpdateMeLidUtils").updateMeLid(a.lid!=null?d("WAWebWidFactory").createWid(a.lid):null);a.displayName!=null&&d("WAWebUserPrefsMeUser").setMeDisplayName(a.displayName);d("WAWebCmd").Cmd.onTemporaryBan({banned:!1});d("WAWebPassiveModeManager").PassiveTaskManager.executePassiveTasks();void d("WAWebUserPrefsGeneral").setOfflinePushDisabled(!1);var c=a.companionEncStatic;void d("WAWebDbEncryptionKey").DbEncKeyStore.generateFinalDbEncryptionAndFtsKey(c);void d("WAWebCryptoEncKeyHelper").generateFinalDbEncryptionAndFtsKeyForInvoker(c);c=(yield d("WAWebUserPrefsGeneral").getServerPropsAttributes());((c=c==null?void 0:c.version)!=null?c:-1)<a.propsVersion&&(yield d("WAWebUpdateServerPropsJob").queryServerProps());a=(c=a.abpropsRefreshId)!=null?c:0;c=d("WAWebABPropsLocalStorage").getRefreshId();if(c<a){c=d("WAWebABPropsLocalStorage").isABPropsAfterFirstSync();c&&(yield d("WAWebAbPropsSyncJob").syncABPropsTask())}yield n(1e3)});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield d("WAPromiseTimeout").promiseTimeout(d("WAWebMediaHosts").mediaHosts.forceRefresh(new AbortController().signal),a)}catch(a){a instanceof d("WACustomError").TimeoutError?d("WALogger").LOG(j()).sendLogs("mms4-fetch-host-timeout",0):d("WALogger").ERROR(i(),a).sendLogs("mms4-fetch-host-failed")}});return o.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInUsernameDisplayNameMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"display_name");return!a.success?a:d("WAResultOrError").makeResult({displayName:a.value})}g.parseDisplayNameMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationDeletedMixin",["WASmaxInUsernameDisplayNameMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"set");if(!b.success)return b;b=d("WASmaxInUsernameDisplayNameMixin").parseDisplayNameMixin(a);return!b.success?b:b}g.parseChangeNotificationDeletedMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationSetHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"set");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"hash");return!b.success?b:d("WAResultOrError").makeResult({hash:b.value})}g.parseChangeNotificationSetHashMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationSetMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"set");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseChangeNotificationSetMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup",["WAResultOrError","WASmaxInUsernameChangeNotificationDeletedMixin","WASmaxInUsernameChangeNotificationSetHashMixin","WASmaxInUsernameChangeNotificationSetMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInUsernameChangeNotificationSetMixin").parseChangeNotificationSetMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ChangeNotificationSet",value:b.value});var c=d("WASmaxInUsernameChangeNotificationSetHashMixin").parseChangeNotificationSetHashMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ChangeNotificationSetHash",value:c.value});var e=d("WASmaxInUsernameChangeNotificationDeletedMixin").parseChangeNotificationDeletedMixin(a);return e.success?d("WAResultOrError").makeResult({name:"ChangeNotificationDeleted",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["Set","SetHash","Deleted"],[b,c,e])}g.parseChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup=a}),98);
__d("WASmaxInUsernameServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationRequest",["WAResultOrError","WASmaxInUsernameChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup","WASmaxInUsernameServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"set");if(!b.success)return b;var c=d("WASmaxParseJid").attrUserJid(a,"from");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","username");if(!e.success)return e;a=d("WASmaxInUsernameServerNotificationMixin").parseServerNotificationMixin(a);if(!a.success)return a;b=d("WASmaxInUsernameChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup").parseChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,type:e.value},a.value,{setChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup:b.value}))}g.parseChangeNotificationRequest=a}),98);
__d("WASmaxOutUsernameNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrUserJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").USER_JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutUsernameChangeNotificationResponseAck",["WASmaxJsx","WASmaxOutUsernameNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutUsernameNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeChangeNotificationResponseAck=a}),98);
__d("WASmaxUsernameChangeNotificationRPC",["WASmaxInUsernameChangeNotificationRequest","WASmaxOutUsernameChangeNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInUsernameChangeNotificationRequest").parseChangeNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ChangeNotification",{Request:b}));return{parsedRequest:b.value,makeChangeNotificationResponseAck:function(){return d("WASmaxOutUsernameChangeNotificationResponseAck").makeChangeNotificationResponseAck(a)}}}g.receiveChangeNotificationRPC=a}),98);
__d("WAWebHandleUsernameChangeNotification",["WALogger","WASmaxUsernameChangeNotificationRPC","WAWebChatCollection","WAWebContactSystemMsg","WAWebHandleSingleMsg","WAWebQueryExistsJob","WAWebSchemaContact","WAWebSetUsernameJob","WAWebUsernameGatingUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["could not find side contact hash for username change notification."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleUsernameChangeNotification: received username change notification for ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxUsernameChangeNotificationRPC").receiveChangeNotificationRPC(a);var b=a.makeChangeNotificationResponseAck;a=a.parsedRequest;var c=a.setChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup.value,e,f=c==null?void 0:c.hash,g;d("WALogger").LOG(i(),e);if(!d("WAWebUsernameGatingUtils").usernameDisplayedEnabled())return b();if(f!=null){f=(yield k(f));f!=null&&(g=f==null?void 0:f.newUsername,e=f.wid)}else e=d("WAWebWidFactory").createUserWid(a.from),g=c==null?void 0:c.elementValue,yield d("WAWebSetUsernameJob").setUsernamesJob([{userId:e,username:g}]);if(e!=null){f=d("WAWebChatCollection").ChatCollection.get(e);if(f!=null){a=d("WAWebContactSystemMsg").genUsernameChangeSystemMsg(e,g);yield d("WAWebHandleSingleMsg").handleSingleMsg(e,a,"username_change_notification")}}return b()});return j.apply(this,arguments)}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],a));if(a.length===0){d("WALogger").WARN(h());return}a=d("WAWebWidFactory").createUserWid((a=a[0])==null?void 0:a.id);var b=(yield d("WAWebQueryExistsJob").queryWidUsernameExists(a));return{newUsername:b==null?void 0:b.username,wid:a}});return l.apply(this,arguments)}g.handleUsernameChangeNotification=a}),98);
__d("WAWebIncomingOfferNoticeVoipHandlerAction",["WALogger","WATimeUtils","WAWebCallCollection","WAWebCmd","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handleIncomingCallOfferNotice: Ignoring stale offer_notice"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handleIncomingCallOfferNotice: callId ",""]);i=function(){return a};return a}var j=45;function a(a,b,e,f,g){d("WALogger").LOG(i(),b);if(d("WATimeUtils").unixTime()-e>j){d("WALogger").LOG(h());return}c("WAWebCallCollection").add({id:b,isVideo:f,isGroup:g,offerTime:e,canHandleLocally:!1,peerJid:a,isSilenced:!1},{merge:!0});d("WAWebCmd").Cmd.alertCall(d("WAWebWidFactory").toUserWid(a),b,f,g,!1,!1);self.setTimeout(function(){d("WAWebCmd").Cmd.cancelCall(a);var e=c("WAWebCallCollection").get(b);e&&c("WAWebCallCollection").remove(e)},j*1e3)}g["default"]=a}),98);
__d("WAWebHandleVoipOfferNotice",["Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebCommsWapMd","WAWebIncomingOfferNoticeVoipHandlerAction","WAWebJidToWid"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("callOfferNoticeParser",function(a){a.assertTag("call");var b=a.attrString("id"),c=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),e=a.child("offer_notice"),f=d("WAWebJidToWid").deviceJidToDeviceWid(e.attrDeviceJid("call-creator")),g=e.attrString("call-id"),h=e.attrString("type");e=e.attrString("media");a=a.attrTime("t");return{stanzaId:b,fromWid:c,callCreator:f,callId:g,isGroup:h==="group",isVideo:e==="video",t:a}});function a(a){var e=k.parse(a);if(e.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),e.error.toString());return(h||(h=b("Promise"))).resolve("NO_ACK")}a=e.success;e=a.stanzaId;var f=a.fromWid,g=a.callCreator,l=a.callId,m=a.isGroup,n=a.isVideo;a=a.t;c("WAWebIncomingOfferNoticeVoipHandlerAction")(g,l,a,n,m);return(h||(h=b("Promise"))).resolve(d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").JID(f),id:d("WAWap").CUSTOM_STRING(e),"class":"call",type:d("WAWap").CUSTOM_STRING("offer_notice")}))}g["default"]=a}),98);
__d("WAWebVoipValidateAndDecryptEncJob",["invariant","WACryptoPkcs7","WAFilteredCatch","WAJids","WALogger","WANullthrows","WAWebAdvSignatureApi","WAWebBackendJobs.flow","WAWebHandleMsgTypes.flow","WAWebProtobufsE2E.pb","WAWebSignal","WAWebSignalCommonErrors","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g,h){function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:validateAndDecryptEnc error"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:validateAndDecryptEnc: successfully validated ADV device-identity"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:validateAndDecryptEnc: expected device-identity with pkmsg enc"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:decryptSignalProto failed with unexpected error; ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:decryptSignalProto failed with decryption error; ",""]);m=function(){return a};return a}function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e,f=b.payload[2]&&b.payload[2].find(function(a){return a[0]==="enc"});a=a.peer_jid;if(!f||!a)return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS};var g=0;((e=f[1])==null?void 0:e.count)&&(g=parseInt(f[1].count,10)||0);e={e2eType:f[1].type,ciphertext:new Uint8Array(f[2]),retryCount:g,encMediaType:null,hideFail:!1};try{b=b.payload[2].find(function(a){return a[0]==="device-identity"});if(a.device!=null&&a.device!==d("WAJids").DEFAULT_DEVICE_ID&&e.e2eType===d("WAWebBackendJobs.flow").CiphertextType.Pkmsg&&!b){d("WALogger").LOG(k());return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR}}if(b){b=new Uint8Array(b[2]);b=(yield d("WAWebAdvSignatureApi").validateADVwithEncs(a,b,[e]));if(!b)return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR};d("WALogger").LOG(j())}b=(yield o(e,a));e=b.result;a=b.decrypted;e===d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS&&(f[2]=Array.prototype.slice.call(new Uint8Array(c("WANullthrows")(a))));return{result:e,retryCount:g}}catch(a){d("WALogger").WARN(i()).devConsole(a);return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR}}});return n.apply(this,arguments)}function o(a,b){a.e2eType!==d("WAWebBackendJobs.flow").CiphertextType.Skmsg||h(0,56543);return d("WAWebSignal").Cipher.decryptSignalProto(b,a.e2eType,a.ciphertext).then(function(a){var b;a=d("WACryptoPkcs7").unpadPkcs7(new Uint8Array(a));a=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").MessageSpec,a);return((b=a.call)==null?void 0:b.callKey)?{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS,decrypted:a.call.callKey}:{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR}})["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebSignalCommonErrors").SignalDecryptionError,function(a){d("WALogger").WARN(m(),a);return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY}}))["catch"](function(a){d("WALogger").WARN(l(),a);return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR}})}g["default"]=a}),98);
__d("WAWebIncomingVoipHandlerAction",["Promise","WALogger","WAResolvable","WAWebCallCollection","WAWebHandleMsgTypes.flow","WAWebSignalStoreApi","WAWebVoip","WAWebVoipGkUtils","WAWebVoipSignalingEnums","WAWebVoipValidateAndDecryptEncJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:rejectCallWithReasonEnc max retry reached, uploading fieldstats"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handleIncomingCallOffer ending call because of enc parse error"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handleIncomingCallOffer reject call because of enc retry"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:incoming: Ignoring call offer since group calling is disabled"]);l=function(){return a};return a}function m(a,b,d){var e=a.call_id;c("WAWebCallCollection").processIncomingCall(e,a.peer_jid,{isVideo:a.isVideoCall,canHandleLocally:d!=null?d:!1,offerTime:a.t});d===!1&&c("WAWebCallCollection").cleanupPendingOffer(e);c("WAWebVoip").Voip.handleIncomingSignalingMessage(a,b)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;b===void 0&&(b=0);var f=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo());if(!f)throw c("err")("No registration info found");f=f.registrationId;b=b+1;c("WAWebVoip").Voip.rejectCallWithoutCallCtx(a.call_id,(e=a.peer_jid)==null?void 0:e.toString({legacy:!0}),(e=a.call_creator)==null?void 0:e.toString({legacy:!0}),d("WAWebVoipSignalingEnums").ENC_RETRY_RECEIPT_ATTRS.SINGLE_PARTICIPANT,b,f);e=5;b===e&&(d("WALogger").LOG(i()),c("WAWebVoip").Voip.processMissedIncomingCallMaxRetry(a))});return o.apply(this,arguments)}function p(a){return a?c("WAWebVoipGkUtils").isVideoCallEnabled():c("WAWebVoipGkUtils").isVoiceCallEnabled()}function a(a,e){c("WAWebCallCollection").processIncomingCall(a.call_id,a.peer_jid,{isVideo:a.isVideoCall,canHandleLocally:a.isVideoCall?c("WAWebVoipGkUtils").isVideoCallEnabled():c("WAWebVoipGkUtils").isVoiceCallEnabled(),offerTime:a.t,isSilenced:a.isSilenced,offerReceivedWhileOffline:a.is_offline,groupWid:a.group_jid});if(!p(a.isVideoCall)){c("WAWebVoip").Voip.handleIncomingSignalingMessage(a,e);return}var f=a.call_id;c("WAWebCallCollection").pendingOffers[f]=new(d("WAResolvable").Resolvable)();c("WAWebCallCollection").pendingOffers[f].resolve((h||(h=b("Promise"))).all([c("WAWebVoipValidateAndDecryptEncJob")(a,e),c("WAWebVoip").Voip.getNumParticipantsFromCallOffer(e)]).then(function(b){var g=b[0],h=g.result;g=g.retryCount;b=b[1];var i=!0;b>0&&(d("WALogger").ERROR(l()),i=!1);a.isVideoCall?i=i&&c("WAWebVoipGkUtils").isVideoCallEnabled():i=i&&c("WAWebVoipGkUtils").isVoiceCallEnabled();switch(h){case d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS:m(a,e,i);break;case d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY:d("WALogger").LOG(k());n(a,g);break;case d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR:d("WALogger").LOG(j());c("WAWebVoip").Voip.endCall(f);break;default:throw c("err")("invalid e2e result type")}})["finally"](function(){delete c("WAWebCallCollection").pendingOffers[f]}))}function e(a,b){c("WAWebVoip").Voip.handleIncomingSignalingMessage(a,b)}function f(a,d){return(h||(h=b("Promise"))).reject(c("err")("incoming enc rekey is not expected in web"))}g.handleIncomingCallOffer=a;g.handleIncomingSignalingMsg=e;g.handleIncomingEncRekey=f}),98);
__d("WAWebNotificationState",["$InternalEnum","WALogger","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDoNotDisturb failed with error ",""]);h=function(){return a};return a}var i=b("$InternalEnum").Mirrored(["UNKNOWN","SESSION_SCREEN_IS_LOCKED","SESSION_ON_CONSOLE_KEY","QUNS_NOT_PRESENT","QUNS_BUSY","QUNS_RUNNING_D3D_FULL_SCREEN","QUNS_PRESENTATION_MODE","QUNS_ACCEPTS_NOTIFICATIONS","QUNS_QUIET_TIME","QUNS_APP","UNKNOWN_ERROR"]);function a(){try{if(c("gkx")("26254"))return!1;if(process.platform==="darwin"){var a;return((a=window.Native.MacOSNotificationState)==null?void 0:a.getDoNotDisturb())||((a=window.Native.MacOSNotificationState)==null?void 0:a.getNotificationState())===i.SESSION_SCREEN_IS_LOCKED}}catch(a){d("WALogger").WARN(h(),a)}return!1}g.getDoNotDisturb=a}),98);
__d("WAWebVoipMainWindowStateModel",["WAWebBaseModel","gkx"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.isFocused=d("WAWebBaseModel").session(!0),b)||babelHelpers.assertThisInitialized(c)}var e=b.prototype;e.initialize=function(){a.prototype.initialize.call(this);this.$MainWindowState1=this.$MainWindowState1.bind(this);this.$MainWindowState2=this.$MainWindowState2.bind(this);if(c("gkx")("26255")){var b;(b=window.Native)==null?void 0:b.addListener("BrowserWindow:focus",this.$MainWindowState1);(b=window.Native)==null?void 0:b.addListener("BrowserWindow:blur",this.$MainWindowState2)}};e["delete"]=function(){if(c("gkx")("26255")){var b;(b=window.Native)==null?void 0:b.removeListener("BrowserWindow:focus",this.$MainWindowState1);(b=window.Native)==null?void 0:b.removeListener("BrowserWindow:blur",this.$MainWindowState2)}a.prototype["delete"].call(this)};e.$MainWindowState1=function(){this.isFocused=!0};e.$MainWindowState2=function(){this.isFocused=!1};return b}(d("WAWebBaseModel").BaseModel);a.Proxy="mainWindowState";b=d("WAWebBaseModel").defineModel(a);e=new b();g["default"]=e}),98);
__d("WAWebVoipSendGroupCallRekeyRetryReceiptJob",["WADeprecatedSendIq","WAWap","WAWebCommsWapMd","WAWebSignalStoreApi","WAWebVoipSignalingEnums","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e===void 0&&(e=0);var f=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo());if(!f)throw c("err")("No registration info found");a=d("WAWap").wap("receipt",{to:d("WAWebCommsWapMd").DEVICE_JID(b.peer_jid),id:d("WAWap").CUSTOM_STRING(a),type:d("WAWap").CUSTOM_STRING(d("WAWebVoipSignalingEnums").ENC_RETRY_RECEIPT_ATTRS.GROUP_CALL)},d("WAWap").wap("enc_rekey",{"call-creator":d("WAWebCommsWapMd").DEVICE_JID(b.call_creator),"call-id":d("WAWap").CUSTOM_STRING(b.call_id),count:d("WAWap").INT(e+1)}),d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(f.registrationId)));d("WADeprecatedSendIq").deprecatedCastStanza(a)});return h.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleVoipCall",["Promise","WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebCommsWapMd","WAWebConstantsDeprecated","WAWebHandleVoipOfferNotice","WAWebIncomingVoipHandlerAction","WAWebJidToWid","WAWebNotificationState","WAWebUpdateLidMetadataJob","WAWebUserPrefsMeUser","WAWebVoipMainWindowStateModel","WAWebVoipSendGroupCallRekeyRetryReceiptJob","WAWebVoipSignalingEnums","WAWebWidFactory","asyncToGeneratorRuntime","cr:4266","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleCall: ignoring incoming call offer because one of audio devices not detected"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleCall: ignoring incoming call offer because do not disturb mode is enabled or screen is locked"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);l=function(){return a};return a}function m(a){return d("WAWebVoipSignalingEnums").TYPE[a.tag().toUpperCase()]||d("WAWebVoipSignalingEnums").TYPE.NONE}var n=new(c("WADeprecatedWapParser"))("callParser",function(a){a.assertTag("call");var b=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),e=a.mapFirstChild(function(a){return a});if(e){var f=e.attrString("call-id"),g=d("WAWebJidToWid").jidWithTypeToWid(e.attrJidWithType("call-creator")),h=e.hasAttr("group-jid")?d("WAWebJidToWid").jidWithTypeToWid(e.attrJidWithType("group-jid")):null,i=e.hasAttr("caller_pn")?d("WAWebJidToWid").jidWithTypeToWid(e.attrJidWithType("caller_pn")):null;i={call_id:f,call_creator:g,caller_pn:i,peer_jid:b,peer_platform:a.hasAttr("platform")?a.attrString("platform"):void 0,peer_app_version:a.hasAttr("version")?a.attrString("version"):void 0,epoch_msec:a.hasAttr("t")?String(a.attrInt("t")*1e3):void 0,elapsed_msec:a.hasAttr("e")?String(a.attrInt("e")*1e3):void 0,is_offline:a.hasAttr("offline"),type:m(e),common:{call_id:f,peer_jid:b.toString(),type:String(m(e))},group_jid:h,isVideoCall:e.hasChild("video"),isSilenced:e.hasChild("silence"),t:a.attrTime("t")};return{from:d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),stanzaId:a.attrString("id"),payloadTag:e.tag(),message:i,callCreator:g}}throw c("err")("Unrecognized call stanza")});function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=n.parse(a);if(e.error){d("WALogger").DEV(l(),a.toString());d("WALogger").ERROR(k(),e.error.toString());return(h||(h=b("Promise"))).resolve("NO_ACK")}e=e.success;var f=e.callCreator,g=e.from,m=e.message,o=e.payloadTag,r=e.stanzaId;e=d("WAWebCommsWapMd").wapNodeToVoipXml(a);e={elapsed_msec:m.elapsed_msec,epoch_msec:m.epoch_msec,is_offline:m.is_offline,payload:e[2][0],peer_app_version:m.peer_app_version,peer_platform:m.peer_platform,peer_jid:m.peer_jid?m.peer_jid.toString({legacy:!0}):void 0};var s=m.caller_pn;f.isLid()&&s!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:d("WAWebWidFactory").toUserWid(f),pn:d("WAWebWidFactory").toUserWid(s)}],!Boolean(e.is_offline)));var t=m.call_id;switch(m.type){case d("WAWebVoipSignalingEnums").TYPE.OFFER:p(g,r,t,f,m.type);d("WAWebNotificationState").getDoNotDisturb()&&!c("WAWebVoipMainWindowStateModel").isFocused?d("WALogger").LOG(j()).color(c("WAWebConstantsDeprecated").VOIP_LOG_COLOR):b("cr:4266")!=null&&(b("cr:4266").isMicrophoneAvailable!==!0||b("cr:4266").isSpeakerAvailable!==!0)?d("WALogger").LOG(i()).color(c("WAWebConstantsDeprecated").VOIP_LOG_COLOR):d("WAWebIncomingVoipHandlerAction").handleIncomingCallOffer(m,e);return(h||(h=b("Promise"))).resolve("NO_ACK");case d("WAWebVoipSignalingEnums").TYPE.ENC_REKEY:d("WAWebIncomingVoipHandlerAction").handleIncomingEncRekey(m,e).then(function(a){var b=a.shouldRetry;a=a.retryCount;b?c("WAWebVoipSendGroupCallRekeyRetryReceiptJob")(r,m,a):p(g,r,t,f,d("WAWebVoipSignalingEnums").TYPE.ENC_REKEY)});return(h||(h=b("Promise"))).resolve("NO_ACK");case d("WAWebVoipSignalingEnums").TYPE.ACCEPT:case d("WAWebVoipSignalingEnums").TYPE.REJECT:p(g,r,t,f,m.type);d("WAWebIncomingVoipHandlerAction").handleIncomingSignalingMsg(m,e);return(h||(h=b("Promise"))).resolve("NO_ACK");case d("WAWebVoipSignalingEnums").TYPE.OFFER_NOTICE:return c("WAWebHandleVoipOfferNotice")(a);default:d("WAWebIncomingVoipHandlerAction").handleIncomingSignalingMsg(m,e);return(h||(h=b("Promise"))).resolve(q(g,r,o))}});return o.apply(this,arguments)}function p(a,b,c,e,f){var g;switch(f){case d("WAWebVoipSignalingEnums").TYPE.OFFER:g=d("WAWap").wap("offer",{"call-id":d("WAWap").CUSTOM_STRING(c),"call-creator":d("WAWebCommsWapMd").JID(e)});break;case d("WAWebVoipSignalingEnums").TYPE.ENC_REKEY:g=d("WAWap").wap("enc_rekey",{"call-id":d("WAWap").CUSTOM_STRING(c),"call-creator":d("WAWebCommsWapMd").JID(e)});break;case d("WAWebVoipSignalingEnums").TYPE.ACCEPT:g=d("WAWap").wap("accept",{"call-id":d("WAWap").CUSTOM_STRING(c),"call-creator":d("WAWebCommsWapMd").JID(e)});break;case d("WAWebVoipSignalingEnums").TYPE.REJECT:g=d("WAWap").wap("reject",{"call-id":d("WAWap").CUSTOM_STRING(c),"call-creator":d("WAWebCommsWapMd").JID(e)});break}d("WADeprecatedSendIq").deprecatedCastStanza(d("WAWap").wap("receipt",{to:d("WAWebCommsWapMd").JID(a),id:d("WAWap").CUSTOM_STRING(b),from:a.isLid()?d("WAWebCommsWapMd").JID(d("WAWebUserPrefsMeUser").getMaybeMeLidUser()):d("WAWebCommsWapMd").JID(d("WAWebUserPrefsMeUser").getMaybeMeUser())},g))}function q(a,b,c){return d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").JID(a),id:d("WAWap").CUSTOM_STRING(b),"class":"call",type:d("WAWap").MAYBE_CUSTOM_STRING(c)})}g.handleCall=a}),98);
__d("WAWebHandleVoipEncRekeyRetryRequest",["WADeprecatedWapParser","WALogger","WANullthrows","WAWap","WAWebCommsWapMd","WAWebHandleRetryRequest","WAWebJidToWid","WAWebVoip","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handle_enc_rekey_retry_receipt: error while attempting to send enc_rekey retry"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handle_enc_rekey_retry_receipt: not sending enc_rekey retry"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("rekeyRetryReceiptParser",function(a){a.assertTag("receipt");a.assertAttr("type","enc_rekey_retry");var b=a.child("enc_rekey");return{from:d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),originalMsgId:b.attrString("call-id"),stanzaId:a.attrString("id"),retryCount:b.hasAttr("count")?b.attrInt("count"):0,regId:a.child("registration").contentUint(4),ts:null,participant:null,recipient:null,keyBundle:null,offline:!1}});function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=l.parse(a);if(b.error){d("WALogger").DEV(k(),a.toString());d("WALogger").ERROR(j(),b.error.toString());throw b.error}a=b.success;b=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(c("WANullthrows")(a.stanzaId)),to:d("WAWebCommsWapMd").JID(a.from),"class":"receipt",type:"enc_rekey_retry"});try{var e=(yield d("WAWebHandleRetryRequest").handleVoipRetryRequest(a));e?c("WAWebVoip").Voip.resendEncRekeyRetry(a.from.toString({legacy:!0,formatFull:!0}),a.retryCount):(d("WALogger").WARN(i()),c("WAWebVoip").Voip.endCall(a.originalMsgId));return b}catch(a){d("WALogger").WARN(h());return b}});return m.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleWaChat",["Promise","WAByteArray","WADeprecatedWapParser","WAJids","WALogger","WAWap","WAWebBackendJobs.flow","WAWebCommsWapMd","WAWebDBMessageDelete","WAWebHandleMsgProcess","WAWebHandleMsgTypes.flow","WAWebMsgCollection","WAWebMsgKey","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["WA Chat notification received, node: ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("incomingWAChatNotificationParser",function(a){a.assertTag("notification");a.assertAttr("from",d("WAJids").PSA_JID);var b=a.attrString("id"),e=a.attrTime("t");if(a.hasChild("messages")){var f=a.child("messages"),g=f.attrString("campaign_id");f=f.mapChildrenWithTag("message",function(a){var b=a.attrString("id");if(a.hasAttr("type")){var c=a.attrString("type");c=c==="text"?a:a.child("media")}else c=a;a={id:b,body:d("WAByteArray").uint8ArrayToBuffer(c.contentBytes())};return a});return{type:"messages",stanzaId:b,ts:e,campaignId:g,messages:f}}g=a.child("revoke");g.attrString("campaign_id");f=g.mapChildrenWithTag("message",function(a){a=new(c("WAWebMsgKey"))({fromMe:!1,remote:d("WAWebWidFactory").createWid(d("WAJids").PSA_JID),id:a.attrString("id")});return a.toString()});return{type:"revoke",stanzaId:b,ts:e,revokeMessageIds:f}});function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.campaignId;a=a.ts;var e=b.id;b=b.body;var f=d("WAWebWidFactory").createWid(d("WAJids").PSA_JID);e={type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_STATUS,externalId:e,ts:a,edit:-1,isHsm:!1,count:null,chat:f,author:f,pushname:null,isDirect:!1,campaignId:c};a={retryCount:0,e2eType:d("WAWebBackendJobs.flow").CiphertextType.Msg,encMediaType:d("WAWebBackendJobs.flow").EncMediaType.Image,hideFail:!1};f={nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null,campaignId:null};yield d("WAWebHandleMsgProcess").processDecryptedMessageProto({decrypted:b,info:e,e2eInfo:a,bizInfo:f,hsmInfo:null,isPadded:!1})});return n.apply(this,arguments)}function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(k(),a);var c=l.parse(a);if(c.error){d("WALogger").LOG(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());throw c.error}var e=c.success;a=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e.stanzaId),"class":"notification",type:"psa",to:d("WAWebCommsWapMd").JID(d("WAWebWidFactory").createWid(d("WAJids").PSA_JID))});switch(e.type){case"revoke":c=e.revokeMessageIds;c.length>0&&(yield d("WAWebDBMessageDelete").removeMessagesFromHistory(c),c.forEach(function(a){a=d("WAWebMsgCollection").MsgCollection.get(a);a&&a["delete"]()}));break;default:e.type;yield (h||(h=b("Promise"))).all(e.messages.map(function(a){return m(e,a)}));break}return a});return o.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebPaymentNotificationHandler",["WALogger","WANullthrows","WAWap","WAWebCommonMsgSubtypeTypes","WAWebDBMsgUtils","WAWebHandleSingleMsg","WAWebMessageStore","WAWebMessagingGatingUtils","WAWebMsgCollection","WAWebMsgKey","WAWebMsgModel","WAWebMsgType","WAWebPaymentNotificationParser","WAWebPaymentStatusUtils","WAWebSchemaOrphanPaymentNotification","WAWebStateUtils","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getOrphanPaymentNotificationTable.bulkRemove: failed for: ",", error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePaymentTransactionNotification: no msg found for id: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePaymentNotification: failed: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["createPaymentNotificationAck: invalid notification, stanzaId:",", from:",""]);k=function(){return a};return a}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAWebPaymentNotificationParser").paymentNotificationParser.parse(a);if(a.error!=null){d("WALogger").WARN(j(),a.error);throw a.error}var b=a.success,c=b.transaction;b=b.invite;b!=null?yield o(b):c!=null&&(yield m(c));if(d("WAWebMessagingGatingUtils").isPaymentNotificationAckKickFixEnabled())return x(a.success)});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=c("WANullthrows")(a.msgKey),e=d("WAWebMsgCollection").MsgCollection.get(b);e=e?d("WAWebStateUtils").unproxy(e):yield d("WAWebDBMsgUtils").getMsgByMsgKey(b);if(!e){d("WALogger").WARN(i(),b);b=babelHelpers["extends"]({},a,{msgKey:b.toString()});yield d("WAWebSchemaOrphanPaymentNotification").getTable().createOrReplace(b);return}yield q(e,a)});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.type!=="account-set-up")return;a=(yield v(a.from,a.timestamp));yield d("WAWebHandleSingleMsg").handleSingleMsg(a.from,a)});return p.apply(this,arguments)}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=[];s(a,b);c.push(a.id.toString());b=[a instanceof d("WAWebMsgModel").Msg?a.toJSON():a];if(a.paymentRequestMessageKey!=null){var e=d("WAWebMsgCollection").MsgCollection.get(a.paymentRequestMessageKey);e=e?d("WAWebStateUtils").unproxy(e):yield d("WAWebDBMsgUtils").getMsgByMsgKey(a.paymentRequestMessageKey||"");e&&(e.paymentStatus=a.paymentStatus,e.paymentTxnStatus=d("WAWebPaymentStatusUtils").determinePaymentRequestFulfilledStatus(a.paymentTxnStatus),b.push(e instanceof d("WAWebMsgModel").Msg?e.toJSON():e))}d("WAWebSchemaOrphanPaymentNotification").getTable().bulkRemove(c)["catch"](function(a){d("WALogger").ERROR(h(),c,a)});yield d("WAWebMessageStore").updateExistingMessages(b)});return r.apply(this,arguments)}function s(a,b){b&&(b.status!=null&&(a.paymentStatus=d("WAWebPaymentStatusUtils").getPaymentWebStatus(b.status,b.type),a.paymentTxnStatus=d("WAWebPaymentStatusUtils").getPaymentTxnWebStatus(b.status)),a.paymentCurrency=b.currency||"",a.paymentAmount1000=c("WANullthrows")(b.amount1000),a.paymentMessageReceiverJid=b.receiver,a.paymentTransactionTimestamp=c("WANullthrows")(b.ts))}function e(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.map(function(a){return a.id.toString()});b=(yield d("WAWebSchemaOrphanPaymentNotification").getTable().bulkGet(b));var e=new Map();a.forEach(function(a){e.set(a.id.toString(),a)});b.forEach(function(a){if(a){var b=e.get(a.msgKey);if(!b)return;void q(b,{receiver:a.receiver,currency:a.currency,amount1000:a.amount1000,type:a.type,status:a.status,ts:a.ts,msgKey:c("WAWebMsgKey").fromString(a.msgKey)})}})});return t.apply(this,arguments)}function f(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaOrphanPaymentNotification").getTable().all()),b=new Map(),e=[];a.forEach(function(a){var f=d("WAWebMsgCollection").MsgCollection.get(a.msgKey);f?void q(f,{receiver:a.receiver,currency:a.currency,amount1000:a.amount1000,type:a.type,status:a.status,ts:a.ts,msgKey:c("WAWebMsgKey").fromString(a.msgKey)}):(b.set(a.msgKey,a),e.push(a.msgKey))});if(e.length>0){a=(yield d("WAWebDBMsgUtils").getMsgsByMsgKey(e,function(a){var e=b.get(a.id.toString());e&&(a.paymentTxnStatus=d("WAWebPaymentStatusUtils").getPaymentTxnWebStatus(e.status),a.paymentCurrency=e.currency||"",a.paymentAmount1000=c("WANullthrows")(e.amount1000),a.paymentMessageReceiverJid=e.receiver,a.paymentTransactionTimestamp=c("WANullthrows")(e.ts))}));return d("WAWebMessageStore").updateExistingMessages(a)}});return u.apply(this,arguments)}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return{id:new(c("WAWebMsgKey"))({remote:a,fromMe:!1,id:yield c("WAWebMsgKey").newId()}),type:d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,kind:d("WAWebMsgType").MsgKind.NotificationTemplate,subtype:d("WAWebCommonMsgSubtypeTypes").MsgSubtype.PaymentInviteAccountSetUp,from:a,to:d("WAWebUserPrefsMeUser").getMeUser(),recipients:[],t:b,templateParams:[a]}});return w.apply(this,arguments)}function x(a){var b=a.stanzaId;a=a.from;if(b==null||a==null){d("WALogger").WARN(k(),b,a).sendLogs("payment-notifications-missing-stanza-id-or-from");return null}return d("WAWap").wap("ack",{"class":"notification",type:"pay",id:d("WAWap").CUSTOM_STRING(b),to:a})}g.handlePaymentNotification=a;g.processOrphanPaymentNotifications=e;g.processAllOrphanPaymentNotifications=f}),98);
__d("WAWebCommsHandleStanza",["WABackendHandleError","WACreateHandleChatState","WAHandleDecisionTreeResult","WAJids","WALogger","WAParsableWapNode","WAWap","WAWebABProps","WAWebAltDeviceLinkingHandleNotification","WAWebCommsHandleWorkerCompatibleStanza","WAWebCreateNackFromStanza","WAWebHandleAboutNotification","WAWebHandleAccountSyncNotification","WAWebHandleAppdata","WAWebHandleBusinessNotification","WAWebHandleChatState","WAWebHandleContactNotification","WAWebHandleDeviceNotification","WAWebHandleDeviceSwitchingNotification","WAWebHandleDigestKey","WAWebHandleDisappearingModeNotification","WAWebHandleFailure","WAWebHandleGrowthNotification","WAWebHandleInfoBulletin","WAWebHandleMediaRetryNotification","WAWebHandleMexNotification","WAWebHandleNewsletterNotification","WAWebHandlePairDevice","WAWebHandlePairSuccess","WAWebHandlePreKeyLow","WAWebHandlePresence","WAWebHandlePrivacyTokensNotification","WAWebHandleProfilePicNotification","WAWebHandlePsa","WAWebHandleQPSurfacesNotification","WAWebHandleRetryRequest","WAWebHandleServerNotification","WAWebHandleServerSyncNotification","WAWebHandleStreamError","WAWebHandleSuccess","WAWebHandleUsernameChangeNotification","WAWebHandleVoipCall","WAWebHandleVoipEncRekeyRetryRequest","WAWebHandleWaChat","WAWebOfflineHandler","WAWebPaymentNotificationHandler","WAWebPostUnknownStanzaMetric","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[handleStanza] ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[handleStanza] exception for tag:"," type:"," id:",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms.handleStanza unrecognized stanza ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms.handleStanza received xmlstreamend, return NO_ACK"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms.handleStanza unrecognized notification stanza ",""]);l=function(){return a};return a}var m=d("WACreateHandleChatState").createHandleChatState({groupMessage:{handleGroupChatState:d("WAWebHandleChatState").handleGroupChatState},individualMessage:{handleIndividualChatState:d("WAWebHandleChatState").handleIndividualChatState}});function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=a.attrs;if(f.offline){var g=parseInt(f.t,10),h=parseInt(f.offline,10);d("WAWebOfflineHandler").OfflineMessageHandler.newOfflineStanza(g,e,h)}g=d("WAWebCommsHandleWorkerCompatibleStanza").handleWorkerCompatibleStanza(a);if(g!=null)return g;switch(a.tag){case"iq":return q(a);case"receipt":try{if(f.type==="retry")return yield d("WAWebHandleRetryRequest").handleMessageRetryRequest(a);else if(f.type==="enc_rekey_retry")return yield c("WAWebHandleVoipEncRekeyRetryRequest")(a);break}catch(b){if(b instanceof d("WAParsableWapNode").XmppParsingFailure){d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.ParsingError)}return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnhandledError)}case"notification":try{switch(f.type){case"server_sync":return yield d("WAWebHandleServerSyncNotification").handleServerSyncNotification(a);case"picture":return yield d("WAWebHandleProfilePicNotification").handleProfilePicNotificationJob(a);case"business":return yield d("WAWebHandleBusinessNotification").handleBusinessNotificationJob(a);case"contacts":e=a.content;if(!Array.isArray(e)||!e.length)break;h=e[0].tag;return h==="invite"?yield c("WAWebHandleGrowthNotification")(a):yield c("WAWebHandleContactNotification")(a);case"devices":return yield d("WAWebHandleDeviceNotification").handleDevicesNotification(a);case"disappearing_mode":return yield d("WAWebHandleDisappearingModeNotification").handleDisappearingModeNotificationJob(a);case"mediaretry":g=(yield c("WAWebHandleMediaRetryNotification")(a));return g;case"encrypt":e=a.content;if(!Array.isArray(e)||!e.length)break;h=e[0].tag;switch(h){case"count":return yield c("WAWebHandlePreKeyLow")(a,b);case"digest":return yield c("WAWebHandleDigestKey")(a)}break;case"server":return yield d("WAWebHandleServerNotification").handleServerNotification(a);case"status":return yield d("WAWebHandleAboutNotification").handleAboutNotification(a);case"account_sync":return yield d("WAWebHandleAccountSyncNotification").handleAccountSyncNotification(a);case"pay":return yield d("WAWebPaymentNotificationHandler").handlePaymentNotification(a);case"psa":if(f.from!=null&&f.from.toString()===d("WAJids").PSA_JID){g=a.content;if(!Array.isArray(g)||!g.length)break;e=g[0].tag;if(e==="surfaces")return yield d("WAWebHandleQPSurfacesNotification").handleQPSurfacesNotification(a);if(d("WAWebABProps").getABPropConfigValue("enable_client_chat_psa"))return yield c("WAWebHandleWaChat")(a);break}return yield c("WAWebHandlePsa")(a);case"privacy_token":return yield c("WAWebHandlePrivacyTokensNotification")(a);case"link_code_companion_reg":return yield d("WAWebAltDeviceLinkingHandleNotification").handleAltDeviceLinkingNotification(a);case"newsletter":return yield c("WAWebHandleNewsletterNotification")(a);case"w:growth":return yield c("WAWebHandleGrowthNotification")(a);case"registration":return yield c("WAWebHandleDeviceSwitchingNotification")(a);case"mex":return yield d("WAWebHandleMexNotification").handleMexNotification(a);case"username":return yield d("WAWebHandleUsernameChangeNotification").handleUsernameChangeNotification(a)}}catch(b){if(b instanceof d("WAParsableWapNode").XmppParsingFailure){d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.ParsingError)}return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnhandledError)}d("WALogger").DEV_XMPP(l(),a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnrecognizedStanza);case"chatstate":return d("WAHandleDecisionTreeResult").handleDecisionTreeResult(a,m(a));case"presence":return c("WAWebHandlePresence")(a);case"ib":return c("WAWebHandleInfoBulletin")(a);case"stream:error":return c("WAWebHandleStreamError")(a);case"failure":return c("WAWebHandleFailure")(a);case"success":return c("WAWebHandleSuccess")(a);case"call":return d("WAWebHandleVoipCall").handleCall(a);case"appdata":if(d("WAWebABProps").getABPropConfigValue("use_appdata_stanza_on_receiver"))return c("WAWebHandleAppdata")(a);break;case"error":return d("WABackendHandleError").handleError(a);case"xmlstreamend":d("WALogger").LOG(k());return"NO_ACK"}d("WALogger").DEV_XMPP(j(),a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnrecognizedStanza)});return o.apply(this,arguments)}function a(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c===void 0&&(c=0);try{b=(yield n(a,b,c));if(b!=null)return b}catch(e){d("WALogger").LOG(i(),a.tag,(c=a.attrs)==null?void 0:c.type,(b=a.attrs)==null?void 0:b.id);d("WALogger").ERROR(h(),e.stack).sendLogs("handle-stanza")}return"NO_ACK"});return p.apply(this,arguments)}function q(a){var b=a.attrs,e=a.content;if(b.xmlns==="urn:xmpp:ping")return d("WAWap").wap("iq",{type:"result",to:b.from});else if(b.xmlns==="md"){if(!Array.isArray(e)||!e.length)return;b=e[0].tag;switch(b){case"pair-device":return c("WAWebHandlePairDevice")(a);case"pair-success":return c("WAWebHandlePairSuccess")(a)}}else throw c("err")("handleIq unrecognized "+a.toString())}g["default"]=a}),98);
__d("WAWebHandleStreamError",["Promise","WAComms","WADeprecatedWapParser","WALogger","WAWebCmd","WAWebCompanionRegUtils","WAWebJestE2ELogUtils","WAWebSocketModel","WAWebStartBackend","WAWebUserPrefsTabMutex","WAWebWamDeviceLinkReporter","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleStreamError: sent xml not well formed, closing the socket:"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleStreamError: sent xml not well formed, closing the socket"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleStreamError: session replaced while we have a mutex, closing the socket"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["stream error due to device removed, logging out"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unrecognized stream:error: ",""]);o=function(){return a};return a}var p=new(c("WADeprecatedWapParser"))("streamErrorParser",function(a){a.assertTag("stream:error");if(a.hasChild("conflict")){var b=a.child("conflict");b=b.attrString("type");switch(b){case"replaced":return{type:"replaced"};case"device_removed":default:return{type:"device_removed"}}}else if(a.hasAttr("code"))return{type:"code",code:a.attrInt("code")};else if(a.hasChild("ack"))return{type:"ack",id:a.child("ack").hasAttr("id")?a.child("ack").attrString("id"):null};else if(a.hasChild("xml-not-well-formed"))return{type:"xml-not-well-formed"};else{d("WALogger").WARN(o(),a.toString());return{type:"other"}}});function a(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=p.parse(a);if(e.error){d("WALogger").DEV(n(),a.toString());d("WALogger").ERROR(m(),e.error.toString());return(h||(h=b("Promise"))).reject(e.error)}e=e.success;if(e.type==="code"&&e.code>=500&&e.code<600){if(e.code===515){d("WAComms").stopComms();yield d("WAWebCompanionRegUtils").startLogin();void d("WAWebStartBackend").startBackend();return(h||(h=b("Promise"))).resolve("NO_ACK")}else if(e.code===516){d("WAComms").stopComms();yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent(516);yield d("WAWebCompanionRegUtils").startLogout();void d("WAWebStartBackend").startBackend();return(h||(h=b("Promise"))).resolve("NO_ACK")}d("WAComms").onStreamErrorReceived()}else if(e.type==="device_removed"){d("WAWebCmd").Cmd.onStartingLogout();d("WAComms").stopComms();yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData();d("WALogger").LOG(l());d("WAWebJestE2ELogUtils").maybeLogToJestE2eJSConsole("stream error due to device removed, logging out");d("WAWebCmd").Cmd.logout();return(h||(h=b("Promise"))).resolve("NO_ACK")}else if(e.type==="replaced"){d("WAWebUserPrefsTabMutex").currentTabHasMutex()&&d("WALogger").ERROR(k()).sendLogs("invalid-session-replacement",.1);d("WAComms").stopComms();return(h||(h=b("Promise"))).resolve("NO_ACK")}else e.type==="xml-not-well-formed"&&(c("gkx")("26258")?d("WALogger").WARN(j()):d("WALogger").WARN(i()).devConsole(a.toString()).sendLogs("sent-xml-not-well-formed"));return(h||(h=b("Promise"))).resolve("CLOSE_SOCKET")});return q.apply(this,arguments)}g["default"]=a}),98);